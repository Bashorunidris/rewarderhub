 <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="google-site-verification" content="2x_OSO7NN5KGwQBMnFkTutn_m4X7AzeLshBvqLVgFDI" />
    <title>Rewarder - Monetized Talent Competition</title>
    <style>
    :root {
        --primary-color: #6c5ce7;
        --primary-dark: #5549c0;
        --secondary-color: #fd79a8;
        --text-color: #2d3436;
        --light-text: #636e72;
        --background-color:  #1a1a2e;
        --white: #ffffff;
        --error-color: #e74c3c;
        --success-color: #2ecc71;
        --border-color: #dfe6e9;
        --box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
    }
    
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }
    
    body {
        font-family: 'Poppins', sans-serif;
        background-color: var(--background-color);
        color: var(--text-color);
        line-height: 1.6;
    }

    
 /* ========== MOBILE-RESPONSIVE OPENING PAGE - COMPLETELY FIXED ========== */
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');

.openpage {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100vh;
    z-index: 9999;
    background: radial-gradient(circle at 20% 80%, #1a1a2e 0%, #16213e 25%, #0f3460 50%, #1a1a2e 100%);
    transition: all 0.8s ease;
    overflow-y: auto;
    overflow-x: hidden;
    font-family: 'Inter', sans-serif;
    -webkit-overflow-scrolling: touch; /* Smooth scrolling on mobile */
}

.openpage.ultra-mode {
    background: radial-gradient(circle at 20% 80%, #000000 0%, #1a0033 25%, #330066 50%, #000000 100%);
}

.openpage::before {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: 
        radial-gradient(circle at 10% 20%, rgba(255, 215, 0, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 90% 80%, rgba(108, 92, 231, 0.15) 0%, transparent 50%),
        radial-gradient(circle at 50% 50%, rgba(253, 121, 168, 0.08) 0%, transparent 50%);
    pointer-events: none;
    z-index: -1;
}

.openpage.hidden {
    opacity: 0;
    visibility: hidden;
    pointer-events: none;
}

/* MOBILE-FIRST SCROLL PROGRESS */
.scroll-progress {
    position: fixed;
    top: 50%;
    right: 15px;
    transform: translateY(-50%);
    z-index: 10001;
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(10px);
    border-radius: 50px;
    padding: 15px 6px;
    border: 1px solid rgba(255, 255, 255, 0.2);
}

.progress-bar {
    width: 3px;
    height: 60px;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 2px;
    position: relative;
    overflow: hidden;
}

.progress-fill {
    width: 100%;
    height: 0%;
    background: linear-gradient(180deg, #ffd700, #6c5ce7, #fd79a8);
    border-radius: 2px;
    transition: height 0.3s ease;
}

.progress-badge {
    position: absolute;
    top: -8px;
    left: 50%;
    transform: translateX(-50%);
    background: linear-gradient(135deg, #ffd700, #6c5ce7);
    color: white;
    padding: 3px 6px;
    border-radius: 10px;
    font-size: 10px;
    font-weight: 600;
    white-space: nowrap;
}

/* MOBILE-OPTIMIZED HEADER */
.openpage-header {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 10000;
    background: rgba(26, 26, 46, 0.95);
    backdrop-filter: blur(20px);
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    padding: 1rem 1.5rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    transition: all 0.3s ease;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    min-height: 70px;
}

.openpage-logo-section {
    display: flex;
    align-items: center;
    gap: 1rem;
}

.openpage-logo {
    width: 45px;
    height: 45px;
    background: linear-gradient(135deg, #ffd700 0%, #ff6b6b 50%, #6c5ce7 100%);
    border-radius: 15px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.4rem;
    font-weight: 900;
    color: white;
    box-shadow: 0 10px 20px rgba(255, 215, 0, 0.3);
}

.openpage-app-name {
    font-size: 1.8rem;
    font-weight: 900;
    background: linear-gradient(135deg, #fff 0%, #ffd700 50%, #6c5ce7 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    letter-spacing: -1px;
}

.openpage-theme-toggle {
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 25px;
    padding: 0.6rem 1rem;
    color: #ffffff;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 0.9rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    white-space: nowrap;
}

.openpage-theme-toggle:hover {
    background: rgba(108, 92, 231, 0.2);
    transform: scale(1.05);
}

.openpage-container {
    width: 100%;
    min-height: 100vh;
    padding-bottom: 2rem;
    position: relative;
}

/* MOBILE-OPTIMIZED SLIDESHOW */
.openpage-slideshow {
    height: 100vh;
    position: relative;
    overflow: hidden;
    margin-top: 70px;
}

.openpage-slide {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, #1a1a2e 0%, #16213e 25%, #0f3460 50%, #1a1a2e 75%, #16213e 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: all 1.5s ease;
    transform: scale(1.1);
}

.openpage-slide.active {
    opacity: 1;
    transform: scale(1);
}

.openpage-slide-content {
    text-align: center;
    color: #ffffff;
    max-width: 90%;
    padding: 2rem 1rem;
    position: relative;
    z-index: 10;
}

.openpage-slide-title {
    font-size: 2.5rem;
    font-weight: 900;
    margin-bottom: 1.5rem;
    background: linear-gradient(135deg, #fff 0%, #ffd700 25%, #6c5ce7 50%, #fd79a8 75%, #fff 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    line-height: 1.2;
    letter-spacing: -1px;
}

.openpage-slide-caption {
    font-size: 1.2rem;
    font-weight: 400;
    opacity: 0.9;
    margin-bottom: 2rem;
    line-height: 1.5;
}

.openpage-slide-slogan {
    font-size: 1.8rem;
    font-weight: 800;
    background: linear-gradient(45deg, #ffd700 0%, #ff6b6b 25%, #6c5ce7 50%, #fd79a8 75%, #ffd700 100%);
    background-size: 400% 400%;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    animation: gradientShift 3s ease-in-out infinite;
    margin: 2rem 0;
    text-transform: uppercase;
    letter-spacing: 2px;
}

@keyframes gradientShift {
    0%, 100% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
}

.openpage-get-started {
    background: linear-gradient(135deg, #6c5ce7 0%, #fd79a8 50%, #ffd700 100%);
    color: #ffffff;
    padding: 1rem 2.5rem;
    border: none;
    border-radius: 30px;
    font-size: 1.1rem;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 10px 20px rgba(108, 92, 231, 0.4);
    margin-top: 2rem;
    text-transform: uppercase;
    letter-spacing: 1px;
}

.openpage-get-started:hover {
    transform: translateY(-3px) scale(1.05);
    box-shadow: 0 15px 30px rgba(108, 92, 231, 0.6);
}


/* Curved Gallery Sections */
.curved-gallery {
    padding: 2rem 1rem;
    margin: 2rem 0;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 25px;
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
    position: relative;
    overflow: hidden;
}

.curved-gallery::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(255, 255, 255, 0.05);
    pointer-events: none;
}

.gallery-header {
    text-align: center;
    margin-bottom: 2rem;
    position: relative;
    z-index: 2;
}

.gallery-title {
    font-size: 2.5rem;
    color: #ffffff;
    margin-bottom: 0.5rem;
    font-weight: 700;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
    letter-spacing: -0.02em;
}

.gallery-subtitle {
    font-size: 1.1rem;
    color: rgba(255, 255, 255, 0.9);
    margin: 0;
    font-weight: 300;
}

.curved-track {
    display: flex;
    gap: 1.5rem;
    overflow-x: auto;
    padding: 1rem 0;
    scroll-behavior: smooth;
    scrollbar-width: none;
    -ms-overflow-style: none;
}

.curved-track::-webkit-scrollbar {
    display: none;
}

.auto-scroll {
    animation: autoScroll 20s linear infinite;
}

@keyframes autoScroll {
    0% { transform: translateX(0); }
    100% { transform: translateX(-50%); }
}

.gallery-item,
.galleryonly-item {
    flex: 0 0 300px;
    background: rgba(255, 255, 255, 0.95);
    border-radius: 20px;
    overflow: hidden;
    box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
    transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    position: relative;
    backdrop-filter: blur(10px);
}

.gallery-item:hover,
.galleryonly-item:hover {
    transform: translateY(-10px) scale(1.02);
    box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
}

.gallery-item img,
.galleryonly-item img {
    width: 100%;
    height: 200px;
    object-fit: cover;
    transition: transform 0.4s ease;
}

.gallery-item:hover img,
.galleryonly-item:hover img {
    transform: scale(1.1);
}

.gallery-overlay {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    background: linear-gradient(transparent, rgba(0, 0, 0, 0.9));
    color: white;
    padding: 1.5rem;
    transform: translateY(100%);
    transition: transform 0.4s ease;
}

.gallery-item:hover .gallery-overlay {
    transform: translateY(0);
}

.gallery-caption {
    font-size: 1.2rem;
    font-weight: 600;
    margin-bottom: 0.5rem;
    color: #ffffff;
    padding: 0.5rem 0;
}

.gallery-description {
    font-size: 0.9rem;
    color: rgba(255, 255, 255, 0.8);
    margin-bottom: 0.5rem;
    line-height: 1.4;
}

.gallery-date,
.gallery-ticket {
    font-size: 0.8rem;
    padding: 0.3rem 0.8rem;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 15px;
    display: inline-block;
    margin: 0.2rem 0.2rem 0.2rem 0;
    backdrop-filter: blur(5px);
}

.gallery-contact {
    font-size: 0.8rem;
    color: #ffd700;
    margin-top: 0.5rem;
    font-weight: 500;
}

/* For galleryonly-item without overlay */
.galleryonly-item .gallery-caption,
.galleryonly-item .gallery-description {
    padding: 1rem;
    background: #ffffff;
    color: #333;
    margin: 0;
}

.galleryonly-item .gallery-caption {
    font-weight: 600;
    font-size: 1.1rem;
    border-bottom: 1px solid #eee;
}

.galleryonly-item .gallery-description {
    font-size: 0.9rem;
    color: #666;
}

/* Live Strip Section */
.live-strip {
    padding: 2rem 1rem;
    background: linear-gradient(45deg, #ff6b6b, #feca57);
    margin: 2rem 0;
    border-radius: 25px;
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
}

.strip-header {
    text-align: center;
    margin-bottom: 2rem;
}

.strip-title {
    font-size: 2.5rem;
    color: #ffffff;
    margin-bottom: 0.5rem;
    font-weight: 700;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
}

.strip-subtitle {
    font-size: 1rem;
    color: rgba(255, 255, 255, 0.9);
    margin: 0.5rem 0;
    font-weight: 400;
}

.photo-strip {
    display: flex;
    justify-content: center;
    gap: 1rem;
}

.strip-photo {
    position: relative;
    border-radius: 15px;
    overflow: hidden;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    transition: transform 0.3s ease;
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(10px);
}

.strip-photo:hover {
    transform: scale(1.05);
}

.strip-photo img {
    width: 100%;
    height: auto;
    display: block;
    min-height: 200px;
    object-fit: cover;
}

.photo-overlay {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    background: linear-gradient(transparent, rgba(0, 0, 0, 0.8));
    color: white;
    padding: 1rem;
    font-weight: 600;
    font-size: 1.1rem;
}

/* Mobile Responsiveness */
@media (max-width: 768px) {
    .curved-gallery,
    .live-strip {
        padding: 1.5rem 0.8rem;
        margin: 1rem 0;
        border-radius: 15px;
    }
    
    .gallery-title,
    .strip-title {
        font-size: 1.8rem;
    }
    
    .gallery-subtitle,
    .strip-subtitle {
        font-size: 0.9rem;
        padding: 0 1rem;
    }
    
    .curved-track {
        gap: 1rem;
        padding: 0.5rem;
    }
    
    .gallery-item,
    .galleryonly-item {
        flex: 0 0 250px;
        min-width: 250px;
    }
    
    .gallery-item img,
    .galleryonly-item img {
        height: 150px;
    }
    
    .gallery-overlay {
        padding: 1rem;
    }
    
    .gallery-caption {
        font-size: 1rem;
    }
    
    .gallery-description {
        font-size: 0.8rem;
    }
    
    .photo-strip {
        flex-direction: column;
        align-items: center;
    }
    
    .strip-photo {
        width: 100%;
        max-width: 300px;
    }
}

@media (max-width: 480px) {
    .curved-gallery,
    .live-strip {
        padding: 1rem 0.5rem;
        border-radius: 10px;
    }
    
    .gallery-title,
    .strip-title {
        font-size: 1.5rem;
    }
    
    .gallery-item,
    .galleryonly-item {
        flex: 0 0 200px;
        min-width: 200px;
    }
    
    .gallery-item img,
    .galleryonly-item img {
        height: 120px;
    }
    
    .gallery-overlay {
        padding: 0.8rem;
    }
    
    .gallery-caption {
        font-size: 0.9rem;
    }
    
    .gallery-description,
    .gallery-contact {
        font-size: 0.75rem;
    }
    
    .gallery-date,
    .gallery-ticket {
        font-size: 0.7rem;
        padding: 0.2rem 0.6rem;
    }
}

/* Animation for auto-scroll pause on hover */
.curved-track.auto-scroll:hover {
    animation-play-state: paused;
}

/* Smooth scrolling for touch devices */
.curved-track {
    -webkit-overflow-scrolling: touch;
}

/* Focus states for accessibility */
.gallery-item:focus,
.galleryonly-item:focus,
.strip-photo:focus {
    outline: 3px solid #ffd700;
    outline-offset: 2px;
}

/* FIXED QUOTES SECTION - MOBILE RESPONSIVE */
.openpage-quotes {
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 50%, #f8f9fa 100%);
    color: #1a1a2e;
    padding: 4rem 1.5rem;
    text-align: center;
    opacity: 1 !important; /* Force visibility */
    transform: translateY(0) !important; /* Force position */
    position: relative;
    z-index: 100;
    visibility: visible !important;
}

.openpage-quotes h2 {
    font-size: 2.5rem;
    font-weight: 900;
    margin-bottom: 3rem;
    background: linear-gradient(135deg, #1a1a2e 0%, #6c5ce7 50%, #1a1a2e 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.openpage-quote-item {
    font-size: 1.4rem;
    font-weight: 600;
    margin: 2rem auto;
    max-width: 90%;
    color: #0f3460;
    opacity: 1 !important; /* Force visibility */
    transform: translateX(0) !important; /* Force position */
    padding: 1.5rem;
    background: rgba(255, 255, 255, 0.8);
    backdrop-filter: blur(10px);
    border-radius: 15px;
    border: 1px solid rgba(255, 255, 255, 0.3);
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
    position: relative;
    line-height: 1.6;
}

.openpage-quote-item::before {
    content: '"';
    position: absolute;
    top: -5px;
    left: 15px;
    font-size: 4rem;
    color: rgba(108, 92, 231, 0.2);
    font-weight: 900;
    line-height: 1;
}

/* FIXED SPONSORS SECTION - MOBILE RESPONSIVE */
.openpage-sponsors {
    background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 50%, #ffffff 100%);
    color: #1a1a2e;
    padding: 4rem 1.5rem;
    text-align: center;
    opacity: 1 !important; /* Force visibility */
    transform: translateY(0) !important; /* Force position */
    position: relative;
    z-index: 100;
    visibility: visible !important;
}

.openpage-sponsors h2 {
    font-size: 2.5rem;
    font-weight: 900;
    margin-bottom: 3rem;
    background: linear-gradient(135deg, #1a1a2e 0%, #fd79a8 50%, #1a1a2e 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.openpage-sponsors-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 2rem;
    max-width: 800px;
    margin: 0 auto;
}

.openpage-sponsor-logo {
    width: 100%;
    height: 100px;
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(10px);
    border-radius: 15px;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 10px 20px rgba(26, 26, 46, 0.1);
    transition: all 0.3s ease;
    color: #0f3460;
    font-weight: 700;
    border: 1px solid rgba(255, 255, 255, 0.3);
    padding: 1rem;
    font-size: 1rem;
}

.openpage-sponsor-logo:hover {
    transform: translateY(-5px) scale(1.05);
    box-shadow: 0 15px 30px rgba(26, 26, 46, 0.2);
}

/* FIXED REVIEWS SECTION - MOBILE RESPONSIVE */
.openpage-reviews {
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 25%, #f8f9fa 50%, #e9ecef 75%, #f8f9fa 100%);
    color: #1a1a2e;
    padding: 4rem 1.5rem;
    text-align: center;
    opacity: 1 !important; /* Force visibility */
    transform: translateY(0) !important; /* Force position */
    position: relative;
    z-index: 100;
    visibility: visible !important;
}

.openpage-reviews h2 {
    font-size: 2.5rem;
    font-weight: 900;
    margin-bottom: 3rem;
    background: linear-gradient(135deg, #1a1a2e 0%, #6c5ce7 25%, #fd79a8 50%, #ffd700 75%, #1a1a2e 100%);
    background-size: 400% 400%;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    animation: gradientShift 4s ease-in-out infinite;
}

.openpage-reviews-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 2rem;
    max-width: 600px;
    margin: 0 auto;
}

.openpage-review-card {
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(20px);
    padding: 2rem;
    border-radius: 20px;
    box-shadow: 0 15px 30px rgba(26, 26, 46, 0.1);
    transition: all 0.3s ease;
    opacity: 1 !important; /* Force visibility */
    transform: translateY(0) !important; /* Force position */
    border: 1px solid rgba(255, 255, 255, 0.3);
    position: relative;
}

.openpage-review-card:hover {
    transform: translateY(-10px) scale(1.02);
    box-shadow: 0 25px 50px rgba(26, 26, 46, 0.2);
}

.openpage-review-text {
    font-size: 1.2rem;
    line-height: 1.6;
    margin-bottom: 1.5rem;
    color: #0f3460;
    font-style: italic;
    font-weight: 500;
}

.openpage-review-author {
    font-weight: 800;
    font-size: 1rem;
    background: linear-gradient(135deg, #1a1a2e 0%, #6c5ce7 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

/* PRICING SECTION - MOBILE RESPONSIVE */
.pricing-section {
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 50%, #f8f9fa 100%);
    padding: 4rem 1.5rem;
    color: #1a1a2e;
    text-align: center;
}

.pricing-title {
    font-size: 2.5rem;
    font-weight: 900;
    background: linear-gradient(135deg, #1a1a2e 0%, #6c5ce7 50%, #fd79a8 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    margin-bottom: 1rem;
}

.pricing-subtitle {
    font-size: 1.2rem;
    color: #6c5ce7;
    font-weight: 600;
    margin-bottom: 2rem;
}

.pricing-highlight {
    background: rgba(108, 92, 231, 0.1);
    border-radius: 15px;
    padding: 2rem;
    margin: 2rem 0;
    border: 2px solid rgba(108, 92, 231, 0.2);
}

.price-badge {
    display: inline-block;
    background: linear-gradient(135deg, #6c5ce7, #fd79a8);
    color: white;
    padding: 1rem 2rem;
    border-radius: 30px;
    font-size: 1.5rem;
    font-weight: 800;
    margin-bottom: 1rem;
    box-shadow: 0 10px 20px rgba(108, 92, 231, 0.3);
}

.pricing-features {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1.5rem;
    margin-top: 2rem;
}

.feature-item {
    background: rgba(255, 255, 255, 0.8);
    border-radius: 10px;
    padding: 1.5rem;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    transition: all 0.3s ease;
}

.feature-item:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
}

.feature-icon {
    font-size: 1.5rem;
    margin-bottom: 0.5rem;
}
/* Ticket Pricing Calculator Styles */

.pricing-calculator {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    padding: 2rem;
    margin: 2rem 0;
    border-radius: 25px;
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
    color: white;
    position: relative;
    overflow: hidden;
}

.pricing-calculator::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(255, 255, 255, 0.05);
    pointer-events: none;
}

.pricing-header {
    text-align: center;
    margin-bottom: 2rem;
    position: relative;
    z-index: 2;
}

.pricing-title {
    font-size: 2.5rem;
    color: #ffffff;
    margin-bottom: 0.5rem;
    font-weight: 700;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
}

.pricing-subtitle {
    font-size: 1.1rem;
    color: rgba(255, 255, 255, 0.9);
    margin: 0;
    font-weight: 300;
}

.pricing-container {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 2rem;
    position: relative;
    z-index: 2;
}

.price-input-section {
    background: rgba(255, 255, 255, 0.1);
    padding: 2rem;
    border-radius: 20px;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.2);
}

.price-label {
    display: block;
    font-size: 1.1rem;
    font-weight: 600;
    margin-bottom: 1rem;
    color: #ffffff;
}

.price-input {
    width: 100%;
    padding: 1rem;
    font-size: 1.2rem;
    border: 2px solid #ddd;
    border-radius: 12px;
    background: rgba(255, 255, 255, 0.9);
    color: #333;
    transition: all 0.3s ease;
    margin-bottom: 1.5rem;
}

.price-input:focus {
    outline: none;
    border-color: #ffd700;
    box-shadow: 0 0 0 3px rgba(255, 215, 0, 0.3);
    transform: scale(1.02);
}

.calculate-btn {
    width: 100%;
    padding: 1rem 2rem;
    font-size: 1.1rem;
    font-weight: 600;
    background: linear-gradient(45deg, #ff6b6b, #feca57);
    color: white;
    border: none;
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.3s ease;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.calculate-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
}

.calculate-btn:active {
    transform: translateY(0);
}

.fee-display {
    background: rgba(255, 255, 255, 0.95);
    padding: 2rem;
    border-radius: 20px;
    color: #333;
    box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
    animation: slideInUp 0.5s ease-out;
}

@keyframes slideInUp {
    from {
        opacity: 0;
        transform: translateY(30px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.fee-breakdown h4 {
    font-size: 1.3rem;
    color: #333;
    margin-bottom: 1.5rem;
    text-align: center;
    border-bottom: 2px solid #eee;
    padding-bottom: 0.5rem;
}

.fee-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.8rem 0;
    border-bottom: 1px solid #f0f0f0;
}

.fee-item:last-child {
    border-bottom: none;
}

.fee-label {
    font-weight: 500;
    color: #555;
}

.fee-value {
    font-weight: 700;
    color: #333;
    font-size: 1.1rem;
}

.total-fee {
    background: rgba(255, 193, 7, 0.1);
    border-radius: 8px;
    padding: 1rem;
    margin: 1rem 0;
    border: 1px solid rgba(255, 193, 7, 0.3);
}

.final-price {
    background: rgba(40, 167, 69, 0.1);
    border-radius: 8px;
    padding: 1rem;
    border: 1px solid rgba(40, 167, 69, 0.3);
}

.final-price .fee-label,
.final-price .fee-value {
    color: #28a745;
    font-size: 1.2rem;
}

.pricing-tiers {
    grid-column: 1 / -1;
    background: rgba(255, 255, 255, 0.1);
    padding: 2rem;
    border-radius: 20px;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.2);
    margin-top: 1rem;
}

.pricing-tiers h4 {
    font-size: 1.3rem;
    color: #ffffff;
    margin-bottom: 1.5rem;
    text-align: center;
}

.tier-list {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1rem;
}

.tier-item {
    background: rgba(255, 255, 255, 0.1);
    padding: 1rem;
    border-radius: 12px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    transition: all 0.3s ease;
    border: 1px solid rgba(255, 255, 255, 0.2);
}

.tier-item:hover {
    background: rgba(255, 255, 255, 0.2);
    transform: translateY(-2px);
}

.tier-range {
    font-weight: 600;
    color: #ffffff;
}

.tier-fee {
    font-weight: 500;
    color: #ffd700;
}

/* Mobile Responsiveness */
@media (max-width: 768px) {
    .pricing-calculator {
        padding: 1.5rem 1rem;
        margin: 1rem 0;
    }
    
    .pricing-title {
        font-size: 1.8rem;
    }
    
    .pricing-container {
        grid-template-columns: 1fr;
        gap: 1.5rem;
    }
    
    .price-input-section,
    .fee-display,
    .pricing-tiers {
        padding: 1.5rem;
    }
    
    .tier-list {
        grid-template-columns: 1fr;
    }
    
    .tier-item {
        flex-direction: column;
        gap: 0.5rem;
        text-align: center;
    }
}

@media (max-width: 480px) {
    .pricing-calculator {
        padding: 1rem 0.5rem;
    }
    
    .pricing-title {
        font-size: 1.5rem;
    }
    
    .price-input-section,
    .fee-display,
    .pricing-tiers {
        padding: 1rem;
    }
    
    .price-input {
        font-size: 1rem;
        padding: 0.8rem;
    }
    
    .calculate-btn {
        font-size: 1rem;
        padding: 0.8rem 1.5rem;
    }
    
    .fee-item {
        padding: 0.6rem 0;
    }
    
    .fee-value {
        font-size: 1rem;
    }
}

/* Error state */
.price-input.error {
    border-color: #ff6b6b !important;
    background-color: rgba(255, 107, 107, 0.1);
}

/* Loading state */
.calculate-btn.loading {
    background: #ccc;
    cursor: not-allowed;
    pointer-events: none;
}

.calculate-btn.loading::after {
    content: '';
    width: 16px;
    height: 16px;
    border: 2px solid #fff;
    border-top: 2px solid transparent;
    border-radius: 50%;
    display: inline-block;
    animation: spin 1s linear infinite;
    margin-left: 10px;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* DJ SECTION - MOBILE RESPONSIVE */
.dj-section {
    background: linear-gradient(135deg, #000000 0%, #1a1a2e 50%, #16213e 100%);
    padding: 4rem 1.5rem;
    position: relative;
}

.dj-title {
    font-size: 2.5rem;
    font-weight: 900;
    background: linear-gradient(135deg, #ffd700 0%, #ff6b6b 25%, #6c5ce7 50%, #fd79a8 75%, #ffd700 100%);
    background-size: 400% 400%;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    animation: gradientShift 3s ease-in-out infinite;
    margin-bottom: 1rem;
    text-align: center;
}

.dj-subtitle {
    font-size: 1.2rem;
    color: rgba(255, 255, 255, 0.8);
    text-align: center;
    margin-bottom: 2rem;
}

.music-player {
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(20px);
    border-radius: 20px;
    padding: 2rem;
    border: 1px solid rgba(255, 255, 255, 0.2);
    box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
    text-align: center;
}

.song-title {
    font-size: 1.4rem;
    font-weight: 700;
    margin-bottom: 0.5rem;
    color: white;
}

.song-artist {
    font-size: 1rem;
    opacity: 0.8;
    color: white;
    margin-bottom: 1rem;
}

.player-controls {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 1rem;
    margin: 1.5rem 0;
}

.control-btn {
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 50%;
    width: 45px;
    height: 45px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 1.2rem;
    cursor: pointer;
    transition: all 0.3s ease;
}

.control-btn:hover {
    background: rgba(255, 255, 255, 0.2);
    transform: scale(1.1);
}

.play-btn {
    width: 60px;
    height: 60px;
    font-size: 1.5rem;
    background: linear-gradient(135deg, #ffd700, #6c5ce7);
}

.progress-container {
    width: 100%;
    height: 4px;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 2px;
    margin: 1.5rem 0;
    cursor: pointer;
}

.progress-bar-music {
    height: 100%;
    background: linear-gradient(90deg, #ffd700, #6c5ce7);
    border-radius: 2px;
    width: 0%;
    transition: width 0.3s ease;
}

.song-list {
    display: grid;
    grid-template-columns: 1fr;
    gap: 0.8rem;
    margin-top: 2rem;
}

.song-item {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 10px;
    padding: 0.8rem;
    display: flex;
    align-items: center;
    gap: 0.8rem;
    cursor: pointer;
    transition: all 0.3s ease;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.song-item:hover {
    background: rgba(255, 255, 255, 0.1);
    transform: translateX(5px);
}

.song-thumbnail {
    width: 40px;
    height: 40px;
    background: linear-gradient(135deg, #ffd700, #6c5ce7);
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: bold;
    font-size: 0.8rem;
}

.song-details h4 {
    color: white;
    font-size: 0.9rem;
    margin-bottom: 0.2rem;
}

.song-details p {
    color: rgba(255, 255, 255, 0.7);
    font-size: 0.8rem;
}

/* ACTION BUTTONS - MOBILE RESPONSIVE */
.openpage-actions {
    padding: 4rem 1.5rem;
    background: linear-gradient(135deg, #1a1a2e 0%, #16213e 25%, #0f3460 50%, #1a1a2e 75%, #16213e 100%);
    color: #ffffff;
    text-align: center;
    opacity: 1 !important; /* Force visibility */
    transform: translateY(0) !important; /* Force position */
    position: relative;
    z-index: 100;
    visibility: visible !important;
}

.actions-title {
    font-size: 2.5rem;
    font-weight: 900;
    background: linear-gradient(135deg, #ffd700 0%, #6c5ce7 25%, #fd79a8 50%, #ffd700 100%);
    background-size: 400% 400%;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    animation: gradientShift 3s ease-in-out infinite;
    margin-bottom: 3rem;
}

.openpage-actions-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 2rem;
    max-width: 500px;
    margin: 0 auto;
}

.openpage-action-button {
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(20px);
    color: #ffffff;
    padding: 2.5rem 2rem;
    border-radius: 20px;
    text-decoration: none;
    font-size: 1.2rem;
    font-weight: 700;
    transition: all 0.3s ease;
    box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    border: 1px solid rgba(255, 255, 255, 0.1);
    cursor: pointer;
}

.openpage-action-button:hover {
    transform: translateY(-10px) scale(1.02);
    box-shadow: 0 25px 50px rgba(108, 92, 231, 0.3);
    background: rgba(255, 255, 255, 0.15);
}

.action-icon {
    font-size: 3rem;
    margin-bottom: 1rem;
    background: linear-gradient(135deg, #ffd700, #6c5ce7, #fd79a8);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}

.action-title {
    font-size: 1.4rem;
    font-weight: 800;
    margin-bottom: 0.8rem;
    text-transform: uppercase;
    letter-spacing: 1px;
}

.action-description {
    font-size: 1rem;
    opacity: 0.8;
    line-height: 1.5;
}

/* LIVE PHOTO STRIP - MOBILE RESPONSIVE */
.live-strip {
    background: rgba(0, 0, 0, 0.8);
    padding: 2rem 0;
    margin: 2rem 0;
    position: relative;
    overflow: hidden;
}

.strip-header {
    text-align: center;
    color: white;
    margin-bottom: 1.5rem;
    padding: 0 1rem;
}

.strip-title {
    font-size: 1.5rem;
    font-weight: 700;
    margin-bottom: 0.5rem;
}

.strip-subtitle {
    font-size: 1rem;
    opacity: 0.8;
}

.photo-strip {
    display: flex;
    gap: 1rem;
    padding: 0 1rem;
    overflow-x: auto;
    scroll-snap-type: x mandatory;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: none;
    -ms-overflow-style: none;
}

.photo-strip::-webkit-scrollbar {
    display: none;
}

.strip-photo {
    flex-shrink: 0;
    width: 120px;
    height: 120px;
    border-radius: 10px;
    overflow: hidden;
    position: relative;
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.5);
    scroll-snap-align: start;
}

.strip-photo img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.photo-overlay {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    background: linear-gradient(transparent, rgba(0, 0, 0, 0.8));
    color: white;
    padding: 0.3rem;
    font-size: 0.7rem;
    text-align: center;
}

/* Hide main app initially */
#mainAppContainer {
    display: none;
}

#mainAppContainer.show {
    display: flex;
}

/* FORCE VISIBILITY FOR ALL SECTIONS ON MOBILE */
@media (max-width: 768px) {
    .openpage-section,
    .openpage-quotes,
    .openpage-sponsors,
    .openpage-reviews,
    .openpage-actions {
        opacity: 1 !important;
        transform: translateY(0) !important;
        visibility: visible !important;
        position: relative !important;
        z-index: 100 !important;
    }
    
    .openpage-quote-item,
    .openpage-review-card {
        opacity: 1 !important;
        transform: translateX(0) translateY(0) !important;
        visibility: visible !important;
    }
}

/* SMALLEST SCREENS */
@media (max-width: 480px) {
    .openpage-header {
        padding: 0.8rem 1rem;
        min-height: 60px;
    }
    
    .openpage-slideshow {
        margin-top: 60px;
    }
    
    .openpage-app-name {
        font-size: 1.5rem;
    }
    
    .openpage-slide-title {
        font-size: 2rem;
    }
    
    .openpage-slide-caption {
        font-size: 1rem;
    }
    
    .openpage-slide-slogan {
        font-size: 1.4rem;
    }
    
    .gallery-item {
        width: 240px;
        height: 320px;
    }
    
    .gallery-title {
        font-size: 1.8rem;
    }
    
    .scroll-progress {
        right: 10px;
        padding: 10px 4px;
    }
    
    .progress-bar {
        height: 50px;
        width: 2px;
    }
    
    .progress-badge {
        font-size: 8px;
        padding: 2px 4px;
    }
}

/* EXTRA SMALL SCREENS */
@media (max-width: 375px) {
    .openpage-app-name {
        font-size: 1.3rem;
    }
    
    .gallery-item {
        width: 220px;
        height: 300px;
    }
    
    .openpage-slide-title {
        font-size: 1.8rem;
    }
    
    .actions-title,
    .dj-title,
    .pricing-title {
        font-size: 2rem;
    }
    
    .openpage-quotes h2,
    .openpage-sponsors h2,
    .openpage-reviews h2 {
        font-size: 2rem;
    }
}
    .container {
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 20px;
         background-color: #1a1a2e;
    }
    
    .split-screen {
        display: flex;
        background-color: #1a1a2e;
        border-radius: 20px;
        overflow: hidden;
        box-shadow: var(--box-shadow);
        width: 100%;
        max-width: 1200px;
        min-height: 600px;
    }
    
    /* Left side styling */
    .left {
        flex: 1;
        background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        color: var(--white);
        padding: 60px 40px;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        position: relative;
        overflow: hidden;
    }
    
    .left::before {
        content: '';
        position: absolute;
        top: -50px;
        right: -50px;
        width: 200px;
        height: 200px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.1);
    }
    
    .left::after {
        content: '';
        position: absolute;
        bottom: -80px;
        left: -80px;
        width: 300px;
        height: 300px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.1);
    }
    
    .logo h1 {
        font-size: 2.5rem;
        font-weight: 700;
        margin-bottom: 10px;
        letter-spacing: 1px;
    }
    
    .tagline {
        margin-top: 60px;
        z-index: 1;
    }
    
    .tagline h2 {
        font-size: 2rem;
        font-weight: 600;
        margin-bottom: 15px;
    }
    
    .tagline p {
        font-size: 1.1rem;
        opacity: 0.9;
    }
    
    .features {
        margin-top: 60px;
        z-index: 1;
    }
    
    .feature {
        display: flex;
        align-items: center;
        margin-bottom: 20px;
    }
    
    .feature i {
        font-size: 1.2rem;
        margin-right: 15px;
        background: rgba(255, 255, 255, 0.2);
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .feature span {
        font-size: 1rem;
    }
    
    /* Right side styling */
    .right {
        flex: 1;
        padding: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .auth-container {
        width: 100%;
        max-width: 1200px;
        transition: all 0.3s ease;
        background-color: #1a1a2e;
    }
    
    .auth-container.hidden {
        display: none;
    }
    
    .auth-container h2 {
        font-size: 1.8rem;
        font-weight: 600;
        margin-bottom: 10px;
        color: var(--text-color);
        
    }
    
    .auth-container > p {
        color: var(--light-text);
        margin-bottom: 30px;
    }
    
    .social-login {
        margin-bottom: 25px;
    }
    
    .social-btn {
        width: 100%;
        padding: 12px;
        border-radius: 8px;
        border: 1px solid var(--border-color);
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    
    
    .social-btn img {
        width: 20px;
        height: 20px;
        margin-right: 10px;
    }
    
    .social-btn span {
        font-size: 1rem;
        color: var(--text-color);
        font-weight: 500;
    }
    .divider {
        display: flex;
        align-items: center;
        margin: 25px 0;
    }
    
    .divider::before,
    .divider::after {
        content: '';
        flex: 1;
        height: 1px;
        background-color: var(--border-color);
    }
    
    .divider span {
        padding: 0 15px;
        color: var(--light-text);
        font-size: 0.9rem;
    }
    
    
    .password-input {
        position: relative;
    }
    
    .toggle-password {
        position: absolute;
        right: 15px;
        top: 50%;
        transform: translateY(-50%);
        cursor: pointer;
        color: var(--light-text);
    }
    
    .password-strength {
        margin-top: 10px;
    }
    
    .strength-meter {
        display: flex;
        gap: 5px;
        margin-bottom: 5px;
    }
    
    .strength-segment {
        height: 4px;
        flex: 1;
        background-color: #ddd;
        border-radius: 2px;
    }
    
    .strength-segment.weak {
        background-color: var(--error-color);
    }
    
    .strength-segment.medium {
        background-color: #f39c12;
    }
    
    .strength-segment.strong {
        background-color: var(--success-color);
    }
    
    .strength-text {
        font-size: 0.8rem;
        color: var(--light-text);
    }
    
    .form-options {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 25px;
        font-size: 0.9rem;
    }
    
    .remember-me,
    .terms {
        display: flex;
        align-items: center;
    }
    
    .remember-me input,
    .terms input {
        margin-right: 8px;
    }
    
    .forgot-password,
    .terms a {
        color: var(--primary-color);
        text-decoration: none;
    }
    
    .forgot-password:hover,
    .terms a:hover {
        text-decoration: underline;
    }
    
    .auth-btn {
        width: 100%;
        padding: 14px;
        background-color: var(--primary-color);
        color: var(--white);
        border: none;
        border-radius: 8px;
        font-size: 1rem;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    
    .auth-btn:hover {
        background-color: var(--primary-dark);
    }
    
    .auth-switch {
        text-align: center;
        margin-top: 25px;
        font-size: 0.9rem;
    }
    
    .auth-switch a {
        color: var(--primary-color);
        text-decoration: none;
        font-weight: 500;
    }
    
    .auth-switch a:hover {
        text-decoration: underline;
    }
    
    /* Error message styling */
    .error-message {
        color: var(--error-color);
        font-size: 0.85rem;
        margin-top: 5px;
        display: none;
    }
    
    .error-message.visible {
        display: block;
    }
    
    /* Success message styling */
    .success-message {
        color: var(--success-color);
        font-size: 0.85rem;
        margin-top: 5px;
        display: none;
    }
    
    .success-message.visible {
        display: block;
    }
    
    /* Loading indicator */
    .loading-spinner {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        border-top-color: var(--white);
        animation: spin 0.8s linear infinite;
        margin-left: 10px;
    }
    
    @keyframes spin {
        to {
            transform: rotate(360deg);
        }
    }
    
    .auth-btn.loading {
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    /* Toast notification */
    .toast {
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 15px 20px;
        border-radius: 8px;
        color: var(--white);
        font-size: 0.9rem;
        max-width: 300px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        z-index: 1000;
        opacity: 0;
        transform: translateY(-20px);
        transition: all 0.3s ease;
    }
    
    .toast.success {
        background-color: var(--success-color);
    }
    
    .toast.error {
        background-color: var(--error-color);
    }
    
    .toast.visible {
        opacity: 1;
        transform: translateY(0);
    }
    
    
/* Image Preview Styles */
.image-preview-container {
    display: none;
    margin-top: 15px;
    padding: 15px;
    background: #f8f9fa;
    border-radius: 12px;
    border: 2px dashed #dee2e6;
    text-align: center;
    position: relative;
}

.image-preview {
    max-width: 100%;
    max-height: 200px;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    margin-bottom: 10px;
    object-fit: cover;
}

.image-preview-text {
    font-size: 14px;
    color: #6c757d;
    margin-bottom: 10px;
    font-weight: 500;
}

.remove-image-btn {
    background: #dc3545;
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 12px;
    font-weight: 500;
    transition: all 0.2s ease;
    display: inline-flex;
    align-items: center;
    gap: 5px;
}

.remove-image-btn:hover {
    background: #c82333;
    transform: translateY(-1px);
}

.remove-image-btn:active {
    transform: translateY(0);
}

/* File Input Styling */
.file-input-wrapper {
    position: relative;
    display: inline-block;
    width: 100%;
}

.file-input-label {
    display: block;
    padding: 12px 20px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border-radius: 8px;
    cursor: pointer;
    text-align: center;
    font-weight: 500;
    transition: all 0.3s ease;
    border: none;
    font-size: 14px;
}

.file-input-label:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
}

.file-input-label i {
    margin-right: 8px;
}

#backgroundImage {
    position: absolute;
    opacity: 0;
    width: 100%;
    height: 100%;
    cursor: pointer;
}

    /* Responsive styles */
    @media (max-width: 992px) {
        .split-screen {
            flex-direction: column;
            max-width: 600px;
        }
        
        .left {
            padding: 40px 30px;
            min-height: 300px;
        }
        
        .tagline {
            margin-top: 30px;
        }
        
        .features {
            margin-top: 30px;
        }
        
        .right {
            padding: 30px;
        }
        .image-preview-container {
        background: #2d3748;
        border-color: #4a5568;
    }
    
    .image-preview-text {
        color: #a0aec0;
    }
    }
    
    @media (max-width: 768px) {
        .container {
            padding: 10px;
        }
        
        .split-screen {
            border-radius: 15px;
        }
        
        .left {
            padding: 30px 20px;
            min-height: 250px;
        }
        
        .logo h1 {
            font-size: 2rem;
        }
        
        .tagline h2 {
            font-size: 1.5rem;
        }
        
        .tagline p {
            font-size: 1rem;
        }
        
        .feature i {
            width: 35px;
            height: 35px;
            font-size: 1rem;
        }
        
        .feature span {
            font-size: 0.9rem;
        }
        
        .auth-container h2 {
            font-size: 1.5rem;
        }
    }
    
    @media (max-width: 480px) {
        .split-screen {
            border-radius: 10px;
        }
        
        .left {
            padding: 25px 15px;
            min-height: 200px;
        }
        
        .logo h1 {
            font-size: 1.8rem;
        }
        
        .tagline {
            margin-top: 20px;
        }
        
        .tagline h2 {
            font-size: 1.3rem;
            margin-bottom: 10px;
        }
        
        .tagline p {
            font-size: 0.9rem;
        }
        
        .features {
            margin-top: 20px;
        }
        
        .feature {
            margin-bottom: 15px;
        }
        
        .feature i {
            width: 30px;
            height: 30px;
            font-size: 0.9rem;
            margin-right: 10px;
        }
        
        .feature span {
            font-size: 0.85rem;
        }
        
        .right {
            padding: 25px 15px;
        }
        
        .auth-container h2 {
            font-size: 1.4rem;
        }
        
        .auth-container > p {
            font-size: 0.9rem;
            margin-bottom: 20px;
        }
       
       
        
        .auth-btn {
            padding: 12px;
        }
        
        .social-btn span {
            font-size: 0.9rem;
        }
        
        .divider span {
            font-size: 0.8rem;
        }
    }
    
    /* iOS specific adjustments */
    @supports (-webkit-touch-callout: none) {
        input, select {
            font-size: 16px !important; /* Prevents zoom on focus in iOS */
        }
        
        
        .auth-btn {
            -webkit-appearance: none;
        }
    }
    
    /* Dark mode support */
    @media (prefers-color-scheme: dark) {
        :root {
            --background-color: #1a1a2e;
            --text-color: #e6e6e6;
            --light-text: #a7a7a7;
            --white:#1a1a2e:
            --border-color: #393954;
        }
        
        .social-btn {
            background-color: #2a2a42;
            border-color: #393954;
        }
        
        .social-btn:hover {
            background-color: #33334d;
        }
        
        .strength-segment {
            background-color: #444;
        }
        
      
    }
    
    /* Animations */
    @keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    .auth-container {
        animation: fadeIn 0.5s ease forwards;
    }
    
    /* Accessibility improvements */
    .auth-btn:focus,
    .social-btn:focus,
    input:focus,
    select:focus {
        outline: 2px solid var(--primary-color);
        outline-offset: 2px;
    }

    /* Dashboard Styles - Fixed for vertical overflow issues */
html, body {
    margin: 0;
    padding: 0;
    width: 100%;
    height: 100%;
    overflow-x: hidden;
    position: relative;
}

body {
    font-family: 'Poppins', sans-serif;
    background-color: var(--background-color);
    color: var(--text-color);
    line-height: 1.6;
}

.dashboard-page {
    display: none;
    flex-direction: column;
    height: 100vh; /* Use viewport height instead of min-height */
    width: 100%;
    max-width: 100%;
    overflow-x: hidden;
    position: fixed; /* Fix the position to prevent page movement */
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: var(--background-color);
}

.dashboard-page.active {
    display: flex;
}


/* Dashboard Navigation Container */
.dashboard-nav {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 12px 20px;
    background-color: var(--bg-light);
    box-shadow: 0 2px 15px rgba(0, 0, 0, 0.08);
    position: sticky;
    top: 0;
    z-index: 100;
    width: 100%;
    transition: all 0.3s ease;
}

/* User info section */
.user-info {
    display: flex;
    align-items: center;
    gap: 12px;
}

.profile-circle {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    overflow: hidden;
    background-color: var(--primary-light);
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1);
}

.user-profile-image {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
}

.username {
    font-weight: 600;
    color: var(--text-dark);
    font-size: 0.95rem;
}

/* Navigation buttons container */
.dashboard-nav > div:not(.user-info):not(.hamburger-menu) {
    display: flex;
    align-items: center;
    gap: 15px;
}

/* Trophy button with improved shining animation */
.trophy-btn {
    display: flex;
    align-items: center;
    gap: 8px;
    background-color: var(--secondary-color);
    color: var(--white);
    padding: 8px 16px;
    border-radius: var(--border-radius);
    font-weight: 500;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 4px 10px var(--shadow-color-secondary);
    position: relative;
    overflow: hidden;
}

/* Trophy icon container */
.trophy-btn i {
    font-size: 1rem;
    position: relative;
    display: inline-block;
    z-index: 2;
    color: var(--white);
}

/* Shining effect - outer glow */
.trophy-btn i::after {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle, rgba(255, 215, 0, 0.8) 0%, transparent 70%);
    animation: trophy-glow 3s infinite;
    z-index: -1;
    pointer-events: none;
}

/* Shining effect - sparkle */
.trophy-btn::before {
    content: '';
    position: absolute;
    font-size: 0.8rem;
    top: 0;
    right: 30%;
    opacity: 0;
    z-index: 3;
    animation: trophy-sparkle 4s infinite;
    pointer-events: none;
}

.trophy-btn::after {
    content: '';
    position: absolute;
    font-size: 0.6rem;
    bottom: 5%;
    left: 30%;
    opacity: 0;
    z-index: 3;
    animation: trophy-sparkle 4s infinite 1s;
    pointer-events: none;
}

/* Shine sweep effect */
.trophy-btn .shine-sweep {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(
        90deg,
        transparent 0%,
        rgba(255, 255, 255, 0.4) 50%,
        transparent 100%
    );
    z-index: 1;
    transform: translateX(-100%);
    animation: shine-sweep 3s infinite;
    pointer-events: none;
}

/* Add this div to your HTML right after the icon */
/* <div class="shine-sweep"></div> */

@keyframes trophy-glow {
    0%, 100% {
        opacity: 0;
        transform: scale(0.5);
    }
    50% {
        opacity: 0.8;
        transform: scale(1.2);
    }
}

@keyframes trophy-sparkle {
    0%, 100% {
        opacity: 0;
        transform: translateY(0) scale(0.8);
    }
    50% {
        opacity: 1;
        transform: translateY(-5px) scale(1);
    }
}

@keyframes shine-sweep {
    0% {
        transform: translateX(-100%);
    }
    100% {
        transform: translateX(100%);
    }
}


/* Wallet button */
.wallet1-btn {
    display: flex;
    align-items: center;
    gap: 8px;
    background-color: var(--primary-color);
    color: var(--white);
    padding: 8px 16px;
    border-radius: var(--border-radius);
    font-weight: 500;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 4px 10px var(--shadow-color);
    position: relative;
    overflow: hidden;
}

.wallet1-btn i {
    font-size: 1rem;
    position: relative;
}

/* Coin entering wallet animation */
.walleticon-btn::before {
    content: '';
    position: absolute;
    font-size: 0.8rem;
    top: -20px;
    left: 50%;
    transform: translateX(-50%);
    opacity: 0;
    animation: coin-drop 3s infinite;
}

.walleticon::after {
    content: '';
    position: absolute;
    font-size: 0.8rem;
    top: -20px;
    left: 30%;
    transform: translateX(-50%);
    opacity: 0;
    animation: coin-drop 3s infinite 1s;
}

@keyframes coin-drop {
    0% {
        top: -20px;
        opacity: 0;
        transform: translateX(-50%) scale(0.5);
    }
    20% {
        opacity: 1;
        transform: translateX(-50%) scale(1);
    }
    80% {
        opacity: 1;
        transform: translateX(-50%) scale(1);
    }
    100% {
        top: 50%;
        opacity: 0;
        transform: translateX(-50%) scale(0.5);
    }
}

.wallet1-btn span {
    font-size: 0.9rem;
    font-weight: 500;
}

/* Hamburger menu */
.hamburger-menu {
    display: none;
    width: 40px;
    height: 40px;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    border-radius: 50%;
    transition: all 0.3s ease;
}

.hamburger-menu i {
    font-size: 1.2rem;
    color: var(--text-dark);
}

.hamburger-menu:hover {
    background-color: rgba(0, 0, 0, 0.05);
}

/* Hover effects */
.trophy-btn:hover, .wallet1-btn:hover {
    transform: translateY(-3px);
}

.trophy-btn:hover {
    box-shadow: 0 6px 15px var(--shadow-color-secondary);
    background-color: var(--secondary-light);
}

.wallet1-btn:hover {
    box-shadow: 0 6px 15px var(--shadow-color);
    background-color: var(--primary-light);
}

/* Active state */
.trophy-btn:active, .wallet1-btn:active {
    transform: translateY(1px);
}

.trophy-btn:active {
    box-shadow: 0 2px 5px var(--shadow-color-secondary);
    background-color: var(--secondary-dark);
}

.wallet1-btn:active {
    box-shadow: 0 2px 5px var(--shadow-color);
    background-color: var(--primary-dark);
}

/* Responsive styles */
@media (max-width: 768px) {
    .dashboard-nav {
        padding: 10px 15px;
    }
    
    .username {
        max-width: 100px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    
    .trophy-btn, .wallet1-btn {
        padding: 6px 12px;
    }
    
    .trophy-btn span, .wallet1-btn span {
        font-size: 0.8rem;
    }
}

@media (max-width: 576px) {
    .hamburger-menu {
        display: flex;
    }
    
    .trophy-btn, .wallet1-btn {
        display: none;
    }
    
    .dashboard-nav.expanded .trophy-btn,
    .dashboard-nav.expanded .wallet1-btn {
        display: flex;
    }
    
    .dashboard-nav.expanded {
        flex-direction: column;
        align-items: flex-start;
    }
    
    .dashboard-nav.expanded .user-info {
        margin-bottom: 15px;
        width: 100%;
        justify-content: space-between;
    }
    
    .dashboard-nav.expanded > div:not(.user-info):not(.hamburger-menu) {
        flex-direction: column;
        width: 100%;
        gap: 10px;
    }
    
    .dashboard-nav.expanded .trophy-btn,
    .dashboard-nav.expanded .wallet1-btn {
        width: 100%;
        justify-content: flex-start;
    }
}

@media (max-width: 400px) {
    .profile-circle {
        width: 35px;
        height: 35px;
    }
    
    .username {
        max-width: 80px;
        font-size: 0.85rem;
    }
}

/* Dark mode support */
@media (prefers-color-scheme: dark) {
    .dashboard-nav {
        background-color: var(--text-dark);
        box-shadow: 0 2px 15px rgba(0, 0, 0, 0.2);
    }
    
    .username {
        color: var(--text-light);
    }
    
    .hamburger-menu i {
        color: var(--text-light);
    }
    
    .hamburger-menu:hover {
        background-color: rgba(255, 255, 255, 0.1);
    }
}

/* Reduced motion preference */
@media (prefers-reduced-motion: reduce) {
    .trophy-btn i::before,
    .trophy-btn i::after,
    .wallet1-btn::before,
    .wallet1-btn::after {
        animation: none !important;
    }
    
    .trophy-btn:hover,
    .wallet1-btn:hover {
        transform: none;
    }
}

/* JavaScript helper for mobile menu toggle */
.dashboard-nav.expanded {
    height: auto;
    padding-bottom: 15px;
}

/* Accessibility focus styles */
.trophy-btn:focus-visible,
.wallet1-btn:focus-visible,
.hamburger-menu:focus-visible {
    outline: 2px solid var(--primary-color);
    outline-offset: 2px;
}

/* RTL language support */
[dir="rtl"] .user-info,
[dir="rtl"] .dashboard-nav > div:not(.user-info):not(.hamburger-menu) {
    flex-direction: row-reverse;
}

/* Animation for new notifications */
@keyframes pulse {
    0% {
        transform: scale(1);
    }
    50% {
        transform: scale(1.05);
    }
    100% {
        transform: scale(1);
    }
}

.trophy-btn.has-notification,
.wallet1-btn.has-notification {
    position: relative;
}

.trophy-btn.has-notification::before,
.wallet1-btn.has-notification::before {
    content: '';
    position: absolute;
    top: -3px;
    right: -3px;
    width: 10px;
    height: 10px;
    background-color: #ff3838;
    border-radius: 50%;
    animation: pulse 1.5s infinite;
}

/* Tablet optimization */
@media (min-width: 768px) and (max-width: 1024px) {
    .dashboard-nav {
        padding: 12px 25px;
    }
}

/* Support for ultra-wide screens */
@media (min-width: 1400px) {
    .dashboard-nav {
        max-width: 1400px;
        margin: 0 auto;
        border-radius: 0 0 10px 10px;
    }
}

/* Fix for iOS Safari */
@supports (-webkit-touch-callout: none) {
    .dashboard-nav {
        -webkit-transform: translateZ(0);
    }
}

/* Fix for sticky hover on mobile */
@media (hover: none) {
    .trophy-btn:hover,
    .wallet1-btn:hover,
    .hamburger-menu:hover {
        transform: none;
        box-shadow: 0 4px 10px var(--shadow-color);
    }
    
    .trophy-btn:hover {
        background-color: var(--secondary-color);
    }
    
    .wallet1-btn:hover {
        background-color: var(--primary-color);
    }
}


/* Main Dashboard Container */
.dashboard-container {
    flex: 1;
    padding: 15px;
    width: 100%;
    overflow-y: auto; /* Allow vertical scrolling within container */
    -webkit-overflow-scrolling: touch;
      background-color: rgba(0, 0, 0, 0.05);
}
/* Media Banner Styles */
.media-banner-container {
    width: 100%;
    height: 70px;
    overflow: hidden;
    position: relative;
    
    border-radius: 8px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
}

.media-banner-track {
    display: flex;
    height: 100%;
    animation: autoScroll 20s linear infinite;
    gap: 16px;
}

.media-item {
    flex-shrink: 0;
    width: 480px;
    height: 70px;
    position: relative;
    border-radius: 6px;
    overflow: hidden;
    cursor: pointer;
    transition: transform 0.3s ease;
}

.media-item:hover {
    transform: scale(1.05);
    z-index: 10;
}

/* Video Styles */
.video-item video {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 6px;
}

/* Image Styles */
.image-item img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 6px;
}

/* Media Overlay */
.media-overlay {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    background: linear-gradient(transparent, rgba(0, 0, 0, 0.8));
    padding: 8px 12px;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.media-item:hover .media-overlay {
    opacity: 1;
}

.media-title {
    color: white;
    font-size: 12px;
    font-weight: 500;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
}

/* Auto Scroll Animation */
@keyframes autoScroll {
    0% {
        transform: translateX(0);
    }
    100% {
        transform: translateX(-50%);
    }
}

/* Pause animation on hover */
.media-banner-container:hover .media-banner-track {
    animation-play-state: paused;
}

/* Responsive Design */
@media (max-width: 768px) {
    .media-item {
        width: 300px;
    }
}

@media (max-width: 480px) {
    .media-item {
        width: 250px;
    }
    
    .media-banner-container {
        height: 60px;
    }
    
    .media-item {
        height: 60px;
    }
}

/* Loading placeholder */
.media-item::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
    background-size: 200% 100%;
    animation: loading 1.5s infinite;
    z-index: -1;
}

@keyframes loading {
    0% {
        background-position: 200% 0;
    }
    100% {
        background-position: -200% 0;
    }
}

/* Play/Pause indicator for videos */
.video-item::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: white;
    font-size: 16px;
    opacity: 0.7;
    pointer-events: none;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
}

/* Media Banner Styles */
.media2-banner-container {
    width: 100%;
    height: 150px;
    overflow: hidden;
    position: relative;
    
    border-radius: 8px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
}

.media2-banner-track {
    display: flex;
    height: 100%;
    animation: autoScroll 20s linear infinite;
    gap: 16px;
}

.media2-item {
    flex-shrink: 0;
    width: 480px;
    height: 70px;
    position: relative;
    border-radius: 6px;
    overflow: hidden;
    cursor: pointer;
    transition: transform 0.3s ease;
}

.media2-item:hover {
    transform: scale(1.05);
    z-index: 10;
}

/* Video Styles */
.video-item video {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 6px;
}

/* Image Styles */
.image-item img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 6px;
}

/* Media Overlay */
.media2-overlay {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    background: linear-gradient(transparent, rgba(0, 0, 0, 0.8));
    padding: 8px 12px;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.media2-item:hover .media-overlay {
    opacity: 1;
}

.media2-title {
    color: white;
    font-size: 12px;
    font-weight: 500;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
}

/* Auto Scroll Animation */
@keyframes autoScroll {
    0% {
        transform: translateX(0);
    }
    100% {
        transform: translateX(-50%);
    }
}

/* Pause animation on hover */
.media2-banner-container:hover .media-banner-track {
    animation-play-state: paused;
}

/* Responsive Design */
@media (max-width: 768px) {
    .media2-item {
        width: 300px;
    }
}

@media (max-width: 480px) {
    .media2-item {
        width: 250px;
    }
    
    .media2-banner-container {
        height: 60px;
    }
    
    .media2-item {
        height: 60px;
    }
}

/* Loading placeholder */
.media2-item::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
    background-size: 200% 100%;
    animation: loading 1.5s infinite;
    z-index: -1;
}

@keyframes loading {
    0% {
        background-position: 200% 0;
    }
    100% {
        background-position: -200% 0;
    }
}

/* Play/Pause indicator for videos */
.video-item::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: white;
    font-size: 16px;
    opacity: 0.7;
    pointer-events: none;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
}

/* Action Buttons - Single Row */
.action-buttons-row {
    display: flex;
    justify-content: space-between;
    gap: 10px;
    margin-top: 15px;
    width: 100%;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: none; /* Firefox */
    -ms-overflow-style: none; /* IE and Edge */
    padding-bottom: 5px;
    flex-shrink: 0; /* Prevent shrinking */
}

.action-buttons-row::-webkit-scrollbar {
    display: none; /* Chrome, Safari, Opera */
}

.action-btn {
    width:50Px;
    height: 100px;
    background-color: var(--white);
    border-radius: 12px;
    padding: 10px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 3px 8px rgba(0, 0, 0, 0.08);
    min-width: 70px;
    flex: 1;
}

.action-btn:active {
    transform: scale(0.95);
}

.action-icon {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.1rem;
}

/* Spinning animation for spin icon */
.spin-icon {
    position: relative;
    overflow: hidden;
}

.spin-icon i {
    animation: spin 5s linear infinite;
}

@keyframes spin {
    0% {
        transform: rotate(0deg);
    }
    100% {
        transform: rotate(360deg);
    }
}

.spin-icon::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    border-radius: 50%;
    border: 2px dashed var(--success-color);
    animation: spin-reverse 10s linear infinite;
}

@keyframes spin-reverse {
    0% {
        transform: rotate(360deg);
    }
    100% {
        transform: rotate(0deg);
    }
}


.creator-btn .action-icon {
    background-color: rgba(253, 121, 168, 0.1);
    color: var(--secondary-color);
}

.spin-btn .action-icon {
    background-color: rgba(46, 204, 113, 0.1);
    color: var(--success-color);
}

.Liveevents-btn .action-icon {
    background-color: rgba(46, 204, 113, 0.1);
    color: var(--success-color);
}


.notification-btn .action-icon {
    background-color: rgba(241, 196, 15, 0.1);
    color: #f1c40f;
}

.action-btn span {
    font-weight: 500;
    font-size: 0.8rem;
    color: #333;
    text-align: center;
    white-space: nowrap;
}

/* Fix for page transition */
.container {
    position: relative;
}

.split-screen.hidden {
    display: none;
}

/* Physical Events Section Styles */
.physical-events-section {
    padding: 20px;
    background-color: var(--background-color);
    margin-top: 15px;
    height:250hv;
}

.section-header {
    margin-bottom: 20px;
    color:ffffff;
}

.section-header-row {
    display: flex;
    align-items: center;
    gap: 20px;
}

.see-more-events-btn {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 20px;
    font-size: 0.85rem;
    font-weight: 200;
    display: flex;
    align-items: center;
    gap: 6px;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
}

.see-more-events-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
}

.see-more-events-btn i {
    font-size: 0.75rem;
}

.physical-events-section .section-title {
    font-size: 1.4rem;
    font-weight: 400;
    color: white !important;
    display: flex;
    align-items: center;
    gap: 10px;
    margin: 0;
}

.physical-events-section .section-title i {
    color: white !important;
    font-size: 1.2rem;
}

.section-subtitle {
    color: rgba(255, 255, 255, 0.8);
    font-size: 0.9rem;
    margin-left: 0;
}

.physical-events-container {
    width: 100%;
    
    overflow: hidden;
}

.events-scroll-wrapper {
    display: flex;
    gap: 15px;
    overflow-x: auto;
    padding: 10px 0 20px 0;
    scroll-behavior: smooth;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: none; /* Firefox */
    -ms-overflow-style: none; /* IE and Edge */
}

.events-scroll-wrapper::-webkit-scrollbar {
    display: none; /* Chrome, Safari, Opera */
}

.physical-event-display-card {
    min-width: 280px;
    max-width: 280px;
    height: 340px;
    background: var(--white);
    border-radius: 16px;
    overflow: hidden;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    transition: all 0.3s ease;
    cursor: pointer;
    position: relative;
    flex-shrink: 0;
}

.physical-event-display-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15);
}

.event-card-image {
    width: 100%;
    height: 160px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    background-size: cover;
    background-position: center;
}

.event-card-image::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, rgba(0,0,0,0.3), rgba(0,0,0,0.1));
}

.event-category-badge {
    position: absolute;
    top: 12px;
    left: 12px;
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(10px);
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 500;
    color: var(--text-color);
    z-index: 2;
}

.event-card-body {
    padding: 16px;
    height: 180px;
    display: flex;
    flex-direction: column;
}


.event-card-details {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.event-detail-item {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 0.85rem;
    color: var(--text-secondary);
}

.event-detail-item i {
    width: 14px;
    color: var(--primary-color);
    font-size: 0.8rem;
}
/* Event Card Responsive Styles */
.event-card {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 15px;
    margin-bottom: 20px;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    overflow: hidden;
    transition: all 0.3s ease;
}

.event-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
}

.event-card-header {
    position: relative;
    min-height: 120px;
    display: flex;
    align-items: center;
    justify-content: center;
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
}

.event-card-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.4);
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 20px;
}


.expand-indicator {
    color: white;
    font-size: 18px;
    margin-left: 10px;
    opacity: 0.8;
    transition: transform 0.3s ease;
}
/* Fix for Event Title Responsiveness */
.event-title {
    color: white !important;
    font-weight: 600 !important;
    margin: 0 !important;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5) !important;
    flex: 1 !important;
    word-break: break-word !important;
    line-height: 1.2 !important;
    max-width: 100% !important;
    overflow-wrap: break-word !important;
    hyphens: auto !important;
    
    /* Default desktop size */
    font-size: 20px !important;
}

/* Tablet responsiveness */
@media (max-width: 992px) {
    .event-title {
        font-size: 18px !important;
        line-height: 1.3 !important;
    }
}

/* Mobile responsiveness */
@media (max-width: 768px) {
    .event-title {
        font-size: 16px !important;
        line-height: 1.3 !important;
        padding-right: 10px !important;
    }
    
    .event-card-overlay {
        padding: 12px 15px !important;
        flex-direction: column !important;
        align-items: flex-start !important;
        gap: 8px !important;
    }
    
    .expand-indicator {
        align-self: flex-end !important;
        margin-left: 0 !important;
    }
}

/* Small mobile responsiveness */
@media (max-width: 480px) {
    .event-title {
        font-size: 14px !important;
        line-height: 1.4 !important;
        padding-right: 8px !important;
    }
    
    .event-card-overlay {
        padding: 10px 12px !important;
    }
    
    .expand-indicator {
        font-size: 14px !important;
    }
}

/* Extra small screens */
@media (max-width: 360px) {
    .event-title {
        font-size: 13px !important;
        line-height: 1.4 !important;
    }
    
    .event-card-overlay {
        padding: 8px 10px !important;
    }
}

/* Alternative flex layout for very long titles */
@media (max-width: 768px) {
    .event-card-overlay {
        display: flex !important;
        flex-direction: row !important;
        align-items: center !important;
        justify-content: space-between !important;
        flex-wrap: wrap !important;
    }
    
    .event-title {
        flex: 1 1 auto !important;
        min-width: 0 !important;
        margin-right: 10px !important;
    }
    
    .expand-indicator {
        flex: 0 0 auto !important;
        margin-left: auto !important;
    }
}

/* For ultra-long titles */
@media (max-width: 480px) {
    .event-title {
        display: -webkit-box !important;
        -webkit-line-clamp: 2 !important;
        -webkit-box-orient: vertical !important;
        overflow: hidden !important;
        text-overflow: ellipsis !important;
        max-height: 2.8em !important;
    }
}

/* iOS specific fixes */
@supports (-webkit-touch-callout: none) {
    .event-title {
        -webkit-user-select: none !important;
        user-select: none !important;
        -webkit-text-size-adjust: 100% !important;
    }
}
.event-card.expanded .expand-indicator {
    transform: rotate(180deg);
}

.event-card-content {
    padding: 20px;
    background: rgba(255, 255, 255, 0.02);
}

/* Event ID Section */
.event-id-section {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 10px;
    padding: 15px;
    margin-bottom: 20px;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.event-id-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    cursor: pointer;
    transition: all 0.3s ease;
}

.event-id-header:hover {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 6px;
    padding: 8px;
    margin: -8px;
}

.event-id-label {
    color: rgba(255, 255, 255, 0.9);
    font-weight: 600;
    font-size: 16px;
    display: flex;
    align-items: center;
    gap: 8px;
}

.security-icon {
    color: #ffd700;
    font-size: 12px;
}

.event-id-controls {
    display: flex;
    gap: 10px;
}

.security-toggle-btn,
.eye-toggle-btn {
    background: rgba(255, 255, 255, 0.1);
    border: 2px solid rgba(255, 255, 255, 0.3);
    color: white;
    padding: 6px 8px;
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
}

.security-toggle-btn:hover,
.eye-toggle-btn:hover {
    background: rgba(255, 255, 255, 0.2);
    transform: translateY(-1px);
}

.eye-toggle-btn.disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.event-id-container {
    margin-top: 12px;
    padding-top: 12px;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
}

.event-id-content {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 8px;
}

.event-id-code {
    background: rgba(0, 0, 0, 0.3);
    color: #4ECDC4;
    padding: 6px 10px;
    border-radius: 6px;
    font-family: 'Courier New', monospace;
    font-size: 13px;
    flex: 1;
    min-width: 0;
    word-break: break-all;
}

.copy-id-btn {
    background: #4ECDC4;
    color: white;
    border: none;
    padding: 8px 10px;
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
}

.copy-id-btn:hover {
    background: #45a9a9;
    transform: translateY(-1px);
}

.copy-id-btn.disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.event-id-note {
    color: rgba(255, 255, 255, 0.7);
    font-size: 12px;
    line-height: 1.4;
}

/* Stats Grid */
.ticket-stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
    margin-bottom: 20px;
}

.stat-card {
    background: rgba(255, 255, 255, 0.05);
    padding: 15px;
    border-radius: 10px;
    text-align: center;
    border: 1px solid rgba(255, 255, 255, 0.1);
    transition: all 0.3s ease;
}

.stat-card:hover {
    background: rgba(255, 255, 255, 0.08);
    transform: translateY(-2px);
}

.stat-value {
    font-size: 24px;
    font-weight: 600;
    color: #4ECDC4;
    margin-bottom: 4px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
}

.stat-label {
    font-size: 14px;
    color: rgba(255, 255, 255, 0.7);
}

/* Individual Ticket Sales */
.individual-ticket-sales {
    grid-column: 1 / -1;
    margin-top: 15px;
}

.individual-ticket-sales h4 {
    color: white;
    font-size: 18px;
    margin-bottom: 12px;
    font-weight: 600;
}

.ticket-breakdown-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 10px;
}

/* Sponsors Section */
.sponsors-section {
    background: rgba(255, 255, 255, 0.05);
    padding: 15px;
    border-radius: 10px;
    margin-bottom: 20px;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.sponsors-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
}

.sponsors-header h4 {
    color: white;
    font-size: 18px;
    margin: 0;
    font-weight: 600;
}

.add-sponsors-btn {
    background: #4ECDC4;
    color: white;
    border: none;
    padding: 8px 12px;
    border-radius: 6px;
    cursor: pointer;
    font-weight: 600;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 13px;
}

.add-sponsors-btn:hover {
    background: #45a9a9;
    transform: translateY(-1px);
}

/* Action Buttons */
.event-action-buttons {
    display: flex;
    gap: 8px;
    margin-top: 12px;
}

.setup-bank-btn,
.withdraw-pee-btn {
    flex: 1;
    border: none;
    padding: 8px 12px;
    border-radius: 6px;
    cursor: pointer;
    font-weight: 600;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
    font-size: 13px;
    color: white;
}

.setup-bank-btn {
    background: linear-gradient(135deg, #007bff, #0056b3);
}

.withdraw-pee-btn {
    background: linear-gradient(135deg, #28a745, #20c997);
}

.setup-bank-btn:hover,
.withdraw-pee-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
}

/* Mobile Responsive Styles */
@media (max-width: 768px) {
    .event-card-header {
        min-height: 100px;
    }
    
    .event-card-overlay {
        padding: 15px;
    }
    
    .event-title {
        font-size: 18px;
    }
    
    .expand-indicator {
        font-size: 16px;
    }
    
    .event-card-content {
        padding: 15px;
    }
    
    .event-id-section {
        padding: 12px;
        margin-bottom: 15px;
    }
    
    .event-id-header {
        flex-wrap: wrap;
        gap: 10px;
    }
    
    .event-id-label {
        font-size: 14px;
        flex: 1;
        min-width: 0;
    }
    
    .event-id-controls {
        gap: 8px;
        flex-shrink: 0;
    }
    
    .security-toggle-btn,
    .eye-toggle-btn {
        padding: 8px;
        min-width: 40px;
        min-height: 40px;
    }
    
    .security-toggle-btn i,
    .eye-toggle-btn i {
        font-size: 14px;
    }
    
    .event-id-content {
        flex-wrap: wrap;
    }
    
    .event-id-code {
        font-size: 12px;
        padding: 8px 12px;
    }
    
    .copy-id-btn {
        padding: 10px;
        min-width: 44px;
        min-height: 44px;
    }
    
    .copy-id-btn i {
        font-size: 14px;
    }
    
    .event-id-note {
        font-size: 11px;
    }
    
    /* Stats Grid Mobile */
    .ticket-stats-grid {
        display: block;
        gap: 12px;
        margin-bottom: 15px;
    }
    
    .stat-card {
        padding: 12px;
        margin-bottom: 12px;
    }
    
    .stat-value {
        font-size: 20px;
        flex-wrap: wrap;
    }
    
    .stat-label {
        font-size: 12px;
    }
    
    /* Individual Ticket Sales Mobile */
    .individual-ticket-sales {
        margin-top: 12px;
    }
    
    .individual-ticket-sales h4 {
        font-size: 16px;
        margin-bottom: 10px;
    }
    
    .ticket-breakdown-grid {
        display: block;
        gap: 8px;
    }
    
    /* Sponsors Section Mobile */
    .sponsors-section {
        padding: 12px;
        margin-bottom: 15px;
    }
    
    .sponsors-header {
        flex-wrap: wrap;
        gap: 10px;
    }
    
    .sponsors-header h4 {
        font-size: 16px;
    }
    
    .add-sponsors-btn {
        padding: 10px 16px;
        font-size: 14px;
        min-height: 44px;
    }
    
    /* Action Buttons Mobile */
    .event-action-buttons {
        display: block;
        gap: 10px;
    }
    
    .setup-bank-btn,
    .withdraw-pee-btn {
        width: 100%;
        padding: 12px 16px;
        font-size: 14px;
        min-height: 44px;
        margin-bottom: 10px;
        box-sizing: border-box;
    }
}

@media (max-width: 480px) {
    .event-card-header {
        min-height: 80px;
    }
    
    .event-card-overlay {
        padding: 12px;
    }
    
    .event-title {
        font-size: 16px;
    }
    
    .event-card-content {
        padding: 12px;
    }
    
    .event-id-section {
        padding: 10px;
    }
    
    .event-id-label {
        font-size: 13px;
    }
    
    .event-id-code {
        font-size: 11px;
        padding: 6px 8px;
    }
    
    .event-id-note {
        font-size: 10px;
    }
    
    .stat-value {
        font-size: 18px;
    }
    
    .stat-label {
        font-size: 11px;
    }
    
    .individual-ticket-sales h4 {
        font-size: 15px;
    }
    
    .sponsors-header h4 {
        font-size: 15px;
    }
    
    .add-sponsors-btn {
        font-size: 13px;
    }
    
    .setup-bank-btn,
    .withdraw-pee-btn {
        font-size: 13px;
    }
}

/* iOS Specific Styles */
@supports (-webkit-touch-callout: none) {
    .security-toggle-btn,
    .eye-toggle-btn,
    .copy-id-btn,
    .add-sponsors-btn,
    .setup-bank-btn,
    .withdraw-pee-btn {
        -webkit-appearance: none;
        -webkit-user-select: none;
        -webkit-touch-callout: none;
    }
    
    .event-id-code {
        -webkit-user-select: all;
        user-select: all;
    }
}

/* Touch Device Optimizations */
@media (hover: none) and (pointer: coarse) {
    .event-card:hover,
    .stat-card:hover,
    .security-toggle-btn:hover,
    .eye-toggle-btn:hover,
    .copy-id-btn:hover,
    .add-sponsors-btn:hover,
    .setup-bank-btn:hover,
    .withdraw-pee-btn:hover {
        transform: none;
        box-shadow: none;
    }
    
    .event-card:active,
    .stat-card:active {
        transform: scale(0.98);
    }
    
    .security-toggle-btn:active,
    .eye-toggle-btn:active,
    .copy-id-btn:active,
    .add-sponsors-btn:active,
    .setup-bank-btn:active,
    .withdraw-pee-btn:active {
        transform: scale(0.95);
    }
}

/* Focus States for Accessibility */
.security-toggle-btn:focus,
.eye-toggle-btn:focus,
.copy-id-btn:focus,
.add-sponsors-btn:focus,
.setup-bank-btn:focus,
.withdraw-pee-btn:focus {
    outline: 2px solid #4ECDC4;
    outline-offset: 2px;
}

/* Animation Classes */
.fade-in {
    animation: fadeIn 0.3s ease-in-out;
}

.slide-down {
    animation: slideDown 0.3s ease-in-out;
}

@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(-10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@keyframes slideDown {
    from {
        max-height: 0;
        opacity: 0;
    }
    to {
        max-height: 200px;
        opacity: 1;
    }
}

.buy-ticket-btn {
    width: 100%;
    background: linear-gradient(135deg, var(--primary-color), #667eea);
    color: white;
    border: none;
    padding: 12px;
    border-radius: 10px;
    font-weight: 600;
    font-size: 0.9rem;
    cursor: pointer;
    transition: all 0.3s ease;
    margin-top: auto;
}

.buy-ticket-btn:hover {
    background: linear-gradient(135deg, #667eea, var(--primary-color));
    transform: translateY(-1px);
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
}

.buy-ticket-btn:active {
    transform: translateY(0);
}

/* Get Ticket Button Top */
.get-ticket-btn-top {
    position: absolute;
    top: 12px;
    right: 12px;
    padding: 6px 12px;
    background: rgba(255, 255, 255, 0.9);
    color: #333;
    border: none;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    backdrop-filter: blur(10px);
    z-index: 2;
}

.get-ticket-btn-top:hover {
    background: rgba(255, 255, 255, 1);
    transform: scale(1.05);
}

.get-ticket-btn-top i {
    margin-right: 4px;
    font-size: 0.7rem;
}

/* Event Sponsors Carousel */
.event-sponsors-carousel {
    margin-top: 12px;
    overflow: hidden;
    height: 50px;
    display: flex;
    align-items: center;
}

.sponsors-track {
    display: flex;
    gap: 8px;
    animation: sponsorScroll 10s linear infinite;
}

.sponsor-circle {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    font-size: 0.9rem;
    flex-shrink: 0;
}

@keyframes sponsorScroll {
    0% { transform: translateX(0); }
    100% { transform: translateX(-100%); }
}

/* Advanced Sponsors Carousel */
.advanced-sponsors-carousel {
    margin-top: 16px;
    overflow: hidden;
    height: 45px;
    display: flex;
    align-items: center;
    border-radius: 12px;
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(10px);
}

.sponsors-label {
    font-size: 0.7rem;
    font-weight: 600;
    color: rgba(255, 255, 255, 0.8);
    text-align: center;
    padding: 5px 0;
    animation: sponsorLabelFade 15s ease-in-out infinite;
}

.advanced-sponsors-track {
    display: flex;
    gap: 10px;
    animation: advancedSponsorScroll 15s linear infinite;
    padding: 0 10px;
}

.advanced-sponsor-circle {
    width: 35px;
    height: 35px;
    border-radius: 50%;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    font-size: 0.8rem;
    flex-shrink: 0;
    border: 2px solid rgba(255, 255, 255, 0.3);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    overflow: hidden;
}

.advanced-sponsor-circle.sponsor-with-logo {
    background: transparent;
    padding: 0;
}

@keyframes advancedSponsorScroll {
    0%, 33% { transform: translateX(0); }
    66%, 100% { transform: translateX(-100%); }
}

@keyframes sponsorLabelFade {
    0%, 20% { opacity: 1; transform: translateY(0); }
    25%, 95% { opacity: 0.7; transform: translateY(-2px); }
    100% { opacity: 1; transform: translateY(0); }
}

/* Ad Card Styles */
.ad-display-card {
    min-width: 280px;
    max-width: 280px;
    height: 340px;
    background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    border-radius: 16px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    color: white;
    text-align: center;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    position: relative;
    overflow: hidden;
    flex-shrink: 0;
}

.ad-display-card::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
    animation: shimmer 3s ease-in-out infinite;
}

@keyframes shimmer {
    0%, 100% { transform: rotate(0deg); }
    50% { transform: rotate(180deg); }
}

@keyframes scroll-banners {
    0% { transform: translateX(100%); }
    100% { transform: translateX(-100%); }
}

.ad-content {
    z-index: 2;
    padding: 20px;
}

.ad-title {
    font-size: 1.3rem;
    font-weight: 700;
    margin-bottom: 10px;
    text-shadow: 0 2px 4px rgba(0,0,0,0.2);
}

.ad-subtitle {
    font-size: 0.9rem;
    opacity: 0.9;
    margin-bottom: 20px;
}

.ad-cta-btn {
    background: rgba(255, 255, 255, 0.2);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.3);
    color: white;
    padding: 10px 20px;
    border-radius: 25px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
}

.ad-cta-btn:hover {
    background: rgba(255, 255, 255, 0.3);
    transform: translateY(-2px);
}

/* Responsive Design */
@media (max-width: 768px) {
    .physical-events-section {
        padding: 15px;
    }
    
    .section-title {
        font-size: 1.2rem;
    }
    
    .physical-event-display-card,
    .ad-display-card {
        min-width: 250px;
        max-width: 250px;
        height: 320px;
    }
    
    .event-card-image {
        height: 140px;
    }
    
    .event-card-body {
        height: 180px;
        padding: 14px;
    }
}

@media (max-width: 480px) {
    .physical-event-display-card,
    .ad-display-card {
        min-width: 220px;
        max-width: 220px;
        height: 300px;
    }
    
    .event-card-image {
        height: 120px;
    }
    
    .event-card-body {
        height: 180px;
        padding: 12px;
    }
    
    .events-scroll-wrapper {
        gap: 12px;
    }
}

/* Loading and Error States for Physical Events Display */
.loading-events-display, .no-events-display, .error-events-display {
    text-align: center;
    padding: 40px 20px;
    color: var(--text-secondary);
}

.loading-events-display i {
    font-size: 2rem;
    color: var(--primary-color);
    margin-bottom: 15px;
    animation: spin 1s linear infinite;
}

.no-events-display i, .error-events-display i {
    font-size: 2.5rem;
    color: var(--text-secondary);
    margin-bottom: 15px;
}

.loading-events-display h3, .no-events-display h3, .error-events-display h3 {
    font-size: 1.2rem;
    font-weight: 600;
    color: var(--text-color);
    margin-bottom: 8px;
}

.loading-events-display p, .no-events-display p, .error-events-display p {
    font-size: 0.9rem;
    margin-bottom: 20px;
}

.retry-btn {
    background: var(--primary-color);
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 8px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.3s ease;
}

.retry-btn:hover {
    background: #667eea;
    transform: translateY(-1px);
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* Advanced Physical Event Card Styles */
.advanced-event-card {
    min-width: 320px;
    max-width: 320px;
    height: 400px;
    border-radius: 24px;
    overflow: hidden;
    position: relative;
    cursor: pointer;
    transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
    flex-shrink: 0;
    background: #fff;
}

.advanced-event-card:hover {
    transform: translateY(-8px) scale(1.02);
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
}

.advanced-event-background {
    width: 100%;
    height: 100%;
    position: absolute;
    top: 0;
    left: 0;
    z-index: 1;
    object-fit: cover;
    border-radius: 24px;
}

.advanced-event-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(
        135deg,
        rgba(0, 0, 0, 0.2) 0%,
        rgba(0, 0, 0, 0.4) 50%,
        rgba(0, 0, 0, 0.7) 100%
    );
    z-index: 2;
}

.advanced-category-badge {
    position: absolute;
    top: 16px;
    left: 16px;
    padding: 8px 16px;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 700;
    color: white;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.2);
    z-index: 3;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
}

.advanced-tickets-badge {
    position: absolute;
    top: 16px;
    right: 16px;
    padding: 8px 12px;
    background: rgba(255, 87, 87, 0.9);
    color: white;
    border-radius: 16px;
    font-size: 0.7rem;
    font-weight: 600;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.2);
    z-index: 3;
    display: flex;
    align-items: center;
    gap: 4px;
    box-shadow: 0 4px 20px rgba(255, 87, 87, 0.3);
}

.advanced-tickets-badge i {
    font-size: 0.6rem;
    animation: flicker 2s ease-in-out infinite alternate;
}

@keyframes flicker {
    0% { opacity: 1; }
    100% { opacity: 0.7; }
}

.advanced-withdraw-badge {
    position: absolute;
    top: 60px;
    right: 16px;
    padding: 8px 12px;
    background: rgba(34, 197, 94, 0.9);
    color: white;
    border-radius: 16px;
    font-size: 0.7rem;
    font-weight: 600;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.2);
    z-index: 3;
    display: flex;
    align-items: center;
    gap: 6px;
    box-shadow: 0 4px 20px rgba(34, 197, 94, 0.3);
}

.advanced-withdraw-badge i {
    font-size: 0.6rem;
}

.eye-toggle-btn {
    background: none;
    border: none;
    color: white;
    cursor: pointer;
    padding: 2px;
    margin-left: 4px;
    border-radius: 50%;
    transition: all 0.3s ease;
    opacity: 0.8;
}

.eye-toggle-btn:hover {
    opacity: 1;
    background: rgba(255, 255, 255, 0.2);
}

.withdraw-amount.hidden {
    display: none;
}

.advanced-likes-badge {
    position: absolute;
    top: 60px;
    left: 16px;
    padding: 8px 12px;
   border-radius: 16px;
    font-size: 0.7rem;
    font-weight: 600;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.2);
    z-index: 3;
    display: flex;
    align-items: center;
    gap: 6px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
}

.like-btn {
    background: none;
    border: none;
    cursor: pointer;
    padding: 2px;
    border-radius: 50%;
    transition: all 0.3s ease;
    color: #ff4757;
}

.like-btn:hover {
    transform: scale(1.1);
}

.like-btn.liked i {
    color: #ff4757;
    animation: heartBeat 0.6s ease-in-out;
}

.like-btn:not(.liked) i {
    color: #999;
}

.likes-count {
    color: #333;
    font-weight: 600;
}

@keyframes heartBeat {
    0% { transform: scale(1); }
    50% { transform: scale(1.2); }
    100% { transform: scale(1); }
}

.advanced-event-content {
    position: absolute;
    bottom: 80px;
    left: 20px;
    right: 20px;
    z-index: 3;
    color: white;
}

.advanced-event-title {
    font-size: 1.4rem;
    font-weight: 700;
    margin: 0 0 16px 0;
    line-height: 1.3;
    text-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

.advanced-event-details {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.advanced-detail-row {
    display: flex;
    gap: 16px;
    align-items: center;
}

.advanced-detail-item {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 0.85rem;
    font-weight: 500;
    color: rgba(255, 255, 255, 0.9);
    text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);
}

.advanced-detail-item i {
    width: 14px;
    font-size: 0.8rem;
    color: rgba(255, 255, 255, 0.8);
}

.advanced-card-actions {
    position: absolute;
    bottom: 20px;
    left: 20px;
    right: 20px;
    z-index: 3;
}

.advanced-buy-btn {
    width: 100%;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
    padding: 14px 20px;
    border-radius: 16px;
    font-weight: 700;
    font-size: 0.9rem;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    box-shadow: 0 4px 20px rgba(102, 126, 234, 0.3);
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.advanced-buy-btn:hover {
    background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
    transform: translateY(-2px);
    box-shadow: 0 8px 30px rgba(102, 126, 234, 0.4);
}

.advanced-buy-btn:active {
    transform: translateY(0);
}

/* Enhanced Ad Cards */
.ad-display-card {
    min-width: 320px;
    max-width: 320px;
    height: 400px;
    border-radius: 24px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    color: white;
    text-align: center;
    position: relative;
    overflow: hidden;
    flex-shrink: 0;
    cursor: pointer;
    transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
}

.ad-display-card:hover {
    transform: translateY(-8px) scale(1.02);
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
}

.ad-display-card::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
    animation: shimmer 4s ease-in-out infinite;
}

@keyframes shimmer {
    0%, 100% { transform: rotate(0deg); }
    50% { transform: rotate(180deg); }
}

.ad-content {
    z-index: 2;
    padding: 30px;
}

.ad-title {
    font-size: 1.5rem;
    font-weight: 800;
    margin-bottom: 12px;
    text-shadow: 0 2px 10px rgba(0,0,0,0.3);
    text-transform: uppercase;
    letter-spacing: 1px;
}

.ad-subtitle {
    font-size: 1rem;
    opacity: 0.9;
    margin-bottom: 24px;
    line-height: 1.4;
    text-shadow: 0 1px 5px rgba(0,0,0,0.2);
}

.ad-cta-btn {
    background: rgba(255, 255, 255, 0.2);
    backdrop-filter: blur(15px);
    border: 2px solid rgba(255, 255, 255, 0.3);
    color: white;
    padding: 12px 24px;
    border-radius: 30px;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.3s ease;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    font-size: 0.85rem;
}

.ad-cta-btn:hover {
    background: rgba(255, 255, 255, 0.3);
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
    border-color: rgba(255, 255, 255, 0.5);
}

/* Responsive Design for Advanced Cards */
@media (max-width: 768px) {
    .advanced-event-card,
    .ad-display-card {
        min-width: 280px;
        max-width: 280px;
        height: 360px;
    }
    
    .advanced-event-title {
        font-size: 1.2rem;
    }
    
    .advanced-event-content {
        bottom: 70px;
        left: 16px;
        right: 16px;
    }
    
    .advanced-card-actions {
        bottom: 16px;
        left: 16px;
        right: 16px;
    }
    
    .advanced-buy-btn {
        padding: 12px 16px;
        font-size: 0.85rem;
    }
}

@media (max-width: 480px) {
    .advanced-event-card,
    .ad-display-card {
        min-width: 260px;
        max-width: 260px;
        height: 340px;
    }
    
    .advanced-category-badge,
    .advanced-tickets-badge {
        top: 12px;
    }
    
    .advanced-category-badge {
        left: 12px;
        padding: 6px 12px;
        font-size: 0.7rem;
    }
    
    .advanced-tickets-badge {
        right: 12px;
        padding: 6px 10px;
        font-size: 0.65rem;
    }
}

.action-btn.Game-btn:active {
  transform: translateY(1px);
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

/* Simple Shimmer Effect for Event Cards */
.advanced-event-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(
        45deg,
        transparent 30%,
        rgba(255, 255, 255, 0.1) 50%,
        transparent 70%
    );
    animation: shimmer 6s ease-in-out infinite;
    z-index: 2;
    pointer-events: none;
}

@keyframes shimmer {
    0% { transform: translateX(-100%) translateY(-100%); }
    50% { transform: translateX(0%) translateY(0%); }
    100% { transform: translateX(100%) translateY(100%); }
}



/* Enhanced Category Badge with Icon */
.advanced-category-badge {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 8px 16px;
}

.advanced-category-badge i {
    font-size: 0.7rem;
    animation: badgeIconSpin 4s ease-in-out infinite;
}

@keyframes badgeIconSpin {
    0%, 100% { transform: rotate(0deg); }
    50% { transform: rotate(5deg); }
}


.action-icon.game-icon {
   width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.1rem;
}

.action-icon.game-icon i {
  color: #c23737;
  font-size: 20px;
 
}

.action-btn.Game-btn span {
  color: #333;
  font-size: 14px;
  font-weight: 500;
  letter-spacing: 0.5px;
  text-transform: uppercase;
}



@keyframes gamepadWiggle {
  0% {
    transform: rotate(0deg);
  }
  25% {
    transform: rotate(-15deg);
  }
  50% {
    transform: rotate(15deg);
  }
  75% {
    transform: rotate(-15deg);
  }
  100% {
    transform: rotate(0deg);
  }
}


/* Responsive adjustments */
@media (max-width: 768px) {
  .action-btn.Game-btn {
    padding: 10px 12px;
  }
  
  .action-icon.game-icon {
    width: 35px;
    height: 35px;
  }
  
  .action-icon.game-icon i {
    font-size: 18px;
  }
  
  .action-btn.Game-btn span {
    font-size: 12px;
  }
}

@media (max-width: 480px) {
  .action-btn.Game-btn {
    padding: 8px 10px;
  }
  
  .action-icon.game-icon {
    width: 30px;
    height: 30px;
    margin-bottom: 5px;
  }
  
  .action-icon.game-icon i {
    font-size: 16px;
  }
  
  .action-btn.Game-btn span {
    font-size: 11px;
  }
}





/* Rewarder Button Styles */
.action-btn.rewarder-btn {
    width: 50px;
    height: 100px;
    background-color: var(--white);
    border-radius: 12px;
    padding: 10px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 3px 8px rgba(0, 0, 0, 0.08);
    min-width: 70px;
    flex: 1;
    position: relative;
    overflow: hidden;

}

.action-btn.rewarder-btn:active {
    transform: scale(0.95);
}


.action-icon.rewarder {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.1rem;
    background-color: rgba(142, 68, 173, 0.1);
    color: #8e44ad;
    position: relative;
    z-index: 1;
}

/* Diamond icon animation */
.action-icon.rewarder i {
    animation: diamond-pulse 3s infinite;
    position: relative;
}

/* Diamond sparkle effect */
.action-icon.rewarder::before {
    content: '';
    position: absolute;
    width: 100%;
    height: 100%;
    border-radius: 50%;
    border: 2px dashed #8e44ad;
    animation: spin-reverse 10s linear infinite;
}

/* Diamond glow effect */
.action-icon.rewarder::after {
    content: '';
    position: absolute;
    width: 100%;
    height: 100%;
    border-radius: 50%;
    background: radial-gradient(circle, rgba(142, 68, 173, 0.4) 0%, transparent 70%);
    animation: glow-pulse 2s infinite;
}

/* Sparkle points around the diamond */
.action-icon.rewarder i::before {
    content: "\f3a5"; /* fa-gem code */
    position: relative;
    z-index: 2;
}

.action-icon.rewarder i::after {
    content: '';
    position: absolute;
    width: 100%;
    height: 100%;
    background: radial-gradient(
        circle at 30% 30%,
        rgba(255, 255, 255, 0.8) 0%,
        rgba(255, 255, 255, 0) 20%
    ), radial-gradient(
        circle at 70% 20%,
        rgba(255, 255, 255, 0.8) 0%,
        rgba(255, 255, 255, 0) 20%
    ), radial-gradient(
        circle at 90% 60%,
        rgba(255, 255, 255, 0.8) 0%,
        rgba(255, 255, 255, 0) 20%
    ), radial-gradient(
        circle at 40% 80%,
        rgba(255, 255, 255, 0.8) 0%,
        rgba(255, 255, 255, 0) 20%
    );
    animation: sparkle-twinkle 3s infinite;
    z-index: 1;
}

.action-btn.rewarder-btn span {
    font-weight: 500;
    font-size: 0.8rem;
    color: #333;
    text-align: center;
    white-space: nowrap;
    position: relative;
    z-index: 1;
}

/* Fix for FontAwesome diamond icon */
.fas.fa-Diamond::before {
    content: "\f3a5"; /* This is the content code for fa-gem which looks like a diamond */
}

/* Animations */
@keyframes diamond-pulse {
    0% {
        transform: scale(1);
        color: #8e44ad;
    }
    50% {
        transform: scale(1.2);
        color: #9b59b6;
    }
    100% {
        transform: scale(1);
        color: #8e44ad;
    }
}

@keyframes spin-reverse {
    0% {
        transform: rotate(360deg);
    }
    100% {
        transform: rotate(0deg);
    }
}

@keyframes glow-pulse {
    0% {
        opacity: 0.3;
    }
    50% {
        opacity: 0.7;
    }
    100% {
        opacity: 0.3;
    }
}


@keyframes sparkle-twinkle {
    0%, 100% {
        opacity: 0.2;
    }
    50% {
        opacity: 1;
    }
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .action-btn.rewarder-btn {
        padding: 10px 12px;
    }
    
    .action-icon.rewarder {
        width: 35px;
        height: 35px;
    }
    
    .action-icon.rewarder i {
        font-size: 18px;
    }
    
    .action-btn.rewarder-btn span {
        font-size: 12px;
    }
}

@media (max-width: 480px) {
    .action-btn.rewarder-btn {
        padding: 8px 10px;
    }
    
    .action-icon.rewarder {
        width: 30px;
        height: 30px;
        margin-bottom: 5px;
    }
    
    .action-icon.rewarder i {
        font-size: 16px;
    }
    
    .action-btn.rewarder-btn span {
        font-size: 11px;
    }
}


/* Wallet icon with subtle bounce animation */
.action-btn.wallet-btn .action-icon i {
    position: relative;
    z-index: 2;
    animation: wallet-bounce 3s ease-in-out infinite;
}

/* Coin animations */
.action-btn.wallet-btn .action-icon::before,
.action-btn.wallet-btn .action-icon::after {
    content: '';
    position: absolute;
    width: 12px;
    height: 12px;
    background-color: #f1c40f;
    border-radius: 50%;
    border: 1px solid #e67e22;
    z-index: 1;
    opacity: 0;
}

/* First coin animation */
.action-btn.wallet-btn .action-icon::before {
    top: -30px;
    left: 10px;
    animation: coin-drop-1 4s infinite;
}

/* Second coin animation */
.action-btn.wallet-btn .action-icon::after {
    top: -30px;
    right: 10px;
    animation: coin-drop-2 4s infinite 1s;
}

/* Wallet opening effect */
.action-btn.wallet-btn::before {
    content: '';
    position: absolute;
    width: 30px;
    height: 3px;
    background-color: rgba(108, 92, 231, 0.3);
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    border-radius: 3px;
    z-index: 1;
    animation: wallet-open 4s infinite;
}

/* Coin pile inside wallet */
.action-btn.wallet-btn::after {
    content: '';
    position: absolute;
    width: 20px;
    height: 6px;
    background: radial-gradient(circle, #f1c40f 30%, #e67e22 100%);
    border-radius: 50%;
    top: 55%;
    left: 50%;
    transform: translate(-50%, -50%) scaleY(0.3);
    z-index: 1;
    opacity: 0;
    animation: coin-pile-grow 4s infinite;
}

.action-btn.wallet-btn span {
    font-weight: 500;
    font-size: 0.8rem;
    color: var(--text-color);
    text-align: center;
    white-space: nowrap;
    position: relative;
    z-index: 2;
}

/* Animations */
@keyframes wallet-bounce {
    0%, 100% {
        transform: translateY(0);
    }
    50% {
        transform: translateY(-2px);
    }
}

@keyframes coin-drop-1 {
    0%, 100% {
        top: -30px;
        opacity: 0;
    }
    20% {
        opacity: 1;
        top: -20px;
    }
    40% {
        top: 10px;
        opacity: 1;
    }
    45% {
        top: 8px;
        opacity: 1;
    }
    50% {
        top: 10px;
        opacity: 0;
    }
}

@keyframes coin-drop-2 {
    0%, 100% {
        top: -30px;
        opacity: 0;
    }
    20% {
        opacity: 1;
        top: -20px;
    }
    40% {
        top: 10px;
        opacity: 1;
    }
    45% {
        top: 8px;
        opacity: 1;
    }
    50% {
        top: 10px;
        opacity: 0;
    }
}

@keyframes wallet-open {
    0%, 15%, 85%, 100% {
        width: 0;
        opacity: 0;
    }
    20%, 80% {
        width: 30px;
        opacity: 1;
    }
}

@keyframes coin-pile-grow {
    0%, 40%, 100% {
        opacity: 0;
        transform: translate(-50%, -50%) scaleY(0.3) scaleX(0.8);
    }
    50%, 90% {
        opacity: 1;
        transform: translate(-50%, -50%) scaleY(0.3) scaleX(1);
    }
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .action-btn.wallet-btn {
        padding: 10px 12px;
    }
    
    .action-btn.wallet-btn .action-icon {
        width: 35px;
        height: 35px;
    }
    
    .action-btn.wallet-btn .action-icon i {
        font-size: 18px;
    }
    
    .action-btn.wallet-btn span {
        font-size: 12px;
    }
}

@media (max-width: 480px) {
    .action-btn.wallet-btn {
        padding: 8px 10px;
    }
    
    .action-btn.wallet-btn .action-icon {
        width: 30px;
        height: 30px;
        margin-bottom: 5px;
    }
    
    .action-btn.wallet-btn .action-icon i {
        font-size: 16px;
    }
    
    .action-btn.wallet-btn span {
        font-size: 11px;
    }
    
    .action-btn.wallet-btn .action-icon::before,
    .action-btn.wallet-btn .action-icon::after {
        width: 10px;
        height: 10px;
    }
}

/* Responsive Styles for Dashboard */
@media (max-width: 360px) {
    .dashboard-nav {
        padding: 8px 10px;
        height: 50px;
    }
    
    .profile-circle {
        width: 32px;
        height: 32px;
    }
    
    .username {
        font-size: 0.85rem;
        max-width: 80px;
    }
    
    
    .hamburger-menu {
        width: 32px;
        height: 32px;
    }
    
    .hamburger-menu i {
        font-size: 1.1rem;
    }
    
    .action-buttons-row {
        gap: 8px;
    }
    
    .action-btn {
        min-width: 60px;
        padding: 8px;
    }
    
    .action-icon {
        width: 35px;
        height: 35px;
        font-size: 1rem;
    }
    
    .action-btn span {
        font-size: 0.75rem;
    }
}

/* iPhone X and newer notch fixes */
@supports (padding: max(0px)) {
    .dashboard-nav {
        padding-left: max(15px, env(safe-area-inset-left));
        padding-right: max(15px, env(safe-area-inset-right));
        padding-top: max(10px, env(safe-area-inset-top));
    }
    
    .dashboard-container {
        padding-left: max(15px, env(safe-area-inset-left));
        padding-right: max(15px, env(safe-area-inset-right));
        padding-bottom: max(15px, env(safe-area-inset-bottom));
    }
}

/* Fix for very small screens */
@media (max-width: 320px) {
    .action-buttons-row {
        justify-content: flex-start;
    }
    
    .action-btn {
        min-width: 55px;
    }
    
    .action-icon {
        width: 30px;
        height: 30px;
        font-size: 0.9rem;
    }
    
    .action-btn span {
        font-size: 0.7rem;
    }
    
}




:root {
    --primary-color: #6c5ce7;
    --primary-light: #a29bfe;
    --primary-dark: #5641e5;
    --secondary-color: #00b894;
    --secondary-light: #55efc4;
    --secondary-dark: #00a785;
    --danger-color: #e74c3c;
    --warning-color: #f39c12;
    --success-color: #2ecc71;
    --info-color: #3498db;
    --text-color: #f0ecec;
    --text-light: #fcf9f9;
    --text-lighter: #f7eeee;
    --bg-color: #1a1a2e;
    --bg-light:#1a1a2e;
    --bg-dark: #0e0d0d;
    --border-color: #f8f7f7;
    --border-radius: 10px;
    --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    --transition: all 0.3s ease;
}

/* Base Styles */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
    color: var(--text-color);
    line-height: 1.5;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
}

/* Modal Base Styles */
.wallet-modal,
.feature-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 1000;
    overflow: hidden;
}

.wallet-modal.active,
.feature-modal.active {
    display: flex;
}

.wallet-container,
.feature-modal-content {
    background-color: var(--bg-color);
    border-radius: var(--border-radius);
    box-shadow: var(--shadow);
    width: 90%;
    max-width: 480px;
    max-height: 90vh;
    overflow-y: auto;
    position: relative;
    z-index: 1001;
    animation: modalFadeIn 0.3s ease;
    display: flex;
    flex-direction: column;
}

.wallet-header,
.feature-modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 16px 20px;
    border-bottom: 1px solid var(--border-color);
    position: flex;
    top: 0;
    background-color: var(--bg-color);
    z-index: 10;
}

.wallet-header h2,
.feature-modal-header h2 {
    margin: 0;
    font-size: 1.25rem;
    color: var(--text-color);
    font-weight: 600;
}

.close-wallet,
.close-feature-modal {
    background: none;
    border: none;
    font-size: 24px;
    cursor: pointer;
    color: var(--text-light);
    padding: 0;
    line-height: 1;
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.wallet-screen,
.feature-modal-body {
    padding: 20px;
    flex: 1;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch; /* Smooth scrolling on iOS */
}

.modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    z-index: 999;
    display: none;
    backdrop-filter: blur(3px);
    -webkit-backdrop-filter: blur(3px);
}

.modal-overlay.active {
    display: block;
}

/* PIN Setup/Entry Styles */
.pin-setup,
.pin-entry {
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    padding: 10px 0;
}

.pin-icon {
    width: 70px;
    height: 70px;
    border-radius: 50%;
    background-color: var(--primary-light);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 28px;
    margin-bottom: 20px;
}

.pin-setup h3,
.pin-entry h3 {
    margin: 0 0 10px;
    font-size: 1.2rem;
    color: var(--text-color);
}

.pin-setup p,
.pin-entry p {
    margin: 0 0 20px;
    color: var(--text-light);
    font-size: 0.95rem;
    max-width: 280px;
}

.pin-input-container,
.otp-input-container {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin: 20px 0;
    width: 100%;
    max-width: 280px;
}

.pin-digit,
.pin-confirm-digit,
.pin-login-digit,
.withdraw-pin-digit,
.current-pin-digit,
.new-pin-digit,
.confirm-new-pin-digit,
.transfer-pin-digit,
.otp-digit {
    width: 45px;
    height: 45px;
    border: 2px solid var(--border-color);
    border-radius: 8px;
    text-align: center;
    font-size: 1.2rem;
    font-weight: bold;
    color: var(--text-color);
    background-color: var(--bg-light);
    transition: var(--transition);
    -webkit-appearance: none;
    -moz-appearance: textfield;
}

.pin-digit:focus,
.pin-confirm-digit:focus,
.pin-login-digit:focus,
.withdraw-pin-digit:focus,
.current-pin-digit:focus,
.new-pin-digit:focus,
.confirm-new-pin-digit:focus,
.transfer-pin-digit:focus,
.otp-digit:focus {
    border-color: var(--primary-color);
    outline: none;
    box-shadow: 0 0 0 2px rgba(108, 92, 231, 0.2);
}

.otp-input-container {
    gap: 8px;
}

.otp-digit {
    width: 40px;
    height: 40px;
}

.primary-btn {
    background-color: var(--primary-color);
    color: white;
}

.primary-btn:hover, .primary-btn:active {
    background-color: var(--primary-dark);
}

.secondary-btn {
    background-color: var(--bg-dark);
    color: var(--text-color);
}

.secondary-btn:hover, .secondary-btn:active {
    background-color: var(--border-color);
}

.text-btn {
    background: none;
    color: var(--primary-color);
    padding: 8px 16px;
}

.text-btn:hover, .text-btn:active {
    text-decoration: underline;
}

/* Wallet Dashboard Styles */
.wallet-info {
    margin-bottom: 20px;
}


.copy-btn {
    background: none;
    border: none;
    color: var(--primary-color);
    cursor: pointer;
    padding: 5px;
    font-size: 0.9rem;
    display: flex;
    align-items: center;
    justify-content: center;
}

.balance-cards {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 15px;
    margin-bottom: 20px;
}

.balance-card {
    background-color: var(--bg-light);
    border-radius: var(--border-radius);
    padding: 15px;
    display: flex;
    flex-direction: column;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
}

.balance-card.talent-coin {
    background-color: var(--primary-light);
    color: white;
}

.balance-card.commission {
    background-color: var(--secondary-light);
    color: white;
}

.balance-icon {
    font-size: 1.5rem;
    margin-bottom: 10px;
}

.balance-details h3 {
    margin: 0 0 8px;
    font-size: 0.9rem;
    font-weight: 500;
    opacity: 0.9;
}

.balance-amount {
    font-size: 1.8rem;
    font-weight: 700;
    margin-bottom: 5px;
}

.balance-equivalent {
    font-size: 0.85rem;
    opacity: 0.8;
}

.wallet-actions {
    margin-bottom: 25px;
}

.action-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 15px;
    margin-bottom: 15px;
}

.wallet-action-btn {
    background-color: var(--bg-light);
    border: 1px solid var(--border-color);
    border-radius: var(--border-radius);
    padding: 15px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
   transition: var(--transition);
    -webkit-tap-highlight-color: transparent;
}

.wallet-action-btn:hover, .wallet-action-btn:active {
    background-color: var(--bg-dark);
    transform: translateY(-2px);
}

.wallet-action-btn .action-icon {
    font-size: 1.5rem;
    color: var(--primary-color);
    margin-bottom: 8px;
}

.wallet-action-btn span {
    font-size: 0.9rem;
    font-weight: 500;
    color: var(--text-color);
    text-align: center;
}

.wallet-action-btn {
    position: relative;
    overflow: visible;
}

.ribbon-wrapper {
    width: 85px;
    height: 88px;
    overflow: hidden;
    position: absolute;
    top: -3px;
    right: -3px;
    z-index: 99;
}

.ribbon {
    font-size: 10px;
    font-weight: bold;
    color: #FFF;
    text-align: center;
    -webkit-transform: rotate(45deg);
    -moz-transform: rotate(45deg);
    -ms-transform: rotate(45deg);
    -o-transform: rotate(45deg);
    position: relative;
    padding: 5px 0;
    left: -5px;
    top: 15px;
    width: 120px;
    background-color: #ff6b6b;
    box-shadow: 0px 0px 3px rgba(0,0,0,0.3);
    animation: shimmer 2s infinite;
}

@keyframes shimmer {
    0% {
        background-color: #ff6b6b;
    }
    50% {
        background-color: #ff8f8f;
    }
    100% {
        background-color: #ff6b6b;
    }
}


/* Blinking effect */
@keyframes blink {
    0%, 80%, 100% {
        opacity: 1;
    }
    40% {
        opacity: 0.5;
    }
}



.wallet-action-card:hover:after {
  transform: scaleX(1);
}

.wallet-action-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 15px;
}

.wallet-action-header h3 {
  margin: 0;
  font-size: 1.25rem;
  color: #333;
  font-weight: 600;
}

.wallet-action-header i {
  font-size: 1.8rem;
  color: #ffc107;
  background: rgba(255, 193, 7, 0.1);
  width: 45px;
  height: 45px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 50%;
}

.wallet-action-content {
  color: #666;
}

.wallet-action-content p {
  margin: 0 0 12px;
  font-size: 0.95rem;
}


/* Responsive adjustments */
@media (max-width: 768px) {
  .wallet-action-card {
    padding: 15px;
  }
  
  .wallet-action-header h3 {
    font-size: 1.1rem;
  }
  
  .wallet-action-header i {
    font-size: 1.5rem;
    width: 38px;
    height: 38px;
  }
  
  .wallet-action-content p {
    font-size: 0.9rem;
  }
  
  .bonus-list li {
    font-size: 0.8rem;
  }
}

@media (max-width: 576px) {
  .wallet-action-header h3 {
    font-size: 1rem;
  }
  
  .wallet-action-header i {
    font-size: 1.3rem;
    width: 32px;
    height: 32px;
  }
}


  
/* Media Queries for Responsive Design */
@media (max-width: 768px) {
    .wallet-modal,
    .feature-modal {
        align-items: flex-end;
    }
    
    .wallet-container,
    .feature-modal-content {
     width: 100%;
        max-width: 100%;
        height: 90vh;
        max-height: 90vh;
        border-radius: var(--border-radius) var(--border-radius) 0 0;
        animation: modalSlideUp 0.3s ease;
    }
    
    .wallet-header,
    .feature-modal-header {
        padding: 16px;
    }
    
    .wallet-screen,
    .feature-modal-body {
        padding: 16px;
    }
    
    .pin-icon {
        width: 60px;
        height: 60px;
        font-size: 24px;
    }
    
    .pin-setup h3,
    .pin-entry h3 {
        font-size: 1.1rem;
    }
    
    .pin-setup p,
    .pin-entry p {
        font-size: 0.9rem;
    }
    
    
    .account-row {
        flex-direction: column;
        align-items: flex-start;
    }
    
    .account-row .label {
        margin-bottom: 4px;
    }
    
    .option-buttons {
        flex-direction: row;
    }
}

@media (max-width: 480px) {
    .pin-digit,
    .pin-confirm-digit,
    .pin-login-digit,
    .withdraw-pin-digit,
    .current-pin-digit,
    .new-pin-digit,
    .confirm-new-pin-digit,
    .transfer-pin-digit {
        width: 40px;
        height: 40px;
        font-size: 1.1rem;
    }
    
    .otp-digit {
        width: 35px;
        height: 35px;
        font-size: 1rem;
    }
    
    .balance-cards {
        grid-template-columns: 1fr;
        gap: 10px;
    }
    
    .balance-card {
        padding: 12px;
    }
    
    .balance-amount {
        font-size: 1.5rem;
    }
    
    .action-row {
        gap: 10px;
    }
    
    .wallet-action-btn {
        padding: 12px 10px;
    }
    
    .wallet-action-btn .action-icon {
        font-size: 1.3rem;
        margin-bottom: 6px;
    }
    
    .wallet-action-btn span {
        font-size: 0.8rem;
    }
    
    .tab {
        padding: 10px 15px;
        font-size: 0.9rem;
    }
    
    .input-group label {
        font-size: 0.9rem;
    }
    
    .input-group input,
    .input-group select {
        padding: 10px 12px;
        font-size: 0.9rem;
    }
    
    .option-btn {
        padding: 12px 10px;
    }
    
    .option-btn i {
        font-size: 1.3rem;
        margin-bottom: 6px;
    }
    
    .option-btn span {
        font-size: 0.8rem;
    }
}

/* iPhone X, 11, 12, 13 Notch Support */
@supports (padding: max(0px)) {
    .wallet-container,
    .feature-modal-content {
        padding-bottom: max(20px, env(safe-area-inset-bottom));
    }
    
    .wallet-header,
    .feature-modal-header {
        padding-top: max(16px, env(safe-area-inset-top));
        padding-left: max(16px, env(safe-area-inset-left));
        padding-right: max(16px, env(safe-area-inset-right));
    }
    
    .wallet-screen,
    .feature-modal-body {
        padding-left: max(16px, env(safe-area-inset-left));
        padding-right: max(16px, env(safe-area-inset-right));
    }
}

/* Fix for iOS input zoom */
@media screen and (-webkit-min-device-pixel-ratio: 0) { 
    select,
    textarea,
    input {
        font-size: 16px !important;
    }
}

/* Fix for Android Chrome bottom bar */
@media screen and (max-height: 600px) {
    .wallet-container,
    .feature-modal-content {
        max-height: 85vh;
    }
}

/* iPad specific adjustments */
@media only screen and (min-device-width: 768px) and (max-device-width: 1024px) {
    .wallet-container,
    .feature-modal-content {
        width: 80%;
        max-width: 600px;
        max-height: 80vh;
        border-radius: var(--border-radius);
    }
    
    .wallet-modal,
    .feature-modal {
        align-items: center;
    }
    
    .balance-cards {
        grid-template-columns: 1fr 1fr;
    }
    .action-row {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .wallet-action-btn {
        padding: 20px 15px;
    }
    
    .wallet-action-btn .action-icon {
        font-size: 1.8rem;
        margin-bottom: 10px;
    }
    
    .wallet-action-btn span {
        font-size: 1rem;
    }
    
    .pin-digit,
    .pin-confirm-digit,
    .pin-login-digit,
    .withdraw-pin-digit,
    .current-pin-digit,
    .new-pin-digit,
    .confirm-new-pin-digit,
    .transfer-pin-digit {
        width: 50px;
        height: 50px;
        font-size: 1.3rem;
    }
    
    .otp-digit {
        width: 45px;
        height: 45px;
        font-size: 1.2rem;
    }
    
    .wallet-btn {
        padding: 14px 28px;
        font-size: 1rem;
    }
}

/* Landscape mode adjustments */
@media (orientation: landscape) and (max-height: 500px) {
    .wallet-container,
    .feature-modal-content {
        height: 95vh;
        max-height: 95vh;
    }
    
    .pin-setup,
    .pin-entry {
        flex-direction: row;
        flex-wrap: wrap;
        justify-content: center;
    }
    
    .pin-icon {
        margin-right: 20px;
        margin-bottom: 0;
    }
    
    .pin-setup h3,
    .pin-entry h3,
    .pin-setup p,
    .pin-entry p {
        text-align: left;
        width: calc(100% - 90px);
    }
    
    .pin-input-container,
    .pin-confirm-container,
    .wallet-btn {
        width: 100%;
    }
    
    .balance-cards {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .action-row {
        grid-template-columns: repeat(4, 1fr);
    }
    
    .transaction-history {
        margin-top: 15px;
    }
    
    .transaction-list {
        max-height: 150px;
    }
}

/* Dark mode support */
@media (prefers-color-scheme: dark) {
   
    
    .modal-overlay {
        background-color: rgba(0, 0, 0, 0.7);
    }
    
    .wallet-action-btn {
        background-color: var(--bg-light);
        border-color: var(--border-color);
    }
    
    .wallet-action-btn:hover, .wallet-action-btn:active {
        background-color: var(--bg-dark);
    }
    
    .option-btn {
        background-color: var(--bg-light);
        border-color: var(--border-color);
    }
    
    .option-btn.active {
        background-color: rgba(140, 122, 230, 0.2);
    }
    
    .transaction-icon {
        background-color: var(--bg-dark);
    }
    
    .file-upload-btn {
        background-color: var(--bg-dark);
        color: var(--text-light);
    }
    
    .file-upload-btn:hover, .file-upload-btn:active {
        background-color: var(--border-color);
    }
    
    .pagination-btn {
        color: var(--text-light);
    }
    
    .pagination-btn:hover, .pagination-btn:active {
        background-color: var(--bg-dark);
    }
}

/* Accessibility improvements */
.wallet-btn:focus,
.close-wallet:focus,
.close-feature-modal:focus,
.option-btn:focus,
.tab:focus,
.wallet-action-btn:focus,
.pagination-btn:focus,
.copy-btn:focus {
    outline: 2px solid var(--primary-color);
    outline-offset: 2px;
}

/* Prevent text selection on buttons */
button, 
.option-btn,
.tab,
.wallet-action-btn {
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
}

/* Improve touch targets for mobile */
@media (max-width: 768px) {
    .close-wallet,
    .close-feature-modal,
    .copy-btn {
        min-width: 44px;
        min-height: 44px;
    }
    
    .tab {
        padding: 12px 20px;
    }
    
    .pagination-btn {
        width: 44px;
        height: 44px;
    }
}

/* Animations for interactive elements */
.wallet-btn,
.wallet-action-btn,
.option-btn,
.tab,
.copy-btn {
    position: relative;
    overflow: hidden;
}

.wallet-btn:after,
.wallet-action-btn:after,
.option-btn:after,
.tab:after,
.copy-btn:after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 5px;
    height: 5px;
    background: rgba(255, 255, 255, 0.5);
    opacity: 0;
    border-radius: 100%;
    transform: scale(1, 1) translate(-50%);
    transform-origin: 50% 50%;
}

@keyframes ripple {
    0% {
        transform: scale(0, 0);
        opacity: 0.5;
    }
    100% {
        transform: scale(100, 100);
        opacity: 0;
    }
}

.wallet-btn:active:after,
.wallet-action-btn:active:after,
.option-btn:active:after,
.tab:active:after,
.copy-btn:active:after {
    animation: ripple 0.4s ease-out;
}

/* Notification styles for success/error messages */
.notification {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    padding: 12px 20px;
    border-radius: 8px;
    color: white;
    font-weight: 500;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    z-index: 2000;
    display: flex;
    align-items: center;
    max-width: 90%;
    animation: notificationFadeIn 0.3s ease, notificationFadeOut 0.3s ease 2.7s forwards;
}

.notification.success {
    background-color: var(--success-color);
}

.notification.error {
    background-color: var(--danger-color);
}

.notification.warning {
    background-color: var(--warning-color);
}

.notification i {
    margin-right: 10px;
    font-size: 1.2rem;
}

@keyframes notificationFadeIn {
    from {
        opacity: 0;
        transform: translate(-50%, 20px);
    }
    to {
        opacity: 1;
        transform: translate(-50%, 0);
    }
}

@keyframes notificationFadeOut {
    from {
        opacity: 1;
        transform: translate(-50%, 0);
    }
    to {
        opacity: 0;
        transform: translate(-50%, 20px);
    }
}

/* Print styles */
@media print {
    .wallet-modal,
    .feature-modal,
    .modal-overlay {
        display: none !important;
    }
}

/* Reduce motion for users who prefer it */
@media (prefers-reduced-motion: reduce) {
    *,
    *::before,
    *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
        scroll-behavior: auto !important;
    }
    
    .wallet-container,
    .feature-modal-content {
        animation: none !important;
    }
    
    .notification {
        animation: none !important;
        opacity: 1;
        transform: translateX(-50%);
    }
}






/* Buy Coins Modal Styles - Cleaned Version */
.buy-coins-modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.8);
  z-index: 2000;
  display: none;
  animation: fadeIn 0.3s ease-in-out;
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
  transform: translateZ(0);
  -webkit-transform: translateZ(0);
}

.buyCoins-modal-content {
  position: relative;
  width: 90%;
  max-width: 800px;
  min-height: 90vh;
  margin: 2rem auto;
  background-color: #fff;
  border-radius: 8px;
  overflow: visible;
  display: flex;
  flex-direction: column;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
  transform: translateZ(0);
  -webkit-transform: translateZ(0);
  animation: slideInUp 0.3s ease-out;
}

.buyCoins-modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 1.5rem 2rem;
  background-color: #1a1a2e;
  color: white;
  flex-shrink: 0;
}

.buyCoins-modal-header h2 {
  margin: 0;
  font-size: 1.5rem;
  font-weight: 600;
}

.close-buycoins {
  background: none;
  border: none;
  color: white;
  font-size: 2rem;
  cursor: pointer;
  transition: color 0.2s;
  padding: 0;
  width: 48px;
  height: 48px;
  display: flex;
  align-items: center;
  justify-content: center;
  touch-action: manipulation;
}

.close-buycoins:hover {
  color: #e74c3c;
}

.close-buycoins:focus {
  outline: 2px solid #473ce7;
  outline-offset: 2px;
}

/* Modal Tabs */
.buyCoins-modal-tabs {
  display: flex;
  background-color: #2c3e50;
  border-bottom: 1px solid #34495e;
  flex-shrink: 0;
}

.buyCoins-tab-btn {
  flex: 1;
  padding: 1rem 1.5rem;
  background-color: transparent;
  color: #bdc3c7;
  border: none;
  cursor: pointer;
  font-size: 1rem;
  font-weight: 500;
  transition: all 0.3s;
  min-height: 48px;
  touch-action: manipulation;
}

.buyCoins-tab-btn.active {
  background-color: #3f3ce7;
  color: white;
}

.buyCoins-tab-btn:hover {
  background-color: #34495e;
  color: white;
}

.buyCoins-tab-btn:focus {
  outline: 2px solid #473ce7;
  outline-offset: -2px;
}

/* Tab Content */
.buyCoins-tab-content {
  display: none;
  padding: 2rem;
  width: 100%;
}

.buyCoins-tab-content.active {
  display: block;
}

/* Coin Purchase Form */
.coin-purchase-form h3 {
  margin: 0 0 1rem 0;
  color: #2c3e50;
  font-size: 1.3rem;
}

.coin-rate-info {
  background-color: #e8f4fd;
  color: #2980b9;
  padding: 0.8rem 1rem;
  border-radius: 6px;
  margin-bottom: 1.5rem;
  font-weight: 500;
  border-left: 4px solid #3498db;
}

/* Coin Packages */
.coin-packages {
  display: grid;
  gap: 1rem;
  margin-bottom: 2rem;
}

.buyCoins-package-option {
  display: flex;
  align-items: center;
  padding: 1rem 1.2rem;
  border: 2px solid #ecf0f1;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.3s;
  position: relative;
  background-color: #fff;
  min-height: 60px;
  touch-action: manipulation;
}

.buyCoins-package-option:hover {
  border-color: #3498db;
  box-shadow: 0 2px 8px rgba(52, 152, 219, 0.1);
}

.buyCoins-package-option input[type="radio"] {
  margin-right: 1rem;
  transform: scale(1.2);
  accent-color: #3498db;
}

.buyCoins-package-option:has(input:checked) {
  border-color: #3498db;
  background-color: #f8fcff;
  box-shadow: 0 4px 12px rgba(52, 152, 219, 0.15);
}

.buyCoins-package-option label {
  flex: 1;
  cursor: pointer;
  font-size: 1rem;
  color: #2c3e50;
  margin: 0;
}

.buyCoins-price {
  font-weight: bold;
  color: #27ae60;
  font-size: 1.1rem;
  margin-right: 0.5rem;
}

.buyCoins-bonus-tag {
  background-color: #e74c3c;
  color: white;
  padding: 0.3rem 0.6rem;
  border-radius: 12px;
  font-size: 0.8rem;
  font-weight: bold;
  position: absolute;
  right: 1rem;
  top: -8px;
}

.instruction-note {
  background-color: #d1ecf1;
  color: #0c5460;
  padding: 1rem;
  border-radius: 6px;
  margin-bottom: 1.5rem;
  border-left: 4px solid #17a2b8;
}

/* Payment Confirmation Form */
.payment-confirmation-form h3 {
  margin: 0 0 1rem 0;
  color: #2c3e50;
  font-size: 1.3rem;
}

/* Summary Section */
.buyCoins-summary-section {
  background-color: #f8f9fa;
  padding: 1.5rem;
  border-radius: 8px;
  margin-bottom: 1.5rem;
  border: 1px solid #e9ecef;
}

.buyCoins-summary-row {
  display: flex;
  justify-content: space-between;
  margin-bottom: 0.8rem;
  font-size: 1rem;
}

.buyCoins-summary-row:last-child {
  margin-bottom: 0;
  font-weight: bold;
  font-size: 1.1rem;
  color: #2c3e50;
  border-top: 1px solid #dee2e6;
  padding-top: 0.8rem;
}

/* Payment Instructions */
.payment-instructions {
  margin-top: 2rem;
  padding: 1.5rem;
  background-color: #fff3cd;
  border: 1px solid #ffeaa7;
  border-radius: 8px;
}

.payment-instructions h3 {
  color: #856404;
  margin: 0 0 1rem 0;
}

.account-details {
  background-color: white;
  padding: 1.5rem;
  border-radius: 6px;
  margin-bottom: 1.5rem;
  border: 1px solid #f1c40f;
}

.buyCoins-detail-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1rem;
  padding-bottom: 0.8rem;
  border-bottom: 1px solid #ecf0f1;
}

.buyCoins-detail-row:last-child {
  margin-bottom: 0;
  border-bottom: none;
  padding-bottom: 0;
}

.buyCoins-detail-label {
  font-weight: 600;
  color: #2c3e50;
}

.buyCoins-detail-value {
  font-weight: bold;
  color: #27ae60;
  font-size: 1.1rem;
}

.buyCoins-copy-btn {
  background-color: #3498db;
  color: white;
  border: none;
  padding: 0.4rem 0.8rem;
  border-radius: 4px;
  cursor: pointer;
  font-size: 0.9rem;
  margin-left: 0.5rem;
  transition: background-color 0.2s;
  min-height: 36px;
  touch-action: manipulation;
}

/* Form Styles */
.buyCoins-form-group {
  margin-bottom: 1.5rem;
}

.buyCoins-form-group label {
  display: block;
  margin-bottom: 0.5rem;
  font-weight: 600;
  color: #2c3e50;
}

.buyCoins-form-group input {
  width: 100%;
  padding: 0.8rem 1rem;
  border: 2px solid #ecf0f1;
  border-radius: 6px;
  font-size: 16px;
  transition: border-color 0.3s;
  box-sizing: border-box;
}

.buyCoins-form-group input:focus {
  outline: none;
  border-color: #3498db;
  box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
}

.buyCoins-confirmation-info {
  color: #7f8c8d;
  margin-bottom: 2rem;
  line-height: 1.5;
}

.buyCoins-verification-notice {
  background-color: #e8f5e8;
  color: #155724;
  padding: 1rem;
  border-radius: 6px;
  margin-bottom: 1.5rem;
  border-left: 4px solid #28a745;
}

/* Confirmation Success */
.confirmation-success {
  text-align: center;
  padding: 2rem;
}

.success-icon {
  font-size: 4rem;
  color: #28a745;
  margin-bottom: 1rem;
}

.confirmation-success h3 {
  color: #28a745;
  margin-bottom: 1rem;
  font-size: 1.5rem;
}

.confirmation-success p {
  color: #6c757d;
  margin-bottom: 1.5rem;
  line-height: 1.5;
}

.pending-info {
  background-color: #fff3cd;
  color: #856404;
  padding: 1.5rem;
  border-radius: 8px;
  margin-bottom: 2rem;
  border: 1px solid #ffeaa7;
}

.pending-info span {
  font-weight: bold;
  color: #2c3e50;
}

/* Buttons */
.btn {
  padding: 0.8rem 2rem;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  font-size: 1rem;
  font-weight: 600;
  transition: all 0.3s;
  text-decoration: none;
  display: inline-block;
  text-align: center;
  min-height: 48px;
  touch-action: manipulation;
}

.btn-success {
  background-color: #28a745;
  color: white;
}

.btn-primary {
  background-color: #3498db;
  color: white;
}

.btn-secondary {
  background-color: #6c757d;
  color: white;
}

.tab-nav-btn {
  background-color: #f39c12;
  color: white;
  padding: 0.8rem 1.5rem;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  font-weight: 600;
  transition: background-color 0.3s;
  min-height: 48px;
  touch-action: manipulation;
}

/* Utility Classes */
.hidden {
  display: none !important;
}

/* Animations */
@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

@keyframes slideInUp {
  from {
    transform: translateY(50px);
    opacity: 0;
  }
  to {
    transform: translateY(0);
    opacity: 1;
  }
}

/* Mobile Responsive */
@media (max-width: 768px) {
  .buy-coins-modal {
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
  }
  
  .buyCoins-modal-content {
    width: 100%;
    min-height: 100vh;
    margin: 0;
    border-radius: 0;
    height: auto;
  }
  
  .buyCoins-tab-content {
    padding: 1rem;
    overflow: visible;
  }
  
  .buyCoins-modal-header {
    padding: 1rem 1.5rem;
  }
  
  .buyCoins-modal-header h2 {
    font-size: 1.3rem;
  }
  
  .buyCoins-package-option {
    padding: 0.8rem 1rem;
    flex-wrap: wrap;
  }
  
  .buyCoins-bonus-tag {
    position: static;
    margin-top: 0.5rem;
    align-self: flex-start;
  }
  
  .buyCoins-detail-row {
    flex-direction: column;
    align-items: flex-start;
    gap: 0.5rem;
  }
  
  .buyCoins-copy-btn {
    margin-left: 0;
    margin-top: 0.5rem;
  }
}

@media (max-width: 480px) {
  .buyCoins-modal-tabs {
    flex-direction: column;
  }
  
  .buyCoins-tab-btn {
    padding: 0.8rem 1rem;
    font-size: 0.9rem;
  }
  
  .buyCoins-tab-content {
    padding: 1rem;
    padding-bottom: 3rem;
  }
  
  .coin-packages {
    gap: 0.8rem;
    margin-bottom: 3rem;
  }
  
  .buyCoins-summary-section {
    margin-bottom: 3rem;
  }
  
   .btn {
    margin-bottom: 2rem;
    width: 100%;
  }
}

/* iOS specific fixes */
@supports (-webkit-appearance: none) {
  .buy-coins-modal {
    height: 100vh;
    height: -webkit-fill-available;
  }
  
  @media (max-width: 768px) {
    .buyCoins-modal-content {
      min-height: 100vh;
      min-height: -webkit-fill-available;
    }
  }
}

/* Android Chrome specific fixes */
@media screen and (max-width: 768px) {
  .buy-coins-modal {
    overflow-y: scroll !important;
    -webkit-overflow-scrolling: touch !important;
    overscroll-behavior: contain;
  }
  
  .buyCoins-modal-content {
    max-height: none !important;
    height: auto !important;
    overflow: visible !important;
  }
  
  .buyCoins-tab-content {
    overflow: visible !important;
    height: auto !important;
    max-height: none !important;
  }
}

/* Prevent zoom on double tap */
.buy-coins-modal * {
  touch-action: manipulation;
}

/* Ensure proper touch scrolling */
.buy-coins-modal {
  scroll-behavior: smooth;
}

/* Fix for very small screens */
@media (max-height: 500px) {
  .buyCoins-modal-content {
    margin: 0.5rem auto;
    min-height: calc(100vh - 1rem);
  }
}

/* Focus and Accessibility */
.buyCoins-package-option:focus-within {
  border-color: #3498db;
  box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
}

.btn:focus {
  outline: 2px solid #2c3e50;
  outline-offset: 2px;
}

.tab-nav-btn:focus {
  outline: 2px solid #2c3e50;
  outline-offset: 2px;
}

/* Loading States */
.btn.loading {
  opacity: 0.7;
  cursor: not-allowed;
  position: relative;
}

.btn.loading::after {
  content: '';
  position: absolute;
  width: 16px;
  height: 16px;
  margin: auto;
  border: 2px solid transparent;
  border-top-color: currentColor;
  border-radius: 50%;
  animation: spin 1s linear infinite;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
}

@keyframes spin {
  0% { transform: translate(-50%, -50%) rotate(0deg); }
  100% { transform: translate(-50%, -50%) rotate(360deg); }
}

/* Error States */
.buyCoins-form-group.error input {
  border-color: #e74c3c;
  box-shadow: 0 0 0 3px rgba(231, 76, 60, 0.1);
}

.buyCoins-form-group .error-message {
  color: #e74c3c;
  font-size: 0.85rem;
  margin-top: 0.5rem;
  display: block;
}

/* Success States */
.buyCoins-form-group.success input {
  border-color: #28a745;
  box-shadow: 0 0 0 3px rgba(40, 167, 69, 0.1);
}

/* Copy Button Animation */
.buyCoins-copy-btn.copied {
  background-color: #28a745;
  animation: pulse 0.3s ease-in-out;
}

@keyframes pulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.05); }
  100% { transform: scale(1); }
}

/* Enhanced Package Selection Animation */
.buyCoins-package-option {
  transform: translateY(0);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.buyCoins-package-option:hover {
  transform: translateY(-2px);
}

.buyCoins-package-option:has(input:checked) {
  transform: translateY(-2px);
  animation: selectPackage 0.4s ease-out;
}

@keyframes selectPackage {
  0% {
    transform: translateY(0) scale(1);
  }
  50% {
    transform: translateY(-4px) scale(1.02);
  }
  100% {
    transform: translateY(-2px) scale(1);
  }
}

/* Reduced Motion Support */
@media (prefers-reduced-motion: reduce) {
  .buy-coins-modal,
  .buyCoins-modal-content,
  .buyCoins-package-option,
  .btn {
    animation: none;
    transition: none;
  }
  
  .buyCoins-package-option:hover,
  .buyCoins-package-option:has(input:checked) {
    transform: none;
  }
}
 

/* Withdraw Modal - Universal Mobile Responsive Styles */
.withdraw-modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: #ffffff;
  z-index: 2000;
  display: none;
  animation: fadeIn 0.3s ease-in-out;
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
  transform: translateZ(0);
  -webkit-transform: translateZ(0);
  /* Prevent body scroll on mobile */
  overscroll-behavior: contain;
}

.withdraw-modal-content {
  position: relative;
  width: 100%;
  max-width: 100%;
  min-height: 100vh;
  margin: 0;
  background-color: #1a1a2e;
  border-radius: 0;
  overflow: visible;
  display: flex;
  flex-direction: column;
  box-shadow: none;
  transform: translateZ(0);
  -webkit-transform: translateZ(0);
  animation: slideInUp 0.3s ease-out;
}

/* PIN Verification Screen */
.pin-verification-content {
    padding: 20px 16px;
    text-align: center;
    background-color: #1a1a2e;
    max-width: 100%;
    box-sizing: border-box;
}

.pin-icon {
    font-size: 2.5rem;
    color: #4a6cf7;
    margin-bottom: 15px;
}

.pin-verification-content h3 {
    font-size: 1.2rem;
    margin-bottom: 8px;
    color: #ffffff;
    line-height: 1.4;
}

.pin-verification-content p {
    color: #ece7e7;
    margin-bottom: 20px;
    font-size: 0.9rem;
    line-height: 1.5;
    max-width: 300px;
    margin-left: auto;
    margin-right: auto;
}

.pin-input-container {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin-bottom: 20px;
    flex-wrap: wrap;
    max-width: 280px;
    margin-left: auto;
    margin-right: auto;
}

.pin-digit {
    width: 45px;
    height: 50px;
    font-size: 1.3rem;
    text-align: center;
    border: 1.5px solid #ddd;
    border-radius: 8px;
    background-color: #1a1a2e;
    color: #ffffff;
    transition: all 0.2s ease;
    box-sizing: border-box;
    flex-shrink: 0;
}

.pin-digit:focus {
    border-color: #4a6cf7;
    box-shadow: 0 0 0 2px rgba(74, 108, 247, 0.2);
    outline: none;
}

.error-message {
    color: #dc3545;
    font-size: 0.85rem;
    margin-bottom: 15px;
    min-height: 18px;
    line-height: 1.4;
}

/* Tablet styles */
@media (max-width: 768px) {
    .pin-verification-content {
        padding: 16px 12px;
    }
    
    .pin-icon {
        font-size: 2.2rem;
        margin-bottom: 12px;
    }
    
    .pin-verification-content h3 {
        font-size: 1.1rem;
    }
    
    .pin-verification-content p {
        font-size: 0.85rem;
        margin-bottom: 18px;
    }
    
    .pin-digit {
        width: 42px;
        height: 48px;
        font-size: 1.2rem;
    }
    
    .pin-input-container {
        gap: 8px;
        margin-bottom: 18px;
    }
}

/* Mobile styles */
@media (max-width: 480px) {
    .pin-verification-content {
        padding: 12px 8px;
    }
    
    .pin-icon {
        font-size: 2rem;
        margin-bottom: 10px;
    }
    
    .pin-verification-content h3 {
        font-size: 1rem;
        margin-bottom: 6px;
    }
    
    .pin-verification-content p {
        font-size: 0.8rem;
        margin-bottom: 16px;
        padding: 0 10px;
    }
    
    .pin-digit {
        width: 38px;
        height: 44px;
        font-size: 1.1rem;
    }
    
    .pin-input-container {
        gap: 6px;
        margin-bottom: 16px;
        max-width: 200px;
    }
    
    .error-message {
        font-size: 0.8rem;
        margin-bottom: 12px;
        padding: 0 10px;
    }
}

/* Extra small mobile styles */
@media (max-width: 320px) {
    .pin-verification-content {
        padding: 10px 6px;
    }
    
    .pin-digit {
        width: 35px;
        height: 40px;
        font-size: 1rem;
    }
    
    .pin-input-container {
        gap: 4px;
        max-width: 180px;
    }
    
    .pin-verification-content h3 {
        font-size: 0.95rem;
    }
    
    .pin-verification-content p {
        font-size: 0.75rem;
    }
}

/* Landscape orientation adjustments */
@media (max-height: 500px) and (orientation: landscape) {
    .pin-verification-content {
        padding: 8px 16px;
    }
    
    .pin-icon {
        font-size: 1.8rem;
        margin-bottom: 8px;
    }
    
    .pin-verification-content h3 {
        margin-bottom: 4px;
    }
    
    .pin-verification-content p {
        margin-bottom: 12px;
    }
    
    .pin-input-container {
        margin-bottom: 12px;
    }
    
    .error-message {
        margin-bottom: 8px;
    }
}




/* Withdrawal Modal Base Styles */
.withdrawmodal-screen
 {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
  max-width: 100%;
  min-height: 100vh;
  margin: 0;
    background-color: rgba(0, 0, 0, 0.5);
    z-index: 1000;
    overflow-y: auto;
    padding: 20px;
    box-sizing: border-box;
}


.withdrawmodal-screen.active 
.modal-screen.active
{
    display: flex;
    align-items: center;
    justify-content: center;
}

/* Withdrawal Form Screen */
#withdrawFormScreen {
    background-color: #fff;
    border-radius: 12px;
    padding: 20px;
    width: 100%;
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    animation: slideIn 0.3s ease-out;
}

/* Modal Header */
.withdraw-modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px 24px;
    border-bottom: 1px solid #e5e7eb;
    background-color: #f8fafc;
    border-radius: 12px 12px 0 0;
}

.withdraw-modal-header h2 {
    margin: 0;
    font-size: 1.5rem;
    font-weight: 600;
    color: #1f2937;
}

.close-withdraw-modal {
    background: none;
    border: none;
    font-size: 24px;
    cursor: pointer;
    color: #111111;
    padding: 0;
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    transition: all 0.2s ease;
}

.close-withdraw-modal:hover {
   color: 
rgb(81, 67, 55)rgb(81, 61, 55)rgb(81, 58, 55)rgb(184, 50, 32);
}
/* Form Content */
.withdraw-form-content {
    padding: 24px;
    width:100%;
}


.balance-info {
    background-color: #1a1a2e;
    border-radius: 8px;
    padding: 12px;
    margin-bottom: 16px;
    border: 1px solid #eaeaea;
}

.balance-item {
    display: flex;
    justify-content: space-between;
    margin-bottom: 6px;
    font-size: 0.9rem;
}

.balance-item:last-child {
    margin-bottom: 0;
}

.balance-label {
    font-weight: 500;
    color: #faf9f9;
}

.balance-value {
    font-weight: 600;
    color: #f7f5f5;
}
 


.amount-preview {
    background-color: #1a1a2e;
    border-radius: 8px;
    padding: 10px 12px;
    margin-bottom: 16px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border: 1px solid #d1e0ff;
    font-size: 0.9rem;
}

#nairaAmount {
    font-weight: 700;
    font-size: 1rem;
    color: #4a6cf7;
}

/* Form Groups */
.withdraw-form-group {
    margin-bottom: 20px;
}

.withdraw-form-group label {
    display: block;
    margin-bottom: 6px;
    font-weight: 500;
    color: #374151;
    font-size: 0.9rem;
}

.withdraw-form-group input,
.withdraw-form-group select {
    width: 100%;
    padding: 12px 16px;
    border: 2px solid #e5e7eb;
    border-radius: 8px;
    font-size: 1rem;
    transition: border-color 0.2s ease;
    box-sizing: border-box;
}

.withdraw-form-group input:focus,
.withdraw-form-group select:focus {
    outline: none;
    border-color: #3b82f6;
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

.input-note {
    display: block;
    margin-top: 4px;
    font-size: 0.8rem;
    color: #6b7280;
}




/* Account Verification */
.withdraw-form-group:has(#accountName) {
    position: relative;
}

#verifyAccountBtn {
    position: absolute;
    right: 8px;
    top: -60px;
    padding: 6px 12px;
    font-size: 0.8rem;
}

/* Fee Summary */
.withdraw-fee-summary {
    background-color: #f9fafb;
    border: 1px solid #e5e7eb;
    border-radius: 8px;
    padding: 16px;
    margin-bottom: 24px;
    color:#333;
}

.withdraw-summary-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 8px;
    font-size: 0.9rem;
}

.withdraw-summary-row:last-child {
    margin-bottom: 0;
}

.withdraw-summary-row.total {
    border-top: 1px solid #e5e7eb;
    padding-top: 8px;
    margin-top: 8px;
    font-weight: 600;
    color: #1f2937;
}

/* Buttons */
.btn {
    padding: 12px 24px;
    border: none;
    border-radius: 8px;
    font-size: 1rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s ease;
    text-align: center;
    text-decoration: none;
    display: inline-block;
}

.btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.btn-primary {
    background-color: #3b82f6;
    color: white;
}

.btn-primary:hover:not(:disabled) {
    background-color: #2563eb;
}

.btn-secondary {
    background-color: #6b7280;
    color: white;
}

.btn-secondary:hover:not(:disabled) {
    background-color: #4b5563;
}

.btn-success {
    background-color: #10b981;
    color: white;
    width: 100%;
}

.btn-success:hover:not(:disabled) {
    background-color: #059669;
}

.btn-sm {
    padding: 6px 12px;
    font-size: 0.8rem;
}

/* Processing Screen */
.withdrawprocessing-content {
    background-color: #fff;
    border-radius: 12px;
    padding: 40px;
    text-align: center;
    max-width: 400px;
    width: 100%;
}

.loader {
    border: 4px solid #f3f4f6;
    border-top: 4px solid #3b82f6;
    border-radius: 50%;
    width: 50px;
    height: 50px;
    animation: spin 1s linear infinite;
    margin: 0 auto 20px;
}

.withdrawprocessing-content h3 {
    margin: 0 0 12px 0;
    color: #1f2937;
    font-size: 1.3rem;
}

.withdrawprocessing-content p {
    margin: 0;
    color: #6b7280;
}

/* Success Screen */
.withdrawsuccess-content {
    background-color: #fff;
    border-radius: 12px;
    padding: 40px;
    text-align: center;
    max-width: 500px;
    width: 100%;
}

.success-icon {
    font-size: 4rem;
    color: #10b981;
    margin-bottom: 20px;
}

.withdrawsuccess-content h3 {
    margin: 0 0 12px 0;
    color: #1f2937;
    font-size: 1.5rem;
}

.withdrawsuccess-content > p {
    margin: 0 0 24px 0;
    color: #6b7280;
}

/* Transaction Details */
.withdrawtransaction-details {
    background-color: #f9fafb;
    border-radius: 8px;
    padding: 20px;
    margin-bottom: 20px;
    text-align: left;
}

.withdrawdetail-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
    padding-bottom: 8px;
    border-bottom: 1px solid #e5e7eb;
}

.withdrawdetail-row:last-child {
    margin-bottom: 0;
    border-bottom: none;
    padding-bottom: 0;
}

.withdrawdetail-label {
    font-weight: 500;
    color: #6b7280;
    font-size: 0.9rem;
}

.withdrawdetail-value {
    font-weight: 600;
    color: #1f2937;
    text-align: right;
    word-break: break-all;
}

.success-note {
    background-color: #ecfdf5;
    color: #065f46;
    padding: 12px;
    border-radius: 6px;
    margin-bottom: 24px;
    font-size: 0.9rem;
}

/* Error Screen */
.withdrawerror-content {
    background-color: #fff;
    border-radius: 12px;
    padding: 40px;
    text-align: center;
    max-width: 400px;
    width: 100%;
}

.withdrawerror-icon {
    font-size: 4rem;
    color: #ef4444;
    margin-bottom: 20px;
}

.withdrawerror-content h3 {
    margin: 0 0 12px 0;
    color: #1f2937;
    font-size: 1.3rem;
}

.withdrawerror-content p {
    margin: 0 0 24px 0;
    color: #6b7280;
}

.withdrawerror-actions {
    display: flex;
    gap: 12px;
    justify-content: center;
}

/* Animations */
@keyframes slideIn {
    from {
        opacity: 0;
        transform: translateY(-20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* Responsive Design */
@media (max-width: 768px) {
    .withdrawmodal-screen {
        padding: 10px;
        align-items: flex-start;
        padding-top: 20px;
    }
    
    #withdrawFormScreen {
        max-height: calc(100vh - 40px);
        margin: 0;
    }
    
    .withdraw-modal-header {
        padding: 16px 20px;
    }
    
    .withdraw-modal-header h2 {
        font-size: 1.3rem;
    }
    
    .withdraw-form-content {
        padding: 20px;
    }
    
    
    .withdraw-form-group {
        margin-bottom: 16px;
    }
    
    .withdraw-form-group input,
    .withdraw-form-group select {
        padding: 10px 14px;
        font-size: 16px; /* Prevents zoom on iOS */
    }
    
    .withdrawdetail-value {
        font-size: 0.85rem;
        max-width: 60%;
    }
    
    .withdrawerror-actions {
        flex-direction: column;
    }
    
    .withdrawerror-actions .btn {
        width: 100%;
    }
    
    .withdrawprocessing-content,
    .withdrawsuccess-content,
    .withdrawerror-content {
        padding: 30px 20px;
    }
}

@media (max-width: 480px) {
    .withdrawmodal-screen {
        padding: 5px;
        padding-top: 10px;
    }
    
    .withdraw-modal-header {
        padding: 12px 16px;
    }
    
    .withdraw-form-content {
        padding: 16px;
    }
    
    
    .withdrawdetail-row {
        flex-direction: column;
        align-items: flex-start;
        gap: 4px;
    }
    
    .withdrawdetail-value {
        max-width: 100%;
        text-align: left;
    }
    
    #verifyAccountBtn {
        position: static;
        margin-top: 8px;
        width: 100%;
    }
}

   
 

/* Focus management for accessibility */
.withdrawmodal-screen:focus-within {
    outline: none;
}

.withdraw-form-group input:invalid {
    border-color: #ef4444;
}

.withdraw-form-group input:invalid:focus {
    border-color: #ef4444;
    box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1);
}

/* Loading states */
.btn.loading {
    position: relative;
    color: transparent;
}

.btn.loading::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 16px;
    height: 16px;
    border: 2px solid transparent;
    border-top: 2px solid currentColor;
    border-radius: 50%;
    animation: spin 1s linear infinite;
    color: white;
}

/* Tooltip styles for form validation */
.withdraw-form-group {
    position: relative;
}

.withdraw-form-group .error-tooltip {
    position: absolute;
    top: 100%;
    left: 0;
    background-color: #ef4444;
    color: white;
    padding: 6px 10px;
    border-radius: 4px;
    font-size: 0.8rem;
    margin-top: 4px;
    z-index: 10;
    opacity: 0;
    transform: translateY(-10px);
    transition: all 0.2s ease;
    pointer-events: none;
}

.withdraw-form-group .error-tooltip.show {
    opacity: 1;
    transform: translateY(0);
}

.withdraw-form-group .error-tooltip::before {
    content: '';
    position: absolute;
    top: -4px;
    left: 10px;
    width: 0;
    height: 0;
    border-left: 4px solid transparent;
    border-right: 4px solid transparent;
    border-bottom: 4px solid #ef4444;
}

/* Success states */
.withdraw-form-group input.success {
    border-color: #10b981;
}

.withdraw-form-group input.success:focus {
    border-color: #10b981;
    box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
}

/* Custom scrollbar for modal content */
.withdrawmodal-screen::-webkit-scrollbar {
    width: 8px;
}

.withdrawmodal-screen::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 4px;
}

.withdrawmodal-screen::-webkit-scrollbar-thumb {
    background: #c1c1c1;
    border-radius: 4px;
}

.withdrawmodal-screen::-webkit-scrollbar-thumb:hover {
    background: #a8a8a8;
}

/* Firefox scrollbar */
.withdrawmodal-screen {
    scrollbar-width: thin;
    scrollbar-color: #c1c1c1 #f1f1f1;
}

/* Additional utility classes */
.text-center {
    text-align: center;
}

.text-left {
    text-align: left;
}

.text-right {
    text-align: right;
}

.mb-0 {
    margin-bottom: 0;
}

.mt-0 {
    margin-top: 0;
}

.hidden {
    display: none;
}

.visible {
    display: block;
}

/* Animation for screen transitions */
.withdrawmodal-screen.fade-in {
    animation: fadeIn 0.3s ease-in-out;
}

.withdrawmodal-screen.fade-out {
    animation: fadeOut 0.3s ease-in-out;
}

@keyframes fadeIn {
    from {
        opacity: 0;
    }
    to {
        opacity: 1;
    }
}

@keyframes fadeOut {
    from {
        opacity: 1;
    }
    to {
        opacity: 0;
    }
}

/* Pulse animation for important elements */
.pulse {
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0% {
        transform: scale(1);
    }
    50% {
        transform: scale(1.05);
    }
    100% {
        transform: scale(1);
    }
}

/* Shake animation for errors */
.shake {
    animation: shake 0.5s ease-in-out;
}

@keyframes shake {
    0%, 100% {
        transform: translateX(0);
    }
    25% {
        transform: translateX(-5px);
    }
    75% {
        transform: translateX(5px);
    }
}



/* Transaction History Modal - Core Styles with BuyCoins Scrolling */
.transaction-modal,
.transaction-details-modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.8);
  z-index: 2000;
  display: none;
  animation: fadeIn 0.3s ease-in-out;
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
  transform: translateZ(0);
  -webkit-transform: translateZ(0);
}

.Historymodal-content
.withdraw-modal-content  {
  position: relative;
  width: 95%;
  max-width: 1200px;
  min-height: 90vh;
  margin: 2rem auto;
  background-color: #fff;
  border-radius: 12px;
  overflow: visible;
  display: flex;
  flex-direction: column;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
  transform: translateZ(0);
  -webkit-transform: translateZ(0);
  animation: slideInUp 0.3s ease-out;
}

/* Modal Header */
.Historymodal-header,
.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 1.5rem 2rem;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  border-radius: 12px 12px 0 0;
  flex-shrink: 0;
}

.Historymodal-header h2,
.modal-header h2 {
  margin: 0;
  font-size: 1.5rem;
  font-weight: 600;
}

.close-History {
  background: none;
  border: none;
  color: white;
  font-size: 2rem;
  cursor: pointer;
  transition: all 0.3s ease;
  padding: 0;
  width: 48px;
  height: 48px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 50%;
  touch-action: manipulation;
}

.close-History:hover {
  background-color: rgba(255, 255, 255, 0.2);
  transform: rotate(90deg);
}

/* Filters Section */
.Historytransaction-filters {
  padding: 2rem;
  background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
  border-bottom: 1px solid #dee2e6;
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 1.5rem;
  align-items: end;
}

.Historyfilter-group {
  display: flex;
  flex-direction: column;
}

.Historyfilter-group label {
  font-weight: 600;
  color: #495057;
  margin-bottom: 0.5rem;
  font-size: 0.9rem;
}

.Historyfilter-group select {
  padding: 0.8rem;
  border: 2px solid #e1e8ed;
  border-radius: 8px;
  font-size: 14px;
  background-color: #fff;
  transition: all 0.3s ease;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
}

.Historyfilter-group select:focus {
  outline: none;
  border-color: #667eea;
  box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
}

.Historyfilter-btn {
  padding: 0.8rem 1.5rem;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 600;
  transition: all 0.3s ease;
  box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
  touch-action: manipulation;
}

.Historyfilter-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
}

/* Transaction Summary */
.transaction-summary {
  padding: 2rem;
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 1.5rem;
  background-color: #fff;
  border-bottom: 1px solid #dee2e6;
}

.Historysummary-card {
  background: linear-gradient(135deg, #fff 0%, #f8f9fa 100%);
  padding: 1.5rem;
  border-radius: 12px;
  text-align: center;
  border: 1px solid #e9ecef;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
  transition: all 0.3s ease;
}

.Historysummary-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
}

.Historysummary-card h4 {
  margin: 0 0 1rem 0;
  color: #495057;
  font-size: 1rem;
  font-weight: 600;
}

.Historysummary-card p {
  margin: 0;
  font-size: 1.5rem;
  font-weight: bold;
  color: #28a745;
}

/* Transaction Table Container */
.transaction-table-container {
  flex: 1;
  padding: 2rem;
  overflow-x: auto;
  position: relative;
}

.transaction-table {
  width: 100%;
  border-collapse: collapse;
  background-color: #fff;
  border-radius: 8px;
  overflow: hidden;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
}

.transaction-table thead {
  background: linear-gradient(135deg, #495057 0%, #343a40 100%);
  color: white;
}

.transaction-table th,
.transaction-table td {
  padding: 1rem;
  text-align: left;
  border-bottom: 1px solid #dee2e6;
}

.transaction-table th {
  font-weight: 600;
  font-size: 0.9rem;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.transaction-table tbody tr {
  transition: all 0.3s ease;
}

.transaction-table tbody tr:hover {
  background-color: #f8f9fa;
  transform: scale(1.01);
}

.transaction-table tbody tr:last-child td {
  border-bottom: none;
}

/* Transaction Status Badges */
.status-completed {
  background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
  color: white;
  padding: 0.3rem 0.8rem;
  border-radius: 20px;
  font-size: 0.8rem;
  font-weight: 600;
  text-transform: uppercase;
}

.status-pending {
  background: linear-gradient(135deg, #ffc107 0%, #fd7e14 100%);
  color: white;
  padding: 0.3rem 0.8rem;
  border-radius: 20px;
  font-size: 0.8rem;
  font-weight: 600;
  text-transform: uppercase;
}

.status-failed {
  background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
  color: white;
  padding: 0.3rem 0.8rem;
  border-radius: 20px;
  font-size: 0.8rem;
  font-weight: 600;
  text-transform: uppercase;
}

/* Transaction Type Badges */
.type-purchase {
  color: #007bff;
  font-weight: 600;
}

.type-withdrawal {
  color: #dc3545;
  font-weight: 600;
}

.type-commission {
  color: #28a745;
  font-weight: 600;
}

.type-earning {
  color: #17a2b8;
  font-weight: 600;
}

/* Empty State */
.empty-state {
  display: none;
  text-align: center;
  padding: 3rem;
  color: #6c757d;
}

.empty-state.show {
  display: block;
}

.empty-state i {
  font-size: 3rem;
  margin-bottom: 1rem;
  color: #adb5bd;
}

.empty-state p {
  font-size: 1.2rem;
  margin-bottom: 0.5rem;
  font-weight: 600;
}

.empty-state span {
  font-size: 0.9rem;
  color: #adb5bd;
}

/* Loading State */
.loading-transactions {
  display: none;
  text-align: center;
  padding: 3rem;
  color: #667eea;
}

.loading-transactions.show {
  display: block;
}

.loading-transactions i {
  font-size: 2rem;
  margin-bottom: 1rem;
}

.loading-transactions p {
  font-size: 1.1rem;
  font-weight: 600;
}

/* Pagination */
.History-pagination {
  padding: 1.5rem 2rem;
  display: flex;
  justify-content: space-between;
  align-items: center;
  background-color: #f8f9fa;
  border-top: 1px solid #dee2e6;
}

.pagination-btn {
  padding: 0.8rem 1.5rem;
  background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
  color: white;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 600;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  gap: 0.5rem;
  touch-action: manipulation;
}

.pagination-btn:disabled {
  background: #e9ecef;
  color: #6c757d;
  cursor: not-allowed;
  transform: none;
}

.pagination-btn:hover:not(:disabled) {
  transform: translateY(-2px);
  box-shadow: 0 4px 15px rgba(108, 117, 125, 0.3);
}

#pageIndicator {
  font-weight: 600;
  color: #495057;
}

/* Export Section */
.Historyexport-section {
  padding: 1.5rem 2rem;
  background-color: #fff;
  border-top: 1px solid #dee2e6;
  display: flex;
  gap: 1rem;
  justify-content: center;
}

.export-btn {
  padding: 0.8rem 1.5rem;
  background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
  color: white;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 600;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  gap: 0.5rem;
  box-shadow: 0 2px 8px rgba(23, 162, 184, 0.3);
  touch-action: manipulation;
}

.export-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 15px rgba(23, 162, 184, 0.4);
}

/* Transaction Details Modal */
.transaction-details-modal .Historymodal-content {
  max-width: 600px;
}

.transaction-details-content {
  padding: 2rem;
  flex: 1;
}

.Historymodal-footer {
  padding: 1.5rem 2rem;
  background-color: #f8f9fa;
  border-top: 1px solid #dee2e6;
  display: flex;
  justify-content: flex-end;
  border-radius: 0 0 12px 12px;
}

.btn {
  padding: 0.8rem 1.5rem;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 600;
  transition: all 0.3s ease;
  touch-action: manipulation;
}

.btn-secondary {
  background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
  color: white;
}

.btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
}

/* Animations */
@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

@keyframes slideInUp {
  from {
    transform: translateY(50px);
    opacity: 0;
  }
  to {
    transform: translateY(0);
    opacity: 1;
  }
}

/* Mobile Responsive */
@media (max-width: 768px) {
  .transaction-modal,
  .transaction-details-modal {
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
  }
  
  .Historymodal-content {
    width: 100%;
    min-height: 100vh;
    margin: 0;
    border-radius: 0;
    height: auto;
  }
  
  .Historymodal-header,
  .modal-header {
    padding: 1rem 1.5rem;
    border-radius: 0;
  }
  
  .Historymodal-header h2,
  .modal-header h2 {
    font-size: 1.3rem;
  }
  
  .Historytransaction-filters {
    padding: 1.5rem;
    grid-template-columns: 1fr;
    gap: 1rem;
  }
  
  .transaction-summary {
    padding: 1.5rem;
    grid-template-columns: repeat(2, 1fr);
    gap: 1rem;
  }
  
  .transaction-table-container {
    padding: 1rem;
    overflow-x: auto;
  }
  
  .transaction-table {
    min-width: 600px;
  
      padding: 0.8rem 0.5rem;
    font-size: 0.9rem;
  }
  
  .History-pagination {
    padding: 1rem 1.5rem;
    flex-direction: column;
    gap: 1rem;
  }
  
  .pagination-btn {
    width: 100%;
    justify-content: center;
  }
  
  .Historyexport-section {
    padding: 1rem 1.5rem;
    flex-direction: column;
    gap: 0.5rem;
  }
  
  .export-btn {
    width: 100%;
    justify-content: center;
  }
  
  .transaction-details-content {
    padding: 1.5rem;
  }
  
  .Historymodal-footer {
    padding: 1rem 1.5rem;
  }
}

@media (max-width: 480px) {
  .Historymodal-header,
  .modal-header {
    padding: 1rem;
  }
  
  .Historymodal-header h2,
  .modal-header h2 {
    font-size: 1.2rem;
  }
  
  .close-History {
    width: 40px;
    height: 40px;
    font-size: 1.5rem;
  }
  
  .Historytransaction-filters {
    padding: 1rem;
  }
  
  .transaction-summary {
    padding: 1rem;
    grid-template-columns: 1fr;
  }
  
  .Historysummary-card {
    padding: 1rem;
  }
  
  .Historysummary-card h4 {
    font-size: 0.9rem;
  }
  
  .Historysummary-card p {
    font-size: 1.3rem;
  }
  
  .transaction-table th,
  .transaction-table td {
    padding: 0.6rem 0.3rem;
    font-size: 0.8rem;
  }
  
  .status-completed,
  .status-pending,
  .status-failed {
    padding: 0.2rem 0.5rem;
    font-size: 0.7rem;
  }
}

/* iOS specific fixes */
@supports (-webkit-appearance: none) {
  .transaction-modal,
  .transaction-details-modal {
    height: 100vh;
    height: -webkit-fill-available;
  }
  
  @media (max-width: 768px) {
    .Historymodal-content {
      min-height: 100vh;
      min-height: -webkit-fill-available;
    }
  }
}

/* Android Chrome specific fixes */
@media screen and (max-width: 768px) {
  .transaction-modal,
  .transaction-details-modal {
    overflow-y: scroll !important;
    -webkit-overflow-scrolling: touch !important;
    overscroll-behavior: contain;
  }
  
  .Historymodal-content {
    max-height: none !important;
    height: auto !important;
    overflow: visible !important;
  }
  
  .transaction-table-container {
    overflow: visible !important;
    height: auto !important;
    max-height: none !important;
  }
}

/* Prevent zoom on double tap */
.transaction-modal *,
.transaction-details-modal * {
  touch-action: manipulation;
}

/* Ensure proper touch scrolling */
.transaction-modal,
.transaction-details-modal {
  scroll-behavior: smooth;
}

/* Fix for very small screens */
@media (max-height: 500px) {
  .Historymodal-content {
    margin: 0.5rem auto;
    min-height: calc(100vh - 1rem);
  }
}

/* Focus and Accessibility */
.Historyfilter-group select:focus {
  border-color: #667eea;
  box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
}

.Historyfilter-btn:focus,
.pagination-btn:focus,
.export-btn:focus,
.btn:focus {
  outline: 2px solid #495057;
  outline-offset: 2px;
}

/* Loading States */
.Historyfilter-btn.loading,
.pagination-btn.loading,
.export-btn.loading {
  opacity: 0.7;
  cursor: not-allowed;
  position: relative;
}

.Historyfilter-btn.loading::after,
.pagination-btn.loading::after,
.export-btn.loading::after {
  content: '';
  position: absolute;
  width: 16px;
  height: 16px;
  margin: auto;
  border: 2px solid transparent;
  border-top-color: currentColor;
  border-radius: 50%;
  animation: spin 1s linear infinite;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

/* Table Responsive Enhancements */
@media (max-width: 600px) {
  .transaction-table {
    font-size: 0.8rem;
  }
  
  .transaction-table th:nth-child(5),
  .transaction-table td:nth-child(5) {
    display: none;
  }
}

@media (max-width: 400px) {
  .transaction-table th:nth-child(4),
  .transaction-table td:nth-child(4) {
    display: none;
  }
}

/* Enhanced Button Animations */
.Historyfilter-btn,
.pagination-btn,
.export-btn,
.btn {
  transform: translateY(0);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.Historyfilter-btn:active:not(:disabled),
.pagination-btn:active:not(:disabled),
.export-btn:active:not(:disabled),
.btn:active:not(:disabled) {
  transform: translateY(0);
  transition: transform 0.1s;
}

/* Transaction Details Styling */
.transaction-detail-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 1rem 0;
  border-bottom: 1px solid #e9ecef;
}

.transaction-detail-item:last-child {
  border-bottom: none;
}

.transaction-detail-label {
  font-weight: 600;
  color: #495057;
}

.transaction-detail-value {
  font-weight: bold;
  color: #28a745;
}

/* Reduced Motion Support */
@media (prefers-reduced-motion: reduce) {
  .transaction-modal,
  .transaction-details-modal,
  .Historymodal-content,
  .Historyfilter-btn,
  .pagination-btn,
  .export-btn,
  .btn,
  .Historysummary-card,
  .transaction-table tbody tr {
    animation: none;
    transition: none;
  }
  
  .Historyfilter-btn:hover:not(:disabled),
  .pagination-btn:hover:not(:disabled),
  .export-btn:hover:not(:disabled),
  .btn:hover:not(:disabled),
  .Historysummary-card:hover,
  .transaction-table tbody tr:hover {
    transform: none;
    box-shadow: initial;
  }
  
  .close-History:hover {
    transform: none;
  }
  
  .loading-transactions i {
    animation: none;
  }
}

/* High Contrast Mode Support */
@media (prefers-contrast: high) {
  .Historymodal-content {
    border: 3px solid #000;
  }
  
  .transaction-table,
  .Historyfilter-group select {
    border-width: 3px;
  }
  
  .Historyfilter-btn,
  .pagination-btn,
  .export-btn,
  .btn {
    border: 2px solid currentColor;
  }
}

/* Print Styles */
@media print {
  .transaction-modal,
  .transaction-details-modal {
    position: static;
    background: white;
  }
  
  .Historymodal-content {
    box-shadow: none;
    border: 1px solid #000;
    max-width: none;
    width: 100%;
  }
  
  .close-History,
  .Historyfilter-btn,
  .pagination-btn,
  .export-btn {
    display: none;
  }
  
  .transaction-table {
    border: 1px solid #000;
  }
  
  .Historytransaction-filters,
  .History-pagination,
  .Historyexport-section {
    display: none;
  }
}

/* Keyboard Navigation Enhancement */
.transaction-modal:focus-within,
.transaction-details-modal:focus-within {
  outline: none;
}

.Historyfilter-group select:focus,
.Historyfilter-btn:focus,
.pagination-btn:focus,
.export-btn:focus {
  z-index: 1;
  position: relative;
}

/* Mobile Keyboard Adjustments */
@media (max-height: 600px) and (max-width: 768px) {
  .Historymodal-content {
    height: 100vh;
  }
  
  .Historytransaction-filters {
    padding: 1rem 1rem 2rem 1rem;
  }
}

/* Very Small Mobile Devices */
@media (max-width: 320px) {
  .Historymodal-header h2,
  .modal-header h2 {
    font-size: 1.1rem;
  }
  
  .close-History {
    width: 36px;
    height: 36px;
    font-size: 1.3rem;
  }
  
  .transaction-table {
    min-width: 500px;
  }
}

/* Landscape Mobile Orientation */
@media (max-height: 500px) and (orientation: landscape) {
  .transaction-summary {
    grid-template-columns: repeat(4, 1fr);
    padding: 1rem;
  }
  
  .Historysummary-card {
    padding: 1rem;
  }
  
  .Historysummary-card h4 {
    font-size: 0.9rem;
    margin-bottom: 0.5rem;
  }
  
  .Historysummary-card p {
    font-size: 1.2rem;
  }
}

/* Scrollbar Styling for Desktop */
@media (min-width: 769px) {
  .transaction-table-container::-webkit-scrollbar {
    height: 8px;
  }
  
  .transaction-table-container::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 4px;
  }
  
  .transaction-table-container::-webkit-scrollbar-thumb {
    background: #c1c1c1;
    border-radius: 4px;
  }
  
  .transaction-table-container::-webkit-scrollbar-thumb:hover {
    background: #a8a8a8;
  }
}



/* Game Portal Styles */
.game-portal-container {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: #f8f9fa;
  z-index: 1000;
  overflow-y: auto;
  display: none;
  animation: fadeIn 0.3s ease-in-out;
}

.game-portal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 1rem 2rem;
  background-color:  #1a1a2e;
  color: white;
  position: sticky;
  top: 0;
  z-index: 10;
}

.close-portal-btn {
  background: none;
  border: none;
  color: white;
  font-size: 2rem;
  cursor: pointer;
  transition: color 0.2s;
}

.close-portal-btn:hover {
  color: #473ce7;
}

/* Game Categories */
.game-categories {
  display: flex;
  overflow-x: auto;
  padding: 1rem;
  background-color: #1a1a2e;;
  position: sticky;
  top: 60px;
  z-index: 9;
}

.category-btn {
  padding: 0.5rem 1.2rem;
  margin-right: 0.5rem;
  background-color:  #1a1a2e;
  color: white;
  border: none;
  border-radius: 20px;
  cursor: pointer;
  white-space: nowrap;
  transition: all 0.2s;
}

.category-btn.active {
  background-color: #3f3ce7;
}

.category-btn:hover {
  background-color:  #3f3ce7;
}

/* Search Bar */
.game-search-container {
  display: flex;
  padding: 1rem 2rem;
  background-color: #ecf0f1;
}

#gameSearch {
  flex: 1;
  padding: 0.8rem 1rem;
  border: 1px solid #ddd;
  border-radius: 4px 0 0 4px;
  font-size: 1rem;
}

.search-btn {
  padding: 0.8rem 1.2rem;
  background-color: #3498db;
  color: white;
  border: none;
  border-radius: 0 4px 4px 0;
  cursor: pointer;
}

/* Featured Games Carousel */
.featured-games-carousel {
  padding: 1.5rem 2rem;
  background-color:  #1a1a2e;
  color: white;
}

.carousel-container {
  display: flex;
  align-items: center;
  position: relative;
}

.carousel-items {
  display: flex;
  overflow-x: auto;
  scroll-behavior: smooth;
  -ms-overflow-style: none;  /* Hide scrollbar for IE and Edge */
  scrollbar-width: none;  /* Hide scrollbar for Firefox */
  padding: 1rem 0;
}

.carousel-items::-webkit-scrollbar {
  display: none; /* Hide scrollbar for Chrome, Safari and Opera */
}

.carousel-nav {
  background-color:  #1a1a2e;
  color: white;
  border: none;
  border-radius: 50%;
  width: 40px;
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  position: absolute;
  z-index: 2;
}

.carousel-nav.prev {
  left: 10px;
}

.carousel-nav.next {
  right: 10px;
}

.featured-game {
  min-width: 280px;
  margin-right: 1.5rem;
  border-radius: 8px;
  overflow: hidden;
  background-color:  #2d2d85;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
  cursor: pointer;
  transition: transform 0.3s;
}

.featured-game:hover {
  transform: translateY(-5px);
}

.game-thumbnail {
  height: 160px;
  background-size: cover;
  background-position: center;
  position: relative;
}

.game-info {
  padding: 1rem;
}

.game-info h4 {
  margin: 0 0 0.5rem 0;
  color: #ecf0f1;
}

.game-meta {
  display: flex;
  justify-content: space-between;
  font-size: 0.9rem;
  color: #ad1d1d;
}

/* Games Grid */
.games-grid-container {
  padding: 2rem;
  background-color: #1a1a2e;;
  color: #ffffff;
}

.games-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  gap: 1.5rem;
  margin-top: 1rem;
}

.game-card {
  border-radius: 8px;
  overflow: hidden;
  background-color: #1a1a2e;;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
  transition: transform 0.3s, box-shadow 0.3s;
}

.game-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
}

.game-card .game-thumbnail {
  height: 180px;
  position: relative;
}

.game-overlay {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.5);
  display: flex;
  justify-content: center;
  align-items: center;
  opacity: 0;
  transition: opacity 0.3s;
}

.game-card:hover .game-overlay {
  opacity: 1;
}

.play-now-btn {
  padding: 0.8rem 1.5rem;
  background-color: #e74c3c;
  color: white;
  border: none;
  border-radius: 4px;
  font-weight: bold;
  cursor: pointer;
  transition: background-color 0.2s;
}

.play-now-btn:hover {
  background-color: #c0392b;
}

.game-details {
  padding: 1.2rem;
}

.game-title {
  margin: 0 0 0.5rem 0;
  color: #2c3e50;
}

.game-description {
  color: #7f8c8d;
  font-size: 0.9rem;
  margin: 0.8rem 0;
  line-height: 1.4;
}

.game-stats {
  display: flex;
  justify-content: space-between;
  font-size: 0.85rem;
  color: #95a5a6;
  margin-top: 1rem;
}

.load-more-btn {
  display: block;
  margin: 2rem auto 0;
  padding: 0.8rem 2rem;
  background-color: #3498db;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  transition: background-color 0.2s;
}

.load-more-btn:hover {
  background-color: #2980b9;
}

/* Recently Played Games */
.recently-played-container {
  padding: 1.5rem 2rem;
  background-color: #ecf0f1;
}

.recently-played-games {
  display: flex;
  overflow-x: auto;
  padding: 1rem 0;
  gap: 1rem;
}

.no-games-message {
  color: #95a5a6;
  font-style: italic;
}


/* Game Modal (continued) */
.game-modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.8);
  z-index: 2000;
  animation: fadeIn 0.3s ease-in-out;
}

.game-modal-content {
  position: relative;
  width: 90%;
  max-width: 1200px;
  height: 90%;
  margin: 2% auto;
  background-color: #fff;
  border-radius: 8px;
  overflow: hidden;
  display: flex;
  flex-direction: column;
}

.game-modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 1rem 1.5rem;
  background-color: #2c3e50;
  color: white;
}

.close-game-modal {
  background: none;
  border: none;
  color: white;
  font-size: 1.8rem;
  cursor: pointer;
  transition: color 0.2s;
}

.close-game-modal:hover {
  color: #e74c3c;
}

.game-modal-body {
  flex: 1;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

.game-iframe-container {
  flex: 1;
  position: relative;
  background-color: #000;
}

#gameIframe {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
}

.game-controls {
  display: flex;
  justify-content: flex-end;
  padding: 0.5rem;
  background-color: #34495e;
}

.game-controls button {
  background: none;
  border: none;
  color: white;
  font-size: 1.2rem;
  margin-left: 1rem;
  cursor: pointer;
  transition: color 0.2s;
}

.game-controls button:hover {
  color: #3498db;
}

.game-info-panel {
  padding: 1.5rem;
  max-height: 30%;
  overflow-y: auto;
  display: flex;
  gap: 2rem;
}

.game-description-panel {
  flex: 2;
}

.game-rewards-panel {
  flex: 1;
  background-color: #f8f9fa;
  padding: 1rem;
  border-radius: 8px;
}

.reward-tiers {
  margin-top: 1rem;
}

.reward-tier {
  display: flex;
  justify-content: space-between;
  padding: 0.5rem 0;
  border-bottom: 1px solid #eee;
}

.tier-coins {
  font-weight: bold;
  color: #f39c12;
}

/* Animations */
@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

/* Responsive Adjustments */
@media (max-width: 768px) {
  .games-grid {
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
  }
  
  .game-info-panel {
    flex-direction: column;
    gap: 1rem;
  }
  
  .featured-game {
    min-width: 220px;
  }
  
  .game-modal-content {
    width: 95%;
    height: 95%;
    margin: 2.5% auto;
  }
}

@media (max-width: 480px) {
  .games-grid {
    grid-template-columns: 1fr;
  }
  
  .game-categories {
    padding: 0.5rem;
  }
  
  .category-btn {
    padding: 0.4rem 0.8rem;
    font-size: 0.9rem;
  }
  
  .game-portal-header h2 {
    font-size: 1.2rem;
  }
}


/* Rewarder Modal Styles */
.rewarder-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.7);
    z-index: 1000;
    overflow-y: auto;
}

.rewarder-modal.active {
    display: block;
}

.rewarder-modal-content {
    background-color: #fff;
    border-radius: 10px;
    width: 90%;
    max-width: 800px;
    margin: 30px auto;
    box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
    animation: modalFadeIn 0.3s ease;
    max-height: 90vh;
    overflow-y: auto;
}
@keyframes modalFadeIn {
    from {
        opacity: 0;
        transform: translateY(-30px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.rewarder-modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px 20px;
    border-bottom: 1px solid #eee;
    background-color: #f8f9fa;
    border-radius: 10px 10px 0 0;
}

.rewarder-modal-header h2 {
    font-size: 22px;
    margin: 0;
    color: #333;
}

.close-rewarder-modal, .close-rewarder-sub-modal {
    font-size: 24px;
    color: #999;
    cursor: pointer;
    transition: color 0.2s ease;
}

.close-rewarder-modal:hover, .close-rewarder-sub-modal:hover {
    color: #333;
}

.rewarder-modal-body {
    padding: 20px;
}

.rewarder-intro {
    text-align: center;
    color: #666;
    margin-bottom: 20px;
}

/* Bonus Cards Container */
.bonus-cards-container {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 15px;
    margin-bottom: 20px;
}

@media (min-width: 768px) {
    .bonus-cards-container {
        grid-template-columns: repeat(4, 1fr);
    }
}

/* Bonus Card Styles */
.bonus-card {
    background-color: #fff;
    border-radius: 10px;
    padding: 15px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    display: flex;
    flex-direction: column;
    transition: transform 0.2s ease;
    position: relative;
    overflow: hidden;
}

.bonus-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15);
}

.bonus-icon {
    display: flex;
    justify-content: center;
    align-items: center;
    width: 50px;
    height: 50px;
    border-radius: 50%;
    background-color: #f0f7ff;
    margin-bottom: 10px;
    color: #2196f3;
    font-size: 20px;
}

#dailyLoginCard .bonus-icon {
    background-color: #e8f5e9;
    color: #4caf50;
}

#referralCard .bonus-icon {
    background-color: #fff3e0;
    color: #ff9800;
}

#investmentCard .bonus-icon {
    background-color: #e3f2fd;
    color: #2196f3;
}

#journeyCard .bonus-icon {
    background-color: #f3e5f5;
    color: #9c27b0;
}

.bonus-info {
    flex: 1;
}

.bonus-info h3 {
    font-size: 16px;
    margin: 0 0 5px 0;
    color: #333;
}

.bonus-info p {
    font-size: 12px;
    color: #666;
    margin: 0 0 10px 0;
}

.bonus-progress {
    margin-top: 10px;
}

.progress-bar {
    height: 6px;
    background-color: #e0e0e0;
    border-radius: 3px;
    overflow: hidden;
    margin-bottom: 5px;
}

.progress-fill {
    height: 100%;
    background-color: #4caf50;
    border-radius: 3px;
    transition: width 0.3s ease;
}

.progress-text {
    font-size: 11px;
    color: #777;
}

.claim-btn {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background-color: #4caf50;
    color: white;
    border: none;
    border-radius: 5px;
    padding: 8px 12px;
    margin-top: 10px;
    cursor: pointer;
    font-weight: 500;
    transition: background-color 0.2s ease;
}

.claim-btn:hover {
    background-color: #388e3c;
}

.claim-btn:disabled {
    background-color: #e0e0e0;
    color: #9e9e9e;
    cursor: not-allowed;
}

.coin-amount {
    background-color: rgba(255, 255, 255, 0.2);
    padding: 2px 6px;
    border-radius: 10px;
    font-size: 12px;
    font-weight: bold;
}

/* Advertisement Banner */
.ad-banner {
    width: 100%;
    max-width: 400px;
    height: 60px;
    margin: 20px auto;
    border-radius: 5px;
    overflow: hidden;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    display: flex;
    justify-content: center;
    align-items: center;
}

.ad-banner img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

/* Rewarder Quests Section */
.rewarder-quests {
    background-color: #fff;
    border-radius: 10px;
    padding: 20px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    margin-top: 20px;
}

.rewarder-quests h3 {
    font-size: 18px;
    margin: 0 0 15px 0;
    color: #333;
    border-bottom: 1px solid #eee;
    padding-bottom: 10px;
}

.quest-list {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.quest-item {
    display: flex;
    align-items: center;
    padding: 15px;
    background-color: #f9f9f9;
    border-radius: 8px;
    transition: transform 0.2s ease;
}

.quest-item:hover {
    transform: translateX(5px);
    background-color: #f5f5f5;
}

.quest-icon {
    display: flex;
    justify-content: center;
    align-items: center;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background-color: #e3f2fd;
    color: #2196f3;
    margin-right: 15px;
    flex-shrink: 0;
}

.quest-details {
    flex: 1;
}

.quest-details h4 {
    font-size: 16px;
    margin: 0 0 5px 0;
    color: #333;
}

.quest-details p {
    font-size: 13px;
    color: #666;
    margin: 0 0 10px 0;
}

.quest-progress {
    margin-top: 5px;
}

.quest-reward {
    display: flex;
    flex-direction: column;
    align-items: center;
    margin-left: 15px;
}

.quest-btn {
    background-color: #2196f3;
    color: white;
    border: none;
    border-radius: 5px;
    padding: 6px 12px;
    margin-top: 5px;
    cursor: pointer;
    font-weight: 500;
    transition: background-color 0.2s ease;
}

.quest-btn:hover {
    background-color: #1976d2;
}

/* Sub-Modal Styles */
.rewarder-sub-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.7);
    z-index: 1100; /* Higher than the main modal */
    overflow-y: auto;
}

.rewarder-sub-modal.active {
    display: block;
}

.rewarder-sub-modal-content {
    background-color: #fff;
    border-radius: 10px;
    width: 90%;
    max-width: 500px;
    margin: 50px auto;
    box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
    animation: subModalFadeIn 0.3s ease;
    max-height: 85vh;
    overflow-y: auto;
}

@keyframes subModalFadeIn {
    from {
        opacity: 0;
        transform: scale(0.9);
    }
    to {
        opacity: 1;
        transform: scale(1);
    }
}

.rewarder-sub-modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px 20px;
    border-bottom: 1px solid #eee;
    background-color: #f8f9fa;
    border-radius: 10px 10px 0 0;
}

.rewarder-sub-modal-header h2 {
    font-size: 20px;
    margin: 0;
    color: #333;
}

.rewarder-sub-modal-body {
    padding: 20px;
}

/* Referral Sub-Modal Specific Styles */
.referral-info {
    text-align: center;
    margin-bottom: 20px;
}

.referral-icon {
    display: flex;
    justify-content: center;
    align-items: center;
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background-color: #fff3e0;
    color: #ff9800;
    font-size: 24px;
    margin: 0 auto 15px;
}

.referral-link-container {
    margin: 20px 0;
}

.link-copy-group {
    display: flex;
    margin-top: 5px;
}

.link-copy-group input {
    flex: 1;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 5px 0 0 5px;
    font-size: 14px;
}

.copy-btn {
    background-color: #2196f3;
    color: white;
    border: none;
    border-radius: 0 5px 5px 0;
    padding: 0 15px;
    cursor: pointer;
    transition: background-color 0.2s ease;
}

.copy-btn:hover {
    background-color: #1976d2;
}

.share-options {
    margin: 20px 0;
}

.social-share-buttons {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin-top: 10px;
}

.share-btn {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    border: none;
    display: flex;
    justify-content: center;
    align-items: center;
    color: white;
    font-size: 18px;
    cursor: pointer;
    transition: transform 0.2s ease;
}

.share-btn:hover {
    transform: scale(1.1);
}

.whatsapp {
    background-color: #25d366;
}

.facebook {
    background-color: #1877f2;
}

.twitter {
    background-color: #1da1f2;
}

.telegram {
    background-color: #0088cc;
}

.referral-stats {
    background-color: #f5f5f5;
    border-radius: 8px;
    padding: 15px;
    margin-top: 20px;
}

.stat-item {
    display: flex;
    justify-content: space-between;
    margin-bottom: 10px;
}

.stat-item:last-child {
    margin-bottom: 0;
}

.stat-label {
    color: #666;
}

.stat-value {
    font-weight: bold;
    color: #333;
}

/* Investment Sub-Modal Specific Styles */
.investment-info {
    text-align: center;
    margin-bottom: 20px;
}

.investment-icon {
    display: flex;
    justify-content: center;
    align-items: center;
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background-color: #e3f2fd;
    color: #2196f3;
    font-size: 24px;
    margin: 0 auto 15px;
}

.investment-plans {
    display: flex;
    flex-direction: column;
    gap: 10px;
    margin: 20px 0;
}

.plan-option {
    position: relative;
}

.plan-option input[type="radio"] {
    position: absolute;
    opacity: 0;
}

.plan-option label {
    display: block;
    padding: 15px;
    background-color: #f5f5f5;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s ease;
}

.plan-option input[type="radio"]:checked + label {
    background-color: #e3f2fd;
    border: 1px solid #2196f3;
}

.plan-details h4 {
    margin: 0 0 5px 0;
    color: #333;
}

.plan-details p {
    margin: 0;
    color: #666;
    font-size: 14px;
}

.min-amount {
    font-size: 12px;
    color: #999;
    margin-top: 5px !important;
}

.investment-amount {
    margin: 20px 0;
}

.investment-amount label {
    display: block;
    margin-bottom: 5px;
    color: #333;
}

.investment-amount input {
    width: 100%;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 5px;
    font-size: 14px;
}

.investment-summary {
    background-color: #f5f5f5;
    border-radius: 8px;
    padding: 15px;
    margin: 20px 0;
}

.summary-row {
    display: flex;
    justify-content: space-between;
    margin-bottom: 10px;
}

.summary-row:last-child {
    margin-bottom: 0;
}

#confirmInvestmentBtn {
    width: 100%;
    padding: 12px;
    background-color: #4caf50;
    color: white;
    border: none;
    border-radius: 5px;
    font-weight: bold;
    cursor: pointer;
    transition: background-color 0.2s ease;
}

#confirmInvestmentBtn:hover {
    background-color: #388e3c;
}
/* Bonuses Card Specific Styles */
#bonusesCard .bonus-icon {
    background-color: #fce4ec;
    color: #e91e63;
}

/* Bonuses Sub-Modal Styles */
.bonuses-info {
    text-align: center;
    margin-bottom: 20px;
}

.bonuses-icon {
    display: flex;
    justify-content: center;
    align-items: center;
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background-color: #fce4ec;
    color: #e91e63;
    font-size: 24px;
    margin: 0 auto 15px;
}

.bonuses-list {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.bonus-item {
    display: flex;
    align-items: center;
    padding: 15px;
    background-color: #f9f9f9;
    border-radius: 8px;
    transition: transform 0.2s ease;
}

.bonus-item:hover {
    transform: translateX(5px);
    background-color: #f5f5f5;
}

.bonus-item-icon {
    display: flex;
    justify-content: center;
    align-items: center;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background-color: #fce4ec;
    color: #e91e63;
    margin-right: 15px;
    flex-shrink: 0;
}

.bonus-item-details {
    flex: 1;
}

.bonus-item-details h4 {
    font-size: 16px;
    margin: 0 0 5px 0;
    color: #333;
}

.bonus-item-details p {
    font-size: 13px;
    color: #666;
    margin: 0;
}

.bonus-claim-btn {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background-color: #e91e63;
    color: white;
    border: none;
    border-radius: 5px;
    padding: 8px 12px;
    cursor: pointer;
    font-weight: 500;
    transition: background-color 0.2s ease;
}

.bonus-claim-btn:hover {
    background-color: #c2185b;
}

.bonus-claim-btn:disabled {
    background-color: #e0e0e0;
    color: #9e9e9e;
    cursor: not-allowed;
}

/* Adjust grid for 5 cards */
@media (min-width: 768px) {
    .bonus-cards-container {
        grid-template-columns: repeat(5, 1fr);
    }
}

@media (max-width: 767px) {
    .bonus-cards-container {
        grid-template-columns: repeat(2, 1fr);
    }
    
    /* Make the Bonuses card span full width on mobile */
    #bonusesCard {
        grid-column: span 2;
    }
}

/* Utility Classes */
.hidden {
    display: none !important;
}


   
   #NominationformPage {
    display: none;
}
/* Creator Modal Overlay */
.creator-modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.7);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 1000;
    backdrop-filter: blur(5px);
}

.creator-modal-overlay.active {
    display: flex;
}

/* Creator Modal Container */
.creator-modal-container {
    background: #1a1a2e;
    border-radius: 20px;
    width: 90%;
    max-width: 500px;
    max-height: 90vh;
    overflow: hidden;
    box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
    animation: creatorModalSlideIn 0.3s ease-out;
    display: flex;
    flex-direction: column;
    border: 1px solid #16213e;
}

@keyframes creatorModalSlideIn {
    from {
        opacity: 0;
        transform: scale(0.8) translateY(-50px);
    }
    to {
        opacity: 1;
        transform: scale(1) translateY(0);
    }
}

/* Modal Header */
.creator-modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px 25px;
    background: rgba(22, 33, 62, 0.3);
    backdrop-filter: blur(10px);
    border-bottom: 1px solid #16213e;
}

.creator-modal-header h2 {
    color: white;
    margin: 0;
    font-size: 1.8rem;
    font-weight: 700;
}

.creator-modal-close-btn {
    background: rgba(22, 33, 62, 0.5);
    border: none;
    border-radius: 50%;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
    color: white;
    font-size: 1.2rem;
}

.creator-modal-close-btn:hover {
    background: rgba(22, 33, 62, 0.8);
    transform: rotate(90deg);
}

/* Banner Ads */
.creator-banner-ad {
    width: 480px;
    height: 65px;
    margin: 0 auto;
    padding: 10px 15px;
    background: linear-gradient(135deg, #16213e, #0f3460);
    backdrop-filter: blur(10px);
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 8px;
    margin-top: 15px;
    margin-bottom: 15px;
}

.creator-banner-ad.top-banner {
    border-bottom: 1px solid #16213e;
    margin-top: 0;
}

.creator-banner-ad.bottom-banner {
    border-top: 1px solid #16213e;
    margin-bottom: 0;
}

.creator-ad-content {
    text-align: center;
}

.creator-ad-label {
    background: #0f3460;
    color: white;
    padding: 4px 12px;
    border-radius: 15px;
    font-size: 0.8rem;
    font-weight: 600;
    display: inline-block;
    margin-bottom: 5px;
}

.creator-ad-content p {
    color: rgba(255, 255, 255, 0.9);
    margin: 0;
    font-size: 0.85rem;
}

/* Scrollable Content Area */
.creator-content-area {
    flex: 1;
    overflow-y: auto;
    padding: 20px 25px;
    background: #1a1a2e;
}

.creator-cards-container {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

/* Creator Card Buttons with Different Border Colors */
.creator-card-btn {
    background: rgba(22, 33, 62, 0.3);
    border-radius: 15px;
    padding: 20px;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 15px;
    backdrop-filter: blur(10px);
    border: 2px solid;
}

/* Entertainment Event - Teal Blue */
.creator-card-btn:nth-child(1) {
    border-color: #008B8B;
}

.creator-card-btn:nth-child(1):hover {
    background: rgba(0, 139, 139, 0.1);
    border-color: #20B2AA;
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0, 139, 139, 0.2);
}

/* Sport Event - Ocean Blue */
.creator-card-btn:nth-child(2) {
    border-color: #1E90FF;
}

.creator-card-btn:nth-child(2):hover {
    background: rgba(30, 144, 255, 0.1);
    border-color: #4169E1;
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(30, 144, 255, 0.2);
}

/* Award Ceremony - Deep Sky Blue */
.creator-card-btn:nth-child(3) {
    border-color: #00BFFF;
}

.creator-card-btn:nth-child(3):hover {
    background: rgba(0, 191, 255, 0.1);
    border-color: #87CEEB;
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0, 191, 255, 0.2);
}

.creator-card-icon {
    width: 50px;
    height: 50px;
    background: rgba(22, 33, 62, 0.5);
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    color: white;
    flex-shrink: 0;
}

.creator-card-content {
    flex: 1;
}

.creator-card-content h3 {
    color: white;
    margin: 0 0 5px 0;
    font-size: 1.1rem;
    font-weight: 600;
}

.creator-card-content p {
    color: rgba(255, 255, 255, 0.8);
    margin: 0;
    font-size: 0.9rem;
    line-height: 1.4;
}

.creator-card-arrow {
    color: rgba(255, 255, 255, 0.6);
    font-size: 1rem;
    transition: all 0.3s ease;
}

.creator-card-btn:hover .creator-card-arrow {
    color: white;
    transform: translateX(5px);
}

/* Add More Placeholder */
.creator-add-more {
    background: rgba(22, 33, 62, 0.2);
    border: 2px dashed rgba(255, 255, 255, 0.3);
    border-radius: 15px;
    padding: 30px 20px;
    text-align: center;
    color: rgba(255, 255, 255, 0.6);
}

.creator-add-icon {
    width: 50px;
    height: 50px;
    background: rgba(22, 33, 62, 0.3);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    margin: 0 auto 15px;
}

.creator-add-more p {
    margin: 0;
    font-size: 0.9rem;
}

/* Custom Scrollbar */
.creator-content-area::-webkit-scrollbar {
    width: 6px;
}

.creator-content-area::-webkit-scrollbar-track {
    background: rgba(22, 33, 62, 0.3);
    border-radius: 3px;
}

.creator-content-area::-webkit-scrollbar-thumb {
    background: rgba(255, 255, 255, 0.3);
    border-radius: 3px;
}

.creator-content-area::-webkit-scrollbar-thumb:hover {
    background: rgba(255, 255, 255, 0.5);
}

/* Responsive Design */
@media (max-width: 768px) {
    .creator-modal-container {
        width: 95%;
        max-height: 95vh;
    }
    
    .creator-modal-header {
        padding: 15px 20px;
    }
    
    .creator-modal-header h2 {
        font-size: 1.5rem;
    }
    
    .creator-content-area {
        padding: 15px 20px;
    }
    
    .creator-banner-ad {
        width: 100%;
        max-width: 480px;
        padding: 8px 12px;
    }
    
    .creator-card-btn {
        padding: 15px;
        gap: 12px;
    }
    
    .creator-card-icon {
        width: 45px;
        height: 45px;
        font-size: 1.3rem;
    }
}

@media (max-width: 480px) {
    .creator-modal-container {
        width: 100%;
        height: 100%;
        max-height: 100vh;
        border-radius: 0;
    }
    
    .creator-banner-ad {
        width: 100%;
        height: 55px;
        padding: 8px 10px;
    }
    
    .creator-ad-content p {
        font-size: 0.8rem;
    }
    
    .creator-card-btn {
        flex-direction: column;
        text-align: center;
        gap: 10px;
    }
    
    .creator-card-arrow {
        display: none;
    }
}

/* Entertainment Event Page */
.entertainment-event-page {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: #1a1a2e;
    z-index: 1000;
    overflow-y: auto;
    display: none;
}

/* Page Header */
.entertainment-page-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px 25px;
    background: rgba(22, 33, 62, 0.3);
    border-bottom: 1px solid #16213e;
    position: sticky;
    top: 0;
    z-index: 10;
}

.entertainment-page-header h2 {
    color: white;
    margin: 0;
    font-size: 1.8rem;
    font-weight: 700;
}

.close-entertainment-event-page-btn {
    background: rgba(22, 33, 62, 0.5);
    border: none;
    border-radius: 50%;
    width: 45px;
    height: 45px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
    color: white;
    font-size: 1.3rem;
}

.close-entertainment-event-page-btn:hover {
    background: rgba(22, 33, 62, 0.8);
    transform: rotate(90deg);
}

/* Banner Ad */
.entertainment-banner-ad {
    width: 480px;
    height: 65px;
    margin: 20px auto;
    padding: 10px 15px;
    background: linear-gradient(135deg, #16213e, #0f3460);
    backdrop-filter: blur(10px);
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 8px;
    border: 1px solid #008B8B;
}

.entertainment-ad-content {
    text-align: center;
}

.entertainment-ad-label {
    background: #0f3460;
    color: white;
    padding: 4px 12px;
    border-radius: 15px;
    font-size: 0.8rem;
    font-weight: 600;
    display: inline-block;
    margin-bottom: 5px;
}

.entertainment-ad-content p {
    color: rgba(255, 255, 255, 0.9);
    margin: 0;
    font-size: 0.85rem;
}

/* Action Buttons */
.entertainment-action-buttons {
    display: flex;
    gap: 20px;
    padding: 0 25px;
    margin: 20px 0;
    justify-content: center;
}

.entertainment-action-btn {
    background: rgba(22, 33, 62, 0.3);
    border: 2px solid #008B8B;
    border-radius: 15px;
    padding: 15px 25px;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 10px;
    color: white;
    font-weight: 600;
    min-width: 120px;
    justify-content: center;
}

.entertainment-action-btn:hover {
    background: rgba(0, 139, 139, 0.1);
    border-color: #20B2AA;
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0, 139, 139, 0.2);
}

.entertainment-btn-icon {
    font-size: 1.2rem;
}

/* Tabs */
.entertainment-tabs {
    padding: 0 25px;
}

.entertainment-tabs-header {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
    border-bottom: 1px solid #16213e;
    padding-bottom: 10px;
}

.entertainment-tab-btn {
    background: rgba(22, 33, 62, 0.3);
    border: 1px solid #16213e;
    border-radius: 10px 10px 0 0;
    padding: 12px 20px;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 8px;
    color: rgba(255, 255, 255, 0.7);
    font-weight: 500;
}

.entertainment-tab-btn:hover {
    background: rgba(22, 33, 62, 0.5);
    color: white;
}

.entertainment-tab-btn.active {
    background: #008B8B;
    color: white;
    border-color: #008B8B;
}

.entertainment-tab-btn i {
    font-size: 1rem;
}

/* Tab Content */
.entertainment-tab-content {
    min-height: 400px;
}

.entertainment-tab-pane {
    display: none;
}

.entertainment-tab-pane.active {
    display: block;
}

.entertainment-cards-container {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 20px;
    padding: 20px 0;
}

/* Empty State */
.entertainment-empty-state {
    grid-column: 1 / -1;
    text-align: center;
    padding: 60px 20px;
    color: rgba(255, 255, 255, 0.6);
}

.entertainment-empty-state i {
    font-size: 4rem;
    margin-bottom: 20px;
    color: rgba(255, 255, 255, 0.3);
}

.entertainment-empty-state p {
    font-size: 1.1rem;
    margin: 0;
    line-height: 1.5;
}

/* Responsive Design */
@media (max-width: 768px) {
    .entertainment-page-header {
        padding: 15px 20px;
    }
    
    .entertainment-page-header h2 {
        font-size: 1.5rem;
    }
    
    .entertainment-banner-ad {
        width: 100%;
        max-width: 480px;
        margin: 15px auto;
        padding: 8px 12px;
    }
    
    .entertainment-action-buttons {
        padding: 0 20px;
        gap: 15px;
    }
    
    .entertainment-action-btn {
        padding: 12px 20px;
        min-width: 100px;
    }
    
    .entertainment-tabs {
        padding: 0 20px;
    }
    
    .entertainment-tabs-header {
        flex-direction: column;
        gap: 5px;
    }
    
    .entertainment-tab-btn {
        justify-content: center;
        padding: 10px 15px;
    }
    
    .entertainment-cards-container {
        grid-template-columns: 1fr;
        gap: 15px;
    }
}

@media (max-width: 480px) {
    .entertainment-page-header {
        padding: 12px 15px;
    }
    
    .entertainment-page-header h2 {
        font-size: 1.3rem;
    }
    
    .entertainment-banner-ad {
        height: 55px;
        padding: 8px 10px;
    }
    
    .entertainment-ad-content p {
        font-size: 0.8rem;
    }
    
    .entertainment-action-buttons {
        flex-direction: column;
        padding: 0 15px;
        gap: 10px;
    }
    
    .entertainment-action-btn {
        width: 100%;
    }
    
    .entertainment-tabs {
        padding: 0 15px;
    }
    
    .entertainment-tab-btn span {
        display: none;
    }
    
    .entertainment-empty-state {
        padding: 40px 15px;
    }
    
    .entertainment-empty-state i {
        font-size: 3rem;
    }
    
    .entertainment-empty-state p {
        font-size: 1rem;
    }
}


/* Host Entertainment Popup Overlay */
.host-entertainment-popup-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.8);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 1500;
    backdrop-filter: blur(5px);
}

/* Popup Container */
.host-entertainment-popup-container {
    background: #1a1a2e;
    border-radius: 20px;
    width: 90%;
    max-width: 600px;
    max-height: 90vh;
    overflow: hidden;
    box-shadow: 0 25px 50px rgba(0, 0, 0, 0.4);
    border: 1px solid #16213e;
    display: flex;
    flex-direction: column;
}

/* Popup Header */
.host-entertainment-popup-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px 25px;
    background: rgba(22, 33, 62, 0.3);
    border-bottom: 1px solid #16213e;
}

.host-entertainment-popup-header h2 {
    color: white;
    margin: 0;
    font-size: 1.6rem;
    font-weight: 700;
}

.close-host-entertainment-popup-btn {
    background: rgba(22, 33, 62, 0.5);
    border: none;
    border-radius: 50%;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
    color: white;
    font-size: 1.2rem;
}

.close-host-entertainment-popup-btn:hover {
    background: rgba(22, 33, 62, 0.8);
    transform: rotate(90deg);
}

/* Banner Ad */
.host-entertainment-banner-ad {
    width: 480px;
    height: 65px;
    margin: 15px auto;
    padding: 10px 15px;
    background: linear-gradient(135deg, #16213e, #0f3460);
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 8px;
    border: 1px solid #008B8B;
}

.host-entertainment-ad-content {
    text-align: center;
}

.host-entertainment-ad-label {
    background: #0f3460;
    color: white;
    padding: 4px 12px;
    border-radius: 15px;
    font-size: 0.8rem;
    font-weight: 600;
    display: inline-block;
    margin-bottom: 5px;
}

.host-entertainment-ad-content p {
    color: rgba(255, 255, 255, 0.9);
    margin: 0;
    font-size: 0.85rem;
}

/* Form Content */
.host-entertainment-form-content {
    flex: 1;
    overflow-y: auto;
    padding: 20px 25px;
}

/* Form Groups */
.form-group {
    margin-bottom: 20px;
}

.form-group label {
    display: block;
    color: white;
    font-weight: 600;
    margin-bottom: 8px;
    font-size: 0.95rem;
}

/* Form Inputs */
.form-input, .form-select, .form-textarea {
    width: 100%;
    padding: 12px 15px;
    background: rgba(22, 33, 62, 0.3);
    border: 1px solid #16213e;
    border-radius: 10px;
    color: white;
    font-size: 0.95rem;
    transition: all 0.3s ease;
}

.form-input:focus, .form-select:focus, .form-textarea:focus {
    outline: none;
    border-color: #008B8B;
    box-shadow: 0 0 0 2px rgba(0, 139, 139, 0.2);
}

.form-input::placeholder, .form-textarea::placeholder {
    color: rgba(255, 255, 255, 0.5);
}
.form-help {
    color: rgba(255, 255, 255, 0.6);
    font-size: 0.8rem;
    margin-top: 5px;
    display: block;
}

/* Custom Category Input */
.custom-category-input {
    display: flex;
    gap: 10px;
    margin-top: 10px;
}

.custom-category-input .form-input {
    flex: 1;
}

.add-category-btn, .custom-category-toggle {
    background: #008B8B;
    color: white;
    border: none;
    padding: 8px 15px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 0.85rem;
    font-weight: 600;
    transition: all 0.3s ease;
}

.add-category-btn:hover, .custom-category-toggle:hover {
    background: #20B2AA;
    transform: translateY(-1px);
}

.custom-category-toggle {
    background: rgba(22, 33, 62, 0.5);
    margin-top: 10px;
    width: 100%;
}

/* Fee Options */
.fee-options {
    display: flex;
    gap: 15px;
    align-items: center;
}

.fee-input-wrapper {
    flex: 1;
    position: relative;
    display: flex;
    align-items: center;
    gap: 10px;
}

.fee-input {
    flex: 1;
}

.currency-label {
    color: #008B8B;
    font-weight: 600;
    font-size: 0.9rem;
}

.naira-equivalent {
    color: rgba(255, 255, 255, 0.6);
    font-size: 0.8rem;
}

.no-fee-btn {
    background: rgba(22, 33, 62, 0.5);
    color: white;
    border: 1px solid #16213e;
    padding: 10px 15px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 0.85rem;
    transition: all 0.3s ease;
    white-space: nowrap;
}

.no-fee-btn:hover {
    background: rgba(22, 33, 62, 0.8);
    border-color: #008B8B;
}

.no-fee-btn.active {
    background: #008B8B;
    border-color: #008B8B;
}

/* Background Options */
.background-options {
    border: 1px solid #16213e;
    border-radius: 10px;
    overflow: hidden;
}

.background-tabs {
    display: flex;
    background: rgba(22, 33, 62, 0.3);
}

.bg-tab {
    flex: 1;
    padding: 10px;
    background: transparent;
    border: none;
    color: rgba(255, 255, 255, 0.7);
    cursor: pointer;
    transition: all 0.3s ease;
}

.bg-tab.active {
    background: #008B8B;
    color: white;
}

.background-content {
    padding: 15px;
}

.bg-content {
    display: none;
}

.bg-content.active {
    display: block;
}

.file-input {
    display: none;
}

.file-label {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    padding: 15px;
    background: rgba(22, 33, 62, 0.3);
    border: 2px dashed #16213e;
    border-radius: 8px;
    color: rgba(255, 255, 255, 0.7);
    cursor: pointer;
    transition: all 0.3s ease;
}

.file-label:hover {
    border-color: #008B8B;
    color: white;
}

.color-palette {
    display: grid;
    grid-template-columns: repeat(6, 1fr);
    gap: 10px;
    margin-bottom: 15px;
}

.color-option {
    width: 40px;
    height: 40px;
    border-radius: 8px;
    cursor: pointer;
    border: 2px solid transparent;
    transition: all 0.3s ease;
}

.color-option:hover, .color-option.selected {
    border-color: white;
    transform: scale(1.1);
}

.custom-color-input {
    width: 100%;
    height: 40px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
}

/* Tags Section */
.tags-section {
    border: 1px solid #16213e;
    border-radius: 10px;
    padding: 15px;
}

.tag-input-section {
    display: flex;
    gap: 10px;
    margin-bottom: 15px;
}

.tag-input {
    flex: 1;
}

.add-tag-btn {
    background: #008B8B;
    color: white;
    border: none;
    padding: 8px 15px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 0.85rem;
    font-weight: 600;
    transition: all 0.3s ease;
}

.add-tag-btn:hover {
    background: #20B2AA;
}

.tags-display {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.hashtags, .startags {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
}

.tag-item {
    background: rgba(22, 33, 62, 0.5);
    color: white;
    padding: 5px 10px;
    border-radius: 15px;
    font-size: 0.8rem;
    display: flex;
    align-items: center;
    gap: 5px;
}

.tag-remove {
    background: none;
    border: none;
    color: rgba(255, 255, 255, 0.7);
    cursor: pointer;
    font-size: 0.7rem;
}

.tag-remove:hover {
    color: #ff6b6b;
}

/* Rules Section */
.rules-section {
    border: 1px solid #16213e;
    border-radius: 10px;
    padding: 15px;
}

.rule-input-section {
    display: flex;
    gap: 10px;
    margin-bottom: 15px;
}

.rule-textarea {
    flex: 1;
    resize: vertical;
}

.add-rule-btn {
    background: #008B8B;
    color: white;
    border: none;
    padding: 10px 15px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 0.85rem;
    font-weight: 600;
    transition: all 0.3s ease;
    align-self: flex-start;
}

.add-rule-btn:hover {
    background: #20B2AA;
}

.rules-list {
    margin-bottom: 10px;
}

.rule-item {
    background: rgba(22, 33, 62, 0.3);
    border: 1px solid #16213e;
    border-radius: 8px;
    padding: 10px;
    margin-bottom: 10px;
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 10px;
}

.rule-text {
    color: white;
    font-size: 0.9rem;
    line-height: 1.4;
    flex: 1;
}

.rule-number {
    background: #008B8B;
    color: white;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.7rem;
    font-weight: 600;
    flex-shrink: 0;
}

.rule-remove {
    background: none;
    border: none;
    color: rgba(255, 255, 255, 0.5);
    cursor: pointer;
    font-size: 0.9rem;
    padding: 2px;
}

.rule-remove:hover {
    color: #ff6b6b;
}

/* Payment Summary */
.payment-summary {
    background: rgba(22, 33, 62, 0.3);
    border: 1px solid #16213e;
    border-radius: 15px;
    padding: 20px;
}

.payment-summary h3 {
    color: white;
    margin: 0 0 15px 0;
    font-size: 1.2rem;
    font-weight: 600;
}

.creation-fee-breakdown {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.fee-item {
    display: flex;
    justify-content: space-between;
    color: rgba(255, 255, 255, 0.8);
    font-size: 0.9rem;
}

.fee-total {
    display: flex;
    justify-content: space-between;
    align-items: center;
    color: white;
    font-weight: 600;
    font-size: 1rem;
    padding-top: 10px;
    border-top: 1px solid #16213e;
    margin-top: 10px;
}

.fee-total small {
    color: rgba(255, 255, 255, 0.6);
    font-size: 0.8rem;
    font-weight: normal;
}

/* Submit Button */
.form-actions {
    margin-top: 20px;
    padding-top: 20px;
    border-top: 1px solid #16213e;
}

.submit-btn {
    width: 100%;
    background: linear-gradient(135deg, #008B8B, #20B2AA);
    color: white;
    border: none;
    padding: 15px;
    border-radius: 12px;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
}

.submit-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0, 139, 139, 0.3);
}

.submit-btn:disabled {
    background: rgba(22, 33, 62, 0.5);
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
}

/* Custom Scrollbar */
.host-entertainment-form-content::-webkit-scrollbar {
    width: 6px;
}

.host-entertainment-form-content::-webkit-scrollbar-track {
    background: rgba(22, 33, 62, 0.3);
    border-radius: 3px;
}

.host-entertainment-form-content::-webkit-scrollbar-thumb {
    background: rgba(255, 255, 255, 0.3);
    border-radius: 3px;
}

.host-entertainment-form-content::-webkit-scrollbar-thumb:hover {
    background: rgba(255, 255, 255, 0.5);
}

/* Responsive Design */
@media (max-width: 768px) {
    .host-entertainment-popup-container {
        width: 95%;
        max-height: 95vh;
    }
    
    .host-entertainment-popup-header {
        padding: 15px 20px;
    }
    
    .host-entertainment-popup-header h2 {
        font-size: 1.4rem;
    }
    
    .host-entertainment-banner-ad {
        width: 100%;
        max-width: 480px;
        margin: 10px auto;
    }
    
    .host-entertainment-form-content {
        padding: 15px 20px;
    }
    
    .fee-options {
        flex-direction: column;
        gap: 10px;
    }
    
    .tag-input-section, .rule-input-section {
        flex-direction: column;
        gap: 8px;
    }
    
    .color-palette {
        grid-template-columns: repeat(4, 1fr);
    }
}

@media (max-width: 480px) {
    .host-entertainment-popup-container {
        width: 100%;
        height: 100%;
        max-height: 100vh;
        border-radius: 0;
    }
    
    .host-entertainment-banner-ad {
        height: 55px;
        padding: 8px 10px;
    }
    
    .host-entertainment-form-content {
        padding: 15px;
    }
    
    .color-palette {
        grid-template-columns: repeat(3, 1fr);
    }
    
    .color-option {
        width: 35px;
        height: 35px;
    }
}

/* Payment Method Selection */
.payment-method-selection {
    display: flex;
    gap: 15px;
    margin-bottom: 20px;
}

.payment-option {
    flex: 1;
}

.payment-option input[type="radio"] {
    display: none;
}

.payment-option-label {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 15px;
    border: 2px solid #e0e0e0;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
    background: white;
    font-weight: 500;
}

.payment-option input[type="radio"]:checked + .payment-option-label,
.payment-option-label.active {
    border-color: #007bff;
    background: #f8f9ff;
    color: #007bff;
}

.payment-option-label:hover {
    border-color: #007bff;
    background: #f8f9ff;
}

.payment-option-label i {
    font-size: 18px;
}

/* Promo Code Section */
.promo-code-section {
    margin-bottom: 20px;
    padding: 15px;
    background: #f8f9fa;
    border-radius: 8px;
    border-left: 4px solid #007bff;
}

.promo-code-section .form-input {
    margin-bottom: 8px;
    padding: 12px 15px;
    border: 2px solid #e0e0e0;
    border-radius: 8px;
    font-size: 14px;
    transition: all 0.3s ease;
}

.promo-code-section .form-input:focus {
    outline: none;
    border-color: #007bff;
    box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
}

.promo-code-section .form-input.valid {
    border-color: #28a745;
    background: #f8fff9;
}

.promo-code-section .form-input.invalid {
    border-color: #dc3545;
    background: #fff8f8;
}

.promo-code-section .form-help {
    color: #6c757d;
    font-size: 12px;
    font-style: italic;
}

/* Payment Summary */
.payment-summary {
    background: #f8f9fa;
    padding: 20px;
    border-radius: 10px;
    margin-top: 20px;
}

.payment-summary h3 {
    margin: 0 0 15px 0;
    color: #333;
    font-size: 18px;
}

.creation-fee-breakdown {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.fee-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 0;
    border-bottom: 1px solid #e9ecef;
}

.fee-item:last-child {
    border-bottom: none;
}

.fee-item.total-fee {
    font-weight: 600;
    font-size: 16px;
    color: #007bff;
    border-top: 2px solid #007bff;
    padding-top: 12px;
    margin-top: 8px;
}

.fee-equivalent {
    text-align: center;
    margin-top: 10px;
    color: #6c757d;
    font-size: 14px;
}

/* Responsive Entertainment Card Styles for Android & iOS */
.entertainment-card {
    width: 100%;
    max-width: 350px;
    height: 280px;
    margin: 15px auto;
    border-radius: 15px;
    overflow: hidden;
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    position: relative;
    /* Prevent text selection on mobile */
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
    /* Improve touch performance */
    -webkit-tap-highlight-color: transparent;
    touch-action: manipulation;
}

.entertainment-card:hover,
.entertainment-card:active {
    transform: translateY(-3px);
    box-shadow: 0 12px 35px rgba(0, 0, 0, 0.2);
}

.entertainment-card-inner {
    width: 100%;
    height: 100%;
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    position: relative;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    padding: 12px;
    /* Improve rendering on mobile */
    -webkit-backface-visibility: hidden;
    backface-visibility: hidden;
    transform: translateZ(0);
}

/* Card Overlay for better text visibility */
.card-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(
        135deg,
        rgba(0, 0, 0, 0.1) 0%,
        rgba(0, 0, 0, 0.3) 50%,
        rgba(0, 0, 0, 0.5) 100%
    );
    z-index: 1;
}

/* All content should be above overlay */
.entertainment-card-inner > * {
    position: relative;
    z-index: 2;
}

/* Event Name Overlay */
.event-name-overlay {
    position: absolute;
    top: 12px;
    left: 12px;
    background: rgba(0, 0, 0, 0.85);
    color: white;
    padding: 8px 12px;
    border-radius: 8px;
    backdrop-filter: blur(10px);
    max-width: calc(100% - 120px);
    z-index: 3;
}

.event-name-overlay h3 {
    margin: 0;
    font-size: 14px;
    font-weight: 600;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    line-height: 1.2;
}

/* Action Buttons (Top Right) */
.card-action-buttons {
    position: absolute;
    top: 12px;
    right: 12px;
    display: flex;
    gap: 6px;
    z-index: 3;
}

.card-btn {
    width: 36px;
    height: 36px;
    border: none;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.95);
    color: #333;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s ease;
    backdrop-filter: blur(10px);
    font-size: 14px;
    /* Better touch targets */
    min-width: 44px;
    min-height: 44px;
    /* Prevent double-tap zoom */
    touch-action: manipulation;
}

.card-btn:hover,
.card-btn:active {
    background: rgba(255, 255, 255, 1);
    transform: scale(1.05);
}

.card-btn:active {
    transform: scale(0.95);
}

.edit-btn:hover,
.edit-btn:active {
    color: #007bff;
}

.delete-btn:hover,
.delete-btn:active {
    color: #dc3545;
}

/* Participants Counter */
.participants-counter {
    position: absolute;
    top: 60px;
    right: 12px;
    background: rgba(0, 0, 0, 0.85);
    color: white;
    padding: 6px 10px;
    border-radius: 15px;
    font-size: 12px;
    display: flex;
    align-items: center;
    gap: 5px;
    backdrop-filter: blur(10px);
    z-index: 3;
}

/* Event Info Middle Section */
.event-info-middle {
    position: absolute;
    left: 12px;
    top: 50%;
    transform: translateY(-50%);
    display: flex;
    flex-direction: column;
    gap: 6px;
    z-index: 3;
    max-width: calc(100% - 24px);
}

.event-duration,
.event-type,
.event-fee {
    background: rgba(0, 0, 0, 0.85);
    color: white;
    padding: 6px 10px;
    border-radius: 15px;
    font-size: 12px;
    display: flex;
    align-items: center;
    gap: 6px;
    backdrop-filter: blur(10px);
    white-space: nowrap;
    max-width: fit-content;
}

.event-duration {
    background: rgba(76, 175, 80, 0.9);
}

.event-type {
    background: rgba(33, 150, 243, 0.9);
}

.event-fee {
    background: rgba(255, 193, 7, 0.9);
    color: #333;
}

/* Bottom Action Buttons */
.card-bottom-actions {
    position: absolute;
    bottom: 12px;
    left: 12px;
    right: 12px;
    display: flex;
    gap: 8px;
    z-index: 3;
}

.open-btn,
.launch-btn {
    flex: 1;
    padding: 10px 12px;
    border: none;
    border-radius: 20px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
    backdrop-filter: blur(10px);
    font-size: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 5px;
    /* Better touch targets */
    min-height: 44px;
    touch-action: manipulation;
}

.open-btn {
    background: rgba(255, 255, 255, 0.95);
    color: #333;
}

.open-btn:hover,
.open-btn:active {
    background: rgba(255, 255, 255, 1);
    transform: translateY(-1px);
}

.launch-btn {
    background: rgba(76, 175, 80, 0.95);
    color: white;
}

.launch-btn:hover,
.launch-btn:active {
    background: rgba(76, 175, 80, 1);
    transform: translateY(-1px);
}

.open-btn:active,
.launch-btn:active {
    transform: scale(0.98);
}

/* Container Responsive Styles */
.entertainment-cards-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
    padding: 20px;
    max-width: 1200px;
    margin: 0 auto;
}

/* Mobile Responsive Styles */
@media screen and (max-width: 768px) {
    .entertainment-card {
        max-width: 100%;
        height: 260px;
        margin: 10px 0;
        border-radius: 12px;
    }
    
    .entertainment-card-inner {
        padding: 10px;
    }
    
    .event-name-overlay {
        top: 10px;
        left: 10px;
        padding: 6px 10px;
        max-width: calc(100% - 100px);
    }
    
    .event-name-overlay h3 {
        font-size: 13px;
    }
    
    .card-action-buttons {
        top: 10px;
        right: 10px;
        gap: 4px;
    }
    
    .card-btn {
        width: 32px;
        height: 32px;
        min-width: 40px;
        min-height: 40px;
        font-size: 12px;
    }
    
    .participants-counter {
        top: 52px;
        right: 10px;
        font-size: 11px;
        padding: 4px 8px;
    }
    
    .event-info-middle {
        left: 10px;
        gap: 5px;
    }
    
    .event-duration,
    .event-type,
    .event-fee {
        font-size: 11px;
        padding: 5px 8px;
    }
    
    .card-bottom-actions {
        bottom: 10px;
        left: 10px;
        right: 10px;
        gap: 6px;
    }
    
    .open-btn,
    .launch-btn {
        padding: 8px 10px;
        font-size: 11px;
        min-height: 40px;
    }
    
    .open-btn span,
    .launch-btn span {
        display: none;
    }
    
    .entertainment-cards-container {
        grid-template-columns: 1fr;
        gap: 15px;
        padding: 15px;
    }
}
.entertainment-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding: 0 15px;
}

.refresh-events-btn {
    background: #007bff;
    color: white;
    border: none;
    padding: 10px 15px;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 14px;
    min-height: 44px;
}

.refresh-events-btn:hover {
    background: #0056b3;
}

.refresh-events-btn:disabled {
    opacity: 0.6;
    cursor: not-allowed;
}

.refresh-events-btn i {
    transition: transform 0.3s ease;
}

.refresh-events-btn:not(:disabled):hover i {
    transform: rotate(180deg);
}

/* Mobile responsive */
@media screen and (max-width: 768px) {
    .entertainment-header {
        padding: 0 10px;
        margin-bottom: 15px;
    }
    
    .refresh-events-btn {
        padding: 8px 12px;
        font-size: 12px;
    }
    
    .refresh-events-btn span {
        display: none;
    }
}

/* Small Mobile Devices */
@media screen and (max-width: 480px) {
    .entertainment-card {
        height: 240px;
        margin: 8px 0;
    }
    
    .event-name-overlay h3 {
        font-size: 12px;
    }
    
    .card-btn {
        width: 30px;
        height: 30px;
        min-width: 36px;
        min-height: 36px;
        font-size: 11px;
    }
    
    .participants-counter {
        font-size: 10px;
    }
    
    .event-duration,
    .event-type,
    .event-fee {
        font-size: 10px;
        padding: 4px 6px;
    }
    
    .open-btn,
    .launch-btn {
        padding: 6px 8px;
        font-size: 10px;
        min-height: 36px;
    }
    
    .entertainment-cards-container {
        padding: 10px;
        gap: 10px;
    }
}

/* Large Tablets */
@media screen and (min-width: 769px) and (max-width: 1024px) {
    .entertainment-cards-container {
        grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
        gap: 25px;
        padding: 25px;
    }
    
    .entertainment-card {
        max-width: 380px;
        height: 300px;
    }
}

/* Desktop */
@media screen and (min-width: 1025px) {
    .entertainment-cards-container {
        grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
        gap: 30px;
        padding: 30px;
    }
    
    .entertainment-card {
        max-width: 400px;
        height: 320px;
    }
    
    .entertainment-card:hover {
        transform: translateY(-8px);
    }
}

/* iOS Safari specific fixes */
@supports (-webkit-touch-callout: none) {
    .entertainment-card {
        -webkit-touch-callout: none;
        -webkit-user-select: none;
    }
    
    .card-btn,
    .open-btn,
    .launch-btn {
        -webkit-appearance: none;
        -webkit-tap-highlight-color: transparent;
    }
}

/* Android Chrome specific fixes */
@media screen and (-webkit-min-device-pixel-ratio: 1) {
    .entertainment-card {
        will-change: transform;
    }
    
    .card-btn:active,
    .open-btn:active,
    .launch-btn:active {
        background-color: rgba(0, 0, 0, 0.1);
    }
}

/* High DPI displays */
@media screen and (-webkit-min-device-pixel-ratio: 2),
       screen and (min-resolution: 192dpi) {
    .entertainment-card {
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }
    
    .entertainment-card:hover,
    .entertainment-card:active {
        box-shadow: 0 6px 18px rgba(0, 0, 0, 0.2);
    }
}

/* Dark mode support */
@media (prefers-color-scheme: dark) {
    .entertainment-card {
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
    }
    
    .card-btn {
        background: rgba(255, 255, 255, 0.9);
        color: #333;
    }
    
    .open-btn {
        background: rgba(255, 255, 255, 0.9);
        color: #333;
    }
}

/* Reduced motion for accessibility */
@media (prefers-reduced-motion: reduce) {
    .entertainment-card,
    .card-btn,
    .open-btn,
    .launch-btn {
        transition: none;
    }
    
    .entertainment-card:hover {
        transform: none;
    }
}

/* Start button styling */
.start-btn {
    background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 14px;
}

.start-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(17, 153, 142, 0.4);
    background: linear-gradient(135deg, #0f8a7e 0%, #32d96d 100%);
}

.start-btn:disabled {
    opacity: 0.7;
    cursor: not-allowed;
    transform: none;
}

.start-btn i {
    font-size: 14px;
}

/* Update launch button for consistency */
.launch-btn {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 14px;
}

.launch-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
    background: linear-gradient(135deg, #5a67d8 0%, #6b46c1 100%);
}

.launch-btn:disabled {
    opacity: 0.7;
    cursor: not-allowed;
    transform: none;
}

.launch-btn i {
    font-size: 14px;
}

/* Empty State Responsive */
.entertainment-empty-state {
    text-align: center;
    padding: 40px 20px;
    color: #666;
}

.entertainment-empty-state i {
    font-size: 48px;
    color: #ddd;
    margin-bottom: 20px;
}

.entertainment-empty-state p {
    font-size: 16px;
    line-height: 1.5;
    max-width: 300px;
    margin: 0 auto;
}

@media screen and (max-width: 480px) {
    .entertainment-empty-state {
        padding: 30px 15px;
    }
    
    .entertainment-empty-state i {
        font-size: 36px;
    }
    
    .entertainment-empty-state p {
        font-size: 14px;
    }
}

/* ===== PHYSICAL EVENT CREATION STYLES ===== */

/* Event Mode Selection */
.event-mode-selection {
    display: flex;
    gap: 15px;
    margin-bottom: 20px;
}

.mode-option {
    flex: 1;
}

.mode-option input[type="radio"] {
    display: none;
}

.mode-option-label {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 20px 15px;
    border: 2px solid #e0e0e0;
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.3s ease;
    background: #fff;
    text-align: center;
}

.mode-option-label:hover {
    border-color: #4ECDC4;
    background: #f8fdfc;
    transform: translateY(-2px);
}

.mode-option input[type="radio"]:checked + .mode-option-label {
    border-color: #4ECDC4;
    background: linear-gradient(135deg, #4ECDC4 0%, #44A08D 100%);
    color: white;
    box-shadow: 0 8px 25px rgba(78, 205, 196, 0.3);
}

.mode-option-label i {
    font-size: 24px;
    margin-bottom: 8px;
    color: #666;
}

.mode-option input[type="radio"]:checked + .mode-option-label i {
    color: white;
}

.mode-option-label span {
    font-weight: 600;
    font-size: 16px;
    margin-bottom: 4px;
}

.mode-option-label small {
    font-size: 12px;
    opacity: 0.8;
    line-height: 1.3;
}

/* Physical Event Sections */
#physicalEventSections {
    animation: slideInUp 0.5s ease-out;
}
tba-option {
    margin-bottom: 15px;
    padding: 10px;
    background-color: #f8f9fa;
    border-radius: 8px;
    border: 2px dashed #dee2e6;
}

.tba-checkbox {
    display: flex;
    align-items: center;
    cursor: pointer;
    font-weight: 500;
}

.tba-checkbox input[type="checkbox"] {
    margin-right: 8px;
    transform: scale(1.2);
}

.tba-display {
    text-align: center;
    padding: 20px;
    background-color: #e3f2fd;
    border-radius: 8px;
    border: 2px solid #2196f3;
}

.tba-message {
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 16px;
    color: #1976d2;
}

.tba-message i {
    margin-right: 8px;
    font-size: 18px;
}

.tba-ticket-note {
    background-color: #fff3cd;
    border: 1px solid #ffeaa7;
    color: #856404;
    padding: 10px;
    border-radius: 6px;
    margin-bottom: 15px;
    display: flex;
    align-items: center;
}

.tba-ticket-note i {
    margin-right: 8px;
    color: #f39c12;
}
@keyframes slideInUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}



/* Physical Category Selection */
#physicalEventCategory {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
    padding: 12px 15px;
    border-radius: 8px;
    font-weight: 500;
}

#physicalEventCategory option {
    background: white;
    color: #333;
    padding: 8px;
}

#physicalEventCategory optgroup {
    background: #f5f5f5;
    font-weight: 600;
    color: #555;
}

.custom-physical-category-input {
    display: flex;
    gap: 10px;
    margin-top: 10px;
    padding: 15px;
    background: #f8f9fa;
    border-radius: 8px;
    border-left: 4px solid #4ECDC4;
}

/* Location Input */
#locationGroup label {
    display: flex;
    align-items: center;
    gap: 8px;
    font-weight: 600;
    color: #333;
    margin-bottom: 8px;
}

#locationGroup label i {
    color: #e74c3c;
    font-size: 16px;
}

#eventLocation {
    border: 2px solid #e0e0e0;
    border-radius: 8px;
    padding: 12px;
    font-family: inherit;
    resize: vertical;
    transition: border-color 0.3s ease;
}

#eventLocation:focus {
    border-color: #4ECDC4;
    outline: none;
    box-shadow: 0 0 0 3px rgba(78, 205, 196, 0.1);
}

/* Event Scheduling */
.scheduling-section {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    padding: 20px;
    border-radius: 12px;
    color: white;
}

.datetime-row {
    display: flex;
    gap: 15px;
    margin-bottom: 15px;
}

.datetime-field {
    flex: 1;
}

.datetime-field label {
    display: block;
    margin-bottom: 5px;
    font-weight: 500;
    font-size: 14px;
}

.datetime-field input {
    width: 100%;
    padding: 10px;
    border: 1px solid rgba(255, 255, 255, 0.3);
    border-radius: 6px;
    background: rgba(255, 255, 255, 0.1);
    color: white;
    font-size: 14px;
}

.datetime-field input:focus {
    outline: none;
    border-color: rgba(255, 255, 255, 0.6);
    background: rgba(255, 255, 255, 0.2);
}

.datetime-field input::-webkit-calendar-picker-indicator {
    filter: invert(1);
    cursor: pointer;
}

.duration-display {
    background: rgba(255, 255, 255, 0.1);
    padding: 12px;
    border-radius: 8px;
    text-align: center;
    margin-top: 10px;
    border: 1px solid rgba(255, 255, 255, 0.2);
}

.duration-display i {
    margin-right: 8px;
    color: #ffd700;
}

.duration-display strong {
    color: #ffd700;
    font-size: 16px;
}

/* Ticket Configuration */
.ticket-config-section {
    background: #f8f9fa;
    border-radius: 12px;
    padding: 20px;
    border: 2px dashed #dee2e6;
    min-height: 120px;
}

.ticket-types-list {
    display: flex;
    flex-direction: column;
    gap: 15px;
    margin-bottom: 20px;
}

.ticket-type-item {
    background: white;
    border: 2px solid #e9ecef;
    border-radius: 10px;
    padding: 15px;
    position: relative;
    transition: all 0.3s ease;
}

.ticket-type-item:hover {
    border-color: #4ECDC4;
    box-shadow: 0 4px 15px rgba(78, 205, 196, 0.1);
}

.ticket-type-header {
    display: flex;
    justify-content: between;
    align-items: center;
    margin-bottom: 10px;
}

.ticket-type-name {
    font-weight: 600;
    font-size: 16px;
    color: #333;
}

.ticket-type-badge {
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 600;
    text-transform: uppercase;
}

.ticket-type-badge.free {
    background: #d4edda;
    color: #155724;
}

.ticket-type-badge.paid {
    background: #d1ecf1;
    color: #0c5460;
}

.ticket-type-badge.donation {
    background: #f8d7da;
    color: #721c24;
}

.ticket-type-details {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
}

.ticket-type-price {
    font-size: 18px;
    font-weight: 700;
    color: #28a745;
}

.ticket-type-quantity {
    font-size: 14px;
    color: #666;
}

.ticket-type-actions {
    display: flex;
    gap: 10px;
}


/* Add this CSS for ticket preview */
.ticket-preview {
    width: 100%;
    height: 60px;
    border-radius: 8px;
    margin-bottom: 10px;
    position: relative;
    overflow: hidden;
}

.ticket-preview-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.3);
    display: flex;
    align-items: center;
    justify-content: center;
}

.ticket-preview-text {
    color: white;
    font-weight: bold;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
}

.ticket-item {
    border: 1px solid #ddd;
    border-radius: 8px;
    padding: 15px;
    margin-bottom: 15px;
    background: white;
}

.ticket-actions {
    display: flex;
    gap: 10px;
    margin-top: 10px;
}

.edit-ticket-btn, .delete-ticket-btn {
    padding: 8px 12px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 14px;
}

.edit-ticket-btn {
    background-color: #007bff;
    color: white;
}

.delete-ticket-btn {
    background-color: #dc3545;
    color: white;
}

.edit-ticket-btn:hover {
    background-color: #0056b3;
}

.delete-ticket-btn:hover {
    background-color: #c82333;
}


.add-ticket-type-btn {
    width: 100%;
    padding: 15px;
    border: 2px dashed #4ECDC4;
    background: transparent;
    color: #4ECDC4;
    border-radius: 10px;
    cursor: pointer;
    font-weight: 600;
    font-size: 16px;
    transition: all 0.3s ease;
}

.add-ticket-type-btn:hover {
    background: #4ECDC4;
    color: white;
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(78, 205, 196, 0.3);
}

.add-ticket-type-btn i {
    margin-right: 8px;
}

/* Physical Event Background */
.background-tabs {
    display: flex;
    background: #f8f9fa;
    border-radius: 8px;
    padding: 4px;
    margin-bottom: 15px;
}

.bg-tab {
    flex: 1;
    padding: 10px;
    border: none;
    background: transparent;
    border-radius: 6px;
    cursor: pointer;
    font-weight: 500;
    transition: all 0.3s ease;
}

.bg-tab.active {
    background: white;
    color: #4ECDC4;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.bg-content {
    display: none;
}

.bg-content.active {
    display: block;
    animation: fadeIn 0.3s ease;
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

/* Media Upload */
.file-label {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    padding: 20px;
    border: 2px dashed #4ECDC4;
    border-radius: 10px;
    cursor: pointer;
    transition: all 0.3s ease;
    background: #f8fdfc;
}

.file-label:hover {
    border-color: #44A08D;
    background: #e8f8f5;
    transform: translateY(-2px);
}

.file-label i {
    font-size: 20px;
    color: #4ECDC4;
}

.media-preview-container {
    margin-top: 15px;
    border-radius: 10px;
    overflow: hidden;
    position: relative;
    background: #000;
}

.media-preview {
    width: 100%;
    max-height: 200px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.media-preview img,
.media-preview video {
    max-width: 100%;
    max-height: 200px;
    object-fit: cover;
    border-radius: 8px;
}

.remove-media-btn {
    position: absolute;
    top: 10px;
    right: 10px;
    background: rgba(220, 53, 69, 0.9);
    color: white;
    border: none;
    padding: 8px 12px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 12px;
    transition: all 0.3s ease;
}

.remove-media-btn:hover {
    background: #dc3545;
    transform: scale(1.05);
}

/* Gradient Background */
.gradient-picker {
    background: white;
    border-radius: 10px;
    padding: 20px;
    border: 1px solid #e0e0e0;
}

.gradient-controls {
    display: flex;
    gap: 20px;
    margin-bottom: 15px;
}

.color-input-group {
    flex: 1;
}

.color-input-group label {
    display: block;
    margin-bottom: 5px;
    font-weight: 500;
    color: #333;
}

.gradient-color-input {
    width: 100%;
    height: 40px;
    border: 2px solid #e0e0e0;
    border-radius: 8px;
    cursor: pointer;
    transition: border-color 0.3s ease;
}

.gradient-color-input:hover {
    border-color: #4ECDC4;
}

.gradient-preview {
    height: 80px;
    border-radius: 8px;
    background: linear-gradient(135deg, #FF6B6B 0%, #4ECDC4 100%);
    border: 2px solid #e0e0e0;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: 600;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
}

/* Physical Ticket Configuration Modal - Scoped Styles */
#physicalTicketConfigModal.ticket-config-modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.7);
    backdrop-filter: blur(5px);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 10000;
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s ease;
}

#physicalTicketConfigModal.ticket-config-modal-overlay[style*="flex"] {
    opacity: 1;
    visibility: visible;
}
/* Fix for text visibility and input styling */
#physicalTicketConfigModal .form-input {
    width: 100%;
    padding: 12px 16px;
    border: 2px solid #e5e7eb;
    border-radius: 8px;
    font-size: 1rem;
    transition: all 0.2s ease;
    background: #ffffff !important;
    color: #1f2937 !important; /* Force dark text */
    box-sizing: border-box;
}

#physicalTicketConfigModal .form-input:focus {
    outline: none;
    border-color: #667eea;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    background: #ffffff !important;
    color: #1f2937 !important;
}

#physicalTicketConfigModal .form-input::placeholder {
    color: #9ca3af !important;
    opacity: 1;
}

/* Fix for radio button labels - separate selected and unselected states */
#physicalTicketConfigModal .ticket-type-label {
    display: flex;
    align-items: center;
    padding: 16px 20px;
    border: 2px solid #e5e7eb;
    border-radius: 12px;
    background: #ffffff;
    transition: all 0.2s ease;
    gap: 16px;
    color: #374151 !important; /* Default dark text */
}

#physicalTicketConfigModal .ticket-type-option:hover .ticket-type-label {
    border-color: #667eea;
    background: #f8faff;
    color: #374151 !important; /* Keep dark text on hover */
}

/* Only apply white text when radio is checked */
#physicalTicketConfigModal .ticket-type-option input[type="radio"]:checked + .ticket-type-label {
    border-color: #667eea;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: #ffffff !important; /* White text only when selected */
}

#physicalTicketConfigModal .ticket-type-option input[type="radio"]:checked + .ticket-type-label strong {
    color: #ffffff !important;
}

#physicalTicketConfigModal .ticket-type-option input[type="radio"]:checked + .ticket-type-label small {
    color: #ffffff !important;
    opacity: 0.9;
}

/* Ensure unselected radio buttons have dark text */
#physicalTicketConfigModal .ticket-type-label strong {
    font-size: 1.1rem;
    margin-bottom: 2px;
    color: inherit;
}

#physicalTicketConfigModal .ticket-type-label small {
    font-size: 0.85rem;
    opacity: 0.8;
    color: inherit;
}

/* Fix form labels */
#physicalTicketConfigModal .form-group label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
    color: #374151 !important;
    font-size: 0.95rem;
}

/* Fix number inputs specifically */
#physicalTicketConfigModal input[type="number"] {
    background: #ffffff !important;
    color: #1f2937 !important;
}

#physicalTicketConfigModal input[type="text"] {
    background: #ffffff !important;
    color: #1f2937 !important;
}

/* Fix for webkit autofill */
#physicalTicketConfigModal .form-input:-webkit-autofill,
#physicalTicketConfigModal .form-input:-webkit-autofill:hover,
#physicalTicketConfigModal .form-input:-webkit-autofill:focus {
    -webkit-box-shadow: 0 0 0 1000px #ffffff inset !important;
    -webkit-text-fill-color: #1f2937 !important;
    background-color: #ffffff !important;
}

/* Additional contrast fixes */
#physicalTicketConfigModal .ticket-config-section {
    margin-top: 24px;
    padding: 20px;
    background: #f9fafb;
    border-radius: 12px;
    border: 1px solid #e5e7eb;
}

#physicalTicketConfigModal .ticket-config-section label {
    color: #374151 !important;
}

#physicalTicketConfigModal .ticket-config-section .form-input {
    background: #ffffff !important;
    color: #1f2937 !important;
}

/* Debug styles - remove after testing */
#physicalTicketConfigModal .form-input {
    /* Temporary red border to see if styles are applying */
    /* border: 2px solid red !important; */
}

#physicalTicketConfigModal .ticket-config-modal-container {
    background: #ffffff;
    border-radius: 16px;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    width: 90%;
    max-width: 600px;
    max-height: 90vh;
    overflow-y: auto;
    transform: scale(0.9) translateY(20px);
    transition: transform 0.3s ease;
}

#physicalTicketConfigModal[style*="flex"] .ticket-config-modal-container {
    transform: scale(1) translateY(0);
}

#physicalTicketConfigModal .ticket-config-modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 24px 32px;
    border-bottom: 1px solid #e5e7eb;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border-radius: 16px 16px 0 0;
}

#physicalTicketConfigModal .ticket-config-modal-header h3 {
    margin: 0;
    font-size: 1.5rem;
    font-weight: 600;
}

#physicalTicketConfigModal .close-modal-btn {
    background: rgba(255, 255, 255, 0.2);
    border: none;
    color: white;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.2rem;
    transition: all 0.2s ease;
}

#physicalTicketConfigModal .close-modal-btn:hover {
    background: rgba(255, 255, 255, 0.3);
    transform: scale(1.1);
}

#physicalTicketConfigModal .ticket-config-modal-content {
    padding: 32px;
}

#physicalTicketConfigModal .form-group {
    margin-bottom: 24px;
}

#physicalTicketConfigModal .form-group label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
    color: #374151;
    font-size: 0.95rem;
}

#physicalTicketConfigModal .form-input {
    width: 100%;
    padding: 12px 16px;
    border: 2px solid #e5e7eb;
    border-radius: 8px;
    font-size: 1rem;
    transition: all 0.2s ease;
    background: #ffffff;
    box-sizing: border-box;
}

#physicalTicketConfigModal .form-input:focus {
    outline: none;
    border-color: #667eea;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

#physicalTicketConfigModal .form-input::placeholder {
    color: #9ca3af;
}

#physicalTicketConfigModal .form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px;
}

#physicalTicketConfigModal .ticket-type-options {
    display: grid;
    gap: 12px;
}

#physicalTicketConfigModal .ticket-type-option {
    display: block;
    cursor: pointer;
    position: relative;
}

#physicalTicketConfigModal .ticket-type-option input[type="radio"] {
    position: absolute;
    opacity: 0;
    width: 0;
    height: 0;
}

#physicalTicketConfigModal .ticket-type-label {
    display: flex;
    align-items: center;
    padding: 16px 20px;
    border: 2px solid #e5e7eb;
    border-radius: 12px;
    background: #ffffff;
    transition: all 0.2s ease;
    gap: 16px;
}

#physicalTicketConfigModal .ticket-type-option:hover .ticket-type-label {
    border-color: #667eea;
    background: #f8faff;
}

#physicalTicketConfigModal .ticket-type-option input[type="radio"]:checked + .ticket-type-label {
    border-color: #667eea;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
}

#physicalTicketConfigModal .ticket-type-label i {
    font-size: 1.5rem;
    width: 24px;
    text-align: center;
}

#physicalTicketConfigModal .ticket-type-label strong {
    font-size: 1.1rem;
    margin-bottom: 2px;
}

#physicalTicketConfigModal .ticket-type-label small {
    font-size: 0.85rem;
    opacity: 0.8;
}

#physicalTicketConfigModal .ticket-type-label div {
    display: flex;
    flex-direction: column;
}

#physicalTicketConfigModal .ticket-config-section {
    margin-top: 24px;
    padding: 20px;
    background: #f9fafb;
    border-radius: 12px;
    border: 1px solid #e5e7eb;
}

#physicalTicketConfigModal .ticket-config-modal-actions {
    display: flex;
    justify-content: flex-end;
    gap: 12px;
    margin-top: 32px;
    padding-top: 24px;
    border-top: 1px solid #e5e7eb;
}

#physicalTicketConfigModal .cancel-ticket-btn {
    padding: 12px 24px;
    border: 2px solid #e5e7eb;
    background: #ffffff;
    color: #6b7280;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
    font-size: 0.95rem;
}

#physicalTicketConfigModal .cancel-ticket-btn:hover {
    border-color: #d1d5db;
    background: #f9fafb;
}

#physicalTicketConfigModal .save-ticket-btn {
    padding: 12px 24px;
    border: none;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
    font-size: 0.95rem;
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
}

#physicalTicketConfigModal .save-ticket-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
}

#physicalTicketConfigModal .save-ticket-btn:active {
    transform: translateY(0);
}

/* Responsive Design */
@media (max-width: 768px) {
    #physicalTicketConfigModal .ticket-config-modal-container {
        width: 95%;
        margin: 20px;
    }
    
    #physicalTicketConfigModal .ticket-config-modal-header {
        padding: 20px 24px;
    }
    
    #physicalTicketConfigModal .ticket-config-modal-header h3 {
        font-size: 1.3rem;
    }
    
    #physicalTicketConfigModal .ticket-config-modal-content {
        padding: 24px;
    }
    
    #physicalTicketConfigModal .form-row {
        grid-template-columns: 1fr;
        gap: 12px;
    }
    
    #physicalTicketConfigModal .ticket-type-label {
        padding: 12px 16px;
        gap: 12px;
    }
    
    #physicalTicketConfigModal .ticket-type-label i {
        font-size: 1.3rem;
    }
    
    #physicalTicketConfigModal .ticket-config-modal-actions {
        flex-direction: column-reverse;
    }
    
    #physicalTicketConfigModal .cancel-ticket-btn,
    #physicalTicketConfigModal .save-ticket-btn {
        width: 100%;
        padding: 14px 24px;
    }
}

@media (max-width: 480px) {
    #physicalTicketConfigModal .ticket-config-modal-container {
        width: 100%;
        height: 100%;
        border-radius: 0;
        max-height: 100vh;
    }
    
    #physicalTicketConfigModal .ticket-config-modal-header {
        border-radius: 0;
    }
    
    #physicalTicketConfigModal .ticket-config-modal-content {
        padding: 20px;
    }
    
    #physicalTicketConfigModal .form-group {
        margin-bottom: 20px;
    }
    
    #physicalTicketConfigModal .ticket-config-section {
        padding: 16px;
        margin-top: 20px;
    }
}

/* Animation for smooth transitions */
@keyframes physicalTicketModalFadeIn {
    from {
        opacity: 0;
        transform: scale(0.9) translateY(20px);
    }
    to {
        opacity: 1;
        transform: scale(1) translateY(0);
    }
}

#physicalTicketConfigModal[style*="flex"] .ticket-config-modal-container {
    animation: physicalTicketModalFadeIn 0.3s ease forwards;
}

/* Custom scrollbar for modal content */
#physicalTicketConfigModal .ticket-config-modal-container::-webkit-scrollbar {
    width: 6px;
}

#physicalTicketConfigModal .ticket-config-modal-container::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 3px;
}

#physicalTicketConfigModal .ticket-config-modal-container::-webkit-scrollbar-thumb {
    background: #c1c1c1;
    border-radius: 3px;
}

#physicalTicketConfigModal .ticket-config-modal-container::-webkit-scrollbar-thumb:hover {
    background: #a8a8a8;
}

/* Focus states for accessibility */
#physicalTicketConfigModal .ticket-type-option:focus-within .ticket-type-label {
    border-color: #667eea;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

#physicalTicketConfigModal .cancel-ticket-btn:focus,
#physicalTicketConfigModal .save-ticket-btn:focus {
    outline: none;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.3);
}

/* Loading state for save button */
#physicalTicketConfigModal .save-ticket-btn.loading {
    position: relative;
    color: transparent;
}

#physicalTicketConfigModal .save-ticket-btn.loading::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 20px;
    height: 20px;
    margin: -10px 0 0 -10px;
    border: 2px solid transparent;
    border-top: 2px solid #ffffff;
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* Error states */
#physicalTicketConfigModal .form-input.error {
    border-color: #ef4444;
    box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1);
}

#physicalTicketConfigModal .error-message {
    color: #ef4444;
    font-size: 0.85rem;
    margin-top: 4px;
    display: flex;
    align-items: center;
    gap: 4px;
}

#physicalTicketConfigModal .error-message i {
    font-size: 0.8rem;
}

/* Ticket Preview */
.ticket-preview {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 12px;
    padding: 20px;
    color: white;
    position: relative;
    overflow: hidden;
}

.ticket-preview::before {
    content: '';
    position: absolute;
    top: -50%;
    right: -50%;
    width: 100%;
    height: 100%;
    background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
    pointer-events: none;
}

.ticket-preview-content {
    position: relative;
    z-index: 2;
}

.ticket-preview-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
}

.ticket-preview-name {
    font-size: 18px;
    font-weight: 700;
}

.ticket-preview-type {
    background: rgba(255, 255, 255, 0.2);
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 600;
    text-transform: uppercase;
}

.ticket-preview-price {
    font-size: 24px;
    font-weight: 800;
    margin-bottom: 8px;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
}

.ticket-preview-quantity {
    font-size: 14px;
    opacity: 0.9;
}

/* Modal Actions */
.ticket-config-actions,
.ticket-edit-actions {
    display: flex;
    gap: 15px;
    justify-content: flex-end;
    padding-top: 20px;
    border-top: 2px solid #f0f0f0;
    margin-top: 20px;
}

.cancel-ticket-btn,
.cancel-edit-btn {
    padding: 12px 24px;
    border: 2px solid #6c757d;
    background: transparent;
    color: #6c757d;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
    transition: all 0.3s ease;
}

.cancel-ticket-btn:hover,
.cancel-edit-btn:hover {
    background: #6c757d;
    color: white;
    transform: translateY(-2px);
}

.save-ticket-btn,
.update-ticket-btn {
    padding: 12px 24px;
    border: none;
    background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
    color: white;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
}

.save-ticket-btn:hover,
.update-ticket-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
}

.save-ticket-btn i,
.update-ticket-btn i {
    margin-right: 8px;
}

/* ===== ENHANCED PAYMENT BREAKDOWN STYLES ===== */

.payment-summary {
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    border-radius: 12px;
    padding: 20px;
    margin-top: 20px;
    border: 2px solid #dee2e6;
}

.payment-summary h3 {
    margin: 0 0 15px 0;
    color: #495057;
    font-size: 18px;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 10px;
}

.payment-summary h3::before {
    content: '';
    font-size: 20px;
}

.creation-fee-breakdown {
    background: white;
    border-radius: 8px;
    padding: 15px;
    border: 1px solid #e0e0e0;
}

.fee-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 0;
    border-bottom: 1px solid #f0f0f0;
}

.fee-item:last-child {
    border-bottom: none;
}

.fee-item.total-fee {
    border-top: 2px solid #4ECDC4;
    margin-top: 10px;
    padding-top: 15px;
    font-weight: 700;
    font-size: 16px;
    color: #2c3e50;
}

.fee-equivalent {
    text-align: center;
    margin-top: 10px;
    padding: 8px;
    background: #f8f9fa;
    border-radius: 6px;
    font-size: 14px;
    color: #6c757d;
    font-style: italic;
}

/* Physical Event Payment Breakdown */
#physicalPaymentBreakdown .fee-item span:first-child {
    color: #495057;
    font-weight: 500;
}

#physicalPaymentBreakdown .fee-item span:last-child {
    color: #28a745;
    font-weight: 600;
}

/* ===== RESPONSIVE DESIGN FOR PHYSICAL EVENTS ===== */

@media (max-width: 768px) {
    .event-mode-selection {
        flex-direction: column;
        gap: 10px;
    }
    
    .mode-option-label {
        padding: 15px 12px;
    }
    
    .datetime-row {
        flex-direction: column;
        gap: 10px;
    }
    
    .ticket-config-modal-container,
    .ticket-edit-modal-container {
        width: 95%;
        margin: 10px;
        max-height: 85vh;
    }
    
    .ticket-config-modal-header,
    .ticket-edit-modal-header {
        padding: 15px 20px;
    }
    
    .ticket-config-modal-content,
    .ticket-edit-modal-content {
        padding: 20px;
    }
    
    .ticket-type-options {
        gap: 8px;
    }
    
    .ticket-type-label {
        padding: 12px 15px;
        gap: 12px;
    }
    
    .ticket-config-actions,
    .ticket-edit-actions {
        flex-direction: column;
        gap: 10px;
    }
    
    .cancel-ticket-btn,
    .cancel-edit-btn,
    .save-ticket-btn,
    .update-ticket-btn {
        width: 100%;
        padding: 15px;
    }
    
    .gradient-controls {
        flex-direction: column;
        gap: 15px;
    }
    
    .scheduling-section {
        padding: 15px;
    }
}

@media (max-width: 480px) {
    .mode-option-label {
        padding: 12px 10px;
    }
    
    .mode-option-label i {
        font-size: 20px;
    }
    
    .mode-option-label span {
        font-size: 14px;
    }
    
    .mode-option-label small {
        font-size: 11px;
    }
    
    .ticket-type-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
    }
    
    .ticket-type-details {
        flex-direction: column;
        align-items: flex-start;
        gap: 5px;
    }
    
    .ticket-type-actions {
        width: 100%;
        justify-content: space-between;
    }
    
    .edit-ticket-btn,
    .delete-ticket-btn {
        flex: 1;
        padding: 8px 12px;
    }
}

/* ===== ENHANCED ANIMATIONS ===== */

.ticket-type-item {
    animation: slideInLeft 0.5s ease-out;
}

@keyframes slideInLeft {
    from {
        opacity: 0;
        transform: translateX(-30px);
    }
    to {
        opacity: 1;
        transform: translateX(0);
    }
}

.add-ticket-type-btn {
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0% {
        box-shadow: 0 0 0 0 rgba(78, 205, 196, 0.4);
    }
    70% {
        box-shadow: 0 0 0 10px rgba(78, 205, 196, 0);
    }
    100% {
        box-shadow: 0 0 0 0 rgba(78, 205, 196, 0);
    }
}
/* Success/Error States */
.ticket-config-success {
    background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
    border: 2px solid #28a745;
    color: #155724;
    padding: 15px;
    border-radius: 8px;
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    gap: 10px;
    animation: successSlideIn 0.5s ease-out;
}

.ticket-config-error {
    background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
    border: 2px solid #dc3545;
    color: #721c24;
    padding: 15px;
    border-radius: 8px;
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    gap: 10px;
    animation: errorShake 0.5s ease-out;
}

@keyframes successSlideIn {
    from {
        opacity: 0;
        transform: translateY(-10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@keyframes errorShake {
    0%, 100% { transform: translateX(0); }
    25% { transform: translateX(-5px); }
    75% { transform: translateX(5px); }
}

/* Loading States */
.ticket-config-loading {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    padding: 20px;
    color: #6c757d;
}

.loading-spinner {
    width: 20px;
    height: 20px;
    border: 2px solid #f3f3f3;
    border-top: 2px solid #4ECDC4;
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* ===== ENHANCED FORM VALIDATION STYLES ===== */

.form-input.error,
.form-textarea.error,
.form-select.error {
    border-color: #dc3545;
    background-color: #fff5f5;
    box-shadow: 0 0 0 3px rgba(220, 53, 69, 0.1);
}

.form-input.success,
.form-textarea.success,
.form-select.success {
    border-color: #28a745;
    background-color: #f8fff8;
    box-shadow: 0 0 0 3px rgba(40, 167, 69, 0.1);
}

.field-error {
    color: #dc3545;
    font-size: 12px;
    margin-top: 5px;
    display: flex;
    align-items: center;
    gap: 5px;
    animation: errorFadeIn 0.3s ease-out;
}

.field-success {
    color: #28a745;
    font-size: 12px;
    margin-top: 5px;
    display: flex;
    align-items: center;
    gap: 5px;
    animation: successFadeIn 0.3s ease-out;
}

@keyframes errorFadeIn {
    from {
        opacity: 0;
        transform: translateY(-5px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@keyframes successFadeIn {
    from {
        opacity: 0;
        transform: translateY(-5px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* ===== TICKET SUMMARY DISPLAY ===== */

.ticket-summary {
    background: white;
    border: 2px solid #e9ecef;
    border-radius: 12px;
    padding: 20px;
    margin-top: 15px;
}

.ticket-summary-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
    padding-bottom: 10px;
    border-bottom: 2px solid #f0f0f0;
}

.ticket-summary-title {
    font-size: 16px;
    font-weight: 600;
    color: #333;
    display: flex;
    align-items: center;
    gap: 8px;
}

.ticket-count-badge {
    background: #4ECDC4;
    color: white;
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 600;
}

.ticket-summary-list {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.ticket-summary-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 15px;
    background: #f8f9fa;
    border-radius: 8px;
    border-left: 4px solid #4ECDC4;
}

.ticket-summary-info {
    display: flex;
    flex-direction: column;
    gap: 2px;
}

.ticket-summary-name {
    font-weight: 600;
    color: #333;
}

.ticket-summary-details {
    font-size: 12px;
    color: #666;
}

.ticket-summary-price {
    font-weight: 700;
    color: #28a745;
    font-size: 16px;
}

/* ===== PHYSICAL EVENT SPECIFIC ENHANCEMENTS ===== */

.physical-event-indicator {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
    color: white;
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-left: 10px;
}

.location-preview {
    background: #f8f9fa;
    border: 1px solid #e9ecef;
    border-radius: 8px;
    padding: 12px;
    margin-top: 10px;
    display: flex;
    align-items: center;
    gap: 10px;
}

.location-preview i {
    color: #e74c3c;
    font-size: 16px;
}

.location-preview-text {
    color: #495057;
    font-size: 14px;
    line-height: 1.4;
}

.event-duration-highlight {
    background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
    color: #333;
    padding: 8px 15px;
    border-radius: 20px;
    font-weight: 600;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    margin-top: 10px;
    box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);
}

/* ===== ADVANCED TICKET CONFIGURATION FEATURES ===== */

.ticket-tier-indicator {
    position: absolute;
    top: -8px;
    right: 15px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 4px 12px;
    border-radius: 12px;
    font-size: 10px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.ticket-availability-bar {
    width: 100%;
    height: 6px;
    background: #e9ecef;
    border-radius: 3px;
    margin-top: 8px;
    overflow: hidden;
}

.ticket-availability-fill {
    height: 100%;
    background: linear-gradient(90deg, #28a745 0%, #20c997 100%);
    border-radius: 3px;
    transition: width 0.3s ease;
}

.ticket-stats {
    display: flex;
    justify-content: space-between;
    margin-top: 8px;
    font-size: 12px;
    color: #6c757d;
}

/* ===== PAYMENT METHOD ENHANCEMENTS ===== */

.payment-method-selection {
    display: flex;
    flex-direction: column;
    gap: 12px;
    margin-bottom: 20px;
}

.payment-option {
    position: relative;
}

.payment-option input[type="radio"] {
    display: none;
}

.payment-option-label {
    display: flex;
    align-items: center;
    gap: 15px;
    padding: 15px 20px;
    border: 2px solid #e0e0e0;
    border-radius: 10px;
    cursor: pointer;
    transition: all 0.3s ease;
    background: white;
}

.payment-option-label:hover {
    border-color: #4ECDC4;
    background: #f8fdfc;
    transform: translateX(5px);
}

.payment-option input[type="radio"]:checked + .payment-option-label {
    border-color: #4ECDC4;
    background: linear-gradient(135deg, #4ECDC4 0%, #44A08D 100%);
    color: white;
    box-shadow: 0 6px 20px rgba(78, 205, 196, 0.3);
}

.payment-option-label i {
    font-size: 20px;
    color: #666;
    min-width: 20px;
}

.payment-option input[type="radio"]:checked + .payment-option-label i {
    color: white;
}

.payment-option-label span {
    font-weight: 600;
    font-size: 16px;
}

.promo-code-section {
    background: #fff3cd;
    border: 2px solid #ffc107;
    border-radius: 10px;
    padding: 15px;
    margin-top: 15px;
    animation: slideDown 0.3s ease-out;
}

@keyframes slideDown {
    from {
        opacity: 0;
        transform: translateY(-10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.promo-code-section input {
    width: 100%;
    padding: 12px;
    border: 2px solid #ffc107;
    border-radius: 8px;
    font-weight: 500;
    background: white;
}

.promo-code-section input:focus {
    outline: none;
    border-color: #e0a800;
    box-shadow: 0 0 0 3px rgba(255, 193, 7, 0.2);
}

/* ===== FINAL RESPONSIVE ADJUSTMENTS ===== */

@media (max-width: 576px) {
    .scheduling-section {
        padding: 12px;
    }
    
    .datetime-field label {
        font-size: 12px;
    }
    
    .datetime-field input {
        padding: 8px;
        font-size: 13px;
    }
    
    .duration-display {
        padding: 10px;
        font-size: 14px;
    }
    
    .ticket-type-item {
        padding: 12px;
    }
    
    .ticket-type-name {
        font-size: 14px;
    }
    
    .ticket-type-price {
        font-size: 16px;
    }
    
    .payment-summary {
        padding: 15px;
    }
    
    .creation-fee-breakdown {
        padding: 12px;
    }
    
    .fee-item {
        font-size: 14px;
        padding: 6px 0;
    }
    
    .fee-item.total-fee {
        font-size: 15px;
    }
}

/* ===== ACCESSIBILITY ENHANCEMENTS ===== */

.sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
}

.form-input:focus,
.form-textarea:focus,
.form-select:focus {
    outline: 2px solid #4ECDC4;
    outline-offset: 2px;
}

.ticket-type-label:focus-within,
.payment-option-label:focus-within,
.mode-option-label:focus-within {
    outline: 2px solid #4ECDC4;
    outline-offset: 2px;
}

/* High contrast mode support */
@media (prefers-contrast: high) {
    .mode-option-label,
    .ticket-type-label,
    .payment-option-label {
        border-width: 3px;
    }
    
    .mode-option input[type="radio"]:checked + .mode-option-label,
    .ticket-type-option input[type="radio"]:checked + .ticket-type-label,
    .payment-option input[type="radio"]:checked + .payment-option-label {
        background: #000;
        color: #fff;
        border-color: #fff;
    }
}

/* Reduced motion support */
@media (prefers-reduced-motion: reduce) {
    *,
    *::before,
    *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
    }
}

/* ===== PRINT STYLES ===== */

@media print {
    .ticket-config-modal-overlay,
    .ticket-edit-modal-overlay {
        display: none !important;
    }
    
    .form-actions,
    .ticket-config-actions,
    .ticket-edit-actions {
        display: none !important;
    }
    
    .payment-summary {
        background: white !important;
        border: 2px solid #000 !important;
    }
    
    .ticket-preview {
        background: white !important;
        color: #000 !important;
        border: 2px solid #000 !important;
    }
}

/* Physical Event Cards Styles */
.physical-event-card {
    background: #ffffff;
    border-radius: 16px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    margin-bottom: 20px;
    overflow: hidden;
    transition: all 0.3s ease;
    cursor: pointer;
}

.physical-event-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
}

/* Card Header */
.event-card-header {
    position: relative;
    height: 200px;
    background: linear-gradient(135deg, #FF6B6B, #4ECDC4);
    display: flex;
    align-items: flex-end;
    padding: 0;
}

.event-card-overlay {
    background: linear-gradient(transparent, rgba(0, 0, 0, 0.7));
    width: 100%;
    padding: 20px;
    color: white;
    position: relative;
}

.event-title {
    font-size: 1.5rem;
    font-weight: 700;
    margin: 0 0 8px 0;
    line-height: 1.2;
}

.event-description {
    font-size: 0.9rem;
    margin: 0;
    opacity: 0.9;
    line-height: 1.4;
}

.expand-indicator {
    position: absolute;
    top: 20px;
    right: 20px;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 50%;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    backdrop-filter: blur(10px);
}

.expand-indicator i {
    transition: transform 0.3s ease;
    font-size: 1.1rem;
}
/* Security Modal Styles */
.security-modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 10003;
    animation: fadeIn 0.3s ease;
}

.security-modal {
    background: white;
    border-radius: 12px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    max-width: 500px;
    width: 90%;
    max-height: 90vh;
    overflow-y: auto;
    animation: slideInUp 0.3s ease;
}

.security-modal.large {
    max-width: 700px;
}

.security-modal.confirm-dialog {
    max-width: 400px;
}

.security-modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px 24px;
    border-bottom: 1px solid #e9ecef;
    background: #f8f9fa;
    border-radius: 12px 12px 0 0;
}

.security-modal-header h3 {
    margin: 0;
    color: #495057;
    font-size: 18px;
    display: flex;
    align-items: center;
    gap: 10px;
}

.close-modal-btn {
    background: none;
    border: none;
    color: #6c757d;
    cursor: pointer;
    padding: 8px;
    border-radius: 4px;
    transition: all 0.2s ease;
}

.close-modal-btn:hover {
    background: #e9ecef;
    color: #495057;
}

.security-modal-body {
    padding: 24px;
}

.security-form {
    margin-top: 20px;
}

.form-group {
    margin-bottom: 20px;
}

.form-group label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
    color: #495057;
}
.password-input-container {
    position: relative;
    display: flex;
    align-items: center;
}

.security-password-input {
    width: 100%;
    padding: 12px 45px 12px 16px;
    border: 2px solid #e9ecef;
    border-radius: 8px;
    font-size: 14px;
    transition: border-color 0.2s ease;
    background: white;
}

.security-password-input:focus {
    outline: none;
    border-color: #1a73e8;
    box-shadow: 0 0 0 3px rgba(26, 115, 232, 0.1);
}

.toggle-password-btn {
    position: absolute;
    right: 12px;
    background: none;
    border: none;
    color: #6c757d;
    cursor: pointer;
    padding: 8px;
    border-radius: 4px;
    transition: all 0.2s ease;
}

.toggle-password-btn:hover {
    background: #f8f9fa;
    color: #495057;
}

.checkbox-label {
    display: flex;
    align-items: center;
    gap: 12px;
    cursor: pointer;
    font-weight: normal;
    margin-bottom: 0;
}

.checkbox-label input[type="checkbox"] {
    display: none;
}

.checkmark {
    width: 20px;
    height: 20px;
    border: 2px solid #e9ecef;
    border-radius: 4px;
    position: relative;
    transition: all 0.2s ease;
}

.checkbox-label input[type="checkbox"]:checked + .checkmark {
    background: #1a73e8;
    border-color: #1a73e8;
}

.checkbox-label input[type="checkbox"]:checked + .checkmark::after {
    content: '';
    position: absolute;
    left: 6px;
    top: 2px;
    width: 6px;
    height: 10px;
    border: solid white;
    border-width: 0 2px 2px 0;
    transform: rotate(45deg);
}

.security-modal-actions {
    display: flex;
    gap: 12px;
    justify-content: flex-end;
    margin-top: 24px;
    padding-top: 20px;
    border-top: 1px solid #e9ecef;
}

.cancel-btn, .confirm-btn {
    padding: 12px 24px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    gap: 8px;
}

.cancel-btn {
    background: #f8f9fa;
    color: #6c757d;
    border: 1px solid #e9ecef;
}

.cancel-btn:hover {
    background: #e9ecef;
    color: #495057;
}

.confirm-btn {
    background: #1a73e8;
    color: white;
}

.confirm-btn:hover {
    background: #1557b0;
    transform: translateY(-1px);
}

/* Enhanced Event ID Controls */
.event-id-controls {
    display: flex;
    align-items: center;
    gap: 8px;
}

.security-toggle-btn {
    background: none;
    border: none;
    color: #6c757d;
    cursor: pointer;
    padding: 6px 8px;
    border-radius: 4px;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
}

.security-toggle-btn:hover {
    background: #e9ecef;
    color: #495057;
}

.security-toggle-btn i {
    font-size: 14px;
}

.security-icon {
    color: #ffc107;
    margin-left: 8px;
    font-size: 12px;
}

.eye-toggle-btn.disabled,
.copy-id-btn.disabled {
    opacity: 0.5;
    cursor: not-allowed;
    pointer-events: none;
}

/* Security Management Panel Styles */
.security-section {
    margin-bottom: 32px;
    padding-bottom: 24px;
    border-bottom: 1px solid #e9ecef;
}

.security-section:last-child {
    border-bottom: none;
    margin-bottom: 0;
}

.security-section h4 {
    margin: 0 0 12px 0;
    color: #495057;
    font-size: 16px;
}

.security-section p {
    color: #6c757d;
    margin-bottom: 16px;
    font-size: 14px;
}

.update-btn {
    background: #28a745;
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 6px;
    cursor: pointer;
    margin-left: 12px;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    gap: 6px;
}

.update-btn:hover {
    background: #218838;
}

.protected-events-list {
    max-height: 200px;
    overflow-y: auto;
    border: 1px solid #e9ecef;
    border-radius: 8px;
    padding: 12px;
}

.no-protected-events {
    text-align: center;
    color: #6c757d;
    font-style: italic;
    margin: 0;
}

.protected-event-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 0;
    border-bottom: 1px solid #f8f9fa;
}

.protected-event-item:last-child {
    border-bottom: none;
}

.event-id-short {
    font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
    background: #f8f9fa;
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 12px;
    color: #495057;
}

.remove-protection-btn {
    background: #dc3545;
    color: white;
    border: none;
    padding: 6px 12px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 12px;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    gap: 4px;
}

.remove-protection-btn:hover {
    background: #c82333;
}

.clear-session-btn {
    background: #ffc107;
    color: #212529;
    border: none;
    padding: 10px 20px;
    border-radius: 6px;
    cursor: pointer;
    font-weight: 600;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 8px;
}

.clear-session-btn:hover {
    background: #e0a800;
}

/* Modal Animations */
@keyframes fadeIn {
    from {
        opacity: 0;
    }
    to {
        opacity: 1;
    }
}

@keyframes fadeOut {
    from {
        opacity: 1;
    }
    to {
        opacity: 0;
    }
}

@keyframes slideInUp {
    from {
        transform: translateY(30px);
        opacity: 0;
    }
    to {
        transform: translateY(0);
        opacity: 1;
    }
}

/* Enhanced Event ID Section with Security */
.event-id-section {
    position: relative;
}



.event-id-header {
    position: relative;
}

.event-id-header::after {
    content: '';
    position: absolute;
    right: 60px;
    top: 50%;
    transform: translateY(-50%);
    width: 1px;
    height: 20px;
    background: #e9ecef;
}

/* Responsive Design for Security Features */
@media (max-width: 768px) {
    .security-modal {
        width: 95%;
        margin: 20px;
    }
    
    .security-modal-header {
        padding: 16px 20px;
    }
    
    .security-modal-body {
        padding: 20px;
    }
    
    .security-modal-actions {
        flex-direction: column-reverse;
        gap: 8px;
    }
    
    .cancel-btn, .confirm-btn {
        width: 100%;
        justify-content: center;
    }
    
    .event-id-controls {
        gap: 4px;
    }
    
    .security-toggle-btn,
    .eye-toggle-btn {
        padding: 4px 6px;
    }
    
    .protected-event-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
    }
    
    .remove-protection-btn {
        align-self: flex-end;
    }
}

/* Dark Mode Support for Security Features */
@media (prefers-color-scheme: dark) {
    .security-modal {
        background: #1a202c;
        color: #e2e8f0;
    }
    
    .security-modal-header {
        background: #2d3748;
        border-color: #4a5568;
    }
    
    .security-modal-header h3 {
        color: #e2e8f0;
    }
    
    .close-modal-btn {
        color: #a0aec0;
    }
    
    .close-modal-btn:hover {
        background: #4a5568;
        color: #e2e8f0;
    }
    
    .security-password-input {
        background: #2d3748;
        border-color: #4a5568;
        color: #e2e8f0;
    }
    
    .security-password-input:focus {
        border-color: #63b3ed;
        box-shadow: 0 0 0 3px rgba(99, 179, 237, 0.1);
    }
    
    .toggle-password-btn {
        color: #a0aec0;
    }
    
    .toggle-password-btn:hover {
        background: #4a5568;
        color: #e2e8f0;
    }
    
    .checkmark {
        border-color: #4a5568;
        background: #2d3748;
    }
    
    .checkbox-label input[type="checkbox"]:checked + .checkmark {
        background: #63b3ed;
        border-color: #63b3ed;
    }
    
    .cancel-btn {
        background: #2d3748;
        color: #a0aec0;
        border-color: #4a5568;
    }
    
    .cancel-btn:hover {
        background: #4a5568;
        color: #e2e8f0;
    }
    
    .security-section {
        border-color: #4a5568;
    }
    
    .security-section h4 {
        color: #e2e8f0;
    }
    
    .security-section p {
        color: #a0aec0;
    }
    
    .protected-events-list {
        background: #2d3748;
        border-color: #4a5568;
    }
    
    .event-id-short {
        background: #4a5568;
        color: #e2e8f0;
    }
    
    .security-toggle-btn,
    .eye-toggle-btn {
        color: #a0aec0;
    }
    
    .security-toggle-btn:hover,
    .eye-toggle-btn:hover {
        background: #4a5568;
        color: #e2e8f0;
    }
}

/* Loading States for Security Operations */
.security-loading {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    color: #6c757d;
    font-size: 14px;
}

.security-loading i {
    animation: spin 1s linear infinite;
}

@keyframes spin {
    from {
        transform: rotate(0deg);
    }
    to {
        transform: rotate(360deg);
    }
}

/* Security Status Indicators */
.security-status {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    font-size: 12px;
    padding: 2px 6px;
    border-radius: 12px;
    font-weight: 500;
}

.security-status.locked {
    background: #fff3cd;
    color: #856404;
}

.security-status.unlocked {
    background: #d1ecf1;
    color: #0c5460;
}

.security-status.session-unlocked {
    background: #d4edda;
    color: #155724;
}


/* Card Content (Expandable) */
.event-card-content {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.4s ease;
    background: #ffffff;
}

.physical-event-card.expanded .event-card-content {
    max-height: 500px; /* Adjust based on content */
}

/* Event Status Section */
.event-status-section {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px;
    border-bottom: 1px solid #f0f0f0;
}

.status-badge {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px 16px;
    border-radius: 20px;
    font-size: 0.85rem;
    font-weight: 600;
}

.status-badge i {
    font-size: 1rem;
}

.status-draft {
    background: #fff3cd;
    color: #856404;
}

.status-upcoming {
    background: #d1ecf1;
    color: #0c5460;
}

.status-live {
    background: #d4edda;
    color: #155724;
}

.status-ended {
    background: #f8d7da;
    color: #721c24;
}

/* Launch Button */
.launch-btn {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 10px 20px;
    border: none;
    border-radius: 8px;
    font-size: 0.9rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
}

.launch-active {
    background: #28a745;
    color: white;
}

.launch-active:hover {
    background: #218838;
    transform: translateY(-1px);
}

.launch-pause {
    background: #ffc107;
    color: #212529;
}

.launch-pause:hover {
    background: #e0a800;
    transform: translateY(-1px);
}

.launch-disabled {
    background: #6c757d;
    color: white;
    cursor: not-allowed;
    opacity: 0.7;
}

/* Ticket Stats Grid */
.ticket-stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    gap: 15px;
    padding: 20px;
    border-bottom: 1px solid #f0f0f0;
}

.stat-card {
    background: #f8f9fa;
    border-radius: 12px;
    padding: 16px;
    text-align: center;
    transition: all 0.3s ease;
}

.stat-card:hover {
    background: #e9ecef;
    transform: translateY(-2px);
}

.stat-value {
    font-size: 1.4rem;
    font-weight: 700;
    color: #2c3e50;
    margin-bottom: 4px;
}

.stat-label {
    font-size: 0.8rem;
    color: #6c757d;
    font-weight: 500;
}

/* Individual Ticket Sales Breakdown */
.individual-ticket-sales {
    padding: 20px;
    border-bottom: 1px solid #f0f0f0;
}

.individual-ticket-sales h4 {
    margin: 0 0 15px 0;
    color: #333;
    font-size: 1.1rem;
    font-weight: 600;
}

.ticket-breakdown-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 12px;
}

.ticket-breakdown-card {
    background: #f8f9fa;
    border-radius: 8px;
    padding: 12px 16px;
    border-left: 4px solid #28a745;
    transition: all 0.3s ease;
}

.ticket-breakdown-card:hover {
    background: #e9ecef;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.ticket-name {
    font-weight: 600;
    color: #333;
    margin-bottom: 6px;
    font-size: 0.9rem;
}

.ticket-details {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.tickets-sold {
    color: #28a745;
    font-weight: 600;
    font-size: 0.85rem;
}

.ticket-price {
    color: #6c757d;
    font-size: 0.8rem;
}

.no-tickets {
    text-align: center;
    color: #6c757d;
    font-style: italic;
    margin: 0;
    padding: 20px;
}

/* Advanced Features Section */
.advanced-features-section {
    margin-top: 15px;
    border-top: 1px solid #eee;
    padding-top: 15px;
}

.advanced-toggle-btn {
    width: 100%;
    padding: 12px;
    background: #f8f9fa;
    border: 1px solid #dee2e6;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    cursor: pointer;
    transition: all 0.3s ease;
    font-weight: 500;
}

.advanced-toggle-btn:hover {
    background: #e9ecef;
}

.advanced-toggle-btn .toggle-icon {
    transition: transform 0.3s ease;
}

.advanced-content {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s ease;
    background: #f8f9fa;
    border-radius: 0 0 8px 8px;
    margin-top: -1px;
}

.advanced-content.expanded {
    padding: 15px;
    border: 1px solid #dee2e6;
    border-top: none;
}

/* Sponsors Section - More Compact */
.sponsors-section {
    margin-bottom: 15px;
}

.sponsors-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
}

.sponsors-header h4 {
    margin: 0;
    font-size: 14px;
    color: #495057;
}

.add-sponsors-btn {
    padding: 6px 12px;
    background: #007bff;
    color: white;
    border: none;
    border-radius: 4px;
    font-size: 12px;
    cursor: pointer;
    transition: background 0.3s ease;
}

.add-sponsors-btn:hover {
    background: #0056b3;
}

/* Sponsors Grid - Responsive */
.sponsors-grid {
    display: grid;
   grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
    gap: 10px;
    margin-top: 10px;
}
@media (max-width: 768px) {
    .sponsors-grid {
        grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
        gap: 8px;
    }
}

@media (max-width: 480px) {
    .sponsors-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 8px;
    }
}
.sponsor-card {
    background: white;
    border: 1px solid #dee2e6;
    border-radius: 6px;
    padding: 8px;
    text-align: center;
    transition: transform 0.2s ease;
}

.sponsor-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.sponsor-logo-container {
    height: 30px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 5px;
}

.sponsor-logo-img {
    max-width: 100%;
    max-height: 30px;
    object-fit: contain;
}

.sponsor-logo-placeholder {
    width: 30px;
    height: 30px;
    background: #e9ecef;
    border-radius: 4px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #6c757d;
}

.sponsor-logo-placeholder.brand-sponsor {
    background: linear-gradient(135deg, #ffd700, #ffed4e);
    color: #b45309;
}

.sponsor-name {
    font-size: 11px;
    font-weight: 500;
    color: #495057;
    margin-bottom: 4px;
}

.promo-code-badge {
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
    padding: 2px 6px;
    border-radius: 3px;
    font-size: 9px;
    cursor: pointer;
    transition: all 0.2s ease;
}

.promo-code-badge:hover {
    transform: scale(1.05);
    box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
}

.show-more-card {
    background: #f8f9fa;
    border: 2px dashed #dee2e6;
    cursor: pointer;
}

.show-more-content {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 60px;
    color: #6c757d;
    font-size: 12px;
}

.show-more-content i {
    font-size: 16px;
    margin-bottom: 4px;
}


/* No Sponsors Message */
.no-sponsors-message {
    text-align: center;
    padding: 20px;
    color: #6c757d;
    font-size: 13px;
}

.no-sponsors-message p {
    margin: 0;
}

/* Mobile Responsiveness */
@media (max-width: 768px) {
    .sponsors-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 8px;
    }
    
    .sponsor-card {
        padding: 6px;
    }
    
    .sponsor-logo-container {
        height: 25px;
    }
    
    .sponsor-logo-img {
        max-height: 25px;
    }
    
    .sponsor-logo-placeholder {
        width: 25px;
        height: 25px;
    }
    
    .sponsor-name {
        font-size: 10px;
    }
    
    .promo-code-badge {
        font-size: 8px;
        padding: 1px 4px;
    }
    
    .advanced-toggle-btn {
        padding: 10px;
        font-size: 13px;
    }
    
    .withdraw-earnings-btn {
        padding: 8px;
        font-size: 12px;
    }
}

@media (max-width: 480px) {
    .sponsors-grid {
        grid-template-columns: 1fr;
    }
    
    .sponsors-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
    }
    
    .add-sponsors-btn {
        align-self: stretch;
        text-align: center;
    }
}

/* Event Card Content Responsive Adjustments */
.event-card-content {
    transition: max-height 0.4s ease;
}

.physical-event-card.expanded .event-card-content {
    max-height: none !important;
}

/* Ticket Stats Grid - More Responsive */
.ticket-stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    gap: 15px;
    margin: 15px 0;
}

@media (max-width: 480px) {
    .ticket-stats-grid {
        grid-template-columns: 1fr;
        gap: 10px;
    }
}

/* Individual Ticket Sales - More Compact */
.individual-ticket-sales h4 {
    font-size: 14px;
    margin-bottom: 10px;
    color: #495057;
}

.ticket-breakdown-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 10px;
}

@media (max-width: 480px) {
    .ticket-breakdown-grid {
        grid-template-columns: 1fr;
        gap: 8px;
    }
}

.ticket-breakdown-card {
    background: #f8f9fa;
    border: 1px solid #dee2e6;
    border-radius: 6px;
    padding: 10px;
}

.ticket-name {
    font-weight: 500;
    font-size: 13px;
    color: #495057;
    margin-bottom: 5px;
}

.ticket-details {
    display: flex;
    justify-content: space-between;
    font-size: 12px;
}

.tickets-sold {
    color: #28a745;
    font-weight: 500;
}

.ticket-price {
    color: #007bff;
    font-weight: 500;
}


 


/* Event Settings Section */
.event-settings-section {
    padding: 20px;
    display: flex;
    gap: 20px;
    flex-wrap: wrap;
}

.edit-event-link,
.view-event-link {
    display: flex;
    align-items: center;
    gap: 8px;
    color: #007bff;
    text-decoration: none;
    font-size: 0.9rem;
    font-weight: 500;
    transition: all 0.3s ease;
}

.edit-event-link:hover,
.view-event-link:hover {
    color: #0056b3;
    text-decoration: none;
    transform: translateX(2px);
}

/* Loading and Error States */
.loading-events,
.error-loading-events,
.no-events-message {
    text-align: center;
    padding: 60px 20px;
    color: #6c757d;
}

.loading-events i,
.error-loading-events i,
.no-events-message i {
    font-size: 3rem;
    margin-bottom: 20px;
    color: #dee2e6;
}

.loading-events h3,
.error-loading-events h3,
.no-events-message h3 {
    font-size: 1.5rem;
    margin-bottom: 10px;
    color: #495057;
}

.loading-events p,
.error-loading-events p,
.no-events-message p {
    font-size: 1rem;
    margin-bottom: 20px;
}

.retry-btn {
    background: #007bff;
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 0.9rem;
    transition: all 0.3s ease;
}

.retry-btn:hover {
    background: #0056b3;
    transform: translateY(-1px);
}

/* Notification Styles */
.notification {
    position: fixed;
    top: 20px;
    right: 20px;
    background: white;
    border-radius: 8px;
    padding: 16px 20px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
    display: flex;
    align-items: center;
    gap: 12px;
    z-index: 1000;
    animation: slideIn 0.3s ease;
}

.notification-success {
    border-left: 4px solid #28a745;
}

.notification-error {
    border-left: 4px solid #dc3545;
}

.notification-info {
    border-left: 4px solid #17a2b8;
}

.notification i {
    font-size: 1.2rem;
}

.notification-success i {
    color: #28a745;
}

.notification-error i {
    color: #dc3545;
}

.notification-info i {
    color: #17a2b8;
}

@keyframes slideIn {
    from {
        transform: translateX(100%);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}

/* Responsive Design */
@media (max-width: 768px) {
    .event-card-header {
        height: 160px;
    }
    
    .event-title {
        font-size: 1.3rem;
    }
    
    .event-description {
        font-size: 0.85rem;
    }
    
    .event-status-section {
        flex-direction: column;
        gap: 15px;
        align-items: stretch;
    }
    
    .launch-btn {
        justify-content: center;
    }
    
    .ticket-stats-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
    }
    
    .stat-card {
        padding: 12px;
    }
    
    .stat-value {
        font-size: 1.2rem;
    }
    
    .event-settings-section {
        flex-direction: column;
        gap: 15px;
    }
    
    .edit-event-link,
    .view-event-link {
        justify-content: center;
        padding: 12px;
        background: #f8f9fa;
        border-radius: 8px;
    }
}

@media (max-width: 480px) {
    .physical-event-card {
        margin-bottom: 15px;
        border-radius: 12px;
    }
    
    .event-card-header {
        height: 140px;
    }
    
    .event-card-overlay {
        padding: 15px;
    }
    
    .event-title {
        font-size: 1.2rem;
    }
    
    .expand-indicator {
        width: 35px;
        height: 35px;
        top: 15px;
        right: 15px;
    }
    
    .ticket-stats-grid {
        grid-template-columns: 1fr;
        padding: 15px;
    }
    
    .event-status-section,
    .event-settings-section {
        padding: 15px;
    }
    
    .notification {
        top: 10px;
        right: 10px;
        left: 10px;
        padding: 12px 16px;
    }
}

/* Dark mode support (optional) */
@media (prefers-color-scheme: dark) {
    .physical-event-card {
        background: #2d3748;
        color: #e2e8f0;
    }
    
    .event-card-content {
        background: #2d3748;
    }
    
    .stat-card {
        background: #4a5568;
        color: #e2e8f0;
    }
    
    .stat-card:hover {
        background: #718096;
    }
    
    .stat-value {
        color: #f7fafc;
    }
    
    .notification {
        background: #2d3748;
        color: #e2e8f0;
    }
}

/* Animation for smooth expand/collapse */
.physical-event-card {
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}
/* Event ID Section Styles */
.event-id-section {
    background: #f8f9fa;
    border: 1px solid #e9ecef;
    border-radius: 8px;
    margin-bottom: 20px;
    overflow: hidden;
    color:#333;
}

.event-id-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 16px;
    background: #ffffff;
    cursor: pointer;
    transition: background-color 0.2s ease;
    border-bottom: 1px solid #e9ecef;
}

.event-id-header:hover {
    background: #f8f9fa;
}

.event-id-label {
    font-weight: 600;
    color: #495057;
    font-size: 14px;
}

.eye-toggle-btn {
    background: none;
    border: none;
    color: #6c757d;
    cursor: pointer;
    padding: 4px 8px;
    border-radius: 4px;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
}

.eye-toggle-btn:hover {
    background: #e9ecef;
    color: #495057;
}
.eye-toggle-btn i {
    font-size: 16px;
    transition: transform 0.2s ease;
}

.eye-toggle-btn:hover i {
    transform: scale(1.1);
}

.event-id-container {
    padding: 16px;
    background: #ffffff;
    border-top: 1px solid #e9ecef;
    animation: slideDown 0.3s ease;
}

.event-id-content {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 8px;
}

.event-id-code {
    background: #f1f3f4;
    border: 1px solid #dadce0;
    border-radius: 6px;
    padding: 8px 12px;
    font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
    font-size: 13px;
    color: #1a73e8;
    flex: 1;
    word-break: break-all;
    user-select: all;
}

.copy-id-btn {
    background: #1a73e8;
    border: none;
    color: white;
    padding: 8px 12px;
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    min-width: 40px;
}

.copy-id-btn:hover {
    background: #1557b0;
    transform: translateY(-1px);
}

.copy-id-btn:active {
    transform: translateY(0);
}

.copy-id-btn i {
    font-size: 14px;
}

.event-id-note {
    color: #6c757d;
    font-size: 12px;
    font-style: italic;
    margin-top: 4px;
}

/* Animation for sliding down */
@keyframes slideDown {
    from {
        opacity: 0;
        max-height: 0;
        transform: translateY(-10px);
    }
    to {
        opacity: 1;
        max-height: 200px;
        transform: translateY(0);
    }
}

/* Animation for sliding up */
@keyframes slideUp {
    from {
        opacity: 1;
        max-height: 200px;
        transform: translateY(0);
    }
    to {
        opacity: 0;
        max-height: 0;
        transform: translateY(-10px);
    }
}

/* Copy success notification animations */
@keyframes slideInRight {
    from {
        transform: translateX(100%);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}

@keyframes slideOutRight {
    from {
        transform: translateX(0);
        opacity: 1;
    }
    to {
        transform: translateX(100%);
        opacity: 0;
    }
}

.copy-success-notification {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
}

/* Enhanced event card styles to accommodate the new section */
.physical-event-card {
    margin-bottom: 24px;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    transition: all 0.3s ease;
}

.physical-event-card:hover {
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
    transform: translateY(-2px);
}

.event-card-content {
    padding: 20px;
    background: white;
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s ease;
}

.physical-event-card.expanded .event-card-content {
    max-height: none;
}

/* Responsive design for event ID section */
@media (max-width: 768px) {
    .event-id-content {
        flex-direction: column;
        align-items: stretch;
        gap: 8px;
    }
    
    .event-id-code {
        font-size: 12px;
        padding: 6px 10px;
    }
    
    .copy-id-btn {
        align-self: flex-end;
        min-width: 80px;
    }
    
    .copy-success-notification {
        right: 10px;
        left: 10px;
        max-width: none;
    }
}

/* Dark mode support for event ID section */
@media (prefers-color-scheme: dark) {
    .event-id-section {
        background: #2d3748;
        border-color: #4a5568;
    }
    
    .event-id-header {
        background: #1a202c;
        border-color: #4a5568;
    }
    
    .event-id-header:hover {
        background: #2d3748;
    }
    
    .event-id-label {
        color: #e2e8f0;
    }
    
    .eye-toggle-btn {
        color: #a0aec0;
    }
    
    .eye-toggle-btn:hover {
        background: #4a5568;
        color: #e2e8f0;
    }
    
    .event-id-container {
        background: #1a202c;
        border-color: #4a5568;
    }
    
    .event-id-code {
        background: #2d3748;
        border-color: #4a5568;
        color: #63b3ed;
    }
    
    .event-id-note {
        color: #a0aec0;
    }
}

/* Loading and error states */
.loading-events,
.error-loading-events,
.no-events-message {
    text-align: center;
    padding: 40px 20px;
    color: #6c757d;
}

.loading-events i,
.error-loading-events i,
.no-events-message i {
    font-size: 48px;
    margin-bottom: 16px;
    display: block;
}

.loading-events i {
    color: #1a73e8;
}

.error-loading-events i {
    color: #dc3545;
}

.no-events-message i {
    color: #28a745;
}

.retry-btn {
    background: #1a73e8;
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 6px;
    cursor: pointer;
    margin-top: 16px;
    transition: background-color 0.2s ease;
}

.retry-btn:hover {
    background: #1557b0;
}

.retry-btn i {
    margin-right: 8px;
}


.event-card-content {
    transition: max-height 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Hover effects for better interactivity */
.physical-event-card:not(.expanded):hover .expand-indicator {
    background: rgba(255, 255, 255, 0.3);
    transform: scale(1.05);
}

.physical-event-card.expanded .expand-indicator {
    background: rgba(255, 255, 255, 0.3);
}

/* Focus states for accessibility */
.physical-event-card:focus-within {
    outline: 2px solid #007bff;
    outline-offset: 2px;
}

.launch-btn:focus,
.edit-event-link:focus,
.view-event-link:focus {
    outline: 2px solid #007bff;
    outline-offset: 2px;
}

/* Football Event Modal */
.football-event-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    backdrop-filter: blur(5px);
    z-index: 1002;
    display: none;
    align-items: center;
    justify-content: center;
    padding: 20px;
}

.football-event-popup {
    background: #1a1a2e;
    border: 2px solid #008B8B;
    border-radius: 20px;
    width: 100%;
    max-width: 900px;
    max-height: 90vh;
    overflow-y: auto;
    animation: popupSlideIn 0.3s ease;
}

.football-event-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px 25px;
    background: rgba(22, 33, 62, 0.3);
    border-bottom: 1px solid #16213e;
    border-radius: 18px 18px 0 0;
}

.football-event-header h3 {
    color: white;
    margin: 0;
    font-size: 1.5rem;
    font-weight: 700;
    display: flex;
    align-items: center;
    gap: 10px;
}

.close-football-event-btn {
    background: rgba(22, 33, 62, 0.5);
    border: none;
    border-radius: 50%;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
    color: white;
    font-size: 1.2rem;
}

.close-football-event-btn:hover {
    background: rgba(22, 33, 62, 0.8);
    transform: rotate(90deg);
}

.football-event-content {
    padding: 25px;
}

.football-step {
    display: none;
}

.football-step.active {
    display: block;
}

.football-step-header {
    text-align: center;
    margin-bottom: 30px;
}

.football-step-header h4 {
    color: white;
    margin: 0 0 10px 0;
    font-size: 1.4rem;
    font-weight: 600;
}

.football-step-header p {
    color: rgba(255, 255, 255, 0.7);
    margin: 0;
    font-size: 0.9rem;
}

.football-form-group {
    margin-bottom: 25px;
}

.football-form-group label {
    display: block;
    color: white;
    font-weight: 600;
    margin-bottom: 10px;
    font-size: 0.95rem;
}

.football-form-group input,
.football-form-group textarea {
    width: 100%;
    padding: 12px 15px;
    background: rgba(22, 33, 62, 0.3);
    border: 2px solid #16213e;
    border-radius: 10px;
    color: white;
    font-size: 0.9rem;
    transition: all 0.3s ease;
}

.football-form-group input:focus,
.football-form-group textarea:focus {
    outline: none;
    border-color: #008B8B;
    background: rgba(22, 33, 62, 0.5);
}

.football-background-options {
    display: flex;
    gap: 15px;
    margin-bottom: 15px;
}

.football-bg-option {
    flex: 1;
    padding: 15px;
    background: rgba(22, 33, 62, 0.3);
    border: 2px solid #16213e;
    border-radius: 10px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
    color: rgba(255, 255, 255, 0.7);
}

.football-bg-option.active {
    border-color: #008B8B;
    background: rgba(0, 139, 139, 0.1);
    color: white;
}

.football-bg-option i {
    display: block;
    font-size: 1.5rem;
    margin-bottom: 8px;
    color: #008B8B;
}

.football-color-picker input {
    width: 60px;
    height: 40px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
}

.football-image-upload label {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    padding: 15px;
    background: rgba(22, 33, 62, 0.3);
    border: 2px dashed #16213e;
    border-radius: 10px;
    cursor: pointer;
    transition: all 0.3s ease;
    color: rgba(255, 255, 255, 0.7);
}

.football-image-upload label:hover {
    border-color: #008B8B;
    color: white;
}

.football-image-upload input {
    display: none;
}

.football-match-types {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
}

.football-match-type {
    padding: 20px 15px;
    background: rgba(22, 33, 62, 0.3);
    border: 2px solid #16213e;
    border-radius: 12px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
}

.football-match-type.selected {
    border-color: #008B8B;
    background: rgba(0, 139, 139, 0.1);
}

.football-match-type i {
    font-size: 2rem;
    color: #008B8B;
    margin-bottom: 10px;
}

.football-match-type h5 {
    color: white;
    margin: 0 0 5px 0;
    font-size: 1.1rem;
}

.football-match-type p {
    color: rgba(255, 255, 255, 0.7);
    margin: 0;
    font-size: 0.85rem;
}

.football-team-options {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
    gap: 10px;
}
.football-team-option {
    padding: 15px 10px;
    background: rgba(22, 33, 62, 0.3);
    border: 2px solid #16213e;
    border-radius: 10px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
    color: white;
    font-weight: 600;
}

.football-team-option.selected {
    border-color: #008B8B;
    background: rgba(0, 139, 139, 0.1);
}

.football-fee-options {
    display: flex;
    gap: 15px;
    margin-bottom: 15px;
}

.football-fee-option {
    flex: 1;
    padding: 15px;
    background: rgba(22, 33, 62, 0.3);
    border: 2px solid #16213e;
    border-radius: 10px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
    color: rgba(255, 255, 255, 0.7);
}

.football-fee-option.active {
    border-color: #008B8B;
    background: rgba(0, 139, 139, 0.1);
    color: white;
}

.football-fee-option i {
    display: block;
    font-size: 1.5rem;
    margin-bottom: 8px;
    color: #008B8B;
}

.football-fee-input {
    position: relative;
}

.football-fee-input input {
    padding-right: 50px;
}

.football-currency {
    position: absolute;
    right: 15px;
    top: 50%;
    transform: translateY(-50%);
    color: #008B8B;
    font-weight: 600;
}

.football-nav-buttons {
    display: flex;
    gap: 15px;
    justify-content: space-between;
    margin-top: 30px;
}

.football-next-btn,
.football-back-btn,
.football-create-btn {
    padding: 12px 30px;
    border: none;
    border-radius: 10px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 0.95rem;
}

.football-next-btn,
.football-create-btn {
    background: #008B8B;
    color: white;
    flex: 1;
}

.football-next-btn:hover,
.football-create-btn:hover {
    background: #20B2AA;
    transform: translateY(-2px);
}

.football-next-btn:disabled,
.football-create-btn:disabled {
    background: rgba(0, 139, 139, 0.3);
    cursor: not-allowed;
    transform: none;
}

.football-back-btn {
    background: rgba(22, 33, 62, 0.5);
    color: white;
    border: 2px solid #16213e;
}

.football-back-btn:hover {
    background: rgba(22, 33, 62, 0.8);
    border-color: #008B8B;
}

.football-summary-card {
    background: rgba(22, 33, 62, 0.3);
    border: 2px solid #16213e;
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 25px;
}

.football-summary-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 0;
    border-bottom: 1px solid rgba(22, 33, 62, 0.5);
    color: white;
}

.football-summary-item:last-child {
    border-bottom: none;
}

.football-summary-item.highlight {
    background: rgba(0, 139, 139, 0.1);
    margin: 0 -20px;
    padding: 15px 20px;
    border-radius: 8px;
    font-weight: 600;
    font-size: 1.1rem;
}

.football-summary-item span:first-child {
    color: rgba(255, 255, 255, 0.8);
}

.football-summary-item span:last-child {
    font-weight: 600;
    color: #20B2AA;
}

.football-payment-section h5 {
    color: white;
    margin: 0 0 15px 0;
    font-size: 1.1rem;
    font-weight: 600;
}

.football-payment-options {
    display: flex;
    flex-direction: column;
    gap: 10px;
    margin-bottom: 20px;
}

.football-payment-option {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 15px;
    background: rgba(22, 33, 62, 0.3);
    border: 2px solid #16213e;
    border-radius: 10px;
    cursor: pointer;
    transition: all 0.3s ease;
    color: white;
}

.football-payment-option.selected {
    border-color: #008B8B;
    background: rgba(0, 139, 139, 0.1);
}

.football-payment-option.disabled {
    opacity: 0.6;
    cursor: not-allowed;
}

.football-payment-option i {
    color: #008B8B;
    margin-right: 10px;
}

.coming-soon {
    background: rgba(255, 193, 7, 0.2);
    color: #ffc107;
    padding: 4px 8px;
    border-radius: 12px;
    font-size: 0.75rem;
    font-weight: 600;
}

.football-promo-input {
    display: flex;
    gap: 10px;
    margin-top: 15px;
}

.football-promo-input input {
    flex: 1;
    text-transform: uppercase;
}

.football-verify-btn {
    padding: 12px 20px;
    background: #008B8B;
    color: white;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    font-weight: 600;
    transition: all 0.3s ease;
}

.football-verify-btn:hover {
    background: #20B2AA;
}

.football-promo-status {
    margin-top: 10px;
    padding: 10px;
    border-radius: 8px;
    font-weight: 600;
    text-align: center;
}

.football-promo-status.valid {
    background: rgba(40, 167, 69, 0.2);
    color: #28a745;
    border: 1px solid rgba(40, 167, 69, 0.3);
}

.football-promo-status.invalid {
    background: rgba(220, 53, 69, 0.2);
    color: #dc3545;
    border: 1px solid rgba(220, 53, 69, 0.3);
}

/* Responsive Design */
@media (max-width: 768px) {
    .football-event-popup {
        margin: 10px;
        max-width: calc(100% - 20px);
    }
    
    .football-event-header {
        padding: 15px 20px;
    }
    
    .football-event-header h3 {
        font-size: 1.3rem;
    }
    
    .football-event-content {
        padding: 20px;
    }
    
    .football-match-types {
        grid-template-columns: 1fr;
    }
    
    .football-team-options {
        grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
    }
    
    .football-fee-options {
        flex-direction: column;
    }
    
    .football-nav-buttons {
        flex-direction: column;
    }
}

@media (max-width: 480px) {
    .football-event-overlay {
        padding: 10px;
    }
    
    .football-event-header {
        padding: 12px 15px;
    }
    
    .football-event-header h3 {
        font-size: 1.2rem;
    }
    
    .football-event-content {
        padding: 15px;
    }
    
    .football-team-options {
        grid-template-columns: repeat(auto-fill, minmax(50px, 1fr));
    }
    
    .football-background-options {
        flex-direction: column;
    }
}

/* Custom scrollbar for football popup */
.football-event-popup::-webkit-scrollbar {
    width: 6px;
}

.football-event-popup::-webkit-scrollbar-track {
    background: rgba(22, 33, 62, 0.3);
    border-radius: 3px;
}

.football-event-popup::-webkit-scrollbar-thumb {
    background: #008B8B;
    border-radius: 3px;
}

.football-event-popup::-webkit-scrollbar-thumb:hover {
    background: #20B2AA;
}


/* Loading States */
.loading-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(255, 255, 255, 0.8);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 10;
    border-radius: 10px;
}



/* Sport Event Page */
.sport-event-page {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: #1a1a2e;
    z-index: 1000;
    overflow-y: auto;
    display: none;
}

/* Page Header */
.sport-page-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px 25px;
    background: rgba(22, 33, 62, 0.3);
    border-bottom: 1px solid #16213e;
    position: sticky;
    top: 0;
    z-index: 10;
}

.sport-page-header h2 {
    color: white;
    margin: 0;
    font-size: 1.8rem;
    font-weight: 700;
}

.close-sport-event-page-btn {
    background: rgba(22, 33, 62, 0.5);
    border: none;
    border-radius: 50%;
    width: 45px;
    height: 45px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
    color: white;
    font-size: 1.3rem;
}

.close-sport-event-page-btn:hover {
    background: rgba(22, 33, 62, 0.8);
    transform: rotate(90deg);
}

/* Banner Ad */
.sport-banner-ad {
    width: 480px;
    height: 65px;
    margin: 20px auto;
    padding: 10px 15px;
    background: linear-gradient(135deg, #16213e, #0f3460);
    backdrop-filter: blur(10px);
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 8px;
    border: 1px solid #008B8B;
}

.sport-ad-content {
    text-align: center;
}

.sport-ad-label {
    background: #0f3460;
    color: white;
    padding: 4px 12px;
    border-radius: 15px;
    font-size: 0.8rem;
    font-weight: 600;
    display: inline-block;
    margin-bottom: 5px;
}

.sport-ad-content p {
    color: rgba(255, 255, 255, 0.9);
    margin: 0;
    font-size: 0.85rem;
}

/* Action Buttons */
.sport-action-buttons {
    display: flex;
    gap: 20px;
    padding: 0 25px;
    margin: 20px 0;
    justify-content: center;
}

.sport-action-btn {
    background: rgba(22, 33, 62, 0.3);
    border: 2px solid #008B8B;
    border-radius: 15px;
    padding: 15px 25px;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 10px;
    color: white;
    font-weight: 600;
    min-width: 120px;
    justify-content: center;
}

.sport-action-btn:hover {
    background: rgba(0, 139, 139, 0.1);
    border-color: #20B2AA;
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0, 139, 139, 0.2);
}

.sport-btn-icon {
    font-size: 1.2rem;
}

/* Sponsors Footer */
.sport-sponsors-footer {
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    background: rgba(22, 33, 62, 0.9);
    border-top: 1px solid #16213e;
    padding: 15px 0;
    backdrop-filter: blur(10px);
}

.sport-sponsors-container {
    overflow: hidden;
    white-space: nowrap;
    position: relative;
}

.sport-sponsors-scroll {
    display: inline-flex;
    animation: scrollSponsors 30s linear infinite;
    gap: 30px;
    align-items: center;
}

.sport-sponsor-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 5px;
    min-width: 100px;
    padding: 0 10px;
}

.sport-sponsor-item img {
    width: 80px;
    height: 40px;
    object-fit: contain;
    border-radius: 5px;
    border: 1px solid rgba(0, 139, 139, 0.3);
}

.sport-sponsor-item span {
    color: white;
    font-size: 0.8rem;
    font-weight: 500;
    text-align: center;
}

/* Scrolling Animation */
@keyframes scrollSponsors {
    0% {
        transform: translateX(100%);
    }
    100% {
        transform: translateX(-100%);
    }
}

/* Responsive Design */
@media (max-width: 768px) {
    .sport-page-header {
        padding: 15px 20px;
    }
    
    .sport-page-header h2 {
        font-size: 1.5rem;
    }
    
    .sport-banner-ad {
        width: 100%;
        max-width: 480px;
        margin: 15px auto;
        padding: 8px 12px;
    }
    
    .sport-action-buttons {
        padding: 0 20px;
        gap: 15px;
    }
    
    .sport-action-btn {
        padding: 12px 20px;
        min-width: 100px;
    }
    
    .sport-sponsors-footer {
        padding: 12px 0;
    }
    
    .sport-sponsor-item {
        min-width: 80px;
        gap: 3px;
    }
    
    .sport-sponsor-item img {
        width: 60px;
        height: 30px;
    }
    
    .sport-sponsor-item span {
        font-size: 0.7rem;
    }
}

@media (max-width: 480px) {
    .sport-page-header {
        padding: 12px 15px;
    }
    
    .sport-page-header h2 {
        font-size: 1.3rem;
    }
    
    .sport-banner-ad {
        height: 55px;
        padding: 8px 10px;
    }
    
    .sport-ad-content p {
        font-size: 0.8rem;
    }
    
    .sport-action-buttons {
        flex-direction: column;
        padding: 0 15px;
        gap: 10px;
    }
    
    .sport-action-btn {
        width: 100%;
    }
    
    .sport-sponsors-footer {
        padding: 10px 0;
    }
    
    .sport-sponsor-item {
        min-width: 70px;
    }
    
    .sport-sponsor-item img {
        width: 50px;
        height: 25px;
    }
    
    .sport-sponsor-item span {
        font-size: 0.65rem;
    }
}

/* Host Sport Event Popup */
.host-sport-popup-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    backdrop-filter: blur(5px);
    z-index: 1001;
    display: none;
    align-items: center;
    justify-content: center;
    padding: 20px;
}

.host-sport-popup {
    background: #1a1a2e;
    border: 2px solid #008B8B;
    border-radius: 20px;
    width: 100%;
    max-width: 800px;
    max-height: 90vh;
    overflow-y: auto;
    animation: popupSlideIn 0.3s ease;
}

.host-sport-popup-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px 25px;
    background: rgba(22, 33, 62, 0.3);
    border-bottom: 1px solid #16213e;
    border-radius: 18px 18px 0 0;
}

.host-sport-popup-header h3 {
    color: white;
    margin: 0;
    font-size: 1.5rem;
    font-weight: 700;
    display: flex;
    align-items: center;
    gap: 10px;
}

.close-host-sport-popup-btn {
    background: rgba(22, 33, 62, 0.5);
    border: none;
    border-radius: 50%;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
    color: white;
    font-size: 1.2rem;
}

.close-host-sport-popup-btn:hover {
    background: rgba(22, 33, 62, 0.8);
    transform: rotate(90deg);
}

.host-sport-popup-content {
    padding: 25px;
}

.host-sport-category-title {
    text-align: center;
    margin-bottom: 30px;
}

.host-sport-category-title h4 {
    color: white;
    margin: 0 0 10px 0;
    font-size: 1.3rem;
    font-weight: 600;
}

.host-sport-category-title p {
    color: rgba(255, 255, 255, 0.7);
    margin: 0;
    font-size: 0.9rem;
}

.host-sport-categories-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 15px;
}

.host-sport-category-card {
    background: rgba(22, 33, 62, 0.3);
    border: 2px solid #16213e;
    border-radius: 12px;
    padding: 20px 15px;
    cursor: pointer;
    transition: all 0.3s ease;
    text-align: center;
    position: relative;
    overflow: hidden;
}

.host-sport-category-card.accessible {
    border-color: #008B8B;
}

.host-sport-category-card.accessible:hover {
    background: rgba(0, 139, 139, 0.1);
    border-color: #20B2AA;
    transform: translateY(-3px);
    box-shadow: 0 8px 25px rgba(0, 139, 139, 0.2);
}

.host-sport-category-card.coming-soon {
    opacity: 0.6;
    cursor: not-allowed;
}

.host-sport-category-card.coming-soon::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: repeating-linear-gradient(
        45deg,
        transparent,
        transparent 10px,
        rgba(255, 255, 255, 0.05) 10px,
        rgba(255, 255, 255, 0.05) 20px
    );
    pointer-events: none;
}

.host-sport-category-icon {
    margin-bottom: 15px;
}

.host-sport-category-icon i {
    font-size: 2.5rem;
    color: #008B8B;
    transition: all 0.3s ease;
}

.host-sport-category-card.accessible:hover .host-sport-category-icon i {
    color: #20B2AA;
    transform: scale(1.1);
}

.host-sport-category-card.coming-soon .host-sport-category-icon i {
    color: rgba(0, 139, 139, 0.5);
}

.host-sport-category-info h5 {
    color: white;
    margin: 0 0 8px 0;
    font-size: 1rem;
    font-weight: 600;
}

.host-sport-category-card.coming-soon .host-sport-category-info h5 {
    color: rgba(255, 255, 255, 0.6);
}

.host-sport-category-status {
    padding: 4px 12px;
    border-radius: 15px;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.host-sport-category-status.available {
    background: rgba(0, 139, 139, 0.2);
    color: #20B2AA;
    border: 1px solid rgba(0, 139, 139, 0.3);
}

.host-sport-category-status.coming-soon {
    background: rgba(255, 193, 7, 0.2);
    color: #ffc107;
    border: 1px solid rgba(255, 193, 7, 0.3);
}

/* Popup Animation */
@keyframes popupSlideIn {
    from {
        opacity: 0;
        transform: scale(0.9) translateY(-20px);
    }
    to {
        opacity: 1;
        transform: scale(1) translateY(0);
    }
}

/* Responsive Design */
@media (max-width: 768px) {
    .host-sport-popup {
        margin: 10px;
        max-width: calc(100% - 20px);
    }
    
    .host-sport-popup-header {
        padding: 15px 20px;
    }
    
    .host-sport-popup-header h3 {
        font-size: 1.3rem;
    }
    
    .host-sport-popup-content {
        padding: 20px;
    }
    
    .host-sport-categories-grid {
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 12px;
    }
    
    .host-sport-category-card {
        padding: 15px 10px;
    }
    
    .host-sport-category-icon i {
        font-size: 2rem;
    }
    
    .host-sport-category-info h5 {
        font-size: 0.9rem;
    }
}

@media (max-width: 480px) {
    .host-sport-popup-overlay {
        padding: 10px;
    }
    
    .host-sport-popup-header {
        padding: 12px 15px;
    }
    
    .host-sport-popup-header h3 {
        font-size: 1.2rem;
    }
    
    .host-sport-popup-content {
        padding: 15px;
    }
    
    .host-sport-categories-grid {
        grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
        gap: 10px;
    }
    
    .host-sport-category-card {
        padding: 12px 8px;
    }
    
    .host-sport-category-icon {
        margin-bottom: 10px;
    }
    
    .host-sport-category-icon i {
        font-size: 1.8rem;
    }
    
    .host-sport-category-info h5 {
        font-size: 0.85rem;
        margin-bottom: 6px;
    }
    
    .host-sport-category-status {
        font-size: 0.7rem;
        padding: 3px 8px;
    }
}

/* Custom scrollbar for popup */
.host-sport-popup::-webkit-scrollbar {
    width: 6px;
}

.host-sport-popup::-webkit-scrollbar-track {
    background: rgba(22, 33, 62, 0.3);
    border-radius: 3px;
}

.host-sport-popup::-webkit-scrollbar-thumb {
    background: #008B8B;
    border-radius: 3px;
}

.host-sport-popup::-webkit-scrollbar-thumb:hover {
    background: #20B2AA;
}

    
/* Main Container */
.sport-events-container {
    width: 100%;
    min-height: 400px;
    padding: clamp(15px, 4vw, 20px);
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: clamp(15px, 4vw, 20px);
    align-content: start;
    position: relative;
    background: transparent;
    border-radius: 12px;
    transition: all 0.3s ease;
}

/* Container States */
.sport-events-container.loading {
    opacity: 0.7;
    pointer-events: none;
}

.sport-events-container.error {
    border: 1px solid rgba(231, 76, 60, 0.3);
    background: rgba(231, 76, 60, 0.05);
}

/* Empty State Container */
.sport-events-empty {
    grid-column: 1 / -1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    padding: clamp(40px, 8vw, 60px) clamp(20px, 5vw, 30px);
    background: rgba(255, 255, 255, 0.05);
    border: 2px dashed rgba(255, 255, 255, 0.2);
    border-radius: 15px;
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    transition: all 0.3s ease;
    min-height: 300px;
    position: relative;
    overflow: hidden;
    animation: emptyStateSlideIn 0.5s ease-out;
}

@keyframes emptyStateSlideIn {
    0% {
        opacity: 0;
        transform: translateY(20px) scale(0.95);
    }
    100% {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
}

/* Empty State Hover Effect */
.sport-events-empty:hover {
    background: rgba(255, 255, 255, 0.08);
    border-color: rgba(255, 255, 255, 0.3);
    transform: translateY(-2px);
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
}

/* Empty State Background Pattern */
.sport-events-empty::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: 
        radial-gradient(circle at 20% 20%, rgba(52, 152, 219, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 80% 80%, rgba(155, 89, 182, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 40% 60%, rgba(46, 204, 113, 0.1) 0%, transparent 50%);
    pointer-events: none;
    border-radius: 15px;
}

/* Empty State Icon */
.empty-state-icon {
    width: clamp(80px, 15vw, 100px);
    height: clamp(80px, 15vw, 100px);
    background: linear-gradient(135deg, #3498db, #2980b9);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: clamp(20px, 5vw, 25px);
    box-shadow: 0 10px 30px rgba(52, 152, 219, 0.3);
    position: relative;
    z-index: 1;
    animation: iconFloat 3s ease-in-out infinite;
}

@keyframes iconFloat {
    0%, 100% {
        transform: translateY(0px);
    }
    50% {
        transform: translateY(-10px);
    }
}

.empty-state-icon i {
    font-size: clamp(32px, 7vw, 40px);
    color: white;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    animation: iconPulse 2s ease-in-out infinite;
}

@keyframes iconPulse {
    0%, 100% {
        transform: scale(1);
    }
    50% {
        transform: scale(1.1);
    }
}

/* Empty State Text */
.sport-events-empty h4 {
    color: white;
    font-size: clamp(20px, 5vw, 24px);
    font-weight: bold;
    margin: 0 0 clamp(10px, 3vw, 15px) 0;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    position: relative;
    z-index: 1;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
    letter-spacing: -0.02em;
}

.sport-events-empty p {
    color: rgba(255, 255, 255, 0.8);
    font-size: clamp(14px, 3.5vw, 16px);
    line-height: 1.5;
    margin: 0 0 clamp(25px, 6vw, 30px) 0;
    max-width: 300px;
    position: relative;
    z-index: 1;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
}

/* Empty State Button */
.empty-state-btn {
    background: linear-gradient(135deg, #e74c3c, #c0392b);
    color: white;
    border: none;
    padding: clamp(12px, 3vw, 15px) clamp(24px, 6vw, 30px);
    border-radius: 25px;
    font-size: clamp(14px, 3.5vw, 16px);
    font-weight: bold;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: all 0.3s ease;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3);
    position: relative;
    z-index: 1;
    overflow: hidden;
    min-height: 48px;
    justify-content: center;
    font-family: inherit;
    -webkit-tap-highlight-color: transparent;
}

.empty-state-btn:hover {
    background: linear-gradient(135deg, #c0392b, #a93226);
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(231, 76, 60, 0.4);
}

.empty-state-btn:active {
    transform: translateY(0);
    box-shadow: 0 2px 10px rgba(231, 76, 60, 0.3);
}

.empty-state-btn i {
    font-size: clamp(16px, 4vw, 18px);
    transition: transform 0.3s ease;
}

.empty-state-btn:hover i {
    transform: scale(1.2) rotate(90deg);
}

/* Button Ripple Effect */
.empty-state-btn::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.3);
    transform: translate(-50%, -50%);
    transition: width 0.3s ease, height 0.3s ease;
    pointer-events: none;
}

.empty-state-btn:active::before {
    width: 100px;
    height: 100px;
}

/* Container Grid Adjustments */
@media (max-width: 768px) {
    .sport-events-container {
        grid-template-columns: 1fr;
        gap: 15px;
        padding: 15px;
        min-height: 350px;
    }
    
    .sport-events-empty {
        min-height: 280px;
        padding: 30px 20px;
    }
}

@media (max-width: 480px) {
    .sport-events-container {
        padding: 10px;
        gap: 12px;
        min-height: 300px;
    }
    
    .sport-events-empty {
        min-height: 250px;
        padding: 25px 15px;
        border-radius: 12px;
    }
    
    .empty-state-icon {
        width: 70px;
        height: 70px;
        margin-bottom: 15px;
    }
    
    .empty-state-icon i {
        font-size: 28px;
    }
    
    .empty-state-btn {
        padding: 12px 20px;
        border-radius: 20px;
        font-size: 13px;
    }
}

@media (max-width: 360px) {
    .sport-events-container {
        padding: 8px;
        gap: 10px;
        min-height: 280px;
    }
    
    .sport-events-empty {
        min-height: 220px;
        padding: 20px 12px;
        border-radius: 10px;
    }
    
    .empty-state-icon {
        width: 60px;
        height: 60px;
        margin-bottom: 12px;
    }
    
    .empty-state-icon i {
        font-size: 24px;
    }
    
    .empty-state-btn {
        padding: 10px 16px;
        border-radius: 18px;
        font-size: 12px;
        min-height: 44px;
    }
}

/* Tablet Styles */
@media (min-width: 769px) and (max-width: 1024px) {
    .sport-events-container {
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 18px;
        padding: 18px;
    }
}

/* Desktop Styles */
@media (min-width: 1025px) {
    .sport-events-container {
        grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
        gap: 20px;
        padding: 20px;
    }
    
    .sport-events-empty {
        max-width: 500px;
        margin: 0 auto;
    }
}

/* Ultra-wide Screens */
@media (min-width: 1400px) {
    .sport-events-container {
        grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
        gap: 25px;
        padding: 25px;
    }
}

/* Loading State */
.sport-events-container.loading::after {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
    animation: shimmer 2s ease-in-out infinite;
}

@keyframes shimmer {
    0% { left: -100%; }
    100% { left: 100%; }
}

/* Focus States */
.empty-state-btn:focus-visible {
    outline: 2px solid #3498db;
    outline-offset: 2px;
    box-shadow: 0 0 0 4px rgba(52, 152, 219, 0.2);
}

/* Touch Device Optimizations */
@media (hover: none) and (pointer: coarse) {
    .sport-events-empty:hover {
        transform: none;
        background: rgba(255, 255, 255, 0.05);
        border-color: rgba(255, 255, 255, 0.2);
        box-shadow: none;
    }
    
    .empty-state-btn:hover {
        background: linear-gradient(135deg, #e74c3c, #c0392b);
        transform: none;
        box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3);
    }
    
    .empty-state-btn:active {
        transform: scale(0.98);
        transition: transform 0.1s ease;
    }
    
    .empty-state-btn:hover i {
        transform: scale(1.1);
    }
}

/* Hover Effects for Desktop */
@media (hover: hover) and (pointer: fine) {
    .sport-events-empty:hover .empty-state-icon {
        transform: scale(1.05);
        box-shadow: 0 15px 40px rgba(52, 152, 219, 0.4);
    }
    
    .sport-events-empty:hover .empty-state-btn {
        transform: translateY(-2px);
    }
}

/* Safe Area Support for iPhone X+ */
@supports (padding: max(0px)) {
    .sport-events-container {
        padding-left: max(15px, env(safe-area-inset-left));
        padding-right: max(15px, env(safe-area-inset-right));
        padding-bottom: max(15px, env(safe-area-inset-bottom));
    }
}

/* Dark Mode Enhancements */
@media (prefers-color-scheme: dark) {
    .sport-events-empty {
        background: rgba(255, 255, 255, 0.03);
        border-color: rgba(255, 255, 255, 0.15);
    }
    
    .sport-events-container.error {
        background: rgba(231, 76, 60, 0.03);
        border-color: rgba(231, 76, 60, 0.2);
    }
}

/* Light Mode Support */
@media (prefers-color-scheme: light) {
    .sport-events-empty {
        background: rgba(0, 0, 0, 0.05);
        border-color: rgba(0, 0, 0, 0.1);
    }
    
    .sport-events-empty h4 {
        color: white;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.7);
    }
    
    .sport-events-empty p {
        color: rgba(255, 255, 255, 0.9);
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
    }
    /* Light Mode Support */
@media (prefers-color-scheme: light) {
    .sport-events-empty {
        background: rgba(0, 0, 0, 0.05);
        border-color: rgba(0, 0, 0, 0.1);
    }
    
    .sport-events-empty h4 {
        color: white;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.7);
    }
    
    .sport-events-empty p {
        color: rgba(255, 255, 255, 0.9);
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
    }
    
    .sport-events-container.error {
        background: rgba(231, 76, 60, 0.08);
        border-color: rgba(231, 76, 60, 0.3);
    }
}

/* High Contrast Mode */
@media (prefers-contrast: high) {
    .sport-events-empty {
        border: 2px solid white;
        background: rgba(0, 0, 0, 0.8);
    }
    
    .sport-events-empty h4 {
        color: white;
    }
    
    .sport-events-empty p {
        color: white;
    }
    
    .empty-state-btn {
        border: 1px solid white;
    }
    
    .empty-state-icon {
        border: 2px solid white;
    }
}

/* Reduced Motion Support */
@media (prefers-reduced-motion: reduce) {
    .sport-events-empty,
    .empty-state-icon,
    .empty-state-icon i,
    .empty-state-btn,
    .empty-state-btn i,
    .sport-events-container.loading::after {
        animation: none;
        transition: none;
    }
    
    .sport-events-empty:hover,
    .empty-state-btn:hover,
    .empty-state-btn:active {
        transform: none;
    }
    
    .empty-state-btn:hover i {
        transform: none;
    }
}

/* Reduced Transparency */
@media (prefers-reduced-transparency: reduce) {
    .sport-events-empty {
        background: rgba(20, 20, 20, 0.95);
        backdrop-filter: none;
        -webkit-backdrop-filter: none;
    }
    
    .sport-events-empty::before {
        display: none;
    }
}

/* Container with Events (when populated) */
.sport-events-container:not(:has(.sport-events-empty)) {
    align-content: start;
    justify-content: start;
}

/* Alternative Empty State Variations */
.sport-events-empty.compact {
    min-height: 200px;
    padding: 30px 20px;
}

.sport-events-empty.compact .empty-state-icon {
    width: 60px;
    height: 60px;
    margin-bottom: 15px;
}

.sport-events-empty.compact .empty-state-icon i {
    font-size: 24px;
}

.sport-events-empty.compact h4 {
    font-size: 18px;
    margin-bottom: 8px;
}

.sport-events-empty.compact p {
    font-size: 14px;
    margin-bottom: 20px;
}

/* Error State for Empty Container */
.sport-events-empty.error {
    border-color: rgba(231, 76, 60, 0.5);
    background: rgba(231, 76, 60, 0.1);
}

.sport-events-empty.error .empty-state-icon {
    background: linear-gradient(135deg, #e74c3c, #c0392b);
    box-shadow: 0 10px 30px rgba(231, 76, 60, 0.3);
}

.sport-events-empty.error .empty-state-icon i::before {
    content: '\f071'; /* Warning icon */
}

.sport-events-empty.error h4 {
    color: #e74c3c;
}

.sport-events-empty.error p {
    color: rgba(231, 76, 60, 0.8);
}

/* Success State for Empty Container */
.sport-events-empty.success {
    border-color: rgba(39, 174, 96, 0.5);
    background: rgba(39, 174, 96, 0.1);
}

.sport-events-empty.success .empty-state-icon {
    background: linear-gradient(135deg, #27ae60, #229954);
    box-shadow: 0 10px 30px rgba(39, 174, 96, 0.3);
}

.sport-events-empty.success .empty-state-icon i::before {
    content: '\f00c'; /* Check icon */
}

/* Loading State for Empty Container */
.sport-events-empty.loading {
    pointer-events: none;
    opacity: 0.7;
}

.sport-events-empty.loading .empty-state-icon {
    animation: iconSpin 2s linear infinite;
}

.sport-events-empty.loading .empty-state-icon i::before {
    content: '\f110'; /* Spinner icon */
}

@keyframes iconSpin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* Enhanced Button States */
.empty-state-btn.loading {
    position: relative;
    color: transparent;
    pointer-events: none;
}

.empty-state-btn.loading::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 16px;
    height: 16px;
    margin: -8px 0 0 -8px;
    border: 2px solid transparent;
    border-top: 2px solid white;
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.empty-state-btn.success {
    background: linear-gradient(135deg, #27ae60, #229954);
    box-shadow: 0 4px 15px rgba(39, 174, 96, 0.3);
}

.empty-state-btn.success:hover {
    background: linear-gradient(135deg, #229954, #1e8449);
    box-shadow: 0 6px 20px rgba(39, 174, 96, 0.4);
}

.empty-state-btn.error {
    background: linear-gradient(135deg, #e74c3c, #c0392b);
    box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3);
}

/* Container Transitions */
.sport-events-container {
    transition: all 0.3s ease;
}

.sport-events-container.fade-in {
    animation: containerFadeIn 0.5s ease-out;
}

@keyframes containerFadeIn {
    0% {
        opacity: 0;
        transform: translateY(20px);
    }
    100% {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Grid Auto-fit Enhancements */
@media (min-width: 1600px) {
    .sport-events-container {
        grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
        gap: 30px;
        padding: 30px;
    }
}

/* Landscape Mobile Optimizations */
@media (max-height: 500px) and (orientation: landscape) {
    .sport-events-empty {
        min-height: 180px;
        padding: 20px 15px;
        flex-direction: row;
        text-align: left;
        gap: 20px;
    }
    
    .empty-state-icon {
        width: 60px;
        height: 60px;
        margin-bottom: 0;
        flex-shrink: 0;
    }
    
    .empty-state-icon i {
        font-size: 24px;
    }
    
    .sport-events-empty h4 {
        font-size: 18px;
        margin-bottom: 5px;
    }
    
    .sport-events-empty p {
        font-size: 14px;
        margin-bottom: 15px;
    }
    
    .empty-state-btn {
        align-self: flex-start;
        margin-top: auto;
    }
}

/* Container Query Support */
@supports (container-type: inline-size) {
    .sport-events-container {
        container-type: inline-size;
    }
    
    @container (max-width: 400px) {
        .sport-events-empty {
            padding: 25px 15px;
            min-height: 220px;
        }
        
        .empty-state-icon {
            width: 60px;
            height: 60px;
        }
        
        .empty-state-icon i {
            font-size: 24px;
        }
    }
    
    @container (min-width: 800px) {
        .sport-events-empty {
            max-width: 600px;
            margin: 0 auto;
            padding: 50px 40px;
        }
    }
}

/* Print Styles */
@media print {
    .sport-events-container {
        background: white !important;
        padding: 20px;
        break-inside: avoid;
    }
    
    .sport-events-empty {
        background: #f9f9f9 !important;
        border: 1px solid #ddd !important;
        color: black !important;
        backdrop-filter: none;
        -webkit-backdrop-filter: none;
    }
    
    .sport-events-empty h4 {
        color: black !important;
        text-shadow: none !important;
    }
    
    .sport-events-empty p {
        color: #666 !important;
        text-shadow: none !important;
    }
    
    .empty-state-icon {
        background: #3498db !important;
        box-shadow: none !important;
    }
    
    .empty-state-btn {
        background: #e74c3c !important;
        box-shadow: none !important;
        color: white !important;
    }
}

/* Performance Optimizations */
.sport-events-container,
.sport-events-empty,
.empty-state-icon,
.empty-state-btn {
    will-change: transform;
    transform: translateZ(0);
    -webkit-backface-visibility: hidden;
    backface-visibility: hidden;
}

.sport-events-container * {
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
}

/* Enhanced Visual Effects */
.sport-events-empty::after {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: 
        radial-gradient(circle at 30% 30%, rgba(52, 152, 219, 0.05) 0%, transparent 50%),
        radial-gradient(circle at 70% 70%, rgba(155, 89, 182, 0.05) 0%, transparent 50%);
    animation: backgroundRotate 20s linear infinite;
    pointer-events: none;
    z-index: 0;
}

@keyframes backgroundRotate {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* Accessibility Improvements */
.sport-events-empty[role="status"] {
    live: polite;
    atomic: true;
}

.empty-state-btn[aria-label] {
    position: relative;
}

/* Enhanced Focus Indicators */
.sport-events-container:focus-within .sport-events-empty {
    border-color: rgba(52, 152, 219, 0.5);
    box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
}

/* Improved Button Accessibility */
.empty-state-btn:focus:not(:focus-visible) {
    outline: none;
}

.empty-state-btn:focus-visible {
    outline: 2px solid #3498db;
    outline-offset: 2px;
    box-shadow: 
        0 4px 15px rgba(231, 76, 60, 0.3),
        0 0 0 4px rgba(52, 152, 219, 0.2);
}

/* Final Responsive Polish */
@media (max-width: 320px) {
    .sport-events-container {
        padding: 5px;
        gap: 8px;
        min-height: 250px;
    }
    
    .sport-events-empty {
        min-height: 200px;
        padding: 15px 10px;
        border-radius: 8px;
    }
    
    .empty-state-icon {
        width: 50px;
        height: 50px;
        margin-bottom: 10px;
    }
    
    .empty-state-icon i {
        font-size: 20px;
    }
    
    .sport-events-empty h4 {
        font-size: 16px;
        margin-bottom: 8px;
    }
    
    .sport-events-empty p {
        font-size: 12px;
        margin-bottom: 15px;
    }
    
    .empty-state-btn {
        padding: 8px 12px;
        font-size: 11px;
        border-radius: 16px;
        min-height: 40px;
    }
}

/* Container Layout Containment */
.sport-events-container {
    contain: layout style paint;
}

.sport-events-empty {
    contain: layout style;
}

/* Final Animation Refinements */
.sport-events-empty.animate-in {
    animation: emptyStateSlideIn 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94);
}

.sport-events-empty.animate-out {
    animation: emptyStateSlideOut 0.3s cubic-bezier(0.55, 0.06, 0.68, 0.19) forwards;
}

@keyframes emptyStateSlideOut {
    0% {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
    100% {
        opacity: 0;
        transform: translateY(-20px) scale(0.95);
    }
}

/* Enhanced Button Interaction */
.empty-state-btn:not(:disabled):not(.loading):active {
    transform: translateY(1px) scale(0.98);
    box-shadow: 0 2px 8px rgba(231, 76, 60, 0.3);
}
/* Ensure proper z-index stacking */
.sport-events-container {
    position: relative;
    z-index: 1;
}

.sport-events-empty {
    position: relative;
    z-index: 2;
}

.empty-state-icon,
.sport-events-empty h4,
.sport-events-empty p,
.empty-state-btn {
    position: relative;
    z-index: 3;
}

/* Enhanced Gradient Animations */
.empty-state-icon {
    background: linear-gradient(135deg, #3498db, #2980b9, #1abc9c);
    background-size: 200% 200%;
    animation: gradientShift 4s ease-in-out infinite, iconFloat 3s ease-in-out infinite;
}

@keyframes gradientShift {
    0%, 100% {
        background-position: 0% 50%;
    }
    50% {
        background-position: 100% 50%;
    }
}

/* Enhanced Button Gradient */
.empty-state-btn {
    background: linear-gradient(135deg, #e74c3c, #c0392b, #e67e22);
    background-size: 200% 200%;
    animation: buttonGradientShift 3s ease-in-out infinite;
}

@keyframes buttonGradientShift {
    0%, 100% {
        background-position: 0% 50%;
    }
    50% {
        background-position: 100% 50%;
    }
}

.empty-state-btn:hover {
    background: linear-gradient(135deg, #c0392b, #a93226, #d35400);
    background-size: 200% 200%;
    animation: buttonGradientShift 2s ease-in-out infinite;
}

/* Micro-interactions */
.empty-state-icon:hover {
    animation: iconBounce 0.6s ease-in-out;
}

@keyframes iconBounce {
    0%, 20%, 60%, 100% {
        transform: translateY(0);
    }
    40% {
        transform: translateY(-10px);
    }
    80% {
        transform: translateY(-5px);
    }
}

/* Enhanced Text Animations */
.sport-events-empty h4 {
    animation: textSlideIn 0.8s ease-out 0.2s both;
}

.sport-events-empty p {
    animation: textSlideIn 0.8s ease-out 0.4s both;
}

.empty-state-btn {
    animation: buttonSlideIn 0.8s ease-out 0.6s both;
}

@keyframes textSlideIn {
    0% {
        opacity: 0;
        transform: translateY(20px);
    }
    100% {
        opacity: 1;
        transform: translateY(0);
    }
}

@keyframes buttonSlideIn {
    0% {
        opacity: 0;
        transform: translateY(20px) scale(0.9);
    }
    100% {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
}

/* Advanced Hover States */
.sport-events-empty:hover .empty-state-icon {
    transform: scale(1.05) rotate(5deg);
    box-shadow: 0 15px 40px rgba(52, 152, 219, 0.4);
}

.sport-events-empty:hover h4 {
    transform: translateY(-2px);
    text-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
}

.sport-events-empty:hover p {
    transform: translateY(-1px);
}

/* Button Loading Animation Enhancement */
.empty-state-btn.loading {
    background: linear-gradient(135deg, #95a5a6, #7f8c8d);
    cursor: not-allowed;
}

.empty-state-btn.loading::after {
    border-top-color: white;
    border-right-color: rgba(255, 255, 255, 0.3);
    border-bottom-color: rgba(255, 255, 255, 0.3);
    border-left-color: rgba(255, 255, 255, 0.3);
}

/* Success Animation */
.empty-state-btn.success {
    animation: successPulse 0.6s ease-in-out;
}

@keyframes successPulse {
    0% {
        transform: scale(1);
        box-shadow: 0 4px 15px rgba(39, 174, 96, 0.3);
    }
    50% {
        transform: scale(1.05);
        box-shadow: 0 8px 25px rgba(39, 174, 96, 0.5);
    }
    100% {
        transform: scale(1);
        box-shadow: 0 4px 15px rgba(39, 174, 96, 0.3);
    }
}

/* Error Animation */
.empty-state-btn.error {
    animation: errorShake 0.6s ease-in-out;
}

@keyframes errorShake {
    0%, 100% {
        transform: translateX(0);
    }
    10%, 30%, 50%, 70%, 90% {
        transform: translateX(-5px);
    }
    20%, 40%, 60%, 80% {
        transform: translateX(5px);
    }
}

/* Enhanced Container States */
.sport-events-container.refreshing {
    position: relative;
    overflow: hidden;
}

.sport-events-container.refreshing::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 4px;
    background: linear-gradient(90deg, transparent, #3498db, transparent);
    animation: refreshBar 2s ease-in-out infinite;
    z-index: 10;
}

@keyframes refreshBar {
    0% {
        left: -100%;
    }
    100% {
        left: 100%;
    }
}

/* Skeleton Loading for Container */
.sport-events-container.skeleton {
    position: relative;
}

.sport-events-container.skeleton::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: 
        linear-gradient(90deg, transparent 25%, rgba(255, 255, 255, 0.1) 50%, transparent 75%),
        linear-gradient(rgba(255, 255, 255, 0.05) 0%, transparent 100%);
    background-size: 200% 100%, 100% 100%;
    animation: skeletonShimmer 2s ease-in-out infinite;
    border-radius: 12px;
    pointer-events: none;
}

@keyframes skeletonShimmer {
    0% {
        background-position: -200% 0, 0 0;
    }
    100% {
        background-position: 200% 0, 0 0;
    }
}

/* Enhanced Responsive Grid */
@media (min-width: 2000px) {
    .sport-events-container {
        grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
        gap: 35px;
        padding: 35px;
        max-width: 1800px;
        margin: 0 auto;
    }
}

/* Foldable Device Support */
@media (spanning: single-fold-vertical) {
    .sport-events-container {
        grid-template-columns: 1fr 1fr;
        gap: 20px;
    }
    
    .sport-events-empty {
        grid-column: 1 / -1;
        max-width: none;
    }
}

@media (spanning: single-fold-horizontal) {
    .sport-events-container {
        max-height: 45vh;
        overflow-y: auto;
    }
    
    .sport-events-empty {
        min-height: 200px;
        flex-direction: row;
        text-align: left;
        gap: 20px;
    }
}

/* Advanced Accessibility */
.sport-events-empty[aria-live="polite"] {
    speak: literal-punctuation;
}

.empty-state-btn[aria-describedby] {
    position: relative;
}

/* Screen Reader Enhancements */
.sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
}

/* Enhanced Focus Management */
.sport-events-container:focus-within {
    outline: none;
}

.sport-events-container:focus-within .sport-events-empty {
    border-color: rgba(52, 152, 219, 0.6);
    box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
}

/* Improved Touch Targets */
@media (pointer: coarse) {
    .empty-state-btn {
        min-height: 48px;
        min-width: 48px;
        padding: 14px 28px;
    }
    
    .empty-state-icon {
        min-width: 60px;
        min-height: 60px;
    }
}

/* Enhanced Visual Hierarchy */
.sport-events-empty h4 {
    font-weight: 700;
    letter-spacing: -0.025em;
    line-height: 1.2;
}

.sport-events-empty p {
    font-weight: 400;
    letter-spacing: 0.01em;
    line-height: 1.6;
    opacity: 0.9;
}

/* Container Performance Optimizations */
.sport-events-container {
    contain: layout style paint;
    content-visibility: auto;
    contain-intrinsic-size: 400px;
}

/* Final Polish */
.sport-events-empty {
    user-select: none;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
}

.empty-state-btn {
    user-select: none;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    -webkit-tap-highlight-color: transparent;
    tap-highlight-color: transparent;
}

/* Enhanced Border Radius for Modern Look */
.sport-events-empty {
    border-radius: clamp(12px, 3vw, 20px);
}

.empty-state-btn {
    border-radius: clamp(20px, 5vw, 30px);
}

/* Improved Animation Performance */
@media (prefers-reduced-motion: no-preference) {
    .sport-events-empty,
    .empty-state-icon,
    .empty-state-btn {
        animation-fill-mode: both;
        animation-timing-function: cubic-bezier(0.25, 0.46, 0.45, 0.94);
    }
}

/* Container Intersection Observer Support */
.sport-events-container[data-visible="false"] {
    opacity: 0;
    transform: translateY(20px);
    transition: opacity 0.6s ease, transform 0.6s ease;
}

.sport-events-container[data-visible="true"] {
    opacity: 1;
    transform: translateY(0);
}

/* Enhanced Empty State Variants */
.sport-events-empty.variant-minimal {
    background: transparent;
    border: 1px solid rgba(255, 255, 255, 0.1);
    backdrop-filter: none;
    -webkit-backdrop-filter: none;
}

.sport-events-empty.variant-bold {
    background: linear-gradient(135deg, rgba(52, 152, 219, 0.1), rgba(155, 89, 182, 0.1));
    border: 2px solid rgba(255, 255, 255, 0.3);
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
}

/* Final Container Grid Enhancements */
.sport-events-container {
    grid-auto-rows: min-content;
    align-items: start;
    justify-items: stretch;
}

/* Ensure consistent spacing */
.sport-events-container > * {
    width: 100%;
    box-sizing: border-box;
}

/* Last responsive breakpoint */
@media (max-width: 280px) {
    .sport-events-container {
        padding: 3px;
        gap: 5px;
        min-height: 200px;
    }
    
    .sport-events-empty {
        min-height: 180px;
        padding: 12px 8px;
        border-radius: 6px;
    }
    
    .empty-state-icon {
        width: 40px;
        height: 40px;
        margin-bottom: 8px;
    }
    
    .empty-state-icon i {
        font-size: 16px;
    }
    
    .sport-events-empty h4 {
        font-size: 14px;
        margin-bottom: 6px;
    }
    
    .sport-events-empty p {
        font-size: 11px;
        margin-bottom: 12px;
    }
    
    .empty-state-btn {
        padding: 6px 10px;
        font-size: 10px;
        border-radius: 14px;
        min-height: 36px;
    }
}

.spinner {
    width: 30px;
    height: 30px;
    border: 3px solid rgba(74, 108, 247, 0.2);
    border-radius: 50%;
    border-top-color: #4a6cf7;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}
   

/* Modal Styles */
.sg-spin-wheel-modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0, 0, 0, 0.7);
}

.sg-spin-wheel-modal .sg-modal-content {
    background-color: #fff;
    margin: 5% auto;
    padding: 20px;
    border-radius: 15px;
    width: 90%;
    max-width: 800px;
    box-shadow: 0 5px 30px rgba(0, 0, 0, 0.3);
    position: relative;
}

.sg-spin-wheel-modal .sg-modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding-bottom: 15px;
    border-bottom: 1px solid #eee;
}

.sg-spin-wheel-modal .sg-modal-header h2 {
    margin: 0;
    color: #333;
    font-size: 1.8rem;
}

.sg-spin-wheel-modal .sg-close-modal {
    color: #aaa;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
    transition: color 0.3s ease;
}

.sg-spin-wheel-modal .sg-close-modal:hover {
    color: #333;
}

/* Tabs */
.sg-spin-wheel-modal .sg-modal-tabs {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin-bottom: 20px;
}

.sg-spin-wheel-modal .sg-tab-btn {
    padding: 12px 20px;
    background-color: transparent;
    border: none;
    border-bottom: 3px solid transparent;
    cursor: pointer;
    font-weight: 600;
    color: #555;
    transition: all 0.3s ease;
}

.sg-spin-wheel-modal .sg-tab-btn:hover {
    color: #333;
}

.sg-spin-wheel-modal .sg-tab-btn.active {
    color: #3498db;
    border-bottom: 3px solid #3498db;
}

/* Tab Content */
.sg-spin-wheel-modal .sg-tab-content {
    display: none;
    padding: 20px;
    background-color: #1a1a2e;
    border-radius: 10px;
}

.sg-spin-wheel-modal .sg-tab-content.active {
    display: block;
}

/* Spin Info */
.sg-spin-wheel-modal .sg-spin-info {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding: 15px;
    background-color: #f8f9fa;
    border-radius: 10px;
}

.sg-spin-wheel-modal .sg-cost-badge {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.sg-spin-wheel-modal .sg-cost-badge span {
    padding: 8px 15px;
    border-radius: 50px;
    font-weight: 600;
    font-size: 0.9rem;
    text-align: center;
}

.sg-spin-wheel-modal .sg-cost-badge span:first-child {
    background-color: #e9ecef;
    color: #495057;
}

.sg-spin-wheel-modal .sg-free-spin-badge {
    background-color: #d4edda;
    color: #155724;
}

.sg-spin-wheel-modal .sg-prize-info {
    flex: 1;
    padding-left: 20px;
}

.sg-spin-wheel-modal .sg-prize-info p {
    margin: 5px 0;
    color: #495057;
}

.sg-spin-wheel-modal .sg-prize-info p:first-child {
    font-weight: 600;
    color: #333;
}

/* Wheel Container */
.sg-spin-wheel-modal .sg-wheel-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    margin-bottom: 30px;
}

/* Wheel Outer Rim */
.sg-spin-wheel-modal .sg-wheel-outer-rim {
    width: 320px;
    height: 320px;
    border-radius: 50%;
    background-color: #333;
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
    margin-bottom: 30px;
    box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);
}

/* Wheel rim colors for different types */
.sg-spin-wheel-modal .sg-basic-wheel-rim {
    border: 10px solid #2980b9;
}

.sg-spin-wheel-modal .sg-standard-wheel-rim {
    border: 10px solid #8e44ad;
}

.sg-spin-wheel-modal .sg-premium-wheel-rim {
    border: 10px solid #d35400;
}

/* Wheel Pointer */
.sg-spin-wheel-modal .sg-wheel-pointer {
    position: absolute;
    top: -5px;
    left: 50%;
    transform: translateX(-50%);
    width: 0;
    height: 0;
    border-left: 15px solid transparent;
    border-right: 15px solid transparent;
    border-top: 30px solid #e74c3c;
    z-index: 10;
}

/* Wheel Wrapper */
.sg-spin-wheel-modal .sg-wheel-wrapper {
    width: 280px;
    height: 280px;
    border-radius: 50%;
    overflow: hidden;
    position: relative;
}

/* Wheel */
.sg-spin-wheel-modal .sg-wheel {
    width: 100%;
    height: 100%;
    border-radius: 50%;
    position: relative;
    transition: transform 5s cubic-bezier(0.17, 0.67, 0.83, 0.67);
}

/* Wheel Sections */
.sg-spin-wheel-modal .sg-wheel-section {
    position: absolute;
    top: 0;
    left: 0;
    width: 50%;
    height: 50%;
    transform-origin: bottom right;
    clip-path: polygon(0 0, 100% 0, 100% 100%);
}

/* Basic Wheel Section Styles */
.sg-spin-wheel-modal .sg-wheel-oneB { 
    transform: rotate(0deg); 
    background-color: #3498db; 
}
.sg-spin-wheel-modal .sg-wheel-twoB { 
    transform: rotate(45deg); 
    background-color: #2ecc71; 
}
.sg-spin-wheel-modal .sg-wheel-threeB { 
    transform: rotate(90deg); 
    background-color: #e74c3c; 
}
.sg-spin-wheel-modal .sg-wheel-fourB { 
    transform: rotate(135deg); 
    background-color: #f1c40f; 
}
.sg-spin-wheel-modal .sg-wheel-fiveB { 
    transform: rotate(180deg); 
    background-color: #9b59b6; 
}
.sg-spin-wheel-modal .sg-wheel-sixB { 
    transform: rotate(225deg); 
    background-color: #e67e22; 
}
.sg-spin-wheel-modal .sg-wheel-sevenB { 
    transform: rotate(270deg); 
    background-color: #1abc9c; 
}
.sg-spin-wheel-modal .sg-wheel-eightB { 
    transform: rotate(315deg); 
    background-color: #e84393; 
}

/* Standard Wheel Section Styles */
.sg-spin-wheel-modal .sg-wheel-oneS { 
    transform: rotate(0deg); 
    background-color: #3498db; 
}
.sg-spin-wheel-modal .sg-wheel-twoS { 
    transform: rotate(45deg); 
    background-color: #2ecc71; 
}
.sg-spin-wheel-modal .sg-wheel-threeS { 
    transform: rotate(90deg); 
    background-color: #e74c3c; 
}
.sg-spin-wheel-modal .sg-wheel-fourS { 
    transform: rotate(135deg); 
    background-color: #f1c40f; 
}
.sg-spin-wheel-modal .sg-wheel-fiveS { 
    transform: rotate(180deg); 
    background-color: #9b59b6; 
}
.sg-spin-wheel-modal .sg-wheel-sixS { 
    transform: rotate(225deg); 
    background-color: #e67e22; 
}
.sg-spin-wheel-modal .sg-wheel-sevenS { 
    transform: rotate(270deg); 
    background-color: #1abc9c; 
}
.sg-spin-wheel-modal .sg-wheel-eightS { 
    transform: rotate(315deg); 
    background-color: #e84393; 
}

/* Premium Wheel Section Styles */
.sg-spin-wheel-modal .sg-wheel-oneP { 
    transform: rotate(0deg); 
    background-color: #3498db; 
}
.sg-spin-wheel-modal .sg-wheel-twoP { 
    transform: rotate(45deg); 
    background-color: #2ecc71; 
}
.sg-spin-wheel-modal .sg-wheel-threeP { 
    transform: rotate(90deg); 
    background-color: #e74c3c; 
}
.sg-spin-wheel-modal .sg-wheel-fourP { 
    transform: rotate(135deg); 
    background-color: #f1c40f; 
}
.sg-spin-wheel-modal .sg-wheel-fiveP { 
    transform: rotate(180deg); 
    background-color: #9b59b6; 
}
.sg-spin-wheel-modal .sg-wheel-sixP { 
    transform: rotate(225deg); 
    background-color: #e67e22; 
}
.sg-spin-wheel-modal .sg-wheel-sevenP { 
    transform: rotate(270deg); 
    background-color: #1abc9c; 
}
.sg-spin-wheel-modal .sg-wheel-eightP { 
    transform: rotate(315deg); 
    background-color: #e84393; 
}

/* Prize Text */
.sg-spin-wheel-modal .sg-prize-text {
    position: absolute;
    top: 20px;
    right: 20px;
    transform: rotate(-15deg);
    font-weight: 600;
    font-size: 14px;
    color: white;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
    white-space: nowrap;
}

/* Wheel Center */
.sg-spin-wheel-modal .sg-wheel-center {
    position: absolute;
    width: 60px;
    height: 60px;
    background-color: #fff;
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
    z-index: 5;
}

.sg-spin-wheel-modal .sg-wheel-logo {
    font-size: 20px;
    font-weight: 700;
    color: #333;
}

/* Spin Button */
.sg-spin-wheel-modal .sg-spin-btn {
    padding: 12px 30px;
    background-color: #3498db;
    color: white;
    border: none;
    border-radius: 50px;
    font-size: 1.1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 10px;
    box-shadow: 0 4px 10px rgba(52, 152, 219, 0.3);
}

.sg-spin-wheel-modal .sg-spin-btn:hover {
    background-color: #2980b9;
    transform: translateY(-2px);
}

.sg-spin-wheel-modal .sg-spin-btn:active {
    transform: translateY(1px);
}

.sg-spin-wheel-modal .sg-spin-icon {
    display: flex;
    align-items: center;
    justify-content: center;
}

/* Recent Spins */
.sg-spin-wheel-modal .sg-recent-spins {
    background-color: #f8f9fa;
    border-radius: 10px;
    padding: 20px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
}

.sg-spin-wheel-modal .sg-recent-spins h3 {
    font-size: 1.2rem;
    color: #333;
    margin-bottom: 15px;
    text-align: center;
    position: relative;
}

.sg-spin-wheel-modal .sg-recent-spins h3:after {
    content: '';
    display: block;
    width: 50px;
    height: 3px;
    background-color: #3498db;
    margin: 8px auto 0;
}

/* Basic Spin History Header */
.sg-spin-wheel-modal #sg-basic-spin .sg-recent-spins h3:after {
    background-color: #3498db;
}

/* Standard Spin History Header */
.sg-spin-wheel-modal #sg-standard-spin .sg-recent-spins h3:after {
    background-color: #9b59b6;
}

/* Premium Spin History Header */
.sg-spin-wheel-modal #sg-premium-spin .sg-recent-spins h3:after {
    background-color: #f39c12;
}

.sg-spin-wheel-modal .sg-spin-history {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    justify-content: center;
}

.sg-spin-wheel-modal .sg-spin-result {
    padding: 8px 15px;
    border-radius: 50px;
    font-size: 0.9rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 8px;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
}

.sg-spin-wheel-modal .sg-win-result {
    background-color: #d4edda;
    color: #155724;
    border: 1px solid #c3e6cb;
}

.sg-spin-wheel-modal .sg-lose-result {
    background-color: #f8d7da;
    color: #721c24;
    border: 1px solid #f5c6cb;
}

.sg-spin-wheel-modal .sg-empty-history {
    color: #6c757d;
    font-style: italic;
    text-align: center;
    width: 100%;
    padding: 10px;
}

/* Spinning Animation */
.sg-spin-wheel-modal .sg-wheel.spinning {
    animation: none; /* Remove the default animation */
    transform: rotate(var(--spin-rotation, 1440deg)); /* Use CSS variable for dynamic rotation */
}

/* Disabled button styles */
.sg-spin-wheel-modal .sg-spin-btn.disabled,
.sg-spin-wheel-modal .sg-spin-btn:disabled {
    background-color: #95a5a6;
    cursor: not-allowed;
    box-shadow: none;
}

.sg-spin-wheel-modal .sg-spin-btn.disabled:hover,
.sg-spin-wheel-modal .sg-spin-btn:disabled:hover {
    transform: none;
    background-color: #95a5a6;
}

/* Spinning button animation */
.sg-spin-wheel-modal .sg-spin-btn.spinning .sg-spin-icon {
    animation: sg-rotate 1s linear infinite;
}

@keyframes sg-rotate {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}

/* Result Modal */
.sg-spin-result-modal {
    display: none;
    position: fixed;
    z-index: 1100;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0, 0, 0, 0.8);
}

.sg-spin-result-modal .sg-modal-content {
    background-color: #fff;
    margin: 10% auto;
    padding: 30px;
    border-radius: 15px;
    width: 90%;
    max-width: 500px;
    box-shadow: 0 5px 30px rgba(0, 0, 0, 0.3);
    text-align: center;
    position: relative;
}

.sg-spin-result-modal .sg-result-icon {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    background-color: #f8f9fa;
    display: flex;
    justify-content: center;
    align-items: center;
    margin: 0 auto 20px;
    font-size: 40px;
    color: #f1c40f;
}

.sg-spin-result-modal h2 {
    margin: 0 0 15px;
    color: #333;
    font-size: 1.8rem;
}

.sg-spin-result-modal p {
    margin: 0 0 30px;
    color: #555;
    font-size: 1.2rem;
}

.sg-spin-result-modal .sg-result-actions {
    display: flex;
    justify-content: center;
    gap: 15px;
}

.sg-spin-result-modal .sg-btn {
    padding: 12px 25px;
    border: none;
    border-radius: 50px;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
}

.sg-spin-result-modal .sg-btn-primary {
    background-color: #3498db;
    color: white;
    box-shadow: 0 4px 10px rgba(52, 152, 219, 0.3);
}

.sg-spin-result-modal .sg-btn-primary:hover {
    background-color: #2980b9;
    transform: translateY(-2px);
}

.sg-spin-result-modal .sg-btn-secondary {
    background-color: #f8f9fa;
    color: #333;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
}

.sg-spin-result-modal .sg-btn-secondary:hover {
    background-color: #e9ecef;
    transform: translateY(-2px);
}

/* Confetti animation */
.sg-confetti {
    position: fixed;
    width: 10px;
    height: 10px;
    background-color: #f39c12;
    opacity: 0;
    top: -10px;
    animation: sg-confetti-fall 3s linear forwards;
    z-index: 1200;
}

@keyframes sg-confetti-fall {
    0% {
        opacity: 1;
        top: -10px;
        transform: translateX(0) rotate(0deg);
    }
    100% {
        opacity: 0;
        top: 100vh;
        transform: translateX(100px) rotate(720deg);
    }
}

/* Responsive styles */
@media (max-width: 768px) {
    .sg-spin-wheel-modal .sg-modal-content {
        width: 95%;
        margin: 10% auto;
        padding: 15px;
    }
    
    .sg-spin-wheel-modal .sg-modal-header h2 {
        font-size: 1.5rem;
    }
    
    .sg-spin-wheel-modal .sg-tab-btn {
        padding: 10px 15px;
        font-size: 0.9rem;
    }
    
    .sg-spin-wheel-modal .sg-wheel-outer-rim {
        width: 280px;
        height: 280px;
    }
    
    .sg-spin-wheel-modal .sg-wheel-wrapper {
        width: 240px;
        height: 240px;
    }
    
    .sg-spin-wheel-modal .sg-prize-text {
        font-size: 12px;
    }
    
    .sg-spin-wheel-modal .sg-wheel-center {
        width: 50px;
        height: 50px;
    }
    
    .sg-spin-wheel-modal .sg-spin-info {
        flex-direction: column;
        align-items: flex-start;
        gap: 15px;
    }
    
    .sg-spin-wheel-modal .sg-cost-badge {
        flex-direction: row;
        width: 100%;
        justify-content: space-between;
    }
    
    .sg-spin-wheel-modal .sg-prize-info {
        padding-left: 0;
    }
}

@media (max-width: 480px) {
    .sg-spin-wheel-modal .sg-modal-tabs {
        flex-direction: column;
        gap: 5px;
    }
    
    .sg-spin-wheel-modal .sg-tab-btn {
        width: 100%;
        border-bottom: none;
        border-left: 3px solid transparent;
        text-align: left;
        padding: 10px;
    }
    
    .sg-spin-wheel-modal .sg-tab-btn.active {
        border-bottom: none;
        border-left: 3px solid #3498db;
        background-color: #f8f9fa;
    }
    
    .sg-spin-wheel-modal .sg-wheel-outer-rim {
        width: 240px;
        height: 240px;
    }
    
    .sg-spin-wheel-modal .sg-wheel-wrapper {
        width: 200px;
        height: 200px;
    }
    
    .sg-spin-wheel-modal .sg-prize-text {
        font-size: 10px;
    }
    
    .sg-spin-result-modal .sg-modal-content {
        padding: 20px;
    }
    
    .sg-spin-result-modal .sg-result-actions {
        flex-direction: column;
        gap: 10px;
    }
}



    </style>

<style>
    /* Admin Buy Coin Support Styles */
    .admin-section {
      background-color: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      padding: 20px;
      margin-bottom: 30px;
    }
    
    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    
    .section-header h2 {
      margin: 0;
      color: #333;
      font-size: 1.5rem;
    }
    
    .pending-indicator {
      background-color: #f8f9fa;
      border-radius: 50%;
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      border: 2px solid #4CAF50;
    }
    
    .pending-count {
      color: #4CAF50;
      font-weight: bold;
      font-size: 16px;
    }
    
    /* Request List Styles */
    .request-list-container {
      border: 1px solid #e9ecef;
      border-radius: 6px;
      overflow: hidden;
    }
    
    .request-list-header {
      display: flex;
      background-color: #f8f9fa;
      padding: 12px 15px;
      font-weight: 600;
      color: #495057;
      border-bottom: 2px solid #e9ecef;
    }
    
    .header-item {
      flex: 1;
    }
    
    .header-item:last-child {
      flex: 1.5;
      text-align: center;
    }
    
    .request-list {
      max-height: 500px;
      overflow-y: auto;
    }
    
    .request-item {
      display: flex;
      padding: 15px;
      border-bottom: 1px solid #e9ecef;
      transition: background-color 0.3s;
      align-items: center;
    }
    
    .request-item:hover {
      background-color: #f8f9fa;
    }
    
    .request-item:last-child {
      border-bottom: none;
    }
    
    .request-data {
      flex: 1;
      padding: 0 5px;
    }
    
    .request-actions {
      flex: 1.5;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
    }
    
    .view-btn {
      background-color: #6c757d;
      color: white;
      border: none;
      padding: 6px 12px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      transition: background-color 0.3s;
    }
    
    .view-btn:hover {
      background-color: #5a6268;
    }
    
    .action-btn.approve {
      background-color: #4CAF50;
      color: white;
    }
    
    .action-btn.approve:hover {
      background-color: #45a049;
    }
    
    .action-btn.reject {
      background-color: #dc3545;
      color: white;
    }
    
    .action-btn.reject:hover {
      background-color: #c82333;
    }
    
    .action-btn.message {
      background-color: #ffc107;
      color: #212529;
    }
    
    .action-btn.message:hover {
      background-color: #e0a800;
    }
    
    /* Request Detail Popup Styles */
    .request-detail-popup {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0, 0, 0, 0.5);
    }
    
    .popup-content {
      background-color: #fefefe;
      margin: 5% auto;
      padding: 0;
      border-radius: 8px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
      width: 90%;
      max-width: 600px;
      position: relative;
      animation: popupFadeIn 0.3s;
    }
    
    @keyframes popupFadeIn {
      from {opacity: 0; transform: translateY(-20px);}
      to {opacity: 1; transform: translateY(0);}
    }
    
    .popup-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 20px;
      background-color: #f8f9fa;
      border-bottom: 1px solid #e9ecef;
      border-radius: 8px 8px 0 0;
    }
    
    .popup-header h3 {
      margin: 0;
      color: #333;
      font-size: 1.2rem;
    }
    
    .popup-controls {
      display: flex;
      gap: 10px;
    }
    
    .popup-control-btn {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      border: none;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 14px;
      font-weight: bold;
      transition: all 0.3s;
      background-color: #e9ecef;
      color: #495057;
    }
    
    .popup-control-btn:hover {
      background-color: #dee2e6;
    }
    
    .request-details {
      padding: 20px;
      border-bottom: 1px solid #e9ecef;
    }
    
    .detail-row {
      display: flex;
      margin-bottom: 12px;
      position: relative;
    }
    
    .detail-label {
      font-weight: 600;
      width: 40%;
      color: #495057;
    }
    
    .detail-value {
      flex: 1;
    }
    
    .balance-note {
      position: absolute;
      left: 0;
      bottom: -18px;
      font-size: 12px;
      color: #6c757d;
      font-style: italic;
    }
    
    .status-indicator {
      display: flex;
      align-items: center;
    }
    
    .status-pending {
      background-color: #ffc107;
      color: #212529;
      padding: 3px 8px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
    }
    
    .status-accepted {
      background-color: #4CAF50;
      color: white;
      padding: 3px 8px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
    }
    
    .status-rejected {
      background-color: #dc3545;
      color: white;
      padding: 3px 8px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
    }
    .screenshot-section {
  padding: 20px;
  border-bottom: 1px solid #e9ecef;
}

.screenshot-section h4 {
  margin-top: 0;
  margin-bottom: 15px;
  color: #495057;
}

.screenshots {
  display: flex;
  gap: 15px;
}

.screenshot-container {
  flex: 1;
}

.screenshot {
  background-color: #f8f9fa;
  border: 1px dashed #ced4da;
  border-radius: 6px;
  height: 150px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #6c757d;
  font-size: 14px;
  cursor: pointer;
  transition: all 0.3s;
}

.screenshot:hover {
  background-color: #e9ecef;
}

.popup-actions {
  padding: 20px;
}

.action-note {
  margin-bottom: 15px;
  color: #495057;
  font-size: 14px;
}

.action-buttons-large {
  display: flex;
  gap: 10px;
}

.action-btn-large {
  flex: 1;
  padding: 10px;
  border: none;
  border-radius: 4px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s;
}

.action-btn-large.approve {
  background-color: #4CAF50;
  color: white;
}

.action-btn-large.approve:hover {
  background-color: #45a049;
}

.action-btn-large.reject {
  background-color: #dc3545;
  color: white;
}

.action-btn-large.reject:hover {
  background-color: #c82333;
}

.action-btn-large.message {
  background-color: #ffc107;
  color: #212529;
}

.action-btn-large.message:hover {
  background-color: #e0a800;
}

/* Confirmation Dialog Styles */
.confirmation-dialog {
  display: none;
  position: fixed;
  z-index: 1100;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  overflow: auto;
  background-color: rgba(0, 0, 0, 0.5);
}

.dialog-content {
  background-color: #fefefe;
  margin: 15% auto;
  padding: 20px;
  border-radius: 8px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
  width: 90%;
  max-width: 400px;
  text-align: center;
  animation: dialogFadeIn 0.3s;
}

@keyframes dialogFadeIn {
  from {opacity: 0; transform: scale(0.9);}
  to {opacity: 1; transform: scale(1);}
}

.dialog-content h3 {
  margin-top: 0;
  color: #333;
}

.dialog-buttons {
  display: flex;
  justify-content: center;
  gap: 15px;
  margin-top: 20px;
}

.dialog-btn {
  padding: 8px 20px;
  border: none;
  border-radius: 4px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s;
}

.dialog-btn.confirm {
  background-color: #4CAF50;
  color: white;
}

.dialog-btn.confirm:hover {
  background-color: #45a049;
}

.dialog-btn.cancel {
  background-color: #6c757d;
  color: white;
}

.dialog-btn.cancel:hover {
  background-color: #5a6268;
}

/* Success Message Styles */
.success-message {
  display: none;
  position: fixed;
  z-index: 1100;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  overflow: auto;
  background-color: rgba(0, 0, 0, 0.5);
}

.message-content {
  background-color: #fefefe;
  margin: 15% auto;
  padding: 30px 20px;
  border-radius: 8px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
  width: 90%;
  max-width: 400px;
  text-align: center;
  animation: messageFadeIn 0.3s;
}

@keyframes messageFadeIn {
  from {opacity: 0; transform: scale(0.9);}
  to {opacity: 1; transform: scale(1);}
}

.success-icon {
  font-size: 50px;
  color: #4CAF50;
  margin-bottom: 15px;
}

.message-content h3 {
  margin-top: 0;
  color: #333;
}

.message-btn {
  margin-top: 20px;
  padding: 8px 20px;
  background-color: #4CAF50;
  color: white;
  border: none;
  border-radius: 4px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s;
}

.message-btn:hover {
  background-color: #45a049;
}

/* Responsive Adjustments */
@media (max-width: 768px) {
  .request-item {
    flex-direction: column;
    align-items: flex-start;
    padding: 15px 10px;
  }
  
  .request-data {
    width: 100%;
    padding: 5px 0;
  }
  
  .request-actions {
    width: 100%;
    justify-content: flex-start;
    margin-top: 10px;
  }
  
  .action-buttons-large {
    flex-direction: column;
  }
  
  .screenshots {
    flex-direction: column;
  }
  
  .popup-content {
    width: 95%;
    margin: 10% auto;
  }
  
  .dialog-content,
  .message-content {
    width: 95%;
  }
}

/* Status Styles */
.status-indicator {
  position: relative;
}

.status-accepted:before {
  content: "";
  margin-right: 5px;
}

.status-rejected:before {
  content: "";
  margin-right: 5px;
}

/* Animation for screenshot expansion */
.screenshot.expanded {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 80%;
  height: 80%;
  max-width: 800px;
  max-height: 600px;
  z-index: 1200;
  background-color: white;
  border: none;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
}

.screenshot.expanded img {
  width: 100%;
  height: 100%;
  object-fit: contain;
}

/* Overlay for expanded screenshot */
.screenshot-overlay {
  display: none;
  position: fixed;
  z-index: 1150;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.7);
}

/* Payment Proof Upload Styles */
.payment-proof-section {
  margin-bottom: 30px;
  padding: 20px;
  background-color: #f8f9fa;
  border-radius: 8px;
}

.payment-proof-section h3 {
  margin-top: 0;
  margin-bottom: 10px;
  color: #333;
}

.section-description {
  margin-bottom: 20px;
  color: #666;
}

.upload-container {
  display: flex;
  flex-wrap: wrap;
  gap: 20px;
  margin-bottom: 20px;
}

.upload-item {
  flex: 1;
  min-width: 200px;
}

.upload-label {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 20px;
  background-color: #fff;
  border: 2px dashed #ccc;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.3s ease;
}

.upload-label:hover {
  border-color: #007bff;
  background-color: #f0f7ff;
}

.upload-icon {
  font-size: 24px;
  color: #007bff;
  margin-bottom: 10px;
}

.upload-text {
  font-weight: 500;
  margin-bottom: 5px;
}

.upload-subtext {
  font-size: 12px;
  color: #666;
}

.file-input {
  display: none;
}

.preview-container {
  margin-top: 10px;
  position: relative;
  display: none;
}

.preview-container.has-image {
  display: block;
}

.image-preview {
  width: 100%;
  border-radius: 8px;
  border: 1px solid #ddd;
}

.image-preview.hidden {
  display: none;
}

.remove-btn {
  position: absolute;
  top: -10px;
  right: -10px;
  width: 24px;
  height: 24px;
  border-radius: 50%;
  background-color: #ff4d4f;
  color: white;
  border: none;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 12px;
}

.remove-btn:hover {
  background-color: #ff7875;
}

.upload-instructions {
  background-color: #fff;
  padding: 15px;
  border-radius: 8px;
  border-left: 4px solid #007bff;
}

.upload-instructions h4 {
  margin-top: 0;
  margin-bottom: 10px;
  color: #333;
}

.upload-instructions ul {
  margin: 0;
  padding-left: 20px;
}

.upload-instructions li {
  margin-bottom: 5px;
  color: #555;
}

/* ===== EVENTPHY PAGE STYLES ===== */
#eventphyPageContainer {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: #0a0a0f;
    color: white;
    z-index: 15000;
    overflow-y: auto;
    display: none;
}

.eventphy-hero-section {
    min-height: 70vh;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
}

.eventphy-hero-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(10, 10, 15, 0.8);
    backdrop-filter: blur(3px);
}

.eventphy-hero-content {
    position: relative;
    z-index: 2;
    text-align: center;
    padding: 50px 20px;
    max-width: 1000px;
    margin: 0 auto;
}

.eventphy-title {
    font-size: 4rem;
    font-weight: 700;
    margin-bottom: 25px;
    text-shadow: 3px 3px 6px rgba(0,0,0,0.7);
    background: linear-gradient(135deg, #ff6b6b, #4ecdc4);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.eventphy-description {
    font-size: 1.5rem;
    margin-bottom: 35px;
    max-width: 700px;
    margin-left: auto;
    margin-right: auto;
    opacity: 0.95;
    line-height: 1.6;
}

.eventphy-get-tickets-btn {
    background: linear-gradient(135deg, #ff6b6b, #ee5a52);
    color: white;
    padding: 18px 40px;
    border: none;
    border-radius: 50px;
    font-size: 1.3rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 10px 30px rgba(255, 107, 107, 0.4);
}

.eventphy-get-tickets-btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 15px 40px rgba(255, 107, 107, 0.6);
}

.eventphy-details-section {
    padding: 80px 20px;
    background: linear-gradient(180deg, #0a0a0f 0%, #1a1a2e 100%);
    max-width: 1200px;
    margin: 0 auto;
}

.eventphy-section-title {
    font-size: 3rem;
    text-align: center;
    margin-bottom: 50px;
    color: #fff;
    font-weight: 600;
}

.eventphy-info-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    gap: 40px;
    margin-bottom: 60px;
}

.eventphy-info-card {
    background: linear-gradient(135deg, #2d2d4a, #1e1e3a);
    padding: 40px;
    border-radius: 20px;
    border: 1px solid rgba(255, 107, 107, 0.1);
    transition: all 0.3s ease;
}

.eventphy-info-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 20px 40px rgba(255, 107, 107, 0.1);
    border-color: rgba(255, 107, 107, 0.3);
}

.eventphy-info-card h3 {
    font-size: 1.8rem;
    margin-bottom: 20px;
    color: #ff6b6b;
    display: flex;
    align-items: center;
    gap: 15px;
}

.eventphy-info-card p {
    font-size: 1.2rem;
    opacity: 0.9;
    line-height: 1.5;
}

.eventphy-tickets-section {
    background: #1a1a2e;
    padding: 60px 20px;
    margin: 40px 0;
    border-radius: 25px;
    border: 2px solid rgba(255, 107, 107, 0.2);
}

.eventphy-tickets-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 30px;
    max-width: 1000px;
    margin: 0 auto;
}

.eventphy-ticket-card {
    padding: 35px;
    border-radius: 15px;
    text-align: center;
    border: 1px solid rgba(78, 205, 196, 0.2);
    transition: all 0.3s ease;
}

.eventphy-ticket-card:hover {
    transform: scale(1.05);
    border-color: rgba(78, 205, 196, 0.5);
    box-shadow: 0 15px 30px rgba(78, 205, 196, 0.2);
}

.eventphy-ticket-type {
    font-size: 1.5rem;
    font-weight: 600;
    color: #4ecdc4;
    margin-bottom: 15px;
}

.eventphy-ticket-price {
    font-size: 2.2rem;
    font-weight: bold;
    color: #fff;
    margin-bottom: 20px;
}

.eventphy-sponsors-section {
    background: #0f0f1a;
    padding: 60px 20px;
    margin: 40px 0;
    border-radius: 25px;
}

.eventphy-sponsors-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 30px;
    max-width: 1000px;
    margin: 0 auto;
}

.eventphy-sponsor-item {
    background: rgba(255, 255, 255, 0.05);
    padding: 30px;
    border-radius: 15px;
    text-align: center;
    transition: all 0.3s ease;
}

.eventphy-sponsor-item:hover {
    background: rgba(255, 255, 255, 0.1);
    transform: translateY(-3px);
}

.eventphy-sponsor-logo {
    width: 80px;
    height: 80px;
    margin: 0 auto 15px;
    border-radius: 12px;
    object-fit: cover;
}

.eventphy-sponsor-name {
    font-size: 1.1rem;
    font-weight: 500;
    color: #fff;
}

.eventphy-rewarder-brand {
    text-align: center;
    padding: 60px 20px;
    background: linear-gradient(135deg, #ff6b6b, #4ecdc4);
    margin-top: 40px;
    border-radius: 20px;
}

.eventphy-brand-content {
    display: flex;
    flex-direction: column;
    gap: 30px;
    align-items: center;
    max-width: 800px;
    margin: 0 auto;
}

.eventphy-brand-logo h3 {
    font-size: 2.5rem;
    margin-bottom: 10px;
    color: white;
    font-weight: 700;
}

.eventphy-brand-tagline {
    font-size: 1.3rem;
    margin-bottom: 20px;
    color: white;
    opacity: 0.95;
}

.eventphy-brand-cta {
    text-align: center;
}

.eventphy-cta-text {
    font-size: 1.2rem;
    color: white;
    margin-bottom: 20px;
    opacity: 0.9;
    font-weight: 500;
}

.eventphy-signup-btn {
    background: white;
    color: #ff6b6b;
    padding: 15px 30px;
    border: none;
    border-radius: 50px;
    font-size: 1.1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
    display: inline-flex;
    align-items: center;
    gap: 10px;
}

.eventphy-signup-btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 12px 35px rgba(0, 0, 0, 0.3);
}

.eventphy-signup-btn i {
    font-size: 1.2rem;
}

.eventphy-modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 20000;
}

.eventphy-modal {
    background: linear-gradient(135deg, #2d2d4a, #1e1e3a);
    padding: 40px;
    border-radius: 20px;
    max-width: 500px;
    width: 90%;
    text-align: center;
    border: 2px solid rgba(255, 107, 107, 0.3);
}

.eventphy-modal h3 {
    font-size: 1.8rem;
    margin-bottom: 20px;
    color: #ff6b6b;
}

.eventphy-copy-section {
    background: rgba(0, 0, 0, 0.3);
    padding: 20px;
    border-radius: 12px;
    margin: 25px 0;
    border: 1px solid rgba(255, 107, 107, 0.2);
}

.eventphy-copy-text {
    font-size: 1.1rem;
    color: #4ecdc4;
    font-weight: 600;
    margin-bottom: 15px;
    word-break: break-all;
}

.eventphy-copy-btn {
    background: #4ecdc4;
    color: white;
    border: none;
    padding: 12px 25px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
    transition: all 0.3s ease;
}

.eventphy-copy-btn:hover {
    background: #45b7aa;
    transform: translateY(-2px);
}

.eventphy-modal-instructions {
    margin: 25px 0;
    text-align: left;
    background: rgba(0, 0, 0, 0.2);
    padding: 20px;
    border-radius: 10px;
}

.eventphy-modal-instructions h4 {
    color: #4ecdc4;
    margin-bottom: 15px;
    font-size: 1.1rem;
    display: flex;
    align-items: center;
    gap: 8px;
}

.eventphy-modal-instructions ol {
    color: white;
    padding-left: 20px;
}

.eventphy-modal-instructions li {
    margin-bottom: 8px;
    font-size: 0.95rem;
    line-height: 1.4;
}

.eventphy-modal-actions {
    display: flex;
    gap: 15px;
    margin-top: 25px;
}

.eventphy-modal-btn {
    flex: 1;
    padding: 12px;
    border: none;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
}

.eventphy-primary-btn {
    background: #ff6b6b;
    color: white;
}

.eventphy-primary-btn:hover {
    background: #ee5a52;
}

.eventphy-secondary-btn {
    background: rgba(255, 255, 255, 0.1);
    color: white;
    border: 1px solid rgba(255, 255, 255, 0.2);
}

.eventphy-secondary-btn:hover {
    background: rgba(255, 255, 255, 0.2);
}

.eventphy-loading {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 100vh;
    background: #0a0a0f;
}

.eventphy-loading i {
    font-size: 3rem;
    color: #ff6b6b;
    animation: spin 1s linear infinite;
    margin-bottom: 20px;
}

.eventphy-loading h2 {
    color: #fff;
    font-size: 1.5rem;
}

.eventphy-error {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 100vh;
    background: #0a0a0f;
    text-align: center;
    padding: 20px;
}

.eventphy-error i {
    font-size: 4rem;
    color: #ff6b6b;
    margin-bottom: 20px;
}

.eventphy-error h2 {
    color: #fff;
    font-size: 2rem;
    margin-bottom: 15px;
}

.eventphy-error p {
    color: #ccc;
    font-size: 1.1rem;
    max-width: 500px;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

@media (max-width: 768px) {
    .eventphy-title {
        font-size: 2.5rem;
    }
    
    .eventphy-description {
        font-size: 1.2rem;
    }
    
    .eventphy-info-grid {
        grid-template-columns: 1fr;
        gap: 25px;
    }
    
    .eventphy-tickets-grid {
        grid-template-columns: 1fr;
    }
    
    .eventphy-sponsors-grid {
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
    }
}

/* ===== EVENT PAGE STYLES ===== */
#eventPageContainer {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: #1a1a2e;
    color: white;
    z-index: 10000;
    overflow-y: auto;
}

.event-hero-section {
    min-height: 60vh;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
}

.event-hero-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(26, 26, 46, 0.7);
    backdrop-filter: blur(2px);
}

.event-hero-content {
    position: relative;
    z-index: 2;
    text-align: center;
    padding: 40px 20px;
    max-width: 1200px;
    margin: 0 auto;
}

.event-title {
    font-size: 3.5rem;
    font-weight: bold;
    margin-bottom: 20px;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
}

.event-description {
    font-size: 1.4rem;
    margin-bottom: 30px;
    max-width: 800px;
    margin-left: auto;
    margin-right: auto;
    opacity: 0.9;
}

.event-details-section {
    padding: 60px 20px;
    background: #1a1a2e;
    max-width: 1200px;
    margin: 0 auto;
}

.event-section-title {
    font-size: 2.5rem;
    text-align: center;
    margin-bottom: 40px;
    color: #fff;
}

.event-info-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 30px;
    margin-bottom: 50px;
}

.event-info-card {
    background: #2d2d4a;
    padding: 30px;
    border-radius: 15px;
    border: 1px solid #3a3a5c;
    text-align: center;
}

.event-info-card i {
    font-size: 2.5rem;
    color: #4CAF50;
    margin-bottom: 15px;
}

.event-info-card h3 {
    font-size: 1.5rem;
    margin-bottom: 10px;
    color: #fff;
}

.event-info-card p {
    font-size: 1.1rem;
    opacity: 0.9;
}

.event-tickets-section {
    padding: 60px 20px;
    background: #16213e;
    max-width: 1200px;
    margin: 0 auto;
}

.event-tickets-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 20px;
    margin-bottom: 40px;
}

.event-ticket-card {
    background: #2d2d4a;
    padding: 25px;
    border-radius: 12px;
    border: 2px solid #3a3a5c;
    text-align: center;
    transition: transform 0.3s ease, border-color 0.3s ease;
}

.event-ticket-card:hover {
    transform: translateY(-5px);
    border-color: #4CAF50;
}

.event-ticket-name {
    font-size: 1.4rem;
    font-weight: bold;
    margin-bottom: 10px;
    color: #fff;
}

.event-ticket-price {
    font-size: 2rem;
    font-weight: bold;
    color: #4CAF50;
}

.event-get-tickets-btn {
    background: linear-gradient(135deg, #4CAF50, #45a049);
    color: white;
    border: none;
    padding: 15px 40px;
    font-size: 1.2rem;
    font-weight: bold;
    border-radius: 50px;
    cursor: pointer;
    transition: all 0.3s ease;
    margin: 20px auto;
    display: block;
    box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
}

.event-get-tickets-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
}

.event-sponsors-section {
    padding: 60px 20px;
    background: #1a1a2e;
    max-width: 1200px;
    margin: 0 auto;
}

.event-sponsors-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 30px;
    margin-bottom: 40px;
}

.event-sponsor-card {
    background: #2d2d4a;
    padding: 20px;
    border-radius: 12px;
    text-align: center;
    border: 1px solid #3a3a5c;
}

.event-sponsor-logo {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    margin: 0 auto 15px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: #fff;
}

.event-sponsor-logo img {
    max-width: 60px;
    max-height: 60px;
    object-fit: contain;
}

.event-sponsor-logo i {
    font-size: 2rem;
    color: #666;
}

.event-sponsor-name {
    font-size: 1.1rem;
    font-weight: bold;
    margin-bottom: 10px;
}

.event-sponsor-website {
    color: #4CAF50;
    text-decoration: none;
    font-size: 0.9rem;
}

.event-sponsor-website:hover {
    text-decoration: underline;
}

.event-branding-section {
    padding: 60px 20px;
    background: #16213e;
    text-align: center;
    max-width: 1200px;
    margin: 0 auto;
}

.event-rewarder-logo {
    width: 120px;
    height: 120px;
    margin: 0 auto 20px;
    background: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 20px;
}

.event-rewarder-logo img {
    max-width: 100%;
    max-height: 100%;
    object-fit: contain;
}

.event-branding-text {
    font-size: 1.3rem;
    margin-bottom: 30px;
    opacity: 0.9;
}

.event-cta-note {
    font-size: 1.5rem;
    margin-bottom: 20px;
    color: #4CAF50;
    font-weight: bold;
}

.event-signup-btn {
    background: linear-gradient(135deg, #FF6B6B, #ee5a52);
    color: white;
    border: none;
    padding: 15px 40px;
    font-size: 1.2rem;
    font-weight: bold;
    border-radius: 50px;
    cursor: pointer;
    transition: all 0.3s ease;
    text-decoration: none;
    display: inline-block;
    box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
}

.event-signup-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(255, 107, 107, 0.4);
}

.event-modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 11000;
}

.event-modal {
    background: #2d2d4a;
    border-radius: 15px;
    padding: 40px;
    max-width: 500px;
    width: 90%;
    text-align: center;
    border: 1px solid #3a3a5c;
}

.event-modal h3 {
    font-size: 1.8rem;
    margin-bottom: 20px;
    color: #4CAF50;
}

.event-modal p {
    font-size: 1.1rem;
    margin-bottom: 20px;
    opacity: 0.9;
}

.event-copy-section {
    background: #1a1a2e;
    padding: 20px;
    border-radius: 10px;
    margin: 20px 0;
    border: 2px dashed #4CAF50;
}

.event-name-display {
    font-size: 1.4rem;
    font-weight: bold;
    margin-bottom: 15px;
    color: #4CAF50;
}

.event-copy-btn {
    background: #4CAF50;
    color: white;
    border: none;
    padding: 10px 25px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 1rem;
    transition: background 0.3s ease;
}

.event-copy-btn:hover {
    background: #45a049;
}

.event-modal-actions {
    display: flex;
    gap: 15px;
    justify-content: center;
    margin-top: 25px;
}

.event-close-btn {
    background: #666;
    color: white;
    border: none;
    padding: 12px 25px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 1rem;
}

.event-close-btn:hover {
    background: #555;
}

.event-loading {
    text-align: center;
    padding: 100px 20px;
    color: white;
}

.event-loading i {
    font-size: 3rem;
    color: #4CAF50;
    animation: spin 1s linear infinite;
    margin-bottom: 20px;
}

.event-error {
    text-align: center;
    padding: 100px 20px;
    color: white;
}

.event-error i {
    font-size: 4rem;
    color: #ff6b6b;
    margin-bottom: 20px;
}

.event-error h2 {
    font-size: 2rem;
    margin-bottom: 15px;
}

.event-error p {
    font-size: 1.2rem;
    opacity: 0.8;
}

@media (max-width: 768px) {
    .event-title {
        font-size: 2.5rem;
    }
    
    .event-description {
        font-size: 1.2rem;
    }
    
    .event-section-title {
        font-size: 2rem;
    }
    
    .event-info-grid {
        grid-template-columns: 1fr;
    }
    
    .event-tickets-grid {
        grid-template-columns: 1fr;
    }
    
    .event-sponsors-grid {
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    }
    
    .event-modal {
        padding: 30px 20px;
    }
    
    .event-modal-actions {
        flex-direction: column;
    }
}

</style>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    
             
       
    <!-- Event Page Section (Hidden by default) -->
    <div id="eventPageContainer" style="display: none;">
        <div id="eventPageContent">
            <!-- Loading state -->
            <div class="event-loading" id="eventLoadingState">
                <i class="fas fa-spinner"></i>
                <h2>Loading Event...</h2>
            </div>
        </div>

        <!-- Get Tickets Modal -->
        <div class="event-modal-overlay" id="eventTicketsModal">
            <div class="event-modal">
                <h3><i class="fas fa-ticket-alt"></i>  View Event</h3>
                <p>To purchase tickets for this event, copy the event name below and paste it in the search bar of the Rewarder app.</p>
                
                <div class="event-copy-section">
                    <div class="event-name-display" id="modalEventName">Event Name</div>
                    <button class="event-copy-btn" onclick="copyEventNameFromModal()">
                        <i class="fas fa-copy"></i> Copy Event Name
                    </button>
                </div>
                
                <p style="font-size: 0.9rem; opacity: 0.7;">Don't have the Rewarder app? Sign up now!</p>
                
                <div class="event-modal-actions">
                    <button class="event-close-btn" onclick="closeEventModal()">Close</button>
                    <a href="https://rewarder-hub.vercel.app" class="event-signup-btn" style="text-decoration: none;">
                        <i class="fas fa-user-plus"></i> Sign Up
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- ========== ULTRA-PREMIUM OPENING PAGE v2.0 ========== -->
<div class="openpage" id="openingPage">
   
    
    <!-- Scroll Progress Indicator -->
    <div class="scroll-progress">
        <div class="progress-bar">
            <div class="progress-fill" id="scrollProgress"></div>
        </div>
        <div class="progress-badge" id="progressBadge">0%</div>
    </div>
    
   
    
    <!-- Enhanced Glassmorphism Header -->
    <header class="openpage-header">
        <div class="openpage-logo-section">
           <h1 class="openpage-app-name">Rewarder</h1>
        </div>
        <button class="openpage-theme-toggle" onclick="toggleOpenPageTheme()">
            <span id="openpage-theme-icon"></span>
            <span id="openpage-theme-text">Premium Mode</span>
        </button>
    </header>

    <div class="openpage-container">
        <!-- Enhanced Slideshow -->
        <section class="openpage-slideshow">
            <div class="openpage-slide active">
                <div class="openpage-slide-content">
                    <h2 class="openpage-slide-title">Welcome to Rewarder</h2>
                    <p class="openpage-slide-caption">The Future of Event Management Has Arrived</p>
                    <div class="openpage-slide-slogan">Life of the Party</div>
                    <button class="openpage-get-started" onclick="enterApp()">
                        <span>Get Started</span>
                    </button>
                </div>
            </div>
             
 
        
            <div class="openpage-slide">
                <div class="openpage-slide-content">
                    <h2 class="openpage-slide-title">Create Epic Events</h2>
                    <p class="openpage-slide-caption">From Underground Battles to Stadium Concerts</p>
                    <div class="openpage-slide-slogan">Life of the Party</div>
                    <button class="openpage-get-started" onclick="enterApp()">
                        <span>Join Revolution</span>
                    </button>
                </div>
            </div>
            <div class="openpage-slide">
                <div class="openpage-slide-content">
                    <h2 class="openpage-slide-title">Users Waiting</h2>
                    <p class="openpage-slide-caption">Be Part of the Most Anticipated Launch</p>
                    <div class="openpage-slide-slogan">Life of the Party</div>
                    <button class="openpage-get-started" onclick="enterApp()">
                        <span>Enter Now</span>
                    </button>
                </div>
            </div>
        </section>

         <!-- Curved Auto-Scrolling Gallery 2 -->
        <section class="curved-gallery">
            <div class="gallery-header">
                <h3 class="gallery-title">Create Event </h3>
                <p class="gallery-subtitle">See what's coming</p>
            </div>
            <div class="curved-track" id="appGallery">
                <div class="galleryonly-item">
                   <img src="https://i.ibb.co/tpNVMDrZ/Fast-Withdrawal-s-20250806-044937-0000.png" alt="Fast-Withdrawal-s-20250806-044937-0000" border="0">
                    <div class="gallery-caption">Create Event</div>
                        <div class="gallery-description">Bring Your Party and Creativity  to life</div>
                    
                </div>
               </div>
               
              
        </section>
 <!-- DJ Music Player Section -->
        <section class="dj-section">
            <div class="dj-container">
                <div class="dj-header">
                    <h2 class="dj-title"> DJ Zone</h2>
                    <p class="dj-subtitle"> Nigerian Hits</p>
                </div>
                
                <div class="music-player">
                    <div class="now-playing">
                        <div class="song-info">
                            <div class="song-title" id="currentSong">Loading...</div>
                            <div class="song-artist" id="currentArtist">Trending Artist</div>
                        </div>
                    </div>
                    
                    <div class="player-controls">
                        <button class="control-btn" id="prevBtn"></button>
                        <button class="control-btn" id="muteBtn"></button>
                        <button class="control-btn play-btn" id="playBtn"></button>
                        <button class="control-btn" id="nextBtn"></button>
                    </div>
                    
                    <div class="progress-container" id="progressContainer">
                        <div class="progress-bar-music" id="progressBar"></div>
                    </div>
                    
                    <div class="trending-list">
                        <h4 class="trending-title"> Gbedu Dj</h4>
                        <div class="song-list" id="songList">
                            
                            
                        </div>
                    </div>
                </div>
            </div>
        </section>

     
               

        <!-- Curved Auto-Scrolling Gallery 1 -->
        <section class="curved-gallery">
            <div class="gallery-header">
                <h3 class="gallery-title">Upcoming Events</h3>
                <p class="gallery-subtitle"> Get your tickets Ready </p>
            </div>
            <div class="curved-track" id="eventsGallery">
                <div class="gallery-item">
                    <img src="https://i.ibb.co/DH8J39my/Fast-Withdrawal-s-20250806-042833-0000.png" alt="Concert">
                    <div class="gallery-overlay">
                        <div class="gallery-caption">Award&Faaji Night</div>
                        <div class="gallery-description"> Owanbe Edition </div>
                         <div class="gallery-date">Anticipating</div>
                        <div class="gallery-ticket"> Not Free </div>
                               <div class="gallery-contact"> Contact Us +234 8029941678 to Connect You  </div>
                 
                    </div>
                </div>
                <div class="gallery-item">
                  <img src=" https://i.ibb.co/9kQb2chQ/Fast-Withdrawal-s-20250806-042109-0000.png" alt="Concert">
                    <div class="gallery-overlay">
                        <div class="gallery-caption">SSOHIS DINNER AND AWARD NIGHT</div>
                        <div class="gallery-description">Diplomacy and Dine</div>
                        <div class="gallery-date">Anticipating</div>
                        <div class="gallery-ticket"> Not Free </div>
                        <div class="gallery-contact"> Contact Us +234 8029941678 to Connect You  </div>
                    </div>
                </div>
                
                
            </div>
        </section>

        <!-- Premium Quotes -->
        <section class="openpage-section openpage-quotes">
           
            <h2>What Legends Say</h2>
            <div class="openpage-quote-item">"This isn't just an app, it's a cultural revolution."</div>
            <div class="openpage-quote-item">"Rewarder made our underground event legendary."</div>
            <div class="openpage-quote-item">" users can't be wrong - this is the future."</div>
        </section>
<section class="curved-gallery">
            <div class="gallery-header">
                <h3 class="gallery-title">Best Ticket System </h3>
                <p class="gallery-subtitle">See what's coming</p>
            </div>
            <div class="curved-track" id="appGallery">
                
                <div class="gallery-item">
                    <img src="https://i.ibb.co/5hrNmSgM/Fast-Withdrawal-s-20250806-044026-0000.png" alt="Ticket Booking">
                          <div class="gallery-overlay">
                    
                <div class="gallery-caption">Purchase Ticket</div>
                        <div class="gallery-description">Seamless experience with Low fee </div>
                 </div>   
                </div>
           
        </section>
        <!-- Live Photo Strip -->
        <section class="live-strip">
            <div class="strip-header">
                <h3 class="strip-title">Summits</h3>
                
            </div>
            <div class="photo-strip">
            <div class="gallery-item">
                 
                <img src=" https://i.ibb.co/tp6T2hjc/Fast-Withdrawal-s-20250806-040305-0000.png"alt="Event 1">
                    <div class="photo-overlay">Tarf Foundation</div>
                </div>
               <p class="strip-subtitle">NGO doings</p>
                
                
               
            </div>
        </section>
 
      
        <!-- Elite Sponsors -->
        <section class="openpage-section openpage-sponsors">
            <h2>Backed by Giants</h2>
            <div class="openpage-sponsors-grid">
                
                <div class="openpage-sponsor-logo">  Contact us for Sponsorship deals </div>
            </div>
        </section>


        <!-- Pricing Section -->
        <section class="pricing-section">
            <div class="pricing-container">
                <div class="pricing-header">
                    <h2 class="pricing-title">Transparent Pricing</h2>
                    <p class="pricing-subtitle">No hidden fees, just fair pricing</p>
                </div>
                
                <div class="pricing-highlight">
                    <div class="price-badge">Only 50</div>
                    <h3>Per Ticket Transaction</h3>
                    <p>That's all we charge! Keep 95% of your earnings.</p>
                </div>
                
                <div class="pricing-features">
                    <div class="feature-item">
                        <div class="feature-icon"></div>
                        <h4>Unlimited Events</h4>
                        <p>Create as many events as you want</p>
                    </div>
                    <div class="feature-item">
                        <div class="feature-icon"></div>
                        <h4>Instant Payouts</h4>
                        <p>Get paid within minutes of ticket sales</p>
                    </div>
                    <div class="feature-item">
                        <div class="feature-icon"></div>
                        <h4>Mobile First</h4>
                        <p>Optimized for mobile users</p>
                    </div>
                    <div class="feature-item">
                        <div class="feature-icon"></div>
                        <h4>Secure Payments with Flutterwave </h4>
                        <p>Bank-level security for all transactions</p>
                    </div>
                </div>
            </div>
        </section>
<!-- Ticket Pricing Calculator Section -->
<section class="pricing-calculator">
    <div class="pricing-header">
        <h3 class="pricing-title">Ticket Pricing Calculator</h3>
        <p class="pricing-subtitle">Calculate fees for your event tickets</p>
    </div>
    
    <div class="pricing-container">
        <div class="price-input-section">
            <label for="ticketPrice" class="price-label">Ticket Price ()</label>
            <input 
                type="number" 
                id="ticketPrice" 
                class="price-input" 
                placeholder="Enter ticket price (min: 100)"
                min="100"
                max="100000000"
            >
            <button onclick="calculateFee()" class="calculate-btn">Calculate Fee</button>         
                </div>
        
        <div class="fee-display" id="feeDisplay" style="display: none;">
            <div class="fee-breakdown">
                <h4>Fee Breakdown</h4>
                <div class="fee-item">
                    <span class="fee-label">Ticket Price:</span>
                    <span class="fee-value" id="displayTicketPrice">0</span>
                </div>
                <div class="fee-item">
                    <span class="fee-label">Platform Fee:</span>
                    <span class="fee-value" id="displayPlatformFee">0</span>
                </div>
                <div class="fee-item" id="gatewayFeeItem" style="display: none;">
                    <span class="fee-label">Payment Gateway Fee:</span>
                    <span class="fee-value" id="displayGatewayFee">0</span>
                </div>
                <div class="fee-item total-fee">
                    <span class="fee-label">Total Fee:</span>
                    <span class="fee-value" id="displayTotalFee">0</span>
                </div>
                <div class="fee-item final-price">
                    <span class="fee-label">Customer Pays:</span>
                    <span class="fee-value" id="displayFinalPrice">0</span>
                </div>
            </div>
        </div>
        
        <div class="pricing-tiers">
            <h4>Pricing Tiers</h4>
            <div class="tier-list">
                <div class="tier-item">
                    <span class="tier-range">100 - 500</span>
                    <span class="tier-fee">50 + 3 per 100</span>
                </div>
                <div class="tier-item">
                    <span class="tier-range">600 - 1,000</span>
                    <span class="tier-fee">100</span>
                </div>
                <div class="tier-item">
                    <span class="tier-range">1,001 - 1,999</span>
                    <span class="tier-fee">150</span>
                </div>
                <div class="tier-item">
                    <span class="tier-range">2,000 - 3,000</span>
                    <span class="tier-fee">200</span>
                </div>
                <div class="tier-item">
                    <span class="tier-range">3,001 - 4,000</span>
                    <span class="tier-fee">250</span>
                </div>
                <div class="tier-item">
                    <span class="tier-range">4,001+</span>
                    <span class="tier-fee">+50 per 1,000</span>
                </div>
            </div>
        </div>
    </div>
</section>

        <!-- Insane Reviews -->
        <section class="openpage-section openpage-reviews">
            <h2> Users</h2>
            <div class="openpage-reviews-grid">
                <div class="openpage-review-card">
                    <p class="openpage-review-text">"I've been waiting 3 months for this update. Finally, an app that understands creators!"</p>
                    <p class="openpage-review-author">- Lagos Creative Director</p>
                </div>
                <div class="openpage-review-card">
                    <p class="openpage-review-text">"This update is insane! The UI is so smooth, I can't stop using it."</p>
                    <p class="openpage-review-author">- FUTA Tech Student</p>
                </div>
                <div class="openpage-review-card">
                    <p class="openpage-review-text">"My event sold out in 2 minutes using Rewarder. This is next level!"</p>
                    <p class="openpage-review-author">- Abuja Event Mogul</p>
                </div>
            </div>
        </section>

        <!-- Enhanced Action Buttons -->
        <section class="openpage-section openpage-actions">
            <div class="actions-header">
                <h2 class="actions-title">Ready to Dominate?</h2>
                <p style="font-size: 1.4rem; opacity: 0.8;">Join the revolution that's changing events forever</p>
            </div>
            <div class="openpage-actions-grid">
                <div class="openpage-action-button" onclick="enterApp()">
                    <div class="action-icon"></div>
                    <div class="action-title">Create Epic Events</div>
                    <div class="action-description">Launch events that break the internet. From intimate gatherings to massive festivals.</div>
                </div>
                <div class="openpage-action-button" onclick="enterApp()">
                    <div class="action-icon"></div>
                    <div class="action-title">Sell Premium Products</div>
                    <div class="action-description">Transform your brand into a money-making machine with our advanced tools.</div>
                </div>
                <div class="openpage-action-button" onclick="enterApp()">
                    <div class="action-icon"></div>
                    <div class="action-title">Get Sponsorship</div>
                    <div class="action-description">Connect with us to invest in your Event
                         Contact us for Sponsorship deals.</div>
                </div>
            </div>
        </section>
    </div>
</div>

    <div class="container" id="mainAppContainer">
        
        <div class="split-screen">
            <div class="left">
                <div class="logo">
                    <h1>Rewarder</h1>
                </div>
                <div class="tagline">
                    <h2>Discover Talent. Vote. Win.</h2>
                    <p>Create Events !</p>
                </div>
                <div class="features">
                    <div class="feature">
                        <i class="fas fa-trophy"></i>
                        <span>Sell Tickets </span>
                    </div>
                    <div class="feature">
                        <i class="fas fa-vote-yea"></i>
                        <span>Send withdrawal Request and you cashout in Minutes</span>
                    </div>
                    <div class="feature">
                        <i class="fas fa-coins"></i>
                        <span>Win cash prizes and recognition</span>
                    </div>
                </div>
            </div>
            <div class="right">
                <div class="auth-container" id="loginForm">
                    <h2>Welcome Back</h2>
                    <p>Sign in to continue your journey</p>
                    
                    <div class="social-login">
                        <button class="social-btn google-btn">
                           <img src="https://i.ibb.co/wZqXcy6z/thegogglelogo.png" alt="thegogglelogo" border="0">
                            <span>Continue with Google</span>
                        </button>
                    </div>
                    
                    <div class="divider">
                        <span>or sign in with email</span>
                    </div>
                    
                    <form id="loginFormElement">
                        <div class="form-group">
                            <label for="loginEmail">Email</label>
                            <input type="email" id="loginEmail" placeholder="Enter your email" required>
                        </div>
                        <div class="form-group">
                            <label for="loginPassword">Password</label>
                            <div class="password-input">
                                <input type="password" id="loginPassword" placeholder="Enter your password" required>
                                <i class="fas fa-eye-slash toggle-password"></i>
                            </div>
                        </div>
                        <div class="form-options">
                            <div class="remember-me">
                                <input type="checkbox" id="remember">
                                <label for="remember">Remember me</label>
                            </div>
                            <a href="#" class="forgot-password">Forgot password?</a>
                        </div>
                        <button type="submit" class="auth-btn">Sign In</button>
                    </form>
                    
                    <div class="auth-switch">
                        <p>Don't have an account? <a href="#" id="showSignup">Sign up</a></p>
                    </div>


                    
<!-- Footer for Rewarder Event & Ticket App -->
<footer style="
    background: linear-gradient(135deg, #1a1a2e 100%, #16213e 0%, #0f3460 100%);
    color: white;
    padding: 60px 0 20px 0;
    margin-top: 80px;
    position: relative;
    overflow: hidden;
">
    <!-- Background Elements -->
    <div style="
        position: absolute;
        top: -50px;
        right: -50px;
        width: 200px;
        height: 200px;
        background: rgba(108, 92, 231, 0.1);
        border-radius: 50%;
        z-index: 0;
    "></div>
    <div style="
        position: absolute;
        bottom: -30px;
        left: -30px;
        width: 150px;
        height: 150px;
        background: rgba(253, 121, 168, 0.1);
        border-radius: 50%;
        z-index: 0;
    "></div>

    <div style="
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 20px;
        position: relative;
        z-index: 1;
    ">
        <!-- Main Footer Content -->
        <div style="
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 40px;
            margin-bottom: 40px;
        ">
            
            <!-- Brand Section -->
            <div style="
                background: rgba(255, 255, 255, 0.05);
                padding: 30px;
                border-radius: 15px;
                border: 1px solid rgba(255, 255, 255, 0.1);
                backdrop-filter: blur(10px);
            ">
                <div style="
                    display: flex;
                    align-items: center;
                    margin-bottom: 20px;
                ">
                    <div style="
                        width: 50px;
                        height: 50px;
                        background: linear-gradient(135deg, #6c5ce7, #fd79a8);
                        border-radius: 12px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        margin-right: 15px;
                    ">
                        <i class="fas fa-ticket-alt" style="font-size: 24px; color: white;"></i>
                    </div>
                    <h3 style="
                        font-size: 28px;
                        font-weight: 700;
                        margin: 0;
                        background: linear-gradient(135deg, #6c5ce7, #fd79a8);
                        -webkit-background-clip: text;
                        -webkit-text-fill-color: transparent;
                        background-clip: text;
                    ">Rewarder</h3>
                </div>
                <p style="
                    color: rgba(255, 255, 255, 0.8);
                    line-height: 1.6;
                    margin-bottom: 20px;
                    font-size: 14px;
                ">
                    The ultimate platform for monetized talent competitions and event management. 
                    Create, discover, and participate in amazing events with seamless ticket booking.
                </p>
                
                <!-- Social Media Links -->
                <div style="display: flex; gap: 15px; margin-top: 20px;">
                    <a href="#" onclick="openSocialLink('facebook')" style="
                        width: 40px;
                        height: 40px;
                        background: rgba(255, 255, 255, 0.1);
                        border-radius: 50%;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        color: white;
                        text-decoration: none;
                        transition: all 0.3s ease;
                        border: 1px solid rgba(255, 255, 255, 0.2);
                    " onmouseover="this.style.background='#3b5998'; this.style.transform='translateY(-3px)'" 
                       onmouseout="this.style.background='rgba(255, 255, 255, 0.1)'; this.style.transform='translateY(0)'">
                        <i class="fab fa-facebook-f"></i>
                    </a>
                    <a href="#" onclick="openSocialLink('twitter')" style="
                        width: 40px;
                        height: 40px;
                        background: rgba(255, 255, 255, 0.1);
                        border-radius: 50%;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        color: white;
                        text-decoration: none;
                        transition: all 0.3s ease;
                        border: 1px solid rgba(255, 255, 255, 0.2);
                    " onmouseover="this.style.background='#1da1f2'; this.style.transform='translateY(-3px)'" 
                       onmouseout="this.style.background='rgba(255, 255, 255, 0.1)'; this.style.transform='translateY(0)'">
                        <i class="fab fa-twitter"></i>
                    </a>
                    <a href="#" onclick="openSocialLink('instagram')" style="
                        width: 40px;
                        height: 40px;
                        background: rgba(255, 255, 255, 0.1);
                        border-radius: 50%;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        color: white;
                        text-decoration: none;
                        transition: all 0.3s ease;
                        border: 1px solid rgba(255, 255, 255, 0.2);
                    " onmouseover="this.style.background='linear-gradient(45deg, #f09433 0%,#e6683c 25%,#dc2743 50%,#cc2366 75%,#bc1888 100%)'; this.style.transform='translateY(-3px)'" 
                       onmouseout="this.style.background='rgba(255, 255, 255, 0.1)'; this.style.transform='translateY(0)'">
                        <i class="fab fa-instagram"></i>
                    </a>
                    <a href="#" onclick="openSocialLink('linkedin')" style="
                        width: 40px;
                        height: 40px;
                        background: rgba(255, 255, 255, 0.1);
                        border-radius: 50%;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        color: white;
                        text-decoration: none;
                        transition: all 0.3s ease;
                        border: 1px solid rgba(255, 255, 255, 0.2);
                    " onmouseover="this.style.background='#0077b5'; this.style.transform='translateY(-3px)'" 
                       onmouseout="this.style.background='rgba(255, 255, 255, 0.1)'; this.style.transform='translateY(0)'">
                        <i class="fab fa-linkedin-in"></i>
                    </a>
                </div>
            </div>
            
            <!-- Quick Links -->
            <div>
                <h4 style="
                    color: white;
                    font-size: 18px;
                    font-weight: 600;
                    margin-bottom: 20px;
                    display: flex;
                    align-items: center;
                ">
                    <i class="fas fa-link" style="margin-right: 10px; color: #6c5ce7;"></i>
                    Quick Links
                </h4>
                <ul style="
                    list-style: none;
                    padding: 0;
                    margin: 0;
                ">
                    <li style="margin-bottom: 12px;">
                        <a href="#" onclick="navigateToPage('events')" style="
                            color: rgba(255, 255, 255, 0.8);
                            text-decoration: none;
                            font-size: 14px;
                            transition: all 0.3s ease;
                            display: flex;
                            align-items: center;
                        " onmouseover="this.style.color='#6c5ce7'; this.style.paddingLeft='10px'" 
                           onmouseout="this.style.color='rgba(255, 255, 255, 0.8)'; this.style.paddingLeft='0'">
                            <i class="fas fa-calendar-alt" style="margin-right: 8px; width: 15px;"></i>
                            Browse Events
                        </a>
                    </li>
                    <li style="margin-bottom: 12px;">
                        <a href="#" onclick="navigateToPage('create-event')" style="
                            color: rgba(255, 255, 255, 0.8);
                            text-decoration: none;
                            font-size: 14px;
                            transition: all 0.3s ease;
                            display: flex;
                            align-items: center;
                        " onmouseover="this.style.color='#6c5ce7'; this.style.paddingLeft='10px'" 
                           onmouseout="this.style.color='rgba(255, 255, 255, 0.8)'; this.style.paddingLeft='0'">
                            <i class="fas fa-plus-circle" style="margin-right: 8px; width: 15px;"></i>
                            Create Event
                        </a>
                    </li>
                    <li style="margin-bottom: 12px;">
                        <a href="#" onclick="navigateToPage('my-tickets')" style="
                            color: rgba(255, 255, 255, 0.8);
                            text-decoration: none;
                            font-size: 14px;
                            transition: all 0.3s ease;
                            display: flex;
                            align-items: center;
                        " onmouseover="this.style.color='#6c5ce7'; this.style.paddingLeft='10px'" 
                           onmouseout="this.style.color='rgba(255, 255, 255, 0.8)'; this.style.paddingLeft='0'">
                            <i class="fas fa-ticket-alt" style="margin-right: 8px; width: 15px;"></i>
                            My Tickets
                        </a>
                    </li>
                    <li style="margin-bottom: 12px;">
                        <a href="#" onclick="navigateToPage('dashboard')" style="
                            color: rgba(255, 255, 255, 0.8);
                            text-decoration: none;
                            font-size: 14px;
                            transition: all 0.3s ease;
                            display: flex;
                            align-items: center;
                        " onmouseover="this.style.color='#6c5ce7'; this.style.paddingLeft='10px'" 
                           onmouseout="this.style.color='rgba(255, 255, 255, 0.8)'; this.style.paddingLeft='0'">
                            <i class="fas fa-tachometer-alt" style="margin-right: 8px; width: 15px;"></i>
                            Dashboard
                        </a>
                    </li>
                    <li style="margin-bottom: 12px;">
                        <a href="#" onclick="navigateToPage('help')" style="
                            color: rgba(255, 255, 255, 0.8);
                            text-decoration: none;
                            font-size: 14px;
                            transition: all 0.3s ease;
                            display: flex;
                            align-items: center;
                        " onmouseover="this.style.color='#6c5ce7'; this.style.paddingLeft='10px'" 
                           onmouseout="this.style.color='rgba(255, 255, 255, 0.8)'; this.style.paddingLeft='0'">
                            <i class="fas fa-question-circle" style="margin-right: 8px; width: 15px;"></i>
                            Help Center
                        </a>
                    </li>
                </ul>
            </div>
            
            <!-- Event Categories -->
            <div>
                <h4 style="
                    color: white;
                    font-size: 18px;
                    font-weight: 600;
                    margin-bottom: 20px;
                    display: flex;
                    align-items: center;
                ">
                    <i class="fas fa-tags" style="margin-right: 10px; color: #fd79a8;"></i>
                    Event Categories
                </h4>
                <ul style="
                    list-style: none;
                    padding: 0;
                    margin: 0;
                ">
                    <li style="margin-bottom: 12px;">
                        <a href="#" onclick="filterEvents('music')" style="
                            color: rgba(255, 255, 255, 0.8);
                            text-decoration: none;
                            font-size: 14px;
                            transition: all 0.3s ease;
                            display: flex;
                            align-items: center;
                        " onmouseover="this.style.color='#fd79a8'; this.style.paddingLeft='10px'" 
                           onmouseout="this.style.color='rgba(255, 255, 255, 0.8)'; this.style.paddingLeft='0'">
                            <i class="fas fa-music" style="margin-right: 8px; width: 15px;"></i>
                            Music & Concerts
                        </a>
                    </li>
                    <li style="margin-bottom: 12px;">
                        <a href="#" onclick="filterEvents('sports')" style="
                            color: rgba(255, 255, 255, 0.8);
                            text-decoration: none;
                            font-size: 14px;
                            transition: all 0.3s ease;
                            display: flex;
                            align-items: center;
                        " onmouseover="this.style.color='#fd79a8'; this.style.paddingLeft='10px'" 
                           onmouseout="this.style.color='rgba(255, 255, 255, 0.8)'; this.style.paddingLeft='0'">
                            <i class="fas fa-futbol" style="margin-right: 8px; width: 15px;"></i>
                            Sports & Fitness
                        </a>
                    </li>
                    <li style="margin-bottom: 12px;">
                        <a href="#" onclick="filterEvents('business')" style="
                            color: rgba(255, 255, 255, 0.8);
                            text-decoration: none;
                            font-size: 14px;
                            transition: all 0.3s ease;
                            display: flex;
                            align-items: center;
                        " onmouseover="this.style.color='#fd79a8'; this.style.paddingLeft='10px'" 
                           onmouseout="this.style.color='rgba(255, 255, 255, 0.8)'; this.style.paddingLeft='0'">
                            <i class="fas fa-briefcase" style="margin-right: 8px; width: 15px;"></i>
                            Business & Networking
                        </a>
                    </li>
                    <li style="margin-bottom: 12px;">
                        <a href="#" onclick="filterEvents('arts')" style="
                            color: rgba(255, 255, 255, 0.8);
                            text-decoration: none;
                            font-size: 14px;
                            transition: all 0.3s ease;
                            display: flex;
                            align-items: center;
                        " onmouseover="this.style.color='#fd79a8'; this.style.paddingLeft='10px'" 
                           onmouseout="this.style.color='rgba(255, 255, 255, 0.8)'; this.style.paddingLeft='0'">
                            <i class="fas fa-palette" style="margin-right: 8px; width: 15px;"></i>
                            Arts & Culture
                        </a>
                    </li>
                    <li style="margin-bottom: 12px;">
                        <a href="#" onclick="filterEvents('food')" style="
                            color: rgba(255, 255, 255, 0.8);
                            text-decoration: none;
                            font-size: 14px;
                            transition: all 0.3s ease;
                            display: flex;
                            align-items: center;
                        " onmouseover="this.style.color='#fd79a8'; this.style.paddingLeft='10px'" 
                           onmouseout="this.style.color='rgba(255, 255, 255, 0.8)'; this.style.paddingLeft='0'">
                            <i class="fas fa-utensils" style="margin-right: 8px; width: 15px;"></i>
                            Food & Drink
                        </a>
                    </li>
                </ul>
            </div>
            
            <!-- Newsletter & Contact -->
            <div>
                <h4 style="
                    color: white;
                    font-size: 18px;
                    font-weight: 600;
                    margin-bottom: 20px;
                    display: flex;
                    align-items: center;
                ">
                    <i class="fas fa-envelope" style="margin-right: 10px; color: #4ECDC4;"></i>
                    Stay Connected
                </h4>
                
                <!-- Newsletter Signup -->
                <div style="
                    background: rgba(255, 255, 255, 0.05);
                    padding: 20px;
                    border-radius: 12px;
                    border: 1px solid rgba(255, 255, 255, 0.1);
                    margin-bottom: 20px;
                ">
                    <p style="
                        color: rgba(255, 255, 255, 0.8);
                        font-size: 14px;
                        margin-bottom: 15px;
                        line-height: 1.4;
                    ">Get updates on new events and exclusive offers!</p>
                    
                    <div style="display: flex; gap: 8px;">
                        <input type="email" id="newsletterEmail" placeholder="Your email address" style="
                            flex: 1;
                            padding: 12px;
                            border: 1px solid rgba(255, 255, 255, 0.2);
                            border-radius: 8px;
                            background: rgba(255, 255, 255, 0.1);
                            color: white;
                            font-size: 14px;
                        " />
                        <button onclick="subscribeNewsletter()" style="
                            background: linear-gradient(135deg, #4ECDC4, #44A08D);
                            color: white;
                            border: none;
                            padding: 12px 16px;
                            border-radius: 8px;
                            cursor: pointer;
                            font-size: 14px;
                            font-weight: 600;
                            transition: all 0.3s ease;
                            white-space: nowrap;
                        " onmouseover="this.style.transform='translateY(-2px)'" 
                           onmouseout="this.style.transform='translateY(0)'">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
                
                <!-- Contact Info -->
                <div style="margin-top: 20px;">
                    <div style="
                        display: flex;
                        align-items: center;
                        margin-bottom: 10px;
                        color: rgba(255, 255, 255, 0.8);
                        font-size: 14px;
                    ">
                        <i class="fas fa-phone" style="margin-right: 10px; color: #4ECDC4; width: 15px;"></i>
                   Whatsapp (only); +234 8029941678
                    </div>
                    <div style="
                        display: flex;
                        align-items: center;
                        margin-bottom: 10px;
                        color: rgba(255, 255, 255, 0.8);
                        font-size: 14px;
                    ">
                        <i class="fas fa-envelope" style="margin-right: 10px; color: #4ECDC4; width: 15px;"></i>
                        support ; rewarderhub@gmail.com
                    </div>
                    <div style="
                        display: flex;
                        align-items: flex-start;
                        color: rgba(255, 255, 255, 0.8);
                        font-size: 14px;
                    ">
                        <i class="fas fa-map-marker-alt" style="margin-right: 10px; color: #4ECDC4; width: 15px; margin-top: 2px;"></i>
                        <span>Lagos, Nigeria</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Bottom Section -->
        <div style="
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            padding-top: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        ">
            <!-- Copyright -->
            <div style="
                color: rgba(255, 255, 255, 0.6);
                font-size: 14px;
            ">
                 2024 Rewarder. All rights reserved. | Built with  in Nigeria by Ismart Digital Connect 
            </div>
            
            <!-- Legal Links -->
            <div style="display: flex; gap: 20px; flex-wrap: wrap;">
                
                <a href="#" id="privacyBtn" style="
                    color: rgba(255, 255, 255, 0.6);
                    text-decoration: none;
                    font-size: 14px;
                    transition: color 0.3s ease;
                " onmouseover="this.style.color='white'" onmouseout="this.style.color='rgba(255, 255, 255, 0.6)'">
                    Privacy Policy
                </a>
                <a href="#" id="termsBtn" style="
                    color: rgba(255, 255, 255, 0.6);
                    text-decoration: none;
                    font-size: 14px;
                    transition: color 0.3s ease;
                " onmouseover="this.style.color='white'" onmouseout="this.style.color='rgba(255, 255, 255, 0.6)'">
                    Terms & Condition
                </a>
              
            </div>
        </div>
    </div>
</footer>


                </div>
                
                <div class="auth-container hidden" id="signupForm">
                    <h2>Create Account</h2>
                    <p>Join the talent revolution</p>
                    
                    <div class="social-login">
                        <button class="social-btn google-btn">
                           <img src="https://i.ibb.co/wZqXcy6z/thegogglelogo.png" alt="thegogglelogo" border="0">
                          
                            <span>Continue with Google</span>
                        </button>
                    </div>
                    
                    <div class="divider">
                        <span>or sign up with email</span>
                    </div>
                    
                    <form id="signupFormElement">
                        <div class="form-group">
                            <label for="fullName">Full Name</label>
                            <input type="text" id="fullName" placeholder="Enter your full name" required>
                        </div>
                        <div class="form-group">
                            <label for="signupEmail">Email</label>
                            <input type="email" id="signupEmail" placeholder="Enter your email" required>
                        </div>
                        <div class="form-group">
                            <label for="signupPassword">Password</label>
                            <div class="password-input">
                                <input type="password" id="signupPassword" placeholder="Create a password" required>
                                <i class="fas fa-eye-slash toggle-password"></i>
                            </div>
                            <div class="password-strength">
                                <div class="strength-meter">
                                    <div class="strength-segment"></div>
                                    <div class="strength-segment"></div>
                                    <div class="strength-segment"></div>
                                    <div class="strength-segment"></div>
                                </div>
                                <span class="strength-text">Password strength</span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="userType">I want to join as</label>
                            <select id="userType" required>
                                <option value="" disabled selected>Select your role</option>
                                <option value="contestant">Contestant</option>
                                <option value="voter">Voter</option>
                                <option value="both">Both</option>
                            </select>
                        </div>
                        <div class="form-options">
                            <div class="terms">
                                <input type="checkbox" id="terms" required>
                                <label for="terms">I agree to the <a href="#">Terms of Service</a> and <a href="#">Privacy Policy</a></label>
                            </div>
                        </div>
                        <button type="submit" class="auth-btn">Create Account</button>
                    </form>
                    
                    <div class="auth-switch">
                        <p>Already have an account? <a href="#" id="showLogin">Sign in</a></p>
                    </div>
                </div>
            </div>
        </div>
        
    </div>

        

        <!-- Dashboard Page -->
<div class="dashboard-page" id="dashboardPage">
    <!-- Top Navigation Bar -->
    <div class="dashboard-nav">
        <div class="user-info">
            <div class="profile-circle">
          <!-- User profile circle in header/navbar -->
<div class="user-profile-image emoji-avatar" id="profileCircle"></div>

            </div>
            <span class="username" id="usernameDisplay">Username</span>
       
        </div>
         
        <div class="trophy-btn">
    <i class="fas fa-trophy"></i>
    
    <div class="shine-sweep"></div>
    
</div>

       
    </div>
    
    <!-- Main Dashboard Container -->
    <div class="dashboard-container">
      
    <!-- Media Banner Container -->
    <div class="media-banner-container">
        <div class="media-banner-track">
           <div class="media-item image-item">
             
            <img src="https://i.ibb.co/Tx9F0qws/Dark-Blue-Purple-White-Modern-Gradient-Football-Match-Day-Instagram-Story-20250804-052758-0000.png" alt="Dark-Blue-Purple-White-Modern-Gradient-Football-Match-Day-Instagram-Story-20250804-052758-0000" border="0">  
           </div> 
            <div class="media-item image-item">
             
            <!-- Image Items -->
              <img src="https://i.ibb.co/0j7x3p83/Dark-Blue-Purple-White-Modern-Gradient-Football-Match-Day-Instagram-Story-20250804-060142-0000.png" alt="Dark-Blue-Purple-White-Modern-Gradient-Football-Match-Day-Instagram-Story-20250804-060142-0000" border="0">
              </div>    
           
              
           
        </div>
    </div>


        <!-- Action Buttons Container - Single Row -->
        <div class="action-buttons-row">
            
            <div class="action-btn creator-btn">
                <div class="action-icon">
                    <i class="fas fa-video"></i>
                </div>
                <span>Creator</span>
            </div>
            
           
            
           <div class="action-btn tickets-btns" onclick="openTicketsModal()">
                <div class="action-icon">
                    <i class="fas fa-ticket-alt"></i>
                </div>
                <span>Tickets</span>
            </div>
           

            
            
            
             <div class="action-btn Game-btn">
    <div class="action-icon game-icon">
    <i class="fa-solid fa-gamepad"></i>

    </div>
    <span>Game</span>
          <span class="host-sport-category-status coming-soon"></span>
                   
</div>

<div class="action-btn spin-btn">
                <div class="action-icon spin-icon">
                    <i class="fas fa-sync-alt"></i>
                </div>
                <span>Spin</span>
                      <span class="host-sport-category-status coming-soon"></span>
                   
            </div>
            <div class="action-btn rewarder-btn">
                <div class="action-icon rewarder">
                    <i class="fas fa-gem"></i>
                </div>
                <span>Rewarder</span>
                      <span class="host-sport-category-status coming-soon"></span>
                   
            </div>
            
            

        </div>
<!-- Auto-scrolling Banner Section -->
        <div class="banner-section">
            <div class="banner-carousel">
                <div class="banner-item">
                    <img src="https://i.ibb.co/5hrNmSgM/Fast-Withdrawal-s-20250806-044026-0000.png" alt="Event Banner 1" />
                </div>
                <div class="banner-item">
                    <img src="https://i.ibb.co/9kQb2chQ/Fast-Withdrawal-s-20250806-042109-0000.png" alt="Event Banner 2" />
                </div>
                <div class="banner-item">
             <img src="https://i.ibb.co/PG6RZTpd/IMG-20250804-WA0101.jpg" alt="IMG-20250804-WA0101" border="0">
                    </div>
                      <div class="banner-item">
             <img src="https://i.ibb.co/yFS5vkcn/IMG-20250818-WA0072.jpg" alt="IMG-20250818-WA0072" border="0">
                    </div>  <div class="banner-item">
             <img src="https://i.ibb.co/wZBVRSdY/IMG-20250818-WA0075.jpg" alt="IMG-20250818-WA0075" border="0">

                    </div>  <div class="banner-item">
             <img src="https://i.ibb.co/QvdkVfkG/6-20250817-215701-0000.png" alt="6-20250817-215701-0000" border="0">
                    </div>  <div class="banner-item">
             <img src="https://i.ibb.co/XZ2sqtbg/7-20250817-215701-0001.png" alt="7-20250817-215701-0001" border="0">
                    </div>  <div class="banner-item">
             <img src="https://i.ibb.co/20rFRD8M/8-20250817-215701-0002.png" alt="8-20250817-215701-0002" border="0">
                    </div>  <div class="banner-item">
<img src="https://i.ibb.co/pBHBmF4B/9-20250817-215701-0003.png" alt="9-20250817-215701-0003" border="0">
                    </div>  <div class="banner-item">
             <img src="https://i.ibb.co/Qvj6t2Sn/IMG-20250813-WA0112.jpg" alt="IMG-20250813-WA0112" border="0">
                    </div>
                <div class="banner-item">
                    <img src="https://i.ibb.co/tpNVMDrZ/Fast-Withdrawal-s-20250806-044937-0000.png" alt="Event Banner 3" />
                </div>

            </div>
        </div>

        <!-- Physical Events Section -->
        <div class="physical-events-section">
            <div class="section-header">
                <div class="section-header-row">
                    
                    <h2 class="section-title">
                      <i class="fas fa-calendar-alt"></i>
                        Physical Events
                        <button class="see-more-events-btn" onclick="showAllEvents()">
                       
                        See More Events
                    </button>
                     </h2>
                </div>
            </div>
            
            <div class="physical-events-container" id="physicalEventsContainer">
                <div class="events-scroll-wrapper">
                    <!-- Events will be dynamically loaded here -->
                </div>
            </div>
        </div>

<!-- Media Banner Container -->
    <div class="media2-banner-container">
        <div class="media2-banner-track">
           <div class="media2-item image-item">
             
            <img src="https://i.ibb.co/Tx9F0qws/Dark-Blue-Purple-White-Modern-Gradient-Football-Match-Day-Instagram-Story-20250804-052758-0000.png" alt="Dark-Blue-Purple-White-Modern-Gradient-Football-Match-Day-Instagram-Story-20250804-052758-0000" border="0">  
           </div> 
            <div class="media2-item image-item">
          <div class="media2-item image-item">
            <img src="https://i.ibb.co/DH8J39my/Fast-Withdrawal-s-20250806-042833-0000.png" alt="Fast-Withdrawal-s-20250806-042833-0000" border="0">
            </div>    
           
             <div class="media2-item image-item">
            <img src="https://i.ibb.co/9kQb2chQ/Fast-Withdrawal-s-20250806-042109-0000.png" alt="Fast-Withdrawal-s-20250806-042109-0000" border="0">
            </div>  
            <div class="media2-item image-item">
            https://i.ibb.co/tp6T2hjc/Fast-Withdrawal-s-20250806-040305-0000.png
            </div>  
        </div>
    </div>
        

<!-- Footer for Rewarder Event & Ticket App -->
<footer style="
    background: linear-gradient(135deg, #1a1a2e 100%, #16213e 0%, #0f3460 100%);
    color: white;
    padding: 60px 0 20px 0;
    margin-top: 80px;
    position: relative;
    overflow: hidden;
">
    <!-- Background Elements -->
    <div style="
        position: absolute;
        top: -50px;
        right: -50px;
        width: 200px;
        height: 200px;
        background: rgba(108, 92, 231, 0.1);
        border-radius: 50%;
        z-index: 0;
    "></div>
    <div style="
        position: absolute;
        bottom: -30px;
        left: -30px;
        width: 150px;
        height: 150px;
        background: rgba(253, 121, 168, 0.1);
        border-radius: 50%;
        z-index: 0;
    "></div>

    <div style="
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 20px;
        position: relative;
        z-index: 1;
    ">
        <!-- Main Footer Content -->
        <div style="
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 40px;
            margin-bottom: 40px;
        ">
            
            <!-- Brand Section -->
            <div style="
                background: rgba(255, 255, 255, 0.05);
                padding: 30px;
                border-radius: 15px;
                border: 1px solid rgba(255, 255, 255, 0.1);
                backdrop-filter: blur(10px);
            ">
                <div style="
                    display: flex;
                    align-items: center;
                    margin-bottom: 20px;
                ">
                    <div style="
                        width: 50px;
                        height: 50px;
                        background: linear-gradient(135deg, #6c5ce7, #fd79a8);
                        border-radius: 12px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        margin-right: 15px;
                    ">
                        <i class="fas fa-ticket-alt" style="font-size: 24px; color: white;"></i>
                    </div>
                    <h3 style="
                        font-size: 28px;
                        font-weight: 700;
                        margin: 0;
                        background: linear-gradient(135deg, #6c5ce7, #fd79a8);
                        -webkit-background-clip: text;
                        -webkit-text-fill-color: transparent;
                        background-clip: text;
                    ">Rewarder</h3>
                </div>
                <p style="
                    color: rgba(255, 255, 255, 0.8);
                    line-height: 1.6;
                    margin-bottom: 20px;
                    font-size: 14px;
                ">
                    The ultimate platform for monetized talent competitions and event management. 
                    Create, discover, and participate in amazing events with seamless ticket booking.
                </p>
                
                <!-- Social Media Links -->
                <div style="display: flex; gap: 15px; margin-top: 20px;">
                    <a href="#" onclick="openSocialLink('facebook')" style="
                        width: 40px;
                        height: 40px;
                        background: rgba(255, 255, 255, 0.1);
                        border-radius: 50%;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        color: white;
                        text-decoration: none;
                        transition: all 0.3s ease;
                        border: 1px solid rgba(255, 255, 255, 0.2);
                    " onmouseover="this.style.background='#3b5998'; this.style.transform='translateY(-3px)'" 
                       onmouseout="this.style.background='rgba(255, 255, 255, 0.1)'; this.style.transform='translateY(0)'">
                        <i class="fab fa-facebook-f"></i>
                    </a>
                    <a href="#" onclick="openSocialLink('twitter')" style="
                        width: 40px;
                        height: 40px;
                        background: rgba(255, 255, 255, 0.1);
                        border-radius: 50%;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        color: white;
                        text-decoration: none;
                        transition: all 0.3s ease;
                        border: 1px solid rgba(255, 255, 255, 0.2);
                    " onmouseover="this.style.background='#1da1f2'; this.style.transform='translateY(-3px)'" 
                       onmouseout="this.style.background='rgba(255, 255, 255, 0.1)'; this.style.transform='translateY(0)'">
                        <i class="fab fa-twitter"></i>
                    </a>
                    <a href="#" onclick="openSocialLink('instagram')" style="
                        width: 40px;
                        height: 40px;
                        background: rgba(255, 255, 255, 0.1);
                        border-radius: 50%;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        color: white;
                        text-decoration: none;
                        transition: all 0.3s ease;
                        border: 1px solid rgba(255, 255, 255, 0.2);
                    " onmouseover="this.style.background='linear-gradient(45deg, #f09433 0%,#e6683c 25%,#dc2743 50%,#cc2366 75%,#bc1888 100%)'; this.style.transform='translateY(-3px)'" 
                       onmouseout="this.style.background='rgba(255, 255, 255, 0.1)'; this.style.transform='translateY(0)'">
                        <i class="fab fa-instagram"></i>
                    </a>
                    <a href="#" onclick="openSocialLink('linkedin')" style="
                        width: 40px;
                        height: 40px;
                        background: rgba(255, 255, 255, 0.1);
                        border-radius: 50%;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        color: white;
                        text-decoration: none;
                        transition: all 0.3s ease;
                        border: 1px solid rgba(255, 255, 255, 0.2);
                    " onmouseover="this.style.background='#0077b5'; this.style.transform='translateY(-3px)'" 
                       onmouseout="this.style.background='rgba(255, 255, 255, 0.1)'; this.style.transform='translateY(0)'">
                        <i class="fab fa-linkedin-in"></i>
                    </a>
                </div>
            </div>
            
           
           
            
            <!-- Newsletter & Contact -->
            <div>
                <h4 style="
                    color: white;
                    font-size: 18px;
                    font-weight: 600;
                    margin-bottom: 20px;
                    display: flex;
                    align-items: center;
                ">
                    <i class="fas fa-envelope" style="margin-right: 10px; color: #4ECDC4;"></i>
                    Stay Connected
                </h4>
                
                <!-- Newsletter Signup -->
                <div style="
                    background: rgba(255, 255, 255, 0.05);
                    padding: 20px;
                    border-radius: 12px;
                    border: 1px solid rgba(255, 255, 255, 0.1);
                    margin-bottom: 20px;
                ">
                    <p style="
                        color: rgba(255, 255, 255, 0.8);
                        font-size: 14px;
                        margin-bottom: 15px;
                        line-height: 1.4;
                    ">Get updates on new events and exclusive offers!</p>
                    
                    <div style="display: flex; gap: 8px;">
                        <input type="email" id="newsletterEmail" placeholder="Your email address" style="
                            flex: 1;
                            padding: 12px;
                            border: 1px solid rgba(255, 255, 255, 0.2);
                            border-radius: 8px;
                            background: rgba(255, 255, 255, 0.1);
                            color: white;
                            font-size: 14px;
                        " />
                        <button onclick="subscribeNewsletter()" style="
                            background: linear-gradient(135deg, #4ECDC4, #44A08D);
                            color: white;
                            border: none;
                            padding: 12px 16px;
                            border-radius: 8px;
                            cursor: pointer;
                            font-size: 14px;
                            font-weight: 600;
                            transition: all 0.3s ease;
                            white-space: nowrap;
                        " onmouseover="this.style.transform='translateY(-2px)'" 
                           onmouseout="this.style.transform='translateY(0)'">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
                
                <!-- Contact Info -->
                <div style="margin-top: 20px;">
                    <div style="
                        display: flex;
                        align-items: center;
                        margin-bottom: 10px;
                        color: rgba(255, 255, 255, 0.8);
                        font-size: 14px;
                    ">
                        <i class="fas fa-phone" style="margin-right: 10px; color: #4ECDC4; width: 15px;"></i>
                   Whatsapp (only); +234 8029941678
                    </div>
                    <div style="
                        display: flex;
                        align-items: center;
                        margin-bottom: 10px;
                        color: rgba(255, 255, 255, 0.8);
                        font-size: 14px;
                    ">
                        <i class="fas fa-envelope" style="margin-right: 10px; color: #4ECDC4; width: 15px;"></i>
                        support ; rewarderhub@gmail.com
                    </div>
                    <div style="
                        display: flex;
                        align-items: flex-start;
                        color: rgba(255, 255, 255, 0.8);
                        font-size: 14px;
                    ">
                        <i class="fas fa-map-marker-alt" style="margin-right: 10px; color: #4ECDC4; width: 15px; margin-top: 2px;"></i>
                        <span>Lagos, Nigeria</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Bottom Section -->
        <div style="
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            padding-top: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        ">
            <!-- Copyright -->
            <div style="
                color: rgba(255, 255, 255, 0.6);
                font-size: 14px;
            ">
                 2024 Rewarder. All rights reserved. | Built with  in Nigeria by Ismart Digital Connect 
            </div>
            
            <!-- Legal Links -->
            <div style="display: flex; gap: 20px; flex-wrap: wrap;">
                
                <a href="#" id="privacyBtn" style="
                    color: rgba(255, 255, 255, 0.6);
                    text-decoration: none;
                    font-size: 14px;
                    transition: color 0.3s ease;
                " onmouseover="this.style.color='white'" onmouseout="this.style.color='rgba(255, 255, 255, 0.6)'">
                    Privacy Policy
                </a>
                <a href="#" id="termsBtn" style="
                    color: rgba(255, 255, 255, 0.6);
                    text-decoration: none;
                    font-size: 14px;
                    transition: color 0.3s ease;
                " onmouseover="this.style.color='white'" onmouseout="this.style.color='rgba(255, 255, 255, 0.6)'">
                    Terms & Condition
                </a>
              
            </div>
        </div>
    </div>
</footer>

          
        </div>
       

   
                   
<div id="profileModal" class="profile-modal">
    <div class="profile-modal-content">
        <div class="profile-modal-header">
            <h2>My Profile</h2>
            <button class="close-profile">&times;</button>
        </div>
        
        <!-- Scrollable Content Wrapper -->
        <div class="profile-modal-body">
            <!-- Emoji Avatar Section (replaces the profile image section) -->
            <div class="emoji-avatar-wrapper" id="emojiAvatarWrapper">
                <div class="current-emoji-avatar" id="currentEmojiAvatar"></div>
                <div class="emoji-selector" id="emojiSelector">
                    <div class="emoji-option" data-emoji=""></div>
                    <div class="emoji-option" data-emoji=""></div>
                    <div class="emoji-option" data-emoji=""></div>
                    <div class="emoji-option" data-emoji=""></div>
                    <div class="emoji-option" data-emoji=""></div>
                    <div class="emoji-option" data-emoji=""></div>
                    <div class="emoji-option" data-emoji=""></div>
                </div>
            </div>
            
            <form id="profileForm">
                <div class="form-group">
                    <label for="profileFullName">Full Name</label>
                    <input type="text" id="profileFullName" placeholder="Your full name">
                </div>
                
                <div class="form-group">
                    <label for="profileEmail">Email</label>
                    <input type="email" id="profileEmail" readonly>
                </div>
                
                <div class="form-group">
                    <label for="profileUserType">Gender</label>
                    <select id="profileUserType">
                        <option value="contestant">Gender</option>
                        <option value="Male">Male</option>
                        <option value="Female">Female</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="profileBio">Bio</label>
                    <textarea id="profileBio" placeholder="Tell us about yourself" rows="3"></textarea>
                </div>
                
                <div class="form-group">
                    <a href="#" id="logoutBtn" class="logout-btn">
                        <i class="fas fa-sign-out-alt"></i>
                        <span>Logout</span>
                    </a>
                    
                    <li class="menu-item">
                       <a href="#" id="termsBtn" style="
                    color: rgba(255, 255, 255, 0.6);
                    text-decoration: none;
                    font-size: 14px;
                    transition: color 0.3s ease;
                " onmouseover="this.style.color='white'" onmouseout="this.style.color='rgba(255, 255, 255, 0.6)'">
                    Terms & Condition
                </a>
              
                    </li>
                    
                    <li class="menu-item">
                        <a href="#" id="privacyBtn" style="
                    color: rgba(255, 255, 255, 0.6);
                    text-decoration: none;
                    font-size: 14px;
                    transition: color 0.3s ease;
                " onmouseover="this.style.color='white'" onmouseout="this.style.color='rgba(255, 255, 255, 0.6)'">
                    Privacy Policy
                </a>
                
                    </li>
                </div>

                <div class="profile-actions">
                    <button type="button" id="changePasswordBtn" class="secondary-btn">Change Password</button>
                    <button type="submit" id="saveProfileBtn" class="primary-btn">Save Changes</button>
                </div>
            </form>
            
            <!-- Change Password Section (Hidden by default) -->
            <div id="changePasswordSection" class="change-password-section hidden">
                <h3>Change Password</h3>
                <form id="changePasswordForm">
                    <div class="form-group">
                        <label for="currentPassword">Current Password</label>
                        <div class="password-input">
                            <input type="password" id="currentPassword" placeholder="Enter current password" required>
                            <i class="fas fa-eye-slash toggle-password"></i>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="newPassword">New Password</label>
                        <div class="password-input">
                            <input type="password" id="newPassword" placeholder="Enter new password" required>
                            <i class="fas fa-eye-slash toggle-password"></i>
                        </div>
                        <div class="password-strength">
                            <div class="strength-meter">
                                <div class="strength-segment"></div>
                                <div class="strength-segment"></div>
                                <div class="strength-segment"></div>
                                <div class="strength-segment"></div>
                            </div>
                            <span class="strength-text">Password strength</span>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="confirmPassword">Confirm Password</label>
                        <div class="password-input">
                            <input type="password" id="confirmPassword" placeholder="Confirm new password" required>
                            <i class="fas fa-eye-slash toggle-password"></i>
                        </div>
                    </div>
                    
                    <div class="profile-actions">
                        <button type="button" id="cancelPasswordChange" class="secondary-btn">Cancel</button>
                        <button type="submit" class="primary-btn">Update Password</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Sidebar Menu -->
<div class="sidebar-menu" id="sidebarMenu">
    <div class="sidebar-header">
       
        <button class="close-sidebar" id="closeSidebarBtn">
            <i class="fas fa-times"></i>
        </button>
    </div>
    
    <div class="sidebar-content">
        <ul class="sidebar-menu-items">
            <li class="menu-item">
                <a href="#" id="profileMenuBtn">
                    <i class="fas fa-user"></i>
                    <span>My Profile</span>
                </a>
            </li>
            
          
            
           
            
        </ul>
    </div>
    
    <div class="sidebar-footer">
        <div class="app-version">Version 1.0.0</div>
    </div>
</div>

<!-- Overlay for closing sidebar when clicking outside -->
<div class="sidebar-overlay" id="sidebarOverlay"></div>

<!-- Tickets Modal -->
<div class="modal" id="ticketsModal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Select Ticket Type</h2>
            <button class="close-modal" onclick="closeTicketsModal()">&times;</button>
        </div>
        <div class="modal-body">
            <div class="ticket-type-buttons">
                <button class="ticket-type-btn physical-event-ticket-btn" onclick="openPhysicalEventTicketPage()">
                    <i class="fas fa-map-marker-alt"></i>
                    <span>Physical Event Tickets</span>
                </button>
                <button class="ticket-type-btn online-event-ticket-btn" onclick="openOnlineEventTicketPage()">
                    <i class="fas fa-globe"></i>
                    <span>Online Event Tickets</span>
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Terms & Conditions Modal -->
<div class="modal" id="termsModal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Terms & Conditions</h2>
            <button class="close-privacy">&times;</button>
        </div>
        <div class="modal-body">
            <div class="terms-content">
                <h3>1. Acceptance of Terms</h3>
                <p>By accessing and using this application, you accept and agree to be bound by the terms and provisions of this agreement.</p>
                
                <h3>2. User Account</h3>
                <p>To use certain features of the application, you must register for an account. You agree to provide accurate information and keep your account secure.</p>
                
                <h3>3. User Conduct</h3>
                <p>You agree not to use the application for any illegal purposes or to conduct activities that may damage, disable, or impair the application's functionality.</p>
                
                <h3>4. Intellectual Property</h3>
                <p>All content, features, and functionality of the application are owned by us and are protected by international copyright, trademark, and other intellectual property laws.</p>
                
                <h3>5. Termination</h3>
                <p>We may terminate or suspend your account and access to the application at our sole discretion, without notice, for conduct that we believe violates these Terms or is harmful to other users or us.</p>
                
                <h3>6. Changes to Terms</h3>
                <p>We reserve the right to modify these terms at any time. Your continued use of the application after such changes constitutes your acceptance of the new terms.</p>
            </div>
        </div>
    </div>
</div>

<!-- Privacy Policy Modal -->
<div class="modal" id="privacyModal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Privacy Policy</h2>
            <button class="close-privacy">&times;</button>
        </div>
        <div class="modal-body">
            <div class="privacy-content">
                <h3>1. Information We Collect</h3>
                <p>We collect information you provide directly to us when you register for an account, create or modify your profile, and use the features of our application.</p>
                
                <h3>2. How We Use Information</h3>
                <p>We use the information we collect to provide, maintain, and improve our services, to develop new ones, and to protect our application and users.</p>
                
                <h3>3. Information Sharing</h3>
                <p>We do not share your personal information with companies, organizations, or individuals outside of our organization except in the following cases: with your consent, for legal reasons, or to protect rights and safety.</p>
                
                <h3>4. Data Security</h3>
                <p>We work hard to protect our users from unauthorized access to or unauthorized alteration, disclosure, or destruction of information we hold.</p>
                
                <h3>5. Data Retention</h3>
                <p>We retain your information for as long as your account is active or as needed to provide you services.</p>
                
                <h3>6. Changes to This Policy</h3>
                <p>We may change this privacy policy from time to time. We will notify you of any changes by posting the new privacy policy on this page.</p>
            </div>
        </div>
    </div>
</div>
<div id="logoutConfirmModal" class="profile-modal">
    <div class="profile-modal-content logout-confirm-content">
        <div class="profile-modal-header">
            <h2>Logout Confirmation</h2>
        </div>
        <div class="logout-confirm-body">
            <div class="logout-icon">
                <i class="fas fa-sign-out-alt"></i>
            </div>
            <p class="logout-message">Are you sure you want to logout of<br><strong>Rewarder-Life of the party</strong>?</p>
            <div class="logout-confirm-actions">
                <button class="logout-no-btn" id="logoutNoBtn">No</button>
                <button class="logout-yes-btn" id="logoutYesBtn">Yes</button>
            </div>
        </div>
    </div>
</div>

<!-- Wallet Modal -->
<div class="wallet-modal" id="walletModal">
    <div class="wallet-container">
        <!-- PIN Setup/Entry Screen (shown first if no PIN exists) -->
        <div class="wallet-screen" id="pinScreen">
            <div class="wallet-header">
                <h2>Wallet Access</h2>
                <button class="close-wallet" id="closeWalletBtn">&times;</button>
            </div>
            
            <div class="pin-setup" id="pinSetupSection">
                <div class="pin-icon">
                    <i class="fas fa-lock"></i>
                </div>
                <h3>Create Your Wallet PIN</h3>
                <p>Set a 4-digit PIN to secure your wallet and transactions.</p>
                
                <div class="pin-input-container">
                    <input type="password" maxlength="1" class="pin-digit" data-index="0">
                    <input type="password" maxlength="1" class="pin-digit" data-index="1">
                    <input type="password" maxlength="1" class="pin-digit" data-index="2">
                    <input type="password" maxlength="1" class="pin-digit" data-index="3">
                </div>
                
                <div class="pin-confirm-container hidden" id="pinConfirmContainer">
                    <p>Confirm your PIN</p>
                    <div class="pin-input-container">
                        <input type="password" maxlength="1" class="pin-confirm-digit" data-index="0">
                        <input type="password" maxlength="1" class="pin-confirm-digit" data-index="1">
                        <input type="password" maxlength="1" class="pin-confirm-digit" data-index="2">
                        <input type="password" maxlength="1" class="pin-confirm-digit" data-index="3">
                    </div>
                </div>
                
                <button class="wallet-btn primary-btn" id="createPinBtn">Create PIN</button>
            </div>
            
            <div class="pin-entry hidden" id="pinEntrySection">
                <div class="pin-icon">
                    <i class="fas fa-unlock-alt"></i>
                </div>
                <h3>Enter Your Wallet PIN</h3>
                <p>Enter your 4-digit PIN to access your wallet.</p>
                
                <div class="pin-input-container">
                    <input type="password" maxlength="1" class="pin-login-digit" data-index="0">
                    <input type="password" maxlength="1" class="pin-login-digit" data-index="1">
                    <input type="password" maxlength="1" class="pin-login-digit" data-index="2">
                    <input type="password" maxlength="1" class="pin-login-digit" data-index="3">
                </div>
                
                <button class="wallet-btn primary-btn" id="loginPinBtn">Access Wallet</button>
                <button class="wallet-btn text-btn" id="forgotPinBtn">Forgot PIN?</button>
            </div>
        </div>
        
        <!-- Main Wallet Dashboard (shown after PIN verification) -->
        <div class="wallet-screen hidden" id="walletDashboard">
            <div class="wallet-header">
                <h2>My Wallet</h2>
                <button class="close-wallet" id="closeWalletDashboardBtn">&times;</button>
            </div>
            
            <div class="wallet-info">
         
   
  <!-- Add this to your send money form -->
  <div class="recipient-validation" id="recipientValidation" style="display:none;">
    <div class="recipient-info" id="recipientInfo"></div>
  </div>
              
                <div class="balance-cards">
                    <div class="balance-card talent-coin">
                        <div class="balance-icon">
                            <i class="fas fa-coins"></i>
                        </div>
                        <div class="balance-details">
                            <h3>Talent Coin Balance</h3>
                            <div class="balance-amount" id="talentCoinBalance">0</div>
                            <div class="balance-equivalent"> <span id="nairaEquivalent">0</span></div>
                        </div>
                    </div>
                    <div class="balance-card pending-coin">
                        <div class="balance-icon">
                            <i class="fas fa-coins"></i>
                        </div>
                        <div class="balance-details">
                            <h3>Pending Coin Balance</h3>
                            <div class="balance-amount" id="pendingCoinBalance">0</div>
                            <div class="balance-equivalent"> <span id="nairaEquivalent">0</span></div>
                        </div>
                    </div>
                    
                    <div class="balance-card commission">
                        <div class="balance-icon">
                            <i class="fas fa-hand-holding-usd"></i>
                        </div>
                        <div class="balance-details">
                            <h3>Commission Balance</h3>
                            <div class="balance-amount" id="commissionBalance">0</div>
                        </div>
                    </div>
                </div>
            </div>
         <!-- Wallet Tag Setup Modal -->
<div id="walletTagModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Create Wallet Tag</h2>
        <span class="close-modal">&times;</span>
      </div>
      <div class="modal-body">
        <div class="tag-icon">
          <i class="fas fa-at"></i>
        </div>
        <p>Create a unique tag for your wallet to receive payments easily.</p>
        <div class="tag-input-wrapper">
          <span>@</span>
          <input type="text" id="walletTagInput" placeholder="yourname" maxlength="15">
        </div>
        <div id="tagStatus" class="tag-status"></div>
        <button id="createTagBtn" class="primary-btn" disabled>Create Tag</button>
      </div>
    </div>
  </div>
  
  <!-- Buy Coin Button for Wallet Dashboard -->
<div class="wallet-action-card">
    <div class="wallet-action-header">
      <h3>Buy Talent Coins</h3>
      <i class="fas fa-coins"></i>
    </div>
    <div class="wallet-action-content">
      <p>Need more Talent Coins? Purchase now and get bonus coins!</p>
      <ul class="bonus-list">
        <li>Buy 10 coins, get 1 free</li>
        <li>Buy 1000+ coins, get 30% bonus</li>
      </ul>
    </div>
   
  </div>
  
  
            <div class="wallet-actions">
                <div class="action-row">
                    
<!-- Buy Coins Button -->
 <button class="wallet-action-btn" id="buycoinsBtn">
                    
    <div class="action-icon">
        <i class="fas fa-shopping-chart"></i>
    </div>
    <span>Buy Talent Coin </span>
</button>

                 
                    <button class="wallet-action-btn" id="withdrawBtn">
                        <div class="action-icon">
                            <i class="fas fa-money-bill-wave"></i>
                        </div>
                        <span>Withdraw</span>
                    </button>
                </div>
                
                <div class="action-row">
                    <button class="wallet-action-btn" id="transferBtn">
                        <div class="action-icon">
                            <i class="fas fa-paper-plane"></i>
                        </div>
                        <span>Transfer</span>
                        <div class="ribbon-wrapper">
                            <div class="ribbon">Coming Soon</div>
                        </div>
                    </button>
                     
                    <button class="wallet-action-btn" id="historyBtn">
                                    <div class="action-icon">
                                      <i class="fas fa-paper-plane"></i>
                                    </div>
                                    <span>Transaction history</span>
                                  </button>
                      <button class="wallet-action-btn" id="changePinBtn">
                            <div class="action-icon">
                                <i class="fas fa-key"></i>
                            </div>
                            <span>Change PIN</span>
                        </button>
                </div>
            </div>
            
           
<!-- Recent Transaction History Preview -->
<div class="transaction-history">
    <h3>Recent Transactions</h3>
    <div class="transaction-list" id="recentTransactionList">
        <!-- Recent transactions will be loaded here -->
        <div class="empty-transactions" id="emptyRecentTransactions">
            <i class="fas fa-history"></i>
            <p>No transactions yet</p>
        </div>
    </div>
    <button class="view-all-btn" id="viewAllTransactionsBtn">View All Transactions</button>
</div>
        </div>
    </div>
</div> 

<!-- Buy Coins Modal -->
<div id="buyCoinsModal" class="buy-coins-modal">
  <div class="buyCoins-modal-content">
    <div class="buyCoins-modal-header">
      <h2>Buy Talent Coins</h2>
         <button class="close-buycoins" id="closebuycoinsmodal">&times;</button>
            <span class="host-sport-category-status coming-soon</span>
          
    </div>
    
    <div class="buyCoins-modal-tabs">
      <button class="buyCoins-tab-btn active" data-tab="buyTab">Buy Coins</button>
      <button class="buyCoins-tab-btn" data-tab="confirmTab">Confirm Payment</button>
    </div>
    
    <!-- Tab 1: Buy Coins -->
    <div id="buyTab" class="buyCoins-tab-content active">
      <div class="coin-purchase-form">
        <h3>Select Coin Package</h3>
        <p class="coin-rate-info">1 Talent Coin = 15 Naira</p>
        
        <div class="coin-packages">
          <div class="package-option">
            <input type="radio" id="package1" name="coinPackage" value="1">
            <label for="package1">1 Talent Coin</label>
            <span class="buyCoins-price">15</span>
          </div>
          
          <div class="buyCoins-package-option">
            <input type="radio" id="package10" name="coinPackage" value="11">
            <label for="package10">10 + 1 Bonus Talent Coins</label>
            <span class="buyCoins-price">150</span>
            <span class="buyCoins-bonus-tag">+1 Bonus</span>
          </div>
          
          <div class="buyCoins-package-option">
            <input type="radio" id="package50" name="coinPackage" value="55">
            <label for="package50">50 + 5 Bonus Talent Coins</label>
            <span class="buyCoins-price">750</span>
            <span class="buyCoins-bonus-tag">+5 Bonus</span>
          </div>
          
          <div class="buyCoins-package-option">
            <input type="radio" id="package100" name="coinPackage" value="110">
            <label for="package100">100 + 10 Bonus Talent Coins</label>
            <span class="buyCoins-price">1,500</span>
            <span class="buyCoins-bonus-tag">+10 Bonus</span>
          </div>
          
          <div class="buyCoins-package-option">
            <input type="radio" id="package200" name="coinPackage" value="220">
            <label for="package200">200 + 20 Bonus Talent Coins</label>
            <span class="buyCoins-price">3,000</span>
            <span class="buyCoins-bonus-tag">+20 Bonus</span>
          </div>
          
          <div class="buyCoins-package-option">
            <input type="radio" id="package1000" name="coinPackage" value="1300">
            <label for="package1000">1000 + 300 Bonus Talent Coins</label>
            <span class="buyCoins-price">15,000</span>
            <span class="buyCoins-bonus-tag">+300 Bonus</span>
          </div>
          
          <div class="buyCoins-package-option">
            <input type="radio" id="package2000" name="coinPackage" value="2600">
            <label for="package2000">2000 + 600 Bonus Talent Coins</label>
            <span class="buyCoins-price">30,000</span>
            <span class="buyCoins-bonus-tag">+600 Bonus</span>
          </div>
        </div>
        
        <div class="buyCoins-summary-section">
          <div class="buyCoins-summary-row">
            <span>Selected Package:</span>
            <span id="selectedPackage">None</span>
          </div>
          <div class="buyCoins-summary-row">
            <span>Total Coins:</span>
            <span id="totalCoins">0</span>
          </div>
          <div class="buyCoins-summary-row">
            <span>Amount to Pay:</span>
            <span id="amountToPay">0</span>
          </div>
        </div>
        
        <button id="payBtn" class="btn btn-success">Pay</button>
      </div>
      
      <!-- Payment Instructions (initially hidden) -->
      <div id="paymentInstructions" class="payment-instructions hidden">
        <h3>Payment Instructions</h3>
        <p>Please transfer the exact amount to the following account:</p>
        
        <div class="account-details">
          <div class="buyCoins-detail-row">
            <span class="buyCoins-detail-label">Account Name:</span>
            <span class="buyCoins-detail-value">Rewarder Quest</span>
          </div>
          <div class="buyCoins-detail-row">
            <span class="buyCoins-detail-label">Account Number (Opay):</span>
            <span class="buyCoins-detail-value">9078139367</span>
            <button class="buyCoins-copy-btn" data-copy="9078139367">Copy</button>
          </div>
          <div class="buyCoins-detail-row">
            <span class="buyCoins-detail-label">Amount:</span>
            <span class="buyCoins-detail-value" id="transferAmount">0</span>
          </div>
        </div>
        
        <div class="instruction-note">
          <p>After making the transfer, please proceed to the "Confirm Payment" tab to complete your purchase.</p>
        </div>
        
        <button class="tab-nav-btn" data-tab="confirmTab">Proceed to Confirm Payment</button>
      </div>
    </div>
    
    <!-- Tab 2: Confirm Payment -->
    <div id="confirmTab" class="buyCoins-tab-content">
      <div class="payment-confirmation-form">
        <h3>Confirm Your Payment</h3>
        <p class="buyCoins-confirmation-info">Please fill in the details of your payment to verify your transaction.</p>
        </div>
        <form id="paymentConfirmationForm">
          <div class="buyCoins-form-group">
            <label for="fullName">Full Name</label>
            <input type="text" id="fullName" name="fullName" required>
          </div>
          
          
        

          
          <div class="buyCoins-form-group">
            <label for="email">Email</label>
            <input type="tel" id="email" name="email" required>
          </div>
          
          
          <div class="buyCoins-verification-notice">
            <p>Talent Coins will be credited to your wallet within 1 to 30 minutes after successful verification.</p>
          </div>
         
    
  
          <button type="submit" id="submitConfirmation" class="btn btn-primary">Submit Confirmation</button>
        </form>
      </div>
      
      <!-- Confirmation Success (initially hidden) -->
      <div id="confirmationSuccess" class="confirmation-success hidden">
        <div class="success-icon">
          <i class="fas fa-check-circle"></i>
        </div>
        <h3>Payment Confirmation Submitted!</h3>
        <p>Your payment confirmation has been submitted successfully.</p>
        <div class="pending-info">
          <p>Your purchase of <span id="pendingCoins">0</span> Talent Coins has been added to your pending balance.</p>
          <p>The coins will be credited to your wallet within 1 to 30 minutes after verification.</p>
        </div>
        <button id="closeModalBtn" class="btn btn-secondary">Close</button>
      </div>
    </div>
  </div>

<!-- Withdraw Modal (Add this to your existing HTML) -->
<div id="withdrawModal" class="withdraw-modal">
  <div class="withdraw-modal-content">
   
     <!-- PIN Verification Screen -->
        <div id="pinVerificationScreen" class="modal-screen active">
            <div class="modal-header">
                <h2>Verify PIN</h2>    
                <button class="close-withdraw-modal" id="closewithdrawmodal">&times;</button>
     
           </div>
            <div class="pin-verification-content">
                <div class="pin-icon">
                    <i class="fas fa-lock"></i>
                </div>
                <h3>Enter Your Wallet PIN</h3>
                <p>Please enter your 4-digit wallet PIN to continue</p>
                
                <div class="pin-input-container">
                    <input type="password" class="pin-digit" maxlength="1" inputmode="numeric" pattern="[0-9]*">
                    <input type="password" class="pin-digit" maxlength="1" inputmode="numeric" pattern="[0-9]*">
                    <input type="password" class="pin-digit" maxlength="1" inputmode="numeric" pattern="[0-9]*">
                    <input type="password" class="pin-digit" maxlength="1" inputmode="numeric" pattern="[0-9]*">
                </div>
                
                <div class="error-message" id="pinError"></div>
                
                <button id="verifyPinBtn" class="btn btn-primary">Verify PIN</button>
            </div>
        </div>
        
       <!-- Withdrawal Form Screen -->
    <div id="withdrawFormScreen" class="withdrawmodal-screen">
      <div class="withdraw-modal-header">
        <h2>Withdraw Funds</h2>
         <button class="close-withdraw-modal" id="closewithdrawmodal">&times;</button>
      <span class="host-sport-category-status coming-soon</span>
          
      </div>
      <div class="withdraw-form-content">
       <div class="balance-info">
   
            <div class="balance-item">
            <span class="balance-label">Talent Coin Balance:</span>
            <span class="balance-value" id="talentcoinBalance">0 TC</span>
          </div>
          <div class="balance-item">
            <span class="balance-label">Naira Equivalent:</span>
            <span class="balance-value" id="nairaEquivalent">0</span>
          </div>
        </div>

        
        <form id="withdrawForm">
          <div class="withdraw-form-group">
            <label for="withdrawAmount">Amount (Talent Coins)</label>
            <input type="number" id="withdrawAmount" name="withdrawAmount" min="10" step="1" required>
            <span class="input-note">Minimum withdrawal: 10 Talent Coins</span>
          </div>
          
          <div class="amount-preview">
           <span>You will receive:</span>
            
              <span id="nairaAmount">0</span>
          </div>
          
          <div class="withdraw-form-group">
            <label for="bankSelect">Select Bank</label>
            <select id="bankSelect" name="bankSelect" required>
              <option value="">-- Select Bank --</option>
              <option value="access">Access Bank</option>
              <option value="firstbank">First Bank</option>
              <option value="gtb">Guaranty Trust Bank</option>
              <option value="zenith">Zenith Bank</option>
              <option value="uba">United Bank for Africa</option>
              <option value="stanbic">Stanbic IBTC Bank</option>
              <option value="fcmb">First City Monument Bank</option>
              <option value="fidelity">Fidelity Bank</option>
              <option value="ecobank">Ecobank</option>
              <option value="union">Union Bank</option>
              <option value="sterling">Sterling Bank</option>
              <option value="polaris">Polaris Bank</option>
              <option value="wema">Wema Bank</option>
              <option value="opay">OPay</option>
              <option value="palmpay">PalmPay</option>
              <option value="kuda">Kuda Bank</option>
              <option value="moniepoint">Moniepoint</option>
            </select>
          </div>
          
          <div class="withdraw-form-group">
            <label for="accountNumber">Account Number</label>
            <input type="text" id="accountNumber" name="accountNumber" pattern="[0-9]{10}" maxlength="10" inputmode="numeric" required>
            <span class="input-note">Enter a valid 10-digit account number</span>
          </div>
          
          <div class="withdraw-form-group">
            <label for="accountName">Account Name</label>
            <input type="text" id="accountName" name="accountName" readonly>
            <button type="button" id="verifyAccountBtn" class="btn btn-secondary btn-sm">Verify Account</button>
          </div>
          
          <div class="withdraw-fee-summary">
            <div class="withdraw-summary-row">
              <span>Withdrawal Amount:</span>
              <span id="withdraw-summaryAmount">0 TC</span>
            </div>
            <div class="withdraw-summary-row">
              <span>Processing Fee:</span>
              <span id="processingFee">0 TC</span>
            </div>
            <div class="withdraw-summary-row total">
              <span>Total Deduction:</span>
              <span id="totalDeduction">0 TC</span>
            </div>
          </div>
          
          <button type="submit" id="submitWithdrawBtn" class="btn btn-success" disabled>Withdraw Funds</button>
        </form>
      </div>
    </div>
    
    <!-- Processing Screen -->
    <div id="processingScreen" class="withdrawmodal-screen">
      <div class="withdrawprocessing-content">
        <div class="loader"></div>
        <h3>Processing Your Withdrawal</h3>
        <p>Please wait while we process your request...</p>
      </div>
    </div>
    
    <!-- Success Screen -->
    <div id="successScreen" class="withdrawmodal-screen">
      <div class="withdrawsuccess-content">
        <div class="success-icon">
          <i class="fas fa-check-circle"></i>
        </div>
        <h3>Withdrawal Successful!</h3>
        <p>Your withdrawal request has been processed successfully.</p>
        
        <div class="withdrawtransaction-details">
          <div class="withdrawdetail-row">
            <span class="withdrawdetail-label">Amount:</span>
            <span class="withdrawdetail-value" id="successAmount">0 TC (0)</span>
          </div>
          <div class="withdrawdetail-row">
            <span class="withdrawdetail-label">Account:</span>
            <span class="withdrawdetail-value" id="successAccount"></span>
          </div>
          <div class="withdrawdetail-row">
            <span class="withdrawdetail-label">Transaction ID:</span>
            <span class="withdrawdetail-value" id="transactionId"></span>
          </div>
          <div class="withdrawdetail-row">
            <span class="withdrawdetail-label">Date & Time:</span>
            <span class="withdrawdetail-value" id="transactionDate"></span>
          </div>
        </div>
        
        <p class="success-note">The funds will be credited to your account within 1min to 5 mins.</p>
        
        <button id="closeSuccessBtn" class="btn btn-primary">Done</button>
      </div>
    </div>
    
    <!-- Error Screen -->
    <div id="errorScreen" class="withdrawmodal-screen">
      <div class="withdrawerror-content">
        <div class="withdrawerror-icon">
          <i class="fas fa-exclamation-circle"></i>
        </div>
        <h3>Withdrawal Failed</h3>
        <p id="withdrawerrorMessage">There was an error processing your withdrawal request.</p>
        
        <div class="withdrawerror-actions"><button id="tryAgainBtn" class="btn btn-primary">Try Again</button>
          <button id="contactSupportBtn" class="btn btn-secondary">Contact Support</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Transaction History Modal -->
<div id="transactionHistoryModal" class="transaction-modal">
    <div class="Historymodal-content">
        <div class="Historymodal-header">
            <h2>Transaction History</h2>
                 <button class="close-History" id="closetransactionhistorymodal">&times;</button>
           <span class="host-sport-category-status coming-soon"></span>
          
        </div>
        
        <div class="Historytransaction-filters">
            <div class="Historyfilter-group">
                <label for="transactionType">Type:</label>
                <select id="transactionType">
                    <option value="all">All Transactions</option>
                    <option value="purchase">Purchases</option>
                    <option value="withdrawal">Withdrawals</option>
                    <option value="commission">Commissions</option>
                    <option value="earning">Earnings</option>
                </select>
            </div>
            
            <div class="Historyfilter-group">
                <label for="dateRange">Period:</label>
                <select id="dateRange">
                    <option value="all">All Time</option>
                    <option value="today">Today</option>
                    <option value="week">This Week</option>
                    <option value="month">This Month</option>
                    <option value="year">This Year</option>
                </select>
            </div>
            
            <div class="Historyfilter-group">
                <label for="transactionStatus">Status:</label>
                <select id="transactionStatus">
                    <option value="all">All Status</option>
                    <option value="completed">Completed</option>
                    <option value="pending">Pending</option>
                    <option value="failed">Failed</option>
                </select>
            </div>
            
            <button id="applyFilters" class="Historyfilter-btn">Apply Filters</button>
        </div>
        
        <div class="transaction-summary">
            <div class="Historysummary-card">
                <h4>Total Purchases</h4>
                <p id="totalPurchases">0 TC</p>
            </div>
            <div class="Historysummary-card">
                <h4>Total Withdrawals</h4>
                <p id="totalWithdrawals">0 TC</p>
            </div>
            <div class="Historysummary-card">
                <h4>Total Earnings</h4>
                <p id="totalEarnings">0 TC</p>
            </div>
            <div class="Historysummary-card">
                <h4>Total Commissions</h4>
                <p id="totalCommissions">0 TC</p>
            </div>
        </div>
        
        <div class="transaction-table-container">
            <table class="transaction-table">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Type</th>
                        <th>Amount</th>
                        <th>Status</th>
                        <th>Details</th>
                    </tr>
                </thead>
                <tbody id="transactionTableBody">
                    <!-- Transactions will be loaded here -->
                </tbody>
            </table>
            
            <div class="empty-state" id="emptyTransactions">
                <i class="fas fa-search"></i>
                <p>No transactions found</p>
                <span>Try changing your filters</span>
            </div>
            
            <div class="loading-transactions" id="loadingTransactions">
                <i class="fas fa-spinner fa-spin"></i>
                <p>Loading transactions...</p>
            </div>
        </div>
        
        <div class="History-pagination">
            <button id="prevPage" class="pagination-btn" disabled>
                <i class="fas fa-chevron-left"></i> Previous
            </button>
            <span id="pageIndicator">Page 1 of 1</span>
            <button id="nextPage" class="pagination-btn" disabled>
                Next <i class="fas fa-chevron-right"></i>
            </button>
        </div>
        
        <div class="Historyexport-section">
            <button id="exportCSV" class="export-btn">
                <i class="fas fa-file-csv"></i> Export CSV
            </button>
            <button id="printTransactions" class="export-btn">
                <i class="fas fa-print"></i> Print
            </button>
        </div>
    </div>
</div>

<!-- Transaction Details Modal -->
<div id="transactionDetailsModal" class="transaction-details-modal">
    <div class="Historymodal-content">
        <div class="modal-header">
            <h2>Transaction Details</h2>
                 <button class="close-History" id="closetransactiondetailsmodal">&times;</button>
           <span class="host-sport-category-status coming-soon"></span>
          
        </div>
        
        <div class="transaction-details-content" id="transactionDetailsContent">
            <!-- Transaction details will be loaded here -->
        </div>
        
        <div class="Historymodal-footer">
            <button id="closeDetailsBtn" class="btn btn-secondary">Close</button>
        </div>
    </div>
</div>



<div class="game-portal-container">
  <!-- Game Portal Header -->
  <div class="game-portal-header">
    <h2>Game Portal</h2>
    <button class="close-portal-btn">&times;</button>
  </div>

  <!-- Game Categories -->
  <div class="game-categories">
    <button class="category-btn active" data-category="all">All Games</button>
    <button class="category-btn" data-category="action">Action</button>
    <button class="category-btn" data-category="puzzle">Puzzle</button>
    <button class="category-btn" data-category="strategy">Strategy</button>
    <button class="category-btn" data-category="arcade">Arcade</button>
    <button class="category-btn" data-category="card">Card Games</button>
  </div>

  <!-- Search Bar -->
  <div class="game-search-container">
    <input type="text" id="gameSearch" placeholder="Search games...">
    <button class="search-btn"><i class="fas fa-search"></i></button>
  </div>

  <!-- Featured Games Carousel -->
  <div class="featured-games-carousel">
    <h3>Featured Games</h3>
    <div class="carousel-container">
      <button class="carousel-nav prev"><i class="fas fa-chevron-left"></i></button>
      <div class="carousel-items">
        <div class="featured-game" data-game-id="game1">
        <div class="game-thumbnail" style="background-image: url('https://i.ibb.co/5WFQSyCD/Chat-GPT-Image-Jul-14-2025-10-50-36-AM.png');"></div>
 <div class="game-info">
            <h4>Tic Tac Toes</h4>
           
          </div>
        </div>
        <div class="featured-game" data-game-id="game2">
          <div class="game-thumbnail" style="background-image: url('images/games/featured-game2.jpg')"></div>
          <div class="game-info">
            <h4>Puzzle Master</h4>
            <div class="game-meta">
              <span class="game-category">Puzzle</span>
              <span class="game-rating"><i class="fas fa-star"></i> 4.6</span>
            </div>
          </div>
        </div>
        <div class="featured-game" data-game-id="game3">
          <div class="game-thumbnail" style="background-image: url('images/games/featured-game3.jpg')"></div>
          <div class="game-info">
            <h4>Card Kingdom</h4>
            <div class="game-meta">
              <span class="game-category">Card</span>
              <span class="game-rating"><i class="fas fa-star"></i> 4.7</span>
            </div>
          </div>
        </div>
      </div>
      <button class="carousel-nav next"><i class="fas fa-chevron-right"></i></button>
    </div>
  </div>

  <!-- Game Grid -->
  <div class="games-grid-container">
    <h3>All Games</h3>
    <div class="games-grid">
      <!-- Game Card Template -->
      <!-- These will be dynamically populated from your game data -->
      <div class="game-card" data-game-id="game1" data-category="action">
        <div class="game-thumbnail" style="background-image: url('images/games/game1.jpg')">
          <div class="game-overlay">
            <button class="play-now-btn">Play Now</button>
          </div>
        </div>
        <div class="game-details">
          <h4 class="game-title">Space Adventure</h4>
          <div class="game-meta">
            <span class="game-category">Action</span>
            <span class="game-rating"><i class="fas fa-star"></i> 4.8</span>
          </div>
          <p class="game-description">Explore the universe and battle alien forces in this action-packed space adventure.</p>
          <div class="game-stats">
            <span class="plays-count"><i class="fas fa-gamepad"></i> 12.5k plays</span>
            <span class="coin-reward"><i class="fas fa-coins"></i> Win up to 50 coins</span>
          </div>
        </div>
      </div>

      <!-- More game cards will be added dynamically -->
    </div>

    <!-- Load More Games Button -->
    <button class="load-more-btn">Load More Games</button>
  </div>

  <!-- Recently Played Games -->
  <div class="recently-played-container">
    <h3>Recently Played</h3>
    <div class="recently-played-games">
      <!-- Will be populated dynamically based on user history -->
      <p class="no-games-message">You haven't played any games yet.</p>
    </div>
  </div>
</div>

<!-- Game Modal (appears when a game is selected) -->
<div id="gameModal" class="game-modal">
  <div class="game-modal-content">
    <div class="game-modal-header">
      <h2 id="modalGameTitle">Game Title</h2>
      <button class="close-game-modal">&times;</button>
    </div>
    <div class="game-modal-body">
      <div class="game-iframe-container">
        <iframe id="gameIframe" src="" frameborder="0" allowfullscreen></iframe>
      </div>
      <div class="game-controls">
        <button class="fullscreen-btn"><i class="fas fa-expand"></i></button>
        <button class="refresh-game-btn"><i class="fas fa-redo"></i></button>
      </div>
      <div class="game-info-panel">
        <div class="game-description-panel">
          <h3>About This Game</h3>
          <p id="modalGameDescription">Game description will appear here.</p>
        </div>
        <div class="game-rewards-panel">
          <h3>Rewards</h3>
          <p>Win up to <span id="modalGameReward">0</span> Talent Coins by achieving high scores!</p>
          <div class="reward-tiers">
            <div class="reward-tier">
              <span class="tier-label">Bronze</span>
              <span class="tier-coins">5 Coins</span>
            </div>
            <div class="reward-tier">
              <span class="tier-label">Silver</span>
              <span class="tier-coins">15 Coins</span>
            </div>
            <div class="reward-tier">
              <span class="tier-label">Gold</span>
              <span class="tier-coins">30 Coins</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>


<!-- Rewarder Modal - Initially hidden -->
<div id="rewarderModal" class="rewarder-modal hidden">
    <div class="rewarder-modal-content">
        <div class="rewarder-modal-header">
            <h2>Rewarder Quest</h2>
            <span class="close-rewarder-modal">&times;</span>
        </div>
        <div class="rewarder-modal-body">
            <p class="rewarder-intro">Complete quests to earn Talent Coins and bonuses</p>
             <!--  Bonuses Card -->
                <div class="bonus-card" id="bonusesCard">
                    <div class="bonus-icon">
                        <i class="fas fa-gift"></i>
                    </div>
                    <div class="bonus-info">
                        <h3>Bonuses</h3>
                        <p>Special rewards and offers</p>
                        <div class="bonus-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 0%"></div>
                            </div>
                            <span class="progress-text">0/5 bonuses</span>
                        </div>
                    </div>
                    <button class="claim-btn" id="bonusesBtn">
                        <span class="btn-text">View</span>
                        <span class="coin-amount">+?</span>
                    </button>
                </div>
            <!-- Bonus Cards Container -->
            <div class="bonus-cards-container">
                <!-- Daily Login Bonus Card -->
                <div class="bonus-card" id="dailyLoginCard">
                    <div class="bonus-icon">
                        <i class="fas fa-calendar-check"></i>
                    </div>
                    <div class="bonus-info">
                        <h3>Daily Login</h3>
                        <p>Login daily to earn coins</p>
                        <div class="bonus-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 0%"></div>
                            </div>
                            <span class="progress-text">0/7 days</span>
                        </div>
                    </div>
                    <button class="claim-btn" id="claimDailyBtn" disabled>
                        <span class="btn-text">Claim</span>
                        <span class="coin-amount">+1</span>
                    </button>
                </div>

                <!-- Referral Bonus Card -->
                <div class="bonus-card" id="referralCard">
                    <div class="bonus-icon">
                        <i class="fas fa-user-plus"></i>
                    </div>
                    <div class="bonus-info">
                        <h3>Refer Friends</h3>
                        <p>Earn when friends join</p>
                        <div class="bonus-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 0%"></div>
                            </div>
                            <span class="progress-text">0 referrals</span>
                        </div>
                    </div>
                    <button class="claim-btn" id="referBtn">
                        <span class="btn-text">Refer</span>
                        <span class="coin-amount">+5</span>
                    </button>
                </div>

                <!-- Investment Bonus Card -->
                <div class="bonus-card" id="investmentCard">
                    <div class="bonus-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div class="bonus-info">
                        <h3>Invest</h3>
                        <p>Grow your coins with interest</p>
                        <div class="bonus-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 0%"></div>
                            </div>
                            <span class="progress-text">0 coins invested</span>
                        </div>
                    </div>
                    <button class="claim-btn" id="investBtn">
                        <span class="btn-text">Invest</span>
                        <span class="coin-amount">+10%</span>
                    </button>
                </div>

                <!-- Journey Bonus Card -->
                <div class="bonus-card" id="journeyCard">
                    <div class="bonus-icon">
                        <i class="fas fa-route"></i>
                    </div>
                    <div class="bonus-info">
                        <h3>Journey</h3>
                        <p>Complete tasks to earn rewards</p>
                        <div class="bonus-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 0%"></div>
                            </div>
                            <span class="progress-text">0/10 tasks</span>
                        </div>
                    </div>
                    <button class="claim-btn" id="journeyBtn">
                        <span class="btn-text">Start</span>
                        <span class="coin-amount">+20</span>
                    </button>
                </div>

               
            </div>

            <!-- Advertisement Banner -->
            <div class="ad-banner">
                <img src="assets/images/ad-banner.jpg" alt="Special Offer" width="400" height="60">
            </div>

            <!-- Rewarder Quests Section -->
            <div class="rewarder-quests">
                <h3>Available Quests</h3>
                
                <div class="quest-list">
                    <!-- Quest Item 1 -->
                    <div class="quest-item">
                        <div class="quest-icon">
                            <i class="fas fa-user-edit"></i>
                        </div>
                        <div class="quest-details">
                            <h4>Complete Your Profile</h4>
                            <p>Add a profile picture and complete your bio</p>
                            <div class="quest-progress">
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 30%"></div>
                                </div>
                                <span class="progress-text">30% complete</span>
                            </div>
                        </div>
                        <div class="quest-reward">
                            <span class="coin-amount">+3</span>
                            <button class="quest-btn" data-quest="profile">Start</button>
                        </div>
                    </div>

                    <!-- Quest Item 2 -->
                    <div class="quest-item">
                        <div class="quest-icon">
                            <i class="fas fa-comment"></i>
                        </div>
                        <div class="quest-details">
                            <h4>Post 5 Comments</h4>
                            <p>Engage with the community by posting comments</p>
                            <div class="quest-progress">
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 20%"></div>
                                </div>
                                <span class="progress-text">1/5 comments</span>
                            </div>
                        </div>
                        <div class="quest-reward">
                            <span class="coin-amount">+5</span>
                            <button class="quest-btn" data-quest="comments">Continue</button>
                        </div>
                    </div>

                    <!-- Quest Item 3 -->
                    <div class="quest-item">
                        <div class="quest-icon">
                            <i class="fas fa-share-alt"></i>
                        </div>
                        <div class="quest-details">
                            <h4>Share Content</h4>
                            <p>Share 3 posts on social media</p>
                            <div class="quest-progress">
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 0%"></div>
                                </div>
                                <span class="progress-text">0/3 shares</span>
                            </div>
                        </div>
                        <div class="quest-reward">
                            <span class="coin-amount">+7</span>
                            <button class="quest-btn" data-quest="share">Start</button>
                        </div>
                    </div>

                    <!-- Quest Item 4 -->
                    <div class="quest-item">
                        <div class="quest-icon">
                            <i class="fas fa-upload"></i>
                        </div>
                        <div class="quest-details">
                            <h4>Upload Content</h4>
                            <p>Upload your first original content</p>
                            <div class="quest-progress">
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 0%"></div>
                                </div>
                                <span class="progress-text">0/1 uploads</span>
                            </div>
                        </div>
                        <div class="quest-reward">
                            <span class="coin-amount">+10</span>
                            <button class="quest-btn" data-quest="upload">Start</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Referral Sub-Modal (Hidden by default) -->
<div id="referralSubModal" class="rewarder-sub-modal hidden">
    <div class="rewarder-sub-modal-content">
        <div class="rewarder-sub-modal-header">
            <h2>Refer Friends & Earn</h2>
            <span class="close-rewarder-sub-modal">&times;</span>
        </div>
        <div class="rewarder-sub-modal-body">
            <div class="referral-info">
                <div class="referral-icon">
                    <i class="fas fa-users"></i>
                </div>
                <h3>Earn 5 Talent Coins for each friend who joins!</h3>
                <p>Share your unique referral link with friends. When they sign up, you'll both receive 5 Talent Coins.</p>
            </div>
            
            <div class="referral-link-container">
                <label for="referralLink">Your Referral Link:</label>
                <div class="link-copy-group">
                    <input type="text" id="referralLink" readonly>
                    <button id="copyReferralLink" class="copy-btn">
                        <i class="fas fa-copy"></i>
                    </button>
                </div>
            </div>
            
            <div class="share-options">
                <h4>Share via:</h4>
                <div class="social-share-buttons">
                    <button class="share-btn whatsapp">
                        <i class="fab fa-whatsapp"></i>
                    </button>
                    <button class="share-btn facebook">
                        <i class="fab fa-facebook-f"></i>
                    </button>
                    <button class="share-btn twitter">
                        <i class="fab fa-twitter"></i>
                    </button>
                    <button class="share-btn telegram">
                        <i class="fab fa-telegram-plane"></i>
                    </button>
                </div>
            </div>
            
            <div class="referral-stats">
                <div class="stat-item">
                    <span class="stat-label">Total Referrals:</span>
                    <span class="stat-value" id="totalReferrals">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Coins Earned:</span>
                    <span class="stat-value" id="referralCoinsEarned">0</span>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Investment Sub-Modal (Hidden by default) -->
<div id="investmentSubModal" class="rewarder-sub-modal hidden">
    <div class="rewarder-sub-modal-content">
        <div class="rewarder-sub-modal-header">
            <h2>Invest Your Talent Coins</h2>
            <span class="close-rewarder-sub-modal">&times;</span>
        </div>
        <div class="rewarder-sub-modal-body">
            <div class="investment-info">
                <div class="investment-icon">
                    <i class="fas fa-chart-line"></i>
                </div>
                <h3>Grow your coins with interest!</h3>
                <p>Invest your Talent Coins and earn up to 10% interest over time.</p>
            </div>
            
            <div class="investment-plans">
                <div class="plan-option">
                    <input type="radio" id="plan1" name="investmentPlan" value="basic">
                    <label for="plan1">
                        <div class="plan-details">
                            <h4>Basic Plan</h4>
                            <p>5% return after 7 days</p>
                            <p class="min-amount">Min: 10 Coins</p>
                        </div>
                    </label>
                </div>
                
                <div class="plan-option">
                    <input type="radio" id="plan2" name="investmentPlan" value="standard">
                    <label for="plan2">
                        <div class="plan-details">
                            <h4>Standard Plan</h4>
                            <p>7% return after 14 days</p>
                            <p class="min-amount">Min: 50 Coins</p>
                        </div>
                    </label>
                </div>
                
                <div class="plan-option">
                    <input type="radio" id="plan3" name="investmentPlan" value="premium">
                    <label for="plan3">
                        <div class="plan-details">
                            <h4>Premium Plan</h4>
                            <p>10% return after 30 days</p>
                            <p class="min-amount">Min: 100 Coins</p>
                        </div>
                    </label>
                </div>
            </div>
            
            <div class="investment-amount">
                <label for="coinAmount">Amount to Invest:</label>
                <input type="number" id="coinAmount" min="10" placeholder="Enter coin amount">
            </div>
            
            <div class="investment-summary">
                <div class="summary-row">
                    <span>Investment Amount:</span>
                    <span id="investmentAmount">0 Coins</span>
                </div>
                <div class="summary-row">
                    <span>Expected Return:</span>
                    <span id="expectedReturn">0 Coins</span>
                </div>
                <div class="summary-row">
                    <span>Maturity Date:</span>
                    <span id="maturityDate">-</span>
                </div>
            </div>
            
            <button id="confirmInvestmentBtn" class="btn btn-primary">Invest Now</button>
        </div>
    </div>
</div>

        

           <!-- Creator Page Modal -->
<div class="creator-modal-overlay" id="creatorModal" onclick="closeCreatorModal(event)">
    <div class="creator-modal-container" onclick="event.stopPropagation()">
        <!-- Modal Header with Close Button -->
        <div class="creator-modal-header">
            <h2> Creator Hub</h2>
            <button class="creator-modal-close-btn" onclick="closeCreatorModal()">
                <i class="fas fa-times"></i>
            </button>
        </div>

        <!-- Top Banner Ad -->
        <div class="creator-banner-ad top-banner">
            <div class="creator-ad-content">
                <span class="creator-ad-label">Sponsored</span>
                <p>Create amazing events and reach thousands of participants!</p>
            </div>
            
        </div>

        <!-- Scrollable Content Area -->
        <div class="creator-content-area">
            <div class="creator-cards-container">
                <!-- Entertainment Event Card -->
                <div class="creator-card-btn" onclick="openEntertainmentEvent()">
                    <div class="creator-card-icon">
                        <i class="fas fa-theater-masks"></i>
                    </div>
                    <div class="creator-card-content">
                        <h3>Entertainment Event</h3>
                        <p>Create talent shows, performances & entertainment events</p>
                    </div>
                    <div class="creator-card-arrow">
                        <i class="fas fa-chevron-right"></i>
                    </div>
                     <span class="host-sport-category-status coming-soon"></span>
          
                </div>

                <!-- Sport Event Card -->
                <div class="creator-card-btn" onclick="openSportEvent()">
                    <div class="creator-card-icon">
                        <i class="fas fa-trophy"></i>
                    </div>
                    <div class="creator-card-content">
                        <h3>Sport Event</h3>
                        <p>Organize sports competitions & tournaments</p>
                    </div>
                    <div class="creator-card-arrow">
                        <i class="fas fa-chevron-right"></i>
                    </div>
                </div>

 <!-- Nomination Form  -->
                <div class="creator-card-btn" onclick="openNominationform()">
                    <div class="creator-card-icon">
                        <i class="fas fa-trophy"></i>
                    </div>
                    <div class="creator-card-content">
                        <h3>Nomination form</h3>
                        <p> The nominizes are </p>
                    </div>
                    <div class="creator-card-arrow">
                        <i class="fas fa-chevron-right"></i>
                    </div>
                </div>

                <!-- Award Ceremony Card -->
                <div class="creator-card-btn" onclick="openAwardCeremony()">
                    <div class="creator-card-icon">
                        <i class="fas fa-award"></i>
                    </div>
                    <div class="creator-card-content">
                        <h3>Award Ceremony</h3>
                        <p>Host award ceremonies & recognition events</p>
                    </div>
                    <div class="creator-card-arrow">
                        <i class="fas fa-chevron-right"></i>
                    </div>
                </div>

               
            </div>
        </div>

        <!-- Bottom Banner Ad -->
        <div class="creator-banner-ad bottom-banner">
            <div class="creator-ad-content">
                <span class="creator-ad-label">Featured</span>
                <p>Boost your events with premium features and wider reach!</p>
            </div>
        </div>
    </div>
</div>
             
                      
       <!-- Entertainment Event Page -->
<div class="entertainment-event-page" id="entertainmentEventPage">
    <!-- Close Button -->
    <div class="entertainment-page-header">
        <h2>Entertainment Event</h2>
        <button class="close-entertainment-event-page-btn" id="closeEntertainmentEventPageBtn">
            <i class="fas fa-times"></i>
        </button>
    </div>

    <!-- Banner Ad -->
    <div class="entertainment-banner-ad">
        <div class="entertainment-ad-content">
            <span class="entertainment-ad-label">Sponsored</span>
            <p>Create amazing entertainment events and showcase your talent to the world!</p>
        </div>
    </div>

    <!-- Action Buttons -->
    <div class="entertainment-action-buttons">
        <button class="entertainment-action-btn host-entertainment-event" id="hostEntertainmentEvent">
            <div class="entertainment-btn-icon">
                <i class="fas fa-plus-circle"></i>
            </div>
            <span>Host</span>
        </button>

        <button class="entertainment-action-btn joined-entertainment-event" id="joinedEntertainmentEvent">
            <div class="entertainment-btn-icon">
                <i class="fas fa-users"></i>
            </div>
            <span>Joined</span>
        </button>
    </div>

    <!-- Tabs Navigation -->
    <div class="entertainment-tabs">
        <div class="entertainment-tabs-header">
            <button class="entertainment-tab-btn active live-entertainment-event" id="liveEntertainmentEvent" onclick="switchEntertainmentTab('live')">
                <i class="fas fa-broadcast-tower"></i>
                <span> Physical event </span>
            </button>
            <button class="entertainment-tab-btn new-entertainment-event" id="newEntertainmentEvent" onclick="switchEntertainmentTab('new')">
                <i class="fas fa-calendar-plus"></i>
                <span>online Events</span>
            </button>
           
        </div>

        <!-- Tab Contents -->
        <div class="entertainment-tab-content">
            <!-- Live Events Tab -->
            <div class="entertainment-tab-pane active" id="entertainment-live-tab">
                <!-- Search and Filter Controls -->
                <div id="searchFilterControls"></div>
                
                <div class="entertainment-cards-container" id="liveEventsContainer">
                    <!-- Entertainment cards will be loaded here -->
                    <div class="entertainment-empty-state">
                        <i class="fas fa-broadcast-tower"></i>
                        <p>No live events of yours now</p>
                    </div>
                </div>
            </div>

            <!-- New Events Tab -->
            <div class="entertainment-tab-pane" id="entertainment-new-tab">
                <div class="entertainment-cards-container" id="newEventsContainer">
                    <!-- Entertainment cards will be loaded here -->
                    <div class="entertainment-empty-state">
                        <i class="fas fa-calendar-plus"></i>
                        <p>No entertainment card<br>Try creating</p>
                    </div>
                </div>
            </div>

            <!-- Previous Events Tab -->
            <div class="entertainment-tab-pane" id="entertainment-previous-tab">
                <div class="entertainment-cards-container" id="previousEventsContainer">
                    <!-- Entertainment cards will be loaded here -->
                    <div class="entertainment-empty-state">
                        <i class="fas fa-history"></i>
                        <p>No previous events</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
     
<!-- Host Entertainment Event Popup -->
<div class="host-entertainment-popup-overlay" id="hostEntertainmentPopup">
    <div class="host-entertainment-popup-container">
        <!-- Close Button -->
        <div class="host-entertainment-popup-header">
            <h2> Host Entertainment Event</h2>
            <button class="close-host-entertainment-popup-btn" id="closeHostEntertainmentPopupBtn">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <!-- Banner Ad -->
        <div class="host-entertainment-banner-ad">
            <div class="host-entertainment-ad-content">
                <span class="host-entertainment-ad-label">Featured</span>
                <p>Create your entertainment event and connect with talented participants!</p>
            </div>
        </div>
        
        <!-- Form Content -->
        <div class="host-entertainment-form-content">
            <form id="hostEntertainmentForm">
                
                <!-- Event Mode Selection -->
                <div class="form-group" id="eventModeGroup">
                    <label for="eventMode">Event Mode</label>
                    <div class="event-mode-selection">
                        <div class="mode-option">
                            <input type="radio" id="onlineEvent" name="eventMode" value="online" checked>
                            <label for="onlineEvent" class="mode-option-label" onclick="selectEventMode('online')">
                                <i class="fas fa-laptop"></i>
                                <span>Online Event</span>
                                <small>Virtual entertainment competitions</small>
                            </label>
                        </div>
                        <div class="mode-option">
                            <input type="radio" id="physicalEvent" name="eventMode" value="physical">
                            <label for="physicalEvent" class="mode-option-label" onclick="selectEventMode('physical')">
                                <i class="fas fa-map-marker-alt"></i>
                                <span>Physical Event</span>
                                <small>In-person events and gatherings</small>
                            </label>
                        </div>
                    </div>
                </div>
                 <!-- ONLINE EVENT SECTIONS -->
                <div id="onlineEventSections">
                    
                    <!-- Event Type Selection -->
                    <div class="form-group">
                        <label for="eventType">Event Type</label>
                        <select id="eventType" class="form-select" onchange="updateEventTypeOptions()">
                            <option value="">Select Event Type</option>
                            <option value="medium">Medium Event</option>
                            <option value="tactical">Tactical Event</option>
                            <option value="bigRush">Big Rush</option>
                        </select>
                    </div>

                    <!-- Category Selection -->
                    <div class="form-group" id="categoryGroup" style="display: none;">
                        <label for="eventCategory">Category</label>
                        <select id="eventCategory" class="form-select">
                            <option value="">Select Category</option>
                        </select>
                        <div class="custom-category-input" style="display: none;">
                            <input type="text" id="customCategory" placeholder="Enter custom category" class="form-input">
                            <button type="button" onclick="addCustomCategory()" class="add-category-btn">Add</button>
                        </div>
                        <button type="button" onclick="toggleCustomCategory()" class="custom-category-toggle">Add Custom Category</button>
                    </div>

                    <!-- Duration Selection -->
                    <div class="form-group" id="durationGroup" style="display: none;">
                        <label for="eventDuration">Event Duration</label>
                        <select id="eventDuration" class="form-select">
                            <option value="">Select Duration</option>
                        </select>
                    </div>

                    <!-- Participants -->
                    <div class="form-group" id="participantsGroup" style="display: none;">
                        <label for="maxParticipants">Maximum Participants</label>
                        <input type="number" id="maxParticipants" class="form-input" min="10" max="50">
                        <small class="form-help" id="participantsHelp">Minimum: 10, Maximum: 50</small>
                    </div>

                    <!-- Entry Fee -->
                    <div class="form-group" id="entryFeeGroup" style="display: none;">
                        <label>Entry Fee</label>
                        <div class="fee-options">
                            <div class="fee-input-wrapper">
                                <input type="number" id="entryFee" class="form-input fee-input" min="1" max="500" placeholder="30">
                                <span class="currency-label">TC</span>
                                <span class="naira-equivalent" id="entryFeeNaira"> 450</span>
                            </div>
                            <button type="button" class="no-fee-btn" id="noEntryFeeBtn" onclick="toggleEntryFee()">No Entry Fee</button>
                        </div>
                    </div>

                    <!-- Voting Fee -->
                    <div class="form-group" id="votingFeeGroup" style="display: none;">
                        <label>Voting Fee</label>
                        <div class="fee-options">
                            <div class="fee-input-wrapper">
                                <input type="number" id="votingFee" class="form-input fee-input" min="1" max="500" placeholder="20">
                                <span class="currency-label">TC</span>
                                <span class="naira-equivalent" id="votingFeeNaira"> 300</span>
                            </div>
                            <button type="button" class="no-fee-btn" id="noVotingFeeBtn" onclick="toggleVotingFee()">No Voting Fee</button>
                        </div>
                    </div>

                    <!-- Event Name -->
                    <div class="form-group" id="eventNameGroup" style="display: none;">
                        <label for="eventName">Event Name</label>
                        <input type="text" id="eventName" class="form-input" placeholder="Enter event name" maxlength="50">
                    </div>

                    <!-- Event Description -->
                    <div class="form-group" id="descriptionGroup" style="display: none;">
                        <label for="eventDescription">Event Description</label>
                        <textarea id="eventDescription" class="form-textarea" placeholder="Describe your event (20-100 words)" rows="4"></textarea>
                        <small class="form-help">
                            <span id="wordCount">0</span>/100 words (minimum 20 words)
                        </small>
                    </div>

                    <!-- Background Selection -->
                    <div class="form-group" id="backgroundGroup" style="display: none;">
                        <label>Event Background</label>
                        <div class="background-options">
                            <div class="background-tabs">
                                <button type="button" class="bg-tab active" onclick="switchBackgroundTab('image')">Image</button>
                                <button type="button" class="bg-tab" onclick="switchBackgroundTab('color')">Color</button>
                            </div>
                            <div class="background-content">
                                <div class="bg-content active" id="imageContent">
                                    <input type="file" id="backgroundImage" accept="image" class="file-input">
                                    <label for="backgroundImage" class="file-label">
                                        <i class="fas fa-upload"></i>
                                        Choose Background Image
                                    </label>
                                    
                                    <!-- Image Preview Container -->
                                    <div id="imagePreviewContainer" class="image-preview-container">
                                        <img id="imagePreview" class="image-preview" alt="Preview">
                                        <div id="imagePreviewText" class="image-preview-text"></div>
                                        <button type="button" id="removeImageBtn" class="remove-image-btn">
                                            <i class="fas fa-trash"></i>
                                            Remove Image
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="bg-content" id="colorContent">
                                    <div class="color-palette">
                                        <div class="color-option" style="background: #FF6B6B" onclick="selectColor('#FF6B6B')"></div>
                                        <div class="color-option" style="background: #4ECDC4" onclick="selectColor('#4ECDC4')"></div>
                                        <div class="color-option" style="background: #45B7D1" onclick="selectColor('#45B7D1')"></div>
                                        <div class="color-option" style="background: #96CEB4" onclick="selectColor('#96CEB4')"></div>
                                        <div class="color-option" style="background: #FFEAA7" onclick="selectColor('#FFEAA7')"></div>
                                        <div class="color-option" style="background: #DDA0DD" onclick="selectColor('#DDA0DD')"></div>
                                    </div>
                                    <input type="color" id="customColor" class="custom-color-input" onchange="selectColor(this.value)">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Tags -->
                    <div class="form-group" id="tagsGroup" style="display: none;">
                        <label>Tags</label>
                        <div class="tags-section">
                            <div class="tag-input-section">
                                <input type="text" id="hashtagInput" placeholder="Add hashtag" class="tag-input">
                                <button type="button" onclick="addHashtag()" class="add-tag-btn"># Add</button>
                            </div>
                            <div class="tag-input-section">
                                <input type="text" id="startagInput" placeholder="Add star tag" class="tag-input">
                                <button type="button" onclick="addStartag()" class="add-tag-btn">* Add</button>
                            </div>
                            <div class="tags-display">
                                <div class="hashtags" id="hashtagsDisplay"></div>
                                <div class="startags" id="startagsDisplay"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Event Rules -->
                    <div class="form-group" id="rulesGroup" style="display: none;">
                        <label>Event Rules</label>
                        <div class="rules-section">
                            <div class="rule-input-section">
                                <textarea id="ruleInput" placeholder="Enter event rule" class="rule-textarea" rows="2"></textarea>
                                <button type="button" onclick="addRule()" class="add-rule-btn">Add Rule</button>
                            </div>
                            <div class="rules-list" id="rulesList"></div>
                            <small class="form-help">
                                <span id="rulesCount">0</span>/15 rules (minimum 1 rule required)
                            </small>
                        </div>
                    </div>

                    <!-- Payment Section -->
                    <div class="form-group" id="paymentGroup" style="display: none;">
                        <label class="form-label">Payment Method</label>
                        
                        <!-- Payment Method Selection -->
                        <div class="payment-method-selection">
                            <div class="payment-option">
                                <input type="radio" id="tcBalancePayment" name="paymentMethod" value="tcBalance" checked>
                                <label for="tcBalancePayment" class="payment-option-label" onclick="togglePaymentMethod('tcBalance')">
                                    <i class="fas fa-coins"></i>
                                    <span>Pay with TC Balance</span>
                                </label>
                            </div>
                            <div class="payment-option">
                                <input type="radio" id="promoCodePayment" name="paymentMethod" value="promoCode">
                                <label for="promoCodePayment" class="payment-option-label" onclick="togglePaymentMethod('promoCode')">
                                    <i class="fas fa-ticket-alt"></i>
                                    <span>Use Promo Code</span>
                                </label>
                            </div>
                        </div>

                        <!-- Promo Code Input -->
                        <div class="promo-code-section" id="promoCodeSection" style="display: none;">
                            <input type="text" id="promoCodeInput" class="form-input" placeholder="Enter promo code (Bisask19, nig2025, Ismartdc)">
                            <small class="form-help">Valid codes: Bisask19, nig2025, Ismartdc</small>
                        </div>

                        <!-- Payment Summary -->
                        <div class="payment-summary">
                            <h3>Payment Summary</h3>
                            <div class="creation-fee-breakdown">
                                <div class="fee-item">
                                    <span>Event Type:</span>
                                    <span id="selectedEventType">-</span>
                                </div>
                                <div class="fee-item">
                                    <span>Creation Fee:</span>
                                    <span id="creationFee">0 TC</span>
                                </div>
                                <div class="fee-item" id="feeDiscountItem" style="display: none;">
                                    <span>Discount (No Entry/Voting Fee):</span>
                                    <span id="discountAmount">0 TC</span>
                                </div>
                                <div class="fee-item total-fee">
                                    <span>Total Creation Fee:</span>
                                    <span id="totalCreationFee">0 TC</span>
                                </div>
                                <div class="fee-equivalent">
                                    <span> <span id="totalCreationFeeNaira">0</span></span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Submit Button -->
                    <div class="form-actions" id="submitGroup" style="display: none;">
                        <button type="submit" class="submit-btn" id="createphysicalEventBtn">
                            <i class="fas fa-rocket"></i>
                            Create Event
                        </button>
                    </div>
                </div>
           <!-- PHYSICAL EVENT SECTIONS -->
<div id="physicalEventSections">
    <!-- Physical Event Category Selection -->
    <div class="form-group" id="physicalCategoryGroup">
        <label for="physicalEventCategory">Event Category</label>
        <select id="physicalEventCategory" class="form-select" onchange="updatePhysicalCategory()">
            <option value="">Select Category</option>
            <optgroup label="Performance Arts">
                <option value="singing">Singing</option>
                <option value="music">Music</option>
                <option value="dance">Dance</option>
                <option value="comedy">Comedy</option>
                <option value="theater">Theater</option>
            </optgroup>
            <optgroup label="Visual Arts">
                <option value="art-exhibition">Art Exhibition</option>
                <option value="fashion-show">Fashion Show</option>
            </optgroup>
            <optgroup label="Sports & Recreation">
                <option value="sports">Sports Events</option>
            </optgroup>
            <optgroup label="Business & Learning">
                <option value="conference">Conference</option>
                <option value="workshop">Workshop</option>
            </optgroup>
            <optgroup label="Social & Cultural">
                <option value="food-drinks">Food & Drinks</option>
                <option value="networking">Networking</option>
                <option value="festival">Festival</option>
            </optgroup>
            <option value="other">Other</option>
        </select>
        <div class="custom-physical-category-input" style="display: none;">
            <input type="text" id="customPhysicalCategory" placeholder="Enter custom category" class="form-input">
            <button type="button" onclick="addCustomPhysicalCategory()" class="add-category-btn">Add</button>
        </div>
    </div>

    <!-- Event Name -->
    <div class="form-group" id="physicalEventNameGroup">
        <label for="physicalEventName">Event Name</label>
        <input type="text" id="physicalEventName" class="form-input" placeholder="Enter event name" minlength="3" maxlength="50">
        <small class="form-help">3-50 characters required</small>
    </div>

    <!-- Physical Event Background -->
    <div class="form-group" id="physicalBackgroundGroup">
        <label>Event Background</label>
        <div class="background-options">
            <div class="background-tabs">
                <button type="button" class="bg-tab active" onclick="switchPhysicalBackgroundTab('media')">Media</button>
                <button type="button" class="bg-tab" onclick="switchPhysicalBackgroundTab('gradient')">Gradient</button>
            </div>
            <div class="background-content">
                <div class="bg-content active" id="physicalMediaContent">
                  <input type="file" id="physicalBackgroundMedia" accept="image/*,video/*,.gif" class="file-input" onchange="handlePhysicalMediaUpload(this)">


                    <label for="physicalBackgroundMedia" class="file-label">
                        <i class="fas fa-upload"></i>
                        Choose Media (Image, GIF, Video)
                    </label>
                    <small class="form-help">Supported: JPG, PNG, GIF, MP4, MOV | Max: 10MB | Video: 15s max</small>
                    <div id="physicalMediaPreviewContainer" class="media-preview-container" style="display: none;">
                        <div id="physicalMediaPreview" class="media-preview"></div>
                        <button type="button" id="removePhysicalMediaBtn" class="remove-media-btn" onclick="removePhysicalMedia()">
                            <i class="fas fa-trash"></i>
                            Remove Media
                        </button>
                    </div>
                </div>
                <div class="bg-content" id="physicalGradientContent">
                    <div class="gradient-picker">
                        <div class="gradient-controls">
                            <div class="color-input-group">
                                <label>Color 1</label>
                                <input type="color" id="physicalGradientColor1" class="gradient-color-input" value="#FF6B6B" onchange="updatePhysicalGradientPreview()">
                            </div>
                            <div class="color-input-group">
                                <label>Color 2</label>
                                <input type="color" id="physicalGradientColor2" class="gradient-color-input" value="#4ECDC4" onchange="updatePhysicalGradientPreview()">
                            </div>
                        </div>
                        <div class="gradient-preview" id="physicalGradientPreview"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Background Preview Section -->
        <div class="background-preview-section" id="physicalBackgroundPreviewSection">
            <label>Background Preview</label>
            <div class="event-background-preview" id="physicalEventBackgroundPreview">
                <div class="preview-overlay">
                    <h3 class="preview-event-title" id="physicalPreviewEventTitle">Your Event Name</h3>
                    <p class="preview-event-category" id="physicalPreviewEventCategory">Event Category</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Event Description -->
    <div class="form-group" id="physicalDescriptionGroup">
        <label for="physicalEventDescription">Event Description</label>
        <textarea id="physicalEventDescription" class="form-textarea" placeholder="Describe your event (minimum 5 words)" rows="4" onkeyup="updatePhysicalWordCount()"></textarea>
        <small class="form-help">
            <span id="physicalWordCount">0</span> words (minimum 5 words required)
        </small>
    </div>

    <!-- Event Location -->
    <div class="form-group" id="physicalLocationGroup">
        <label for="physicalEventLocation">
            <i class="fas fa-map-marker-alt"></i>
            Event Location
        </label>
        <textarea id="physicalEventLocation" class="form-textarea" placeholder="Enter full venue address or location details" rows="3"></textarea>
        <small class="form-help">Provide complete address including city, state for easy navigation</small>
    </div>

           <!-- Event Scheduling -->
<div class="form-group" id="physicalSchedulingGroup">
    <label>Event Schedule</label>
    <div class="scheduling-section">
        <!-- TBA Option -->
        <div class="tba-option">
            <label class="tba-checkbox">
                <input type="checkbox" id="physicalTBASchedule" onchange="toggleTBASchedule()">
                <span>To Be Announced (TBA)</span>
            </label>
            <small class="form-help">Check this if event date and time are not yet confirmed</small>
        </div>
        
        <!-- Regular Date/Time Fields -->
        <div class="datetime-fields" id="physicalDateTimeFields">
            <div class="datetime-row">
                <div class="datetime-field">
                    <label for="physicalStartDate">Start Date</label>
                    <input type="date" id="physicalStartDate" class="form-input" onchange="calculatePhysicalDuration()">
                </div>
                <div class="datetime-field">
                    <label for="physicalStartTime">Start Time</label>
                    <input type="time" id="physicalStartTime" class="form-input" onchange="calculatePhysicalDuration()">
                </div>
            </div>
            <div class="datetime-row">
                <div class="datetime-field">
                    <label for="physicalEndDate">End Date</label>
                    <input type="date" id="physicalEndDate" class="form-input" onchange="calculatePhysicalDuration()">
                </div>
                <div class="datetime-field">
                    <label for="physicalEndTime">End Time</label>
                    <input type="time" id="physicalEndTime" class="form-input" onchange="calculatePhysicalDuration()">
                </div>
            </div>
            <div class="duration-display" id="physicalDurationDisplay" style="display: none;">
                <i class="fas fa-clock"></i>
                <span>Duration: <strong id="physicalCalculatedDuration">-</strong></span>
            </div>
        </div>
        
        <!-- TBA Display -->
        <div class="tba-display" id="physicalTBADisplay" style="display: none;">
            <div class="tba-message">
                <i class="fas fa-calendar-times"></i>
                <span>Event date and time: <strong>To Be Announced</strong></span>
            </div>
        </div>
    </div>
</div>

    <!-- Event Link -->
    <div class="form-group" id="physicalEventLinkGroup">
        <label for="physicalEventLink">
            <i class="fas fa-link"></i>
            Event Link
        </label>
        <div class="event-link-input-group">
            <span class="link-prefix">reward-hub.vercel.app/</span>
            <input type="text" id="physicalEventLink" class="form-input" placeholder="my-awesome-event" 
                   pattern="[a-z0-9-]+" title="Only lowercase letters, numbers, and hyphens allowed"
                   onkeyup="checkPhysicalEventLinkAvailability()">
            <button type="button" id="checkPhysicalLinkBtn" class="check-link-btn" onclick="manualCheckPhysicalEventLink()">
                <i class="fas fa-search"></i>
            </button>
        </div>
        <small class="form-help">Use lowercase letters, numbers, and hyphens only. This will be your shareable event link.</small>
        <div id="physicalLinkAvailabilityMessage" class="link-availability-message"></div>
    </div>

    <!-- Ticket Configuration -->
<div class="form-group" id="physicalTicketConfigGroup">
    <label>Ticket Configuration</label>
    
    <!-- No Tickets Option -->
    <div class="no-tickets-option">
        <label class="no-tickets-checkbox">
            <input type="checkbox" id="physicalNoTickets" onchange="toggleNoTicketsMode()">
            <span>No Tickets Required</span>
        </label>
        <small class="form-help">Check this if your event doesn't require tickets (free entry, open event, etc.)</small>
    </div>
    
    <div class="ticket-config-section">
        <div class="ticket-types-list" id="physicalTicketTypesList">
            <!-- Ticket types will be added here dynamically -->
            <div class="no-tickets-message" id="physicalNoTicketsMessage">
                <i class="fas fa-ticket-alt"></i>
                <p>No tickets added yet. Click "Add Ticket Type" to create your first ticket.</p>
            </div>
        </div>
       
        <button type="button" class="add-ticket-type-btn" id="addPhysicalTicketBtn" onclick="debugAddTicket()">
            <i class="fas fa-plus"></i>
            Add Ticket Type
        </button>
        
        <!-- No Tickets Mode Message -->
        <div id="noTicketsModeMessage" class="no-tickets-mode-message" style="display: none;">
            <i class="fas fa-info-circle"></i>
            <p>This event doesn't require tickets. Attendees can contact you directly using the contact information provided above.</p>
        </div>
    </div>
</div>
<!-- Event Contact Information (Optional) -->
<div class="form-group" id="phyeveContactGroup">
    <label>
        <i class="fas fa-address-book"></i>
        Contact Information (Optional)
    </label>
    <small class="form-help">Add contact details to help attendees reach you</small>
    <div id="phyeveContactRequiredNote" class="contact-required-note" style="display: none;">
        <i class="fas fa-exclamation-triangle"></i>
        <span>At least one contact method is required when "No Tickets" is selected</span>
    </div>
    
    <div class="contact-info-section">
        <!-- Host/Contact Name -->
        <div class="form-group">
            <label for="phyeveHostName">Host/Contact Name</label>
            <input type="text" id="phyeveHostName" class="form-input" placeholder="Enter host or contact person name" maxlength="50">
            <small class="form-help">Name of the person organizing or hosting the event</small>
        </div>

        <!-- Phone Number -->
        <div class="form-group">
            <label for="phyevePhoneNumber">
                <i class="fas fa-phone"></i>
                Phone Number
            </label>
            <input type="tel" id="phyevePhoneNumber" class="form-input" placeholder="+234 xxx xxx xxxx" onblur="validatePhyevePhoneNumber()">
            <div class="url-validation-message" id="phyevePhoneNumberMessage"></div>
            <small class="form-help">Contact phone number for attendees</small>
        </div>

        <!-- Contact Links Grid -->
        <div class="contact-links-grid">
            <!-- Website URL -->
            <div class="contact-field">
                <label for="phyeveWebsiteUrl">
                    <i class="fas fa-globe"></i>
                    Website URL
                </label>
                <input type="url" id="phyeveWebsiteUrl" class="form-input" placeholder="https://yourwebsite.com" onblur="validatePhyeveUrl('phyeveWebsiteUrl')">
                <div class="url-validation-message" id="phyeveWebsiteUrlMessage"></div>
            </div>

            <!-- Instagram -->
            <div class="contact-field">
                <label for="phyeveInstagramUrl">
                    <i class="fab fa-instagram"></i>
                    Instagram
                </label>
                <input type="url" id="phyeveInstagramUrl" class="form-input" placeholder="https://instagram.com/username" onblur="validatePhyeveUrl('phyeveInstagramUrl', 'instagram')">
                <div class="url-validation-message" id="phyeveInstagramUrlMessage"></div>
            </div>

            <!-- TikTok -->
            <div class="contact-field">
                <label for="phyeveTiktokUrl">
                    <i class="fab fa-tiktok"></i>
                    TikTok
                </label>
                <input type="url" id="phyeveTiktokUrl" class="form-input" placeholder="https://tiktok.com/@username" onblur="validatePhyeveUrl('phyeveTiktokUrl', 'tiktok')">
                <div class="url-validation-message" id="phyeveTiktokUrlMessage"></div>
            </div>

            <!-- Facebook -->
            <div class="contact-field">
                <label for="phyeveFacebookUrl">
                    <i class="fab fa-facebook"></i>
                    Facebook
                </label>
                <input type="url" id="phyeveFacebookUrl" class="form-input" placeholder="https://facebook.com/page" onblur="validatePhyeveUrl('phyeveFacebookUrl', 'facebook')">
                <div class="url-validation-message" id="phyeveFacebookUrlMessage"></div>
            </div>

            <!-- Twitter/X -->
            <div class="contact-field">
                <label for="phyeveTwitterUrl">
                    <i class="fab fa-twitter"></i>
                    Twitter/X
                </label>
                <input type="url" id="phyeveTwitterUrl" class="form-input" placeholder="https://twitter.com/username" onblur="validatePhyeveUrl('phyeveTwitterUrl', 'twitter')">
                <div class="url-validation-message" id="phyeveTwitterUrlMessage"></div>
            </div>

            <!-- YouTube -->
            <div class="contact-field">
                <label for="phyeveYoutubeUrl">
                    <i class="fab fa-youtube"></i>
                    YouTube
                </label>
                <input type="url" id="phyeveYoutubeUrl" class="form-input" placeholder="https://youtube.com/channel" onblur="validatePhyeveUrl('phyeveYoutubeUrl', 'youtube')">
                <div class="url-validation-message" id="phyeveYoutubeUrlMessage"></div>
            </div>

            <!-- LinkedIn -->
            <div class="contact-field">
                <label for="phyeveLinkedinUrl">
                    <i class="fab fa-linkedin"></i>
                    LinkedIn
                </label>
                <input type="url" id="phyeveLinkedinUrl" class="form-input" placeholder="https://linkedin.com/in/profile" onblur="validatePhyeveUrl('phyeveLinkedinUrl', 'linkedin')">
                <div class="url-validation-message" id="phyeveLinkedinUrlMessage"></div>
            </div>

            <!-- WhatsApp -->
            <div class="contact-field">
                <label for="phyeveWhatsappUrl">
                    <i class="fab fa-whatsapp"></i>
                    WhatsApp
                </label>
                <input type="text" id="phyeveWhatsappUrl" class="form-input" placeholder="https://wa.me/1234567890" onblur="validatePhyeveUrl('phyeveWhatsappUrl', 'whatsapp')">
                <div class="url-validation-message" id="phyeveWhatsappUrlMessage"></div>
                <small class="form-help">Use format: https://wa.me/yourcountrycodephonenumber</small>
            </div>
        </div>

        <!-- Multiple Custom Links -->
        <div class="custom-links-section">
            <h4 style="margin: 20px 0 15px 0; color: #495057; font-size: 16px;">Custom Links</h4>
            
            <!-- Custom Link 1 -->
            <div class="custom-link-group">
                <div class="custom-link-row">
                    <div class="contact-field custom-link-field">
                        <label for="phyeveCustomLinkName1">
                            <i class="fas fa-external-link-alt"></i>
                            Custom Link 1 Name
                        </label>
                        <input type="text" id="phyeveCustomLinkName1" class="form-input" placeholder="e.g. My Portfolio, Store, etc." maxlength="30" onblur="updatePhyeveContactPreview()">
                    </div>
                    <div class="contact-field custom-link-field">
                        <label for="phyeveCustomUrl1">
                            <i class="fas fa-link"></i>
                            Custom Link 1 URL
                        </label>
                        <input type="url" id="phyeveCustomUrl1" class="form-input" placeholder="https://yourlink.com" onblur="validatePhyeveUrl('phyeveCustomUrl1')">
                        <div class="url-validation-message" id="phyeveCustomUrl1Message"></div>
                    </div>
                </div>
            </div>

            <!-- Custom Link 2 -->
            <div class="custom-link-group">
                <div class="custom-link-row">
                    <div class="contact-field custom-link-field">
                        <label for="phyeveCustomLinkName2">
                            <i class="fas fa-external-link-alt"></i>
                            Custom Link 2 Name
                        </label>
                        <input type="text" id="phyeveCustomLinkName2" class="form-input" placeholder="e.g. My Store, Blog, etc." maxlength="30" onblur="updatePhyeveContactPreview()">
                    </div>
                    <div class="contact-field custom-link-field">
                        <label for="phyeveCustomUrl2">
                            <i class="fas fa-link"></i>
                            Custom Link 2 URL
                        </label>
                        <input type="url" id="phyeveCustomUrl2" class="form-input" placeholder="https://yourlink.com" onblur="validatePhyeveUrl('phyeveCustomUrl2')">
                        <div class="url-validation-message" id="phyeveCustomUrl2Message"></div>
                    </div>
                </div>
            </div>

            <!-- Custom Link 3 -->
            <div class="custom-link-group">
                <div class="custom-link-row">
                    <div class="contact-field custom-link-field">
                        <label for="phyeveCustomLinkName3">
                            <i class="fas fa-external-link-alt"></i>
                            Custom Link 3 Name
                        </label>
                        <input type="text" id="phyeveCustomLinkName3" class="form-input" placeholder="e.g. My Channel, App, etc." maxlength="30" onblur="updatePhyeveContactPreview()">
                    </div>
                    <div class="contact-field custom-link-field">
                        <label for="phyeveCustomUrl3">
                            <i class="fas fa-link"></i>
                            Custom Link 3 URL
                        </label>
                        <input type="url" id="phyeveCustomUrl3" class="form-input" placeholder="https://yourlink.com" onblur="validatePhyeveUrl('phyeveCustomUrl3')">
                        <div class="url-validation-message" id="phyeveCustomUrl3Message"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Contact Preview -->
        <div class="contact-preview" id="phyeveContactPreview" style="display: none;">
            <h4>Contact Information Preview</h4>
            <div class="contact-preview-content" id="phyeveContactPreviewContent">
                <!-- Will be populated dynamically -->
            </div>
        </div>
    </div>
</div>
 

    <!-- Physical Event Submit Button -->
    <div class="form-actions" id="physicalSubmitGroup">
        <button type="submit" class="submit-btn" id="createPhysicalEventBtn" onclick="createPhysicalEvent()">
            <i class="fas fa-calendar-plus"></i>
            Create Physical Event
        </button>
    </div>
</div>
    
    <!-- Enhanced Physical Ticket Configuration Modal -->
<div class="ticket-config-modal-overlay" id="physicalTicketConfigModal" style="display: none;">
    <div class="ticket-config-modal-container">
        <div class="ticket-config-modal-header">
            <h3>Configure Ticket Type</h3>
            <button class="close-modal-btn" onclick="closePhysicalTicketConfigModal()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="ticket-config-modal-content">
            <form id="physicalTicketConfigForm">
                <!-- Ticket Name -->
                <div class="form-group">
                    <label for="physicalTicketName">Ticket Name *</label>
                    <input type="text" id="physicalTicketName" class="form-input" placeholder="e.g., General Admission, VIP, Early Bird" required>
                </div>

                <!-- Ticket Type Selection -->
                <div class="form-group">
                    <label>Ticket Type *</label>
                    <div class="ticket-type-options">
                        <label class="ticket-type-option">
                            <input type="radio" name="physicalTicketType" value="free" id="physicalFreeTicket" checked onchange="selectPhysicalTicketType('free')">
                            <span class="ticket-type-label">
                                <i class="fas fa-gift"></i>
                                <strong>Free</strong>
                                <small>No cost to attendees</small>
                            </span>
                        </label>
                        
                        <label class="ticket-type-option">
                            <input type="radio" name="physicalTicketType" value="paid" id="physicalPaidTicket" onchange="selectPhysicalTicketType('paid')">
                            <span class="ticket-type-label">
                                <i class="fas fa-money-bill-wave"></i>
                                <strong>Paid</strong>
                                <small>Fixed price tickets</small>
                            </span>
                        </label>
                        
                        <label class="ticket-type-option">
                            <input type="radio" name="physicalTicketType" value="donation" id="physicalDonationTicket" onchange="selectPhysicalTicketType('donation')">
                            <span class="ticket-type-label">
                                <i class="fas fa-heart"></i>
                                <strong>Donation</strong>
                                <small>Pay what you want</small>
                            </span>
                        </label>
                    </div>
                </div>

                <!-- Ticket Configuration Sections -->
                <div class="ticket-config-section" id="physicalFreeTicketConfig">
                    <div class="form-group">
                        <label for="physicalFreeTicketQuantity">Available Quantity *</label>
                        <input type="number" id="physicalFreeTicketQuantity" class="form-input" min="1" placeholder="Number of free tickets" value="100">
                    </div>
                </div>

                <div class="ticket-config-section" id="physicalPaidTicketConfig" style="display: none;">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="physicalTicketPrice">Price () *</label>
                            <input type="number" id="physicalTicketPrice" class="form-input" min="100" step="50" placeholder="Ticket price">
                        </div>
                        <div class="form-group">
                            <label for="physicalPaidTicketQuantity">Quantity *</label>
                            <input type="number" id="physicalPaidTicketQuantity" class="form-input" min="1" placeholder="Number of paid tickets">
                        </div>
                    </div>
                </div>

                <div class="ticket-config-section" id="physicalDonationTicketConfig" style="display: none;">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="physicalSuggestedDonation">Suggested Amount ()</label>
                            <input type="number" id="physicalSuggestedDonation" class="form-input" min="0" step="50" placeholder="Optional suggested amount">
                        </div>
                        <div class="form-group">
                            <label for="physicalDonationTicketQuantity">Quantity *</label>
                            <input type="number" id="physicalDonationTicketQuantity" class="form-input" min="1" placeholder="Number of donation tickets">
                        </div>
                    </div>
                </div>

                <!-- Ticket Description (Optional) -->
                <div class="form-group">
                    <label for="physicalTicketDescription">Ticket Description (Optional)</label>
                    <textarea id="physicalTicketDescription" class="form-textarea" placeholder="Describe what this ticket includes, benefits, or any special notes..." rows="3"></textarea>
                    <small class="form-help">Help attendees understand what this ticket offers</small>
                </div>

                <!-- Ticket Background -->
                <div class="form-group">
                    <label>Ticket Background</label>
                    <div class="ticket-background-options">
                        <div class="background-tabs">
                            <button type="button" class="bg-tab active" onclick="switchTicketBackgroundTab('color')" data-tab="color">Color</button>
                            <button type="button" class="bg-tab" onclick="switchTicketBackgroundTab('media')" data-tab="media">Media</button>
                        </div>
                        
                        <div class="background-content">
                            <!-- Color Background -->
                            <div class="bg-content active" id="ticketColorContent">
                                <div class="color-picker-section">
                                    <div class="color-input-group">
                                        <label>Ticket Color</label>
                                        <input type="color" id="ticketBackgroundColor" class="color-input" value="#4ECDC4" onchange="updateTicketColorPreview()">
                                    </div>
                                    <div class="color-preview" id="ticketColorPreview"></div>
                                </div>
                            </div>
                            
                            <!-- Media Background -->
                            <div class="bg-content" id="ticketMediaContent">
                                <input type="file" id="ticketBackgroundMedia" accept="image/video/mp4,video/mov,.gif" class="file-input" onchange="handleTicketMediaUpload(this)">
                                <label for="ticketBackgroundMedia" class="file-label">
                                    <i class="fas fa-upload"></i>
                                    Choose Media (Image, GIF, Video)
                                </label>
                                <small class="form-help">Supported: JPG, PNG, GIF, MP4, MOV | Max: 5MB | Video: 15s max</small>
                                
                                <div id="ticketMediaPreviewContainer" class="media-preview-container" style="display: none;">
                                    <div id="ticketMediaPreview" class="media-preview"></div>
                                    <button type="button" class="remove-media-btn" onclick="removeTicketMedia()">
                                        <i class="fas fa-trash"></i>
                                        Remove Media
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Ticket Preview -->
                <div class="form-group">
                    <label>Ticket Preview</label>
                    <div class="ticket-preview-card" id="ticketPreviewCard">
                        <div class="ticket-preview-background" id="ticketPreviewBackground">
                            <div class="ticket-preview-content">
                                <h4 class="ticket-preview-name" id="ticketPreviewName">Ticket Name</h4>
                                <p class="ticket-preview-type" id="ticketPreviewType">Free Ticket</p>
                                <p class="ticket-preview-price" id="ticketPreviewPrice" style="display: none;">0</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Modal Actions -->
                <div class="ticket-config-modal-actions">
                    <button type="button" class="cancel-ticket-btn" onclick="closePhysicalTicketConfigModal()">Cancel</button>
                    <button type="button" class="save-ticket-btn" onclick="savePhysicalTicketConfiguration()">Save Ticket</button>
                </div>
            </form>
        </div>
    </div>
</div>

 </div>
                </div>
                 </div>
     
                        

 

<div class="sport-event-page">
    <div class="sport-event-container">
        <!-- Page Header -->
        <header class="sport-page-header">
            <h2><i class="fas fa-trophy"></i> Sport Events</h2>
            <button class="close-sport-event-page-btn" type="button" aria-label="Close Sport Events">
                <i class="fas fa-times"></i>
            </button>
        </header>

        <!-- Banner Ad -->
        <div class="sport-banner-ad">
            <div class="sport-ad-content">
                <span class="sport-ad-label">Advertisement</span>
                <p>Your sports ad here - 480px x 65px</p>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="sport-action-buttons">
            <button class="sport-action-btn" id="host-sport-event">
                <i class="sport-btn-icon fas fa-plus-circle"></i>
                <span>Host Event</span>
            </button>
            <button class="sport-action-btn" id="joined-sport-event">
                <i class="sport-btn-icon fas fa-users"></i>
                <span>Joined Event</span>
            </button>
        </div>
<div class="sport-events-container" id="sport-events-container">
                <!-- Empty state when no events -->
                <div class="sport-events-empty" id="sport-events-empty">
                    <div class="empty-state-icon">
                        <i class="fas fa-calendar-times"></i>
                    </div>
                    <h4>No Events Yet</h4>
                    <p>Create your first sport event to get started!</p>
                    <button class="empty-state-btn" onclick="document.getElementById('host-sport-event').click()">
                        <i class="fas fa-plus"></i> Host Event
                    </button>
                </div>
                
                <!-- Event cards will be dynamically inserted here -->
            </div>
        <!-- Sponsors Footer -->
        <div class="sport-sponsors-footer">
            <div class="sport-sponsors-container">
                <div class="sport-sponsors-scroll">
                    <div class="sport-sponsor-item">
                        <img src="https://via.placeholder.com/80x40/008B8B/white?text=Nike" alt="Nike">
                        <span>Nike</span>
                    </div>
                    <div class="sport-sponsor-item">
                        <img src="https://via.placeholder.com/80x40/008B8B/white?text=Adidas" alt="Adidas">
                        <span>Adidas</span>
                    </div>
                    <div class="sport-sponsor-item">
                        <img src="https://via.placeholder.com/80x40/008B8B/white?text=Puma" alt="Puma">
                        <span>Puma</span>
                    </div>
                    <div class="sport-sponsor-item">
                        <img src="https://via.placeholder.com/80x40/008B8B/white?text=FIFA" alt="FIFA">
                        <span>FIFA</span>
                    </div>
                    <div class="sport-sponsor-item">
                        <img src="https://via.placeholder.com/80x40/008B8B/white?text=UEFA" alt="UEFA">
                        <span>UEFA</span>
                    </div>
                    <div class="sport-sponsor-item">
                        <img src="https://via.placeholder.com/80x40/008B8B/white?text=ESPN" alt="ESPN">
                        <span>ESPN</span>
                    </div>
                    <div class="sport-sponsor-item">
                        <img src="https://via.placeholder.com/80x40/008B8B/white?text=NBC" alt="NBC Sports">
                        <span>NBC Sports</span>
                    </div>
                    <div class="sport-sponsor-item">
                        <img src="https://via.placeholder.com/80x40/008B8B/white?text=FOX" alt="FOX Sports">
                        <span>FOX Sports</span>
                    </div>
                    <!-- Duplicate for seamless loop -->
                    <div class="sport-sponsor-item">
                        <img src="https://via.placeholder.com/80x40/008B8B/white?text=Nike" alt="Nike">
                        <span>Nike</span>
                    </div>
                    <div class="sport-sponsor-item">
                        <img src="https://via.placeholder.com/80x40/008B8B/white?text=Adidas" alt="Adidas">
                        <span>Adidas</span>
                    </div>
                    <div class="sport-sponsor-item">
                        <img src="https://via.placeholder.com/80x40/008B8B/white?text=Puma" alt="Puma">
                        <span>Puma</span>
                    </div>
                    <div class="sport-sponsor-item">
                        <img src="https://via.placeholder.com/80x40/008B8B/white?text=FIFA" alt="FIFA">
                        <span>FIFA</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Host Sport Event Popup -->
<div class="host-sport-popup-overlay" id="host-sport-popup">
    <div class="host-sport-popup">
        <div class="host-sport-popup-header">
            <h3><i class="fas fa-plus-circle"></i> Host Sport Event</h3>
            <button class="close-host-sport-popup-btn" type="button">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="host-sport-popup-content">
            <div class="host-sport-category-title">
                <h4>Select Sport Category</h4>
                <p>Choose the type of sport event you want to host</p>
            </div>
            
            <div class="host-sport-categories-grid">
                <!-- Football - Accessible -->
                <div class="host-sport-category-card accessible" data-sport="football">
                    <div class="host-sport-category-icon">
                        <i class="fas fa-futbol"></i>
                    </div>
                    <div class="host-sport-category-info">
                        <h5>Football</h5>
                        <span class="host-sport-category-status available">Available</span>
                    </div>
                </div>
                
                <!-- Basketball - Coming Soon -->
                <div class="host-sport-category-card coming-soon" data-sport="basketball">
                    <div class="host-sport-category-icon">
                        <i class="fas fa-basketball-ball"></i>
                    </div>
                    <div class="host-sport-category-info">
                        <h5>Basketball</h5>
                        <span class="host-sport-category-status coming-soon">Coming Soon</span>
                    </div>
                </div>
                
                <!-- Table Tennis - Coming Soon -->
                <div class="host-sport-category-card coming-soon" data-sport="table-tennis">
                    <div class="host-sport-category-icon">
                        <i class="fas fa-ping-pong-paddle-ball"></i>
                    </div>
                    <div class="host-sport-category-info">
                        <h5>Table Tennis</h5>
                        <span class="host-sport-category-status coming-soon">Coming Soon</span>
                    </div>
                </div>
                
                <!-- Tennis - Coming Soon -->
                <div class="host-sport-category-card coming-soon" data-sport="tennis">
                    <div class="host-sport-category-icon">
                        <i class="fas fa-table-tennis"></i>
                    </div>
                    <div class="host-sport-category-info">
                        <h5>Tennis</h5>
                        <span class="host-sport-category-status coming-soon">Coming Soon</span>
                    </div>
                </div>
                
                <!-- Volleyball - Coming Soon -->
                <div class="host-sport-category-card coming-soon" data-sport="volleyball">
                    <div class="host-sport-category-icon">
                        <i class="fas fa-volleyball-ball"></i>
                    </div>
                    <div class="host-sport-category-info">
                        <h5>Volleyball</h5>
                        <span class="host-sport-category-status coming-soon">Coming Soon</span>
                    </div>
                </div>
                
                <!-- Badminton - Coming Soon -->
                <div class="host-sport-category-card coming-soon" data-sport="badminton">
                    <div class="host-sport-category-icon">
                        <i class="fas fa-shuttlecock"></i>
                    </div>
                    <div class="host-sport-category-info">
                        <h5>Badminton</h5>
                        <span class="host-sport-category-status coming-soon">Coming Soon</span>
                    </div>
                </div>
                
                <!-- Running - Coming Soon -->
                <div class="host-sport-category-card coming-soon" data-sport="running">
                    <div class="host-sport-category-icon">
                        <i class="fas fa-running"></i>
                    </div>
                    <div class="host-sport-category-info">
                        <h5>Running</h5>
                        <span class="host-sport-category-status coming-soon">Coming Soon</span>
                    </div>
                </div>
                
              
                
                
            
                
                
                <!-- Indoor Sports - Coming Soon -->
                <div class="host-sport-category-card coming-soon" data-sport="indoor-sports">
                    <div class="host-sport-category-icon">
                        <i class="fas fa-home"></i>
                    </div>
                    <div class="host-sport-category-info">
                        <h5>Indoor Sports</h5>
                        <span class="host-sport-category-status coming-soon">Coming Soon</span>
                    </div>
                </div>
                
                <!-- All Events - Coming Soon -->
                <div class="host-sport-category-card coming-soon" data-sport="all-events">
                    <div class="host-sport-category-icon">
                        <i class="fas fa-globe"></i>
                    </div>
                    <div class="host-sport-category-info">
                        <h5>All Events</h5>
                        <span class="host-sport-category-status coming-soon">Coming Soon</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Football Event Modal -->
<div class="football-event-overlay" id="footballEventOverlay">
    <div class="football-event-popup">
        <div class="football-event-header">
            <h3><i class="fas fa-futbol"></i> Create Football Event</h3>
            <button class="close-football-event-btn" id="closeFootballEventBtn">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="football-event-content">
            <!-- Step 1: Basic Event Info -->
            <div class="football-step active" id="footballStep1">
                <div class="football-step-header">
                    <h4>Event Details</h4>
                    <p>Set up your football event information</p>
                </div>
                
                <div class="football-form-group">
                    <label>Event Name</label>
                    <input type="text" id="footballEventName" placeholder="Enter event name" maxlength="50">
                </div>
                
                <div class="football-form-group">
                    <label>Background</label>
                    <div class="football-background-options">
                        <div class="football-bg-option active" data-bg="color">
                            <i class="fas fa-palette"></i>
                            <span>Color</span>
                        </div>
                        <div class="football-bg-option" data-bg="image">
                            <i class="fas fa-image"></i>
                            <span>Image</span>
                        </div>
                    </div>
                    <div class="football-color-picker" id="footballColorPicker">
                        <input type="color" id="footballBgColor" value="#008B8B">
                    </div>
                    <div class="football-image-upload" id="footballImageUpload" style="display: none;">
                        <input type="file" id="footballBgImage" accept="image">
                        <label for="footballBgImage">
                            <i class="fas fa-upload"></i>
                            Choose Image
                        </label>
                    </div>
                </div>
                
                <div class="football-form-group">
                    <label>Event Description</label>
                    <textarea id="footballEventDescription" placeholder="Describe your football event..." rows="4" maxlength="200"></textarea>
                </div>
                
                <div class="football-form-group">
                    <label>Match Type</label>
                    <div class="football-match-types">
                        <div class="football-match-type" data-type="single">
                            <i class="fas fa-trophy"></i>
                            <h5>Single Match</h5>
                            <p>One-time tournament</p>
                        </div>
                        <div class="football-match-type" data-type="multiple">
                            <i class="fas fa-calendar-alt"></i>
                            <h5>Multiple Match</h5>
                            <p>Series of matches</p>
                        </div>
                        <div class="football-match-type" data-type="league">
                            <i class="fas fa-crown"></i>
                            <h5>League</h5>
                            <p>Full season format</p>
                        </div>
                    </div>
                </div>
                
                <button class="football-next-btn" id="footballNextBtn" disabled>Next Step</button>
            </div>
            
            <!-- Step 2: Team Configuration -->
            <div class="football-step" id="footballStep2">
                <div class="football-step-header">
                    <h4>Team Configuration</h4>
                    <p>Configure teams and fees for your event</p>
                </div>
                
                <div class="football-form-group">
                    <label>Number of Teams</label>
                    <div class="football-team-options" id="footballTeamOptions">
                        <!-- Team options will be populated by JavaScript -->
                    </div>
                </div>
                
                <div class="football-form-group">
                    <label>Team Fee</label>
                    <div class="football-fee-options">
                        <div class="football-fee-option active" data-fee="paid">
                            <i class="fas fa-coins"></i>
                            <span>Set Team Fee</span>
                        </div>
                        <div class="football-fee-option" data-fee="free">
                            <i class="fas fa-gift"></i>
                            <span>No Team Fee</span>
                        </div>
                    </div>
                    <div class="football-fee-input" id="footballFeeInput">
                        <input type="number" id="footballTeamFee" min="10" max="8000" placeholder="Enter fee (10-8000 TC)">
                        <span class="football-currency">TC</span>
                    </div>
                </div>
                
                <div class="football-nav-buttons">
                    <button class="football-back-btn" id="footballBackBtn">Back</button>
                    <button class="football-next-btn" id="footballSummaryBtn" disabled>View Summary</button>
                </div>
            </div>
            
            <!-- Step 3: Summary & Payment -->
            <div class="football-step" id="footballStep3">
                <div class="football-step-header">
                    <h4>Football Event Summary</h4>
                    <p>Review your event details and complete creation</p>
                </div>
                
                <div class="football-summary-card">
                    <div class="football-summary-item">
                        <span>Event Name:</span>
                        <span id="summaryEventName">-</span>
                    </div>
                    <div class="football-summary-item">
                        <span>Match Type:</span>
                        <span id="summaryMatchType">-</span>
                    </div>
                    <div class="football-summary-item">
                        <span>Number of Teams:</span>
                        <span id="summaryTeamCount">-</span>
                    </div>
                    <div class="football-summary-item">
                        <span>Team Fee:</span>
                        <span id="summaryTeamFee">-</span>
                    </div>
                    <div class="football-summary-item highlight">
                        <span>Creation Fee:</span>
                        <span id="summaryCreationFee">-</span>
                    </div>
                </div>
                
                <div class="football-payment-section" id="footballPaymentSection">
                    <h5>Payment Method</h5>
                    <div class="football-payment-options">
                        <div class="football-payment-option" data-payment="tc">
                            <i class="fas fa-wallet"></i>
                            <span>Pay with TC Balance</span>
                            <span class="coming-soon">Coming Soon</span>
                        </div>
                        <div class="football-payment-option" data-payment="promo">
                            <i class="fas fa-ticket-alt"></i>
                            <span>Promo Code</span>
                        </div>
                    </div>
                    <div class="football-promo-input" id="footballPromoInput" style="display: none;">
                        <input type="text" id="footballPromoCode" placeholder="Enter promo code" maxlength="8">
                        <button class="football-verify-btn" id="footballVerifyBtn">Verify</button>
                    </div>
                    <div class="football-promo-status" id="footballPromoStatus"></div>
                </div>
                
                <div class="football-nav-buttons">
                    <button class="football-back-btn" id="footballBackToStep2">Back</button>
                    <button class="football-create-btn" id="footballCreateBtn" disabled>Create Event</button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Tickets Modal -->
<div id="ticketsModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 10000; justify-content: center; align-items: center;">
    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 20px; padding: 40px; width: 90%; max-width: 400px; text-align: center; position: relative;">
        <button onclick="closeTicketsModal()" style="position: absolute; top: 15px; right: 20px; background: none; border: none; color: white; font-size: 24px; cursor: pointer;">&times;</button>
        
        <h2 style="color: white; margin-bottom: 30px; font-size: 24px;">Select Ticket Type</h2>
        
        <div style="display: flex; flex-direction: column; gap: 20px;">
            <button id="physical-event-ticket-btn" onclick="openPhysicalEventTicketPage()" style="background: rgba(255,255,255,0.2); color: white; border: 2px solid rgba(255,255,255,0.3); padding: 20px; border-radius: 15px; cursor: pointer; font-size: 18px; font-weight: 600; transition: all 0.3s ease; backdrop-filter: blur(10px);">
                <i class="fas fa-calendar-alt" style="margin-right: 10px;"></i>
                Physical Event Tickets
            </button>
            
            <button id="online-event-ticket-btn" onclick="alert('Online Event Tickets - Coming Soon!')" style="background: rgba(255,255,255,0.1); color: rgba(255,255,255,0.6); border: 2px solid rgba(255,255,255,0.2); padding: 20px; border-radius: 15px; cursor: not-allowed; font-size: 18px; font-weight: 600; backdrop-filter: blur(10px);">
                <i class="fas fa-laptop" style="margin-right: 10px;"></i>
                Online Event Tickets
                <span style="font-size: 12px; display: block; margin-top: 5px;">Coming Soon</span>
            </button>
        </div>
    </div>
</div>

<!-- Add this to your HTML (modal section) -->
<!-- Withdrawal History Modal -->
<div id="withdrawalHistoryModal" class="withdrawal-history-modal" style="display: none;">
    <div class="withdrawal-history-content">
        <div class="withdrawal-history-header">
            <h2><i class="fas fa-history"></i> Withdrawal History</h2>
            <button class="close-withdrawal-history" onclick="closeWithdrawalHistory()">&times;</button>
        </div>
        
        <div class="withdrawal-history-body">
            <div class="withdrawal-history-filters">
                <select id="statusFilter" onchange="filterWithdrawalHistory()">
                    <option value="all">All Status</option>
                    <option value="pending">Pending</option>
                    <option value="paid">Paid</option>
                    <option value="failed">Failed</option>
                </select>
                
                <select id="timeFilter" onchange="filterWithdrawalHistory()">
                    <option value="all">All Time</option>
                    <option value="today">Today</option>
                    <option value="week">This Week</option>
                    <option value="month">This Month</option>
                </select>
            </div>
            
            <div id="withdrawalHistoryList" class="withdrawal-history-list">
                <div class="loading-state">
                    <i class="fas fa-spinner fa-spin"></i>
                    <p>Loading withdrawal history...</p>
                </div>
            </div>
        </div>
    </div>
</div>
  <!-- Overlay for modals -->
<div class="modal-overlay" id="modalOverlay"></div>

      
      
<!-- Bank Details Setup Modal -->
<div id="bankSetupModal" class="modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1001; justify-content: center; align-items: center;">
    <div class="modal-content" style="background: white; border-radius: 12px; width: 90%; max-width: 450px; padding: 30px;">
        <div class="modal-header" style="text-align: center; margin-bottom: 30px;">
            <h3 style="margin: 0; color: #333;">Setup Bank Details</h3>
            <button type="button" onclick="closeBankSetup()" style="position: absolute; top: 15px; right: 15px; background: none; border: none; font-size: 24px; cursor: pointer; color: #666;">&times;</button>
        </div>
        
        <div style="margin-bottom: 20px;">
            <label style="display: block; margin-bottom: 8px; color: #333; font-weight: 500;">Bank:</label>
            <select id="setupBank" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px; color: #333;">
                <option value="">Select Bank</option>
                <option value="Access Bank">Access Bank</option>
                <option value="GTBank">GTBank</option>
                <option value="Zenith Bank">Zenith Bank</option>
                <option value="UBA">UBA</option>
                <option value="First Bank">First Bank</option>
                <option value="Kuda Bank">Kuda Bank</option>
                <option value="Opay">Opay</option>
                <option value="PalmPay">PalmPay</option>
            </select>
        </div>
        
        <div style="margin-bottom: 20px;">
            <label style="display: block; margin-bottom: 8px; color: #333; font-weight: 500;">Account Number:</label>
            <input type="text" id="setupAccount" placeholder="1234567890" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px; color: #333;">
        </div>
        
        <div style="margin-bottom: 20px;">
            <label style="display: block; margin-bottom: 8px; color: #333; font-weight: 500;">Account Name:</label>
            <input type="text" id="setupName" placeholder="John Doe" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px; color: #333;">
        </div>
        
        <div id="bankSetupError" style="display: none; color: red; margin-bottom: 20px; padding: 10px; background: #ffe6e6; border-radius: 6px;"></div>
        
        <div style="display: flex; gap: 15px;">
            <button onclick="closeBankSetup()" style="flex: 1; padding: 12px; background: #6c757d; color: white; border: none; border-radius: 6px; cursor: pointer;">Cancel</button>
            <button onclick="saveBankDetails()" style="flex: 1; padding: 12px; background: #28a745; color: white; border: none; border-radius: 6px; cursor: pointer;">Save</button>
        </div>
    </div>
</div>



<!-- Nomination form Page -->
<div class="entertainment-event-page" id="NominationformPage">
    <!-- Close Button -->
    <div class="entertainment-page-header">
        <h2>Entertainment Event</h2>
        <button class="close-entertainment-event-page-btn" id="closeNominationformPageBtn">
            <i class="fas fa-times"></i>
        </button>
    </div>

    <!-- Banner Ad -->
    <div class="entertainment-banner-ad">
        <div class="entertainment-ad-content">
            <span class="entertainment-ad-label">Sponsored</span>
            <p> the nominizes are !</p>
        </div>
    </div>

    <!-- Action Buttons -->
    <div class="entertainment-action-buttons">
        <button class="entertainment-action-btn host-entertainment-event" id="hostNominationform">
            <div class="entertainment-btn-icon">
                <i class="fas fa-plus-circle"></i>
            </div>
            <span>Host</span>
        </button>

       
    </div>

    <!-- Tabs Navigation -->
    <div class="entertainment-tabs">
        <div class="entertainment-tabs-header">
            
            <div class="entertainment-tab-btn active">
                <i class="fas fa-calendar-plus"></i>
                <span> Nomination forms</span>
            </div>
           
        </div>

           <!-- Live Events Tab -->
               <!-- Search and Filter Controls -->
                <div id="searchFilterControls"></div>
                
                <div class="entertainment-cards-container" id="NominationformContainer">
                    <!-- Entertainment cards will be loaded here -->
                    <div class="entertainment-empty-state">
                        <i class="fas fa-broadcast-tower"></i>
                        <p>No Nomination form now </p>
                    </div>
                </div>
            

           

            
        </div>
    </div>
</div>
    
<!-- Nomination/Awards Choice Modal -->
<div id="nominsChoiceModal" class="modal-overlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100vh; background: rgba(0,0,0,0.8); z-index: 10000; justify-content: center; align-items: center;">
    <div class="choice-modal-content" style="
        background: white;
        border-radius: 20px;
        padding: 40px;
        max-width: 500px;
        width: 90%;
        text-align: center;
        position: relative;
        box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    ">
        <button onclick="closeNominsChoiceModal()" style="
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #6c757d;
        ">&times;</button>
        
        <h2 style="margin: 0 0 20px 0; color: #495057;">
            <i class="fas fa-trophy" style="color: #ffc107; margin-right: 10px;"></i>
            Choose Event Type
        </h2>
        <p style="color: #6c757d; margin-bottom: 30px;">What type of event would you like to create?</p>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
            <button onclick="openNominsModal()" style="
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                border: none;
                padding: 30px 20px;
                border-radius: 15px;
                cursor: pointer;
                transition: all 0.3s ease;
                text-align: center;
            " onmouseover="this.style.transform='translateY(-5px)'" onmouseout="this.style.transform='translateY(0)'">
                <i class="fas fa-vote-yea" style="font-size: 32px; margin-bottom: 10px; display: block;"></i>
                <strong style="font-size: 18px; display: block; margin-bottom: 5px;">Nominations</strong>
                <small style="opacity: 0.9;">Create nomination forms</small>
            </button>
            
            <button onclick="openAwardsModal()" style="
                background: linear-gradient(135deg, #ffc107 0%, #e0a800 100%);
                color: #212529;
                border: none;
                padding: 30px 20px;
                border-radius: 15px;
                cursor: pointer;
                transition: all 0.3s ease;
                text-align: center;
            " onmouseover="this.style.transform='translateY(-5px)'" onmouseout="this.style.transform='translateY(0)'">
                <i class="fas fa-award" style="font-size: 32px; margin-bottom: 10px; display: block;"></i>
                <strong style="font-size: 18px; display: block; margin-bottom: 5px;">Awards</strong>
                <small style="opacity: 0.9;">Create awards ceremony</small>
            </button>
        </div>
    </div>
</div>

<!-- Nominations Modal -->
<div id="nominsModal" class="modal-overlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100vh; background: rgba(0,0,0,0.8); z-index: 10001; justify-content: center; align-items: center; overflow-y: auto;">
    <div class="nomins-modal-content" style="
        background: white;
        border-radius: 20px;
        max-width: 800px;
        width: 95%;
        max-height: 95vh;
        overflow-y: auto;
        position: relative;
        margin: 20px;
        box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    ">
        <!-- Header -->
        <div style="
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 20px 20px 0 0;
            position: sticky;
            top: 0;
            z-index: 1;
        ">
            <h2 style="margin: 0; display: flex; align-items: center; gap: 10px;">
                <i class="fas fa-vote-yea"></i>
                Create Nomination Form
            </h2>
            <button onclick="closeNominsModal()" style="
                position: absolute;
                top: 15px;
                right: 15px;
                background: rgba(255,255,255,0.2);
                border: none;
                color: white;
                width: 35px;
                height: 35px;
                border-radius: 50%;
                cursor: pointer;
                font-size: 18px;
            ">&times;</button>
        </div>
        
        <!-- Form Content -->
        <div style="padding: 30px;">
            <form id="nominsForm" onsubmit="createNominsEvent(event)">
                <!-- Event Name -->
                <div class="form-group" style="margin-bottom: 20px;">
                    <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #495057;">
                        <i class="fas fa-signature" style="color: #667eea; margin-right: 5px;"></i>
                        Nomination Event Name *
                    </label>
                    <input type="text" id="nominsEventName" required style="
                        width: 100%;
                        padding: 12px;
                        border: 2px solid #e9ecef;
                        border-radius: 8px;
                        font-size: 14px;
                        transition: border-color 0.3s ease;
                    " placeholder="Enter nomination event name">
                </div>

                <!-- Background -->
                <div class="form-group" style="margin-bottom: 20px;">
                    <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #495057;">
                        <i class="fas fa-image" style="color: #667eea; margin-right: 5px;"></i>
                        Event Background
                    </label>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <div>
                            <label>Background Type:</label>
                            <select id="nominsBackgroundType" onchange="toggleNominsBackgroundType()" style="
                                width: 100%;
                                padding: 10px;
                                border: 2px solid #e9ecef;
                                border-radius: 6px;
                            ">
                                <option value="gradient">Gradient</option>
                                <option value="image">Image Upload</option>
                            </select>
                        </div>
                        <div id="nominsGradientSection">
                            <label>Gradient Colors:</label>
                            <div style="display: flex; gap: 10px;">
                                <input type="color" id="nominsColor1" value="#667eea" style="width: 50px; height: 40px; border: none; border-radius: 6px;">
                                <input type="color" id="nominsColor2" value="#764ba2" style="width: 50px; height: 40px; border: none; border-radius: 6px;">
                            </div>
                        </div>
                        <div id="nominsImageSection" style="display: none;">
                            <label>Upload Image:</label>
                            <input type="file" id="nominsBackgroundImage" accept="image/*" style="width: 100%; padding: 8px; border: 2px solid #e9ecef; border-radius: 6px;">
                        </div>
                    </div>
                </div>

                <!-- Extra Media -->
                <div class="form-group" style="margin-bottom: 20px;">
                    <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #495057;">
                        <i class="fas fa-photo-video" style="color: #667eea; margin-right: 5px;"></i>
                        Extra Media (Max 15)
                    </label>
                    <input type="file" id="nominsExtraMedia" accept="image/*,video/*" multiple style="
                        width: 100%;
                        padding: 12px;
                        border: 2px solid #e9ecef;
                        border-radius: 8px;
                    ">
                    <small style="color: #6c757d;">Upload additional images or videos for your nomination event</small>
                </div>

                <!-- Description -->
                <div class="form-group" style="margin-bottom: 20px;">
                    <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #495057;">
                        <i class="fas fa-align-left" style="color: #667eea; margin-right: 5px;"></i>
                        Description *
                    </label>
                    <textarea id="nominsDescription" required rows="4" style="
                        width: 100%;
                        padding: 12px;
                        border: 2px solid #e9ecef;
                        border-radius: 8px;
                        font-size: 14px;
                        resize: vertical;
                    " placeholder="Describe your nomination event"></textarea>
                </div>

                <!-- Date and Time -->
                <div class="form-group" style="margin-bottom: 20px;">
                    <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #495057;">
                        <i class="fas fa-calendar" style="color: #667eea; margin-right: 5px;"></i>
                        Nomination Period *
                    </label>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div>
                            <label>Start Date & Time:</label>
                            <input type="datetime-local" id="nominsStartDateTime" required style="
                                width: 100%;
                                padding: 10px;
                                border: 2px solid #e9ecef;
                                border-radius: 6px;
                            ">
                        </div>
                        <div>
                            <label>End Date & Time:</label>
                            <input type="datetime-local" id="nominsEndDateTime" required style="
                                width: 100%;
                                padding: 10px;
                                border: 2px solid #e9ecef;
                                border-radius: 6px;
                            ">
                        </div>
                    </div>
                </div>

                <!-- Event Link -->
                <div class="form-group" style="margin-bottom: 20px;">
                    <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #495057;">
                        <i class="fas fa-link" style="color: #667eea; margin-right: 5px;"></i>
                        Nomination Event Link *
                    </label>
                    <div style="display: flex; align-items: center; border: 2px solid #e9ecef; border-radius: 8px; overflow: hidden;">
                        <span style="background: #f8f9fa; padding: 12px; color: #6c757d; border-right: 1px solid #e9ecef;">
                            reward-hub.vercel.app/nomins/
                        </span>
                        <input type="text" id="nominsEventLink" required style="
                            flex: 1;
                            padding: 12px;
                            border: none;
                            outline: none;
                        " placeholder="my-nomination-event">
                    </div>
                </div>

                <!-- Nomination Categories -->
                <div class="form-group" style="margin-bottom: 20px;">
                    <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #495057;">
                        <i class="fas fa-list" style="color: #667eea; margin-right: 5px;"></i>
                        Nomination Categories
                    </label>
                    <div id="nominsCategoriesList" style="margin-bottom: 10px;">
                        <!-- Categories will be added here -->
                    </div>
                    <button type="button" onclick="addNominsCategory()" style="
                        background: #28a745;
                        color: white;
                        border: none;
                        padding: 8px 16px;
                        border-radius: 6px;
                        cursor: pointer;
                        font-size: 14px;
                    ">
                        <i class="fas fa-plus"></i> Add Category
                    </button>
                </div>

                <!-- Response Type -->
                <div class="form-group" style="margin-bottom: 20px;">
                    <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #495057;">
                        <i class="fas fa-question-circle" style="color: #667eea; margin-right: 5px;"></i>
                        Response Type *
                    </label>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <label style="
                            display: flex;
                            align-items: center;
                            padding: 12px;
                            border: 2px solid #e9ecef;
                            border-radius: 8px;
                            cursor: pointer;
                            transition: all 0.3s ease;
                        ">
                            <input type="radio" name="nominsResponseType" value="multiple_choice" checked style="margin-right: 8px;">
                            <span>Multiple Choice</span>
                        </label>
                        <label style="
                            display: flex;
                            align-items: center;
                            padding: 12px;
                            border: 2px solid #e9ecef;
                            border-radius: 8px;
                            cursor: pointer;
                            transition: all 0.3s ease;
                        ">
                            <input type="radio" name="nominsResponseType" value="short_text" style="margin-right: 8px;">
                            <span>Short Text Answer</span>
                        </label>
                    </div>
                </div>

                <!-- Nomination Type -->
                <div class="form-group" style="margin-bottom: 20px;">
                    <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #495057;">
                        <i class="fas fa-money-bill" style="color: #667eea; margin-right: 5px;"></i>
                        Nomination Type *
                    </label>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <label style="
                            display: flex;
                            align-items: center;
                            padding: 12px;
                            border: 2px solid #e9ecef;
                            border-radius: 8px;
                            cursor: pointer;
                        ">
                            <input type="radio" name="nominsType" value="free" checked onchange="toggleNominsPayment()" style="margin-right: 8px;">
                            <span>Free</span>
                        </label>
                        <label style="
                            display: flex;
                            align-items: center;
                            padding: 12px;
                            border: 2px solid #e9ecef;
                            border-radius: 8px;
                            cursor: pointer;
                        ">
                            <input type="radio" name="nominsType" value="paid" onchange="toggleNominsPayment()" style="margin-right: 8px;">
                            <span>Paid</span>
                        </label>
                    </div>
                    
                    <div id="nominsPaymentSection" style="display: none; margin-top: 15px;">
                        <label>Nomination Fee ():</label>
                        <input type="number" id="nominsNominationFee" min="100" step="50" style="
                            width: 100%;
                            padding: 10px;
                            border: 2px solid #e9ecef;
                            border-radius: 6px;
                            margin-top: 5px;
                        " placeholder="Enter nomination fee">
                    </div>
                </div>

                <!-- Number of People -->
                <div class="form-group" style="margin-bottom: 20px;">
                    <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #495057;">
                        <i class="fas fa-users" style="color: #667eea; margin-right: 5px;"></i>
                        Maximum Nominations per Category
                    </label>
                    <input type="number" id="nominsMaxPeople" min="1" value="100" style="
                        width: 100%;
                        padding: 12px;
                        border: 2px solid #e9ecef;
                        border-radius: 8px;
                    " placeholder="Enter maximum number of nominations">
                </div>

                <!-- Optional Sponsors -->
                <div class="form-group" style="margin-bottom: 20px;">
                    <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #495057;">
                        <i class="fas fa-handshake" style="color: #667eea; margin-right: 5px;"></i>
                        Sponsors (Optional)
                    </label>
                    <div id="nominsSponsorsList" style="margin-bottom: 10px;">
                        <!-- Sponsors will be added here -->
                    </div>
                    <button type="button" onclick="addNominsSponsor()" style="
                        background: #17a2b8;
                        color: white;
                        border: none;
                        padding: 8px 16px;
                        border-radius: 6px;
                        cursor: pointer;
                        font-size: 14px;
                    ">
                        <i class="fas fa-plus"></i> Add Sponsor
                    </button>
                </div>

                <!-- Host Details -->
                <div class="form-group" style="margin-bottom: 20px;">
                    <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #495057;">
                        <i class="fas fa-user" style="color: #667eea; margin-right: 5px;"></i>
                        Host Information *
                    </label>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div>
                            <label>Host Name:</label>
                            <input type="text" id="nominsHostName" required style="
                                width: 100%;
                                padding: 10px;
                                border: 2px solid #e9ecef;
                                border-radius: 6px;
                                margin-top: 5px;
                            " placeholder="Enter host name">
                        </div>
                        <div>
                            <label>Contact (Optional):</label>
                            <input type="text" id="nominsHostContact" style="
                                width: 100%;
                                padding: 10px;
                                border: 2px solid #e9ecef;
                                border-radius: 6px;
                                margin-top: 5px;
                            " placeholder="Phone or email">
                        </div>
                    </div>
                </div>

                <!-- Social Media -->
                <div class="form-group" style="margin-bottom: 30px;">
                    <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #495057;">
                        <i class="fas fa-share-alt" style="color: #667eea; margin-right: 5px;"></i>
                        Social Media Links (Optional)
                    </label>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <input type="url" id="nominsTwitter" style="
                            padding: 10px;
                            border: 2px solid #e9ecef;
                            border-radius: 6px;
                        " placeholder="Twitter URL">
                        <input type="url" id="nominsInstagram" style="
                            padding: 10px;
                            border: 2px solid #e9ecef;
                            border-radius: 6px;
                        " placeholder="Instagram URL">
                    </div>
                </div>

                <!-- Submit Button -->
                <div style="text-align: center; padding-top: 20px; border-top: 1px solid #e9ecef;">
                    <button type="submit" style="
                        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                        color: white;
                        border: none;
                        padding: 15px 40px;
                        border-radius: 10px;
                        cursor: pointer;
                        font-size: 16px;
                        font-weight: 600;
                        transition: all 0.3s ease;
                    " onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                        <i class="fas fa-rocket"></i>
                        Create Nomination Form
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
<!-- Awards Modal (Complete) -->
<div id="awardsModal" class="modal-overlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100vh; background: rgba(0,0,0,0.8); z-index: 10001; justify-content: center; align-items: center; overflow-y: auto;">
    <div class="awards-modal-content" style="
        background: white;
        border-radius: 20px;
        max-width: 800px;
        width: 95%;
        max-height: 95vh;
        overflow-y: auto;
        position: relative;
        margin: 20px;
        box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    ">
        <!-- Header -->
        <div style="
            background: linear-gradient(135deg, #ffc107 0%, #e0a800 100%);
            color: #212529;
            padding: 25px;
            border-radius: 20px 20px 0 0;
            position: sticky;
            top: 0;
            z-index: 1;
        ">
            <h2 style="margin: 0; display: flex; align-items: center; gap: 10px;">
                <i class="fas fa-award"></i>
                Create Awards Ceremony
            </h2>
            <button onclick="closeAwardsModal()" style="
                position: absolute;
                top: 15px;
                right: 15px;
                background: rgba(0,0,0,0.2);
                border: none;
                color: #212529;
                width: 35px;
                height: 35px;
                border-radius: 50%;
                cursor: pointer;
                font-size: 18px;
            ">&times;</button>
        </div>
        
        <!-- Form Content -->
        <div style="padding: 30px;">
            <form id="awardsForm" onsubmit="createAwardsEvent(event)">
                <!-- Event Name -->
                <div class="form-group" style="margin-bottom: 20px;">
                    <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #495057;">
                        <i class="fas fa-trophy" style="color: #ffc107; margin-right: 5px;"></i>
                        Awards Event Name *
                    </label>
                    <input type="text" id="awardsEventName" required style="
                        width: 100%;
                        padding: 12px;
                        border: 2px solid #e9ecef;
                        border-radius: 8px;
                        font-size: 14px;
                        color: #495057;
                        background-color: #fff;
                        transition: border-color 0.3s ease;
                    " placeholder="Enter awards event name">
                </div>

                <!-- Background -->
                <div class="form-group" style="margin-bottom: 20px;">
                    <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #495057;">
                        <i class="fas fa-image" style="color: #ffc107; margin-right: 5px;"></i>
                        Event Background
                    </label>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <div>
                            <label style="color: #495057;">Background Type:</label>
                            <select id="awardsBackgroundType" onchange="toggleAwardsBackgroundType()" style="
                                width: 100%;
                                padding: 10px;
                                border: 2px solid #e9ecef;
                                border-radius: 6px;
                                color: #495057;
                                background-color: #fff;
                            ">
                                <option value="gradient">Gradient</option>
                                <option value="image">Image Upload</option>
                            </select>
                        </div>
                        <div id="awardsGradientSection">
                            <label style="color: #495057;">Gradient Colors:</label>
                            <div style="display: flex; gap: 10px;">
                                <input type="color" id="awardsColor1" value="#ffc107" style="width: 50px; height: 40px; border: none; border-radius: 6px;">
                                <input type="color" id="awardsColor2" value="#e0a800" style="width: 50px; height: 40px; border: none; border-radius: 6px;">
                            </div>
                        </div>
                        <div id="awardsImageSection" style="display: none;">
                            <label style="color: #495057;">Upload Image:</label>
                            <input type="file" id="awardsBackgroundImage" accept="image/*" style="
                                width: 100%; 
                                padding: 8px; 
                                border: 2px solid #e9ecef; 
                                border-radius: 6px;
                                color: #495057;
                                background-color: #fff;
                            ">
                        </div>
                    </div>
                </div>

                <!-- Extra Media -->
                <div class="form-group" style="margin-bottom: 20px;">
                    <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #495057;">
                        <i class="fas fa-photo-video" style="color: #ffc107; margin-right: 5px;"></i>
                        Extra Media (Max 15)
                    </label>
                    <input type="file" id="awardsExtraMedia" accept="image/*,video/*" multiple style="
                        width: 100%;
                        padding: 12px;
                        border: 2px solid #e9ecef;
                        border-radius: 8px;
                        color: #495057;
                        background-color: #fff;
                    ">
                    <small style="color: #6c757d;">Upload additional images or videos for your awards event</small>
                </div>

                <!-- Description -->
                <div class="form-group" style="margin-bottom: 20px;">
                    <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #495057;">
                        <i class="fas fa-align-left" style="color: #ffc107; margin-right: 5px;"></i>
                        Description *
                    </label>
                    <textarea id="awardsDescription" required rows="4" style="
                        width: 100%;
                        padding: 12px;
                        border: 2px solid #e9ecef;
                        border-radius: 8px;
                        font-size: 14px;
                        resize: vertical;
                        color: #495057;
                        background-color: #fff;
                    " placeholder="Describe your awards event"></textarea>
                </div>

                <!-- Date and Time -->
                <div class="form-group" style="margin-bottom: 20px;">
                    <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #495057;">
                        <i class="fas fa-calendar" style="color: #ffc107; margin-right: 5px;"></i>
                        Awards Period *
                    </label>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div>
                            <label style="color: #495057;">Start Date & Time:</label>
                            <input type="datetime-local" id="awardsStartDateTime" required style="
                                width: 100%;
                                padding: 10px;
                                border: 2px solid #e9ecef;
                                border-radius: 6px;
                                color: #495057;
                                background-color: #fff;
                            ">
                        </div>
                        <div>
                            <label style="color: #495057;">End Date & Time:</label>
                            <input type="datetime-local" id="awardsEndDateTime" required style="
                                width: 100%;
                                padding: 10px;
                                border: 2px solid #e9ecef;
                                border-radius: 6px;
                                color: #495057;
                                background-color: #fff;
                            ">
                        </div>
                    </div>
                </div>

                <!-- Event Link -->
                <div class="form-group" style="margin-bottom: 20px;">
                    <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #495057;">
                        <i class="fas fa-link" style="color: #ffc107; margin-right: 5px;"></i>
                        Awards Event Link *
                    </label>
                    <div style="display: flex; align-items: center; border: 2px solid #e9ecef; border-radius: 8px; overflow: hidden;">
                        <span style="background: #f8f9fa; padding: 12px; color: #6c757d; border-right: 1px solid #e9ecef;">
                            reward-hub.vercel.app/awards/
                        </span>
                        <input type="text" id="awardsEventLink" required style="
                            flex: 1;
                            padding: 12px;
                            border: none;
                            outline: none;
                            color: #495057;
                            background-color: #fff;
                        " placeholder="my-awards-event">
                    </div>
                </div>

                <!-- Awards Categories -->
                <div class="form-group" style="margin-bottom: 20px;">
                    <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #495057;">
                        <i class="fas fa-list" style="color: #ffc107; margin-right: 5px;"></i>
                        Awards Categories
                    </label>
                    <div id="awardsCategoriesList" style="margin-bottom: 10px;">
                        <!-- Categories will be added here -->
                    </div>
                    <button type="button" onclick="addAwardsCategory()" style="
                        background: #28a745;
                        color: white;
                        border: none;
                        padding: 8px 16px;
                        border-radius: 6px;
                        cursor: pointer;
                        font-size: 14px;
                    ">
                        <i class="fas fa-plus"></i> Add Category
                    </button>
                </div>

                <!-- Response Type -->
                <div class="form-group" style="margin-bottom: 20px;">
                    <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #495057;">
                        <i class="fas fa-question-circle" style="color: #ffc107; margin-right: 5px;"></i>
                        Response Type *
                    </label>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <label style="
                            display: flex;
                            align-items: center;
                            padding: 12px;
                            border: 2px solid #e9ecef;
                            border-radius: 8px;
                            cursor: pointer;
                            transition: all 0.3s ease;
                            color: #495057;
                        ">
                            <input type="radio" name="awardsResponseType" value="multiple_choice" checked style="margin-right: 8px;">
                            <span>Multiple Choice</span>
                        </label>
                        <label style="
                            display: flex;
                            align-items: center;
                            padding: 12px;
                            border: 2px solid #e9ecef;
                            border-radius: 8px;
                            cursor: pointer;
                            transition: all 0.3s ease;
                            color: #495057;
                        ">
                            <input type="radio" name="awardsResponseType" value="short_text" style="margin-right: 8px;">
                            <span>Short Text Answer</span>
                        </label>
                    </div>
                </div>

                <!-- Awards Type -->
                <div class="form-group" style="margin-bottom: 20px;">
                    <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #495057;">
                        <i class="fas fa-money-bill" style="color: #ffc107; margin-right: 5px;"></i>
                        Awards Type *
                    </label>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <label style="
                            display: flex;
                            align-items: center;
                            padding: 12px;
                            border: 2px solid #e9ecef;
                            border-radius: 8px;
                            cursor: pointer;
                            color: #495057;
                        ">
                            <input type="radio" name="awardsType" value="free" checked onchange="toggleAwardsPayment()" style="margin-right: 8px;">
                            <span>Free</span>
                        </label>
                        <label style="
                            display: flex;
                            align-items: center;
                            padding: 12px;
                            border: 2px solid #e9ecef;
                            border-radius: 8px;
                            cursor: pointer;
                            color: #495057;
                        ">
                            <input type="radio" name="awardsType" value="paid" onchange="toggleAwardsPayment()" style="margin-right: 8px;">
                            <span>Paid</span>
                        </label>
                    </div>
                    
                    <div id="awardsPaymentSection" style="display: none; margin-top: 15px;">
                        <label style="color: #495057;">Awards Fee ():</label>
                        <input type="number" id="awardsNominationFee" min="100" step="50" style="
                            width: 100%;
                            padding: 10px;
                            border: 2px solid #e9ecef;
                            border-radius: 6px;
                            margin-top: 5px;
                            color: #495057;
                            background-color: #fff;
                        " placeholder="Enter awards fee">
                    </div>
                </div>

                <!-- Number of People -->
                <div class="form-group" style="margin-bottom: 20px;">
                    <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #495057;">
                        <i class="fas fa-users" style="color: #ffc107; margin-right: 5px;"></i>
                        Maximum Entries per Category
                    </label>
                    <input type="number" id="awardsMaxPeople" min="1" value="100" style="
                        width: 100%;
                        padding: 12px;
                        border: 2px solid #e9ecef;
                        border-radius: 8px;
                        color: #495057;
                        background-color: #fff;
                    " placeholder="Enter maximum number of entries">
                </div>

                <!-- Optional Sponsors -->
                <div class="form-group" style="margin-bottom: 20px;">
                    <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #495057;">
                        <i class="fas fa-handshake" style="color: #ffc107; margin-right: 5px;"></i>
                        Sponsors (Optional)
                    </label>
                    <div id="awardsSponsorsList" style="margin-bottom: 10px;">
                        <!-- Sponsors will be added here -->
                    </div>
                    <button type="button" onclick="addAwardsSponsor()" style="
                        background: #17a2b8;
                        color: white;
                        border: none;
                        padding: 8px 16px;
                        border-radius: 6px;
                        cursor: pointer;
                        font-size: 14px;
                    ">
                        <i class="fas fa-plus"></i> Add Sponsor
                    </button>
                </div>

                <!-- Host Details -->
                <div class="form-group" style="margin-bottom: 20px;">
                    <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #495057;">
                        <i class="fas fa-user" style="color: #ffc107; margin-right: 5px;"></i>
                        Host Information *
                    </label>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div>
                            <label style="color: #495057;">Host Name:</label>
                            <input type="text" id="awardsHostName" required style="
                                width: 100%;
                                padding: 10px;
                                border: 2px solid #e9ecef;
                                border-radius: 6px;
                                margin-top: 5px;
                                color: #495057;
                                background-color: #fff;
                            " placeholder="Enter host name">
                        </div>
                        <div>
                            <label style="color: #495057;">Contact (Optional):</label>
                            <input type="text" id="awardsHostContact" style="
                                width: 100%;
                                padding: 10px;
                                border: 2px solid #e9ecef;
                                border-radius: 6px;
                                margin-top: 5px;
                                color: #495057;
                                background-color: #fff;
                            " placeholder="Phone or email">
                        </div>
                    </div>
                </div>

                <!-- Social Media -->
                <div class="form-group" style="margin-bottom: 30px;">
                    <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #495057;">
                        <i class="fas fa-share-alt" style="color: #ffc107; margin-right: 5px;"></i>
                        Social Media Links (Optional)
                    </label>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <input type="url" id="awardsTwitter" style="
                            padding: 10px;
                            border: 2px solid #e9ecef;
                            border-radius: 6px;
                            color: #495057;
                            background-color: #fff;
                        " placeholder="Twitter URL">
                        <input type="url" id="awardsInstagram" style="
                            padding: 10px;
                            border: 2px solid #e9ecef;
                            border-radius: 6px;
                            color: #495057;
                            background-color: #fff;
                        " placeholder="Instagram URL">
                    </div>
                </div>

                <!-- Submit Button -->
                <div style="text-align: center; padding-top: 20px; border-top: 1px solid #e9ecef;">
                    <button type="submit" style="
                        background: linear-gradient(135deg, #ffc107 0%, #e0a800 100%);
                        color: #212529;
                        border: none;
                        padding: 15px 40px;
                        border-radius: 10px;
                        cursor: pointer;
                        font-size: 16px;
                        font-weight: 600;
                        transition: all 0.3s ease;
                    " onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                        <i class="fas fa-trophy"></i>
                        Create Awards Event
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
              
            
                             
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-analytics-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
<script src="https://checkout.flutterwave.com/v3.js"></script>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6058145320758437"
     crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.js"></script>
<script>
// For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyDW8V2SjNITrA4LcdmeILh944mTbOKnM0c",
  authDomain: "rewarderhub.firebaseapp.com",
  projectId: "rewarderhub",
  storageBucket: "rewarderhub.firebasestorage.app",
  messagingSenderId: "85965945106",
  appId: "1:85965945106:web:fa0a57d8968926e1041bcb",
  measurementId: "G-F2ERB5NGN0"
};



// Initialize Firebase
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();
const analytics = firebase.analytics();



// Constants
const ADMIN_EMAIL = 'rewarderprivate@gmail.com';
const ADMIN_PASSWORD = 'BISA1999';



// DOM Elements
const splitScreen = document.querySelector('.split-screen');
const loginForm = document.getElementById('loginForm');
const signupForm = document.getElementById('signupForm');
const googleBtns = document.querySelectorAll('.google-btn');
const dashboardPage = document.getElementById('dashboardPage');
const passwordFields = document.querySelectorAll('.password-field');


// Initialize UI
document.addEventListener('DOMContentLoaded', function() {
 
 
 // Setup form switching
 setupFormSwitching();
});


// Setup form switching
function setupFormSwitching() {
      // Get the forms
        const loginForm = document.getElementById('loginForm');
        const signupForm = document.getElementById('signupForm');
        
        // Get the switch links
        const showSignupLink = document.getElementById('showSignup');
        const showLoginLink = document.getElementById('showLogin');
        
        // Add event listeners to the links
        if (showSignupLink) {
            showSignupLink.addEventListener('click', function(e) {
                e.preventDefault();
                loginForm.classList.add('hidden');
                signupForm.classList.remove('hidden');
            });
        }
        
        if (showLoginLink) {
            showLoginLink.addEventListener('click', function(e) {
                e.preventDefault();
                signupForm.classList.add('hidden');
                loginForm.classList.remove('hidden');
            });
        }
    }
  
  

// Show toast notification
function showToast(message, type = 'success') {
 const toast = document.getElementById('toast') || createToastElement();
 
 // Set toast type
 toast.className = 'toast';
 toast.classList.add(type);
 
 // Set message
 toast.querySelector('.toast-message').textContent = message;
 
 // Set icon
 const iconElement = toast.querySelector('.toast-icon i');
 if (iconElement) {
  iconElement.className = type === 'success' 
   ? 'fas fa-check-circle' 
   : 'fas fa-exclamation-circle';
 }
 
 // Show toast
 toast.classList.add('show');
 
 // Hide after 3 seconds
 setTimeout(() => {
  toast.classList.remove('show');
 }, 3000);
}


// Create toast element if it doesn't exist
function createToastElement() {
 const toast = document.createElement('div');
 toast.className = 'toast';
 toast.innerHTML = `
  <div class="toast-icon">
   <i class="fas fa-check-circle"></i>
  </div>
  <div class="toast-message"></div>
 `;
 document.body.appendChild(toast);
 return toast;
}






document.addEventListener('DOMContentLoaded', function() {
      // Direct approach for password toggle
      const passwordInput = document.getElementById('signupPassword');
      const toggleIcon = document.querySelector('.toggle-password');
      
      if (passwordInput && toggleIcon) {
        // Add click event directly to the toggle icon
        toggleIcon.onclick = function() {
          // Toggle between password and text
          if (passwordInput.type === 'password') {
            passwordInput.type = 'text';
            toggleIcon.classList.remove('fa-eye-slash');
            toggleIcon.classList.add('fa-eye');
          } else {
            passwordInput.type = 'password';
            toggleIcon.classList.remove('fa-eye');
            toggleIcon.classList.add('fa-eye-slash');
          }
        };
      }
      
      // Password validation and strength meter
      if (passwordInput) {
        const strengthMeter = document.querySelector('.strength-meter');
        const strengthText = document.querySelector('.strength-text');
        const strengthSegments = document.querySelectorAll('.strength-segment');
        
        // Add minlength attribute
        passwordInput.setAttribute('minlength', '6');
        
        // Create error message element
        const errorMessage = document.createElement('div');
        errorMessage.style.color = '#ff4d4d';
        errorMessage.style.fontSize = '12px';
        errorMessage.style.marginTop = '4px';
        errorMessage.style.display = 'none';
        
        // Insert error message after strength text
        if (strengthText && strengthText.parentNode) {
          strengthText.parentNode.insertBefore(errorMessage, strengthText.nextSibling);
        }
        
        // Password input event
        passwordInput.addEventListener('input', function() {
          const password = this.value;
          
          // Check minimum length
          if (password.length > 0 && password.length < 6) {
            errorMessage.textContent = 'Password must be at least 6 characters';
            errorMessage.style.display = 'block';
          } else {
            errorMessage.style.display = 'none';
          }
          
          // Update strength meter
          if (strengthSegments && strengthText) {
            updatePasswordStrength(password, strengthSegments, strengthText);
          }
        });
      }
      
      // Function to update password strength
      function updatePasswordStrength(password, segments, textElement) {
        // Reset segments
        segments.forEach(segment => {
          segment.style.backgroundColor = '#e0e0e0';
        });
        
        if (!password) {
          textElement.textContent = 'Password strength';
          return;
        }
        
        // Calculate strength
        const hasLower = /[a-z]/.test(password);
        const hasUpper = /[A-Z]/.test(password);
        const hasNumber = /[0-9]/.test(password);
        const hasSpecial = /[^A-Za-z0-9]/.test(password);
        const length = password.length;
        
        let strength = 0;
        // Only count if minimum length is met
        if (length >= 6) {
          strength++;
          if (length >= 8) strength++;
          if (hasLower && hasUpper) strength++;
          if (hasNumber) strength++;
          if (hasSpecial) strength++;
        }
        
        // Colors for different strength levels
        const colors = {
          1: '#ff4d4d', // weak
          2: '#ffaa00', // medium
          3: '#2ecc71', // strong
          4: '#27ae60' // very strong
        };
        
        // Update segments
        for (let i = 0; i < Math.min(strength, segments.length); i++) {
          segments[i].style.backgroundColor = colors[strength] || colors[1];
        }
        
        // Update text
        if (length < 6) {
          textElement.textContent = 'Too short';
          textElement.style.color = '#ff4d4d';
        } else {
          textElement.style.color = '';
          if (strength <= 1) textElement.textContent = 'Weak';
          else if (strength === 2) textElement.textContent = 'Medium';
          else if (strength === 3) textElement.textContent = 'Strong';
          else textElement.textContent = 'Very strong';
        }
      }
    });

// Show loading state on button
function setButtonLoading(button, isLoading) {
 if (isLoading) {
  button.classList.add('loading');
  const originalText = button.textContent;
  button.setAttribute('data-original-text', originalText);
  button.innerHTML = 'Processing... <span class="loading-spinner"></span>';
  button.disabled = true;
 } else {
  button.classList.remove('loading');
  const originalText = button.getAttribute('data-original-text');
  button.textContent = originalText;
  button.disabled = false;
  }
}

// Bank Details Setup Functions
function openBankSetup() {
    document.getElementById('bankSetupModal').style.display = 'flex';
}

function closeBankSetup() {
    document.getElementById('bankSetupModal').style.display = 'none';
    // Clear form
    document.getElementById('setupBank').value = '';
    document.getElementById('setupAccount').value = '';
    document.getElementById('setupName').value = '';
    document.getElementById('bankSetupError').style.display = 'none';
}

async function saveBankDetails() {
    const bank = document.getElementById('setupBank').value;
    const account = document.getElementById('setupAccount').value;
    const name = document.getElementById('setupName').value;
    const errorDiv = document.getElementById('bankSetupError');
    
    // Hide previous errors
    errorDiv.style.display = 'none';
    
    // Validation
    if (!bank) {
        errorDiv.textContent = 'Please select a bank';
        errorDiv.style.display = 'block';
        return;
    }
    
    if (!account) {
        errorDiv.textContent = 'Please enter account number';
        errorDiv.style.display = 'block';
        return;
    }
    
    if (!name) {
        errorDiv.textContent = 'Please enter account name';
        errorDiv.style.display = 'block';
        return;
    }
    
    try {
        const user = firebase.auth().currentUser;
        if (!user) {
            errorDiv.textContent = 'Please log in first';
            errorDiv.style.display = 'block';
            return;
        }
        
        const db = firebase.firestore();
        
        // Save bank details to the current event document
        if (currentEventId) {
            await db.collection('physicalevents').doc(currentEventId).update({
                [`userBankDetails.${user.uid}`]: {
                    bankName: bank,
                    accountNumber: account,
                    accountName: name,
                    savedAt: firebase.firestore.FieldValue.serverTimestamp()
                }
            });
            
            alert('Bank details saved successfully!');
            closeBankSetup();
            loadUserBankDetails(); // Refresh the display
        } else {
            errorDiv.textContent = 'No event selected';
            errorDiv.style.display = 'block';
        }
        
    } catch (error) {
        console.error('Error:', error);
        errorDiv.textContent = 'Error saving bank details: ' + error.message;
        errorDiv.style.display = 'block';
    }
}

async function loadUserBankDetails() {
    try {
        const user = firebase.auth().currentUser;
        const eventId = window.currentEventId || currentEventId;
        if (!user || !eventId) return;
        
        const db = firebase.firestore();
        const eventDoc = await db.collection('physicalevents').doc(eventId).get();
        
        if (eventDoc.exists) {
            const eventData = eventDoc.data();
            const userBankDetails = eventData.userBankDetails && eventData.userBankDetails[user.uid];
            
            if (userBankDetails) {
                // Update display
                document.getElementById('bankDetailsDisplay').innerHTML = `
                    <div style="display: grid; grid-template-columns: auto 1fr; gap: 8px; align-items: center;">
                        <div style="display: flex; align-items: center; gap: 6px; color: #28a745;">
                            <i class="fas fa-check-circle"></i>
                            <strong>Bank:</strong>
                        </div>
                        <div style="color: #333; font-weight: 500;">${userBankDetails.bankName}</div>
                        <div style="display: flex; align-items: center; gap: 6px; color: #28a745;">
                            <i class="fas fa-check-circle"></i>
                            <strong>Account:</strong>
                        </div>
                        <div style="color: #333; font-weight: 500;">${userBankDetails.accountNumber}</div>
                        <div style="display: flex; align-items: center; gap: 6px; color: #28a745;">
                            <i class="fas fa-check-circle"></i>
                            <strong>Name:</strong>
                        </div>
                        <div style="color: #333; font-weight: 500;">${userBankDetails.accountName}</div>
                    </div>
                `;
                
                // Auto-populate withdrawal form fields
                const bankSelect = document.getElementById('withdraw-bank');
                const accountName = document.getElementById('withdraw-account-name');
                const accountNumber = document.getElementById('withdraw-account-number');
                
                if (bankSelect) bankSelect.value = userBankDetails.bankName;
                if (accountName) accountName.value = userBankDetails.accountName;
                if (accountNumber) accountNumber.value = userBankDetails.accountNumber;
                
                // Also check for simple withdrawal form fields if they exist
                const simpleBank = document.getElementById('simpleBank');
                const simpleAccount = document.getElementById('simpleAccount');
                const simpleName = document.getElementById('simpleName');
                
                if (simpleBank) simpleBank.value = userBankDetails.bankName;
                if (simpleAccount) simpleAccount.value = userBankDetails.accountNumber;
                if (simpleName) simpleName.value = userBankDetails.accountName;
            }
        }
        
    } catch (error) {
        console.error('Error loading bank details:', error);
    }
}


// Check if user is admin
function isAdmin(email) {
 return email === ADMIN_EMAIL;
}


// Navigate to dashboard
function navigateToDashboard(user, isAdminUser = false) {
 // Store admin status in localStorage for persistence
 if (isAdminUser) {
  localStorage.setItem('isAdmin', 'true');
 } else {
  localStorage.removeItem('isAdmin');
 }


 // Hide authentication container
 if (splitScreen) {
  splitScreen.style.display = 'none';
 }
 
 // If admin, show admin dashboard instead of regular dashboard
 if (isAdminUser) {
  console.log('Showing admin dashboard for:', user.email);
  
  // Hide regular dashboard if it exists
  if (dashboardPage) {
   dashboardPage.classList.remove('active');
  }
  
  // Show admin dashboard
  const adminDashboard = document.getElementById('dashboard');
  if (adminDashboard) {
   adminDashboard.classList.remove('hidden');
   
   // Set moderator name if available
   const moderatorName = document.querySelector('.moderator-name');
   if (moderatorName) {
    moderatorName.textContent = user.displayName || 'Administrator';
   }
   
   // Initialize admin dashboard functionality
   initializeAdminDashboard();
   
   showToast('Admin mode activated', 'success');
  } else {
   console.error('Admin dashboard element not found');
   showToast('Error loading admin dashboard', 'error');
  }
 } else {
  // Show regular dashboard
  if (dashboardPage) {
   dashboardPage.classList.add('active');
   
   // Set username
   const displayName = user.displayName || user.email.split('@')[0];
   const usernameDisplay = document.getElementById('usernameDisplay');
   if (usernameDisplay) {
    usernameDisplay.textContent = displayName;
   }
   
   // Set profile image if available
   const userProfileImage = document.getElementById('userProfileImage');
   if (userProfileImage && user.photoURL) {
    userProfileImage.src = user.photoURL;
   }
  }
 }
 
 // Prevent body scrolling
 document.body.style.overflow = 'hidden';
 
 // Log analytics event
 if (typeof analytics !== 'undefined') {
  analytics.logEvent('login', {
   method: user.providerData[0].providerId,
   isAdmin: isAdminUser
  });
 }
}


// Initialize admin dashboard
function initializeAdminDashboard() {
 console.log('Initializing admin dashboard');
 
 // Set up logout button
 const logoutBtn = document.getElementById('logoutBtn');
 if (logoutBtn) {
  logoutBtn.addEventListener('click', logout);
 }
 
 // Set up action card buttons
 const buyCoinSupportBtn = document.getElementById('buyCoinSupportBtn');
 const withdrawSupportBtn = document.getElementById('withdrawSupportBtn');
 const transferSupportBtn = document.getElementById('transferSupportBtn');
 const talentCoinDispenserBtn = document.getElementById('talentCoinDispenserBtn');
 
 // Dashboard sections
 const dashboard = document.getElementById('dashboard');
 const buyCoinSupport = document.getElementById('buyCoinSupport');
 const withdrawSupport = document.getElementById('withdrawSupport');
 const transferSupport = document.getElementById('transferSupport');
 const talentCoinDispenser = document.getElementById('talentCoinDispenser');
 
 // Function to show a specific section and hide others
 function showSection(sectionToShow) {
  // Hide all sections
  [buyCoinSupport, withdrawSupport, transferSupport, talentCoinDispenser].forEach(section => {
   if (section) section.classList.add('hidden');
  });
  
  // Show the selected section
  if (sectionToShow) {
   sectionToShow.classList.remove('hidden');
  }
 }
 
 // Set up action card click handlers
 if (buyCoinSupportBtn) {
  buyCoinSupportBtn.addEventListener('click', () => showSection(buyCoinSupport));
 }
 
 if (withdrawSupportBtn) {
  withdrawSupportBtn.addEventListener('click', () => showSection(withdrawSupport));
 }
 
 if (transferSupportBtn) {
  transferSupportBtn.addEventListener('click', () => showSection(transferSupport));
 }
 
 if (talentCoinDispenserBtn) {
  talentCoinDispenserBtn.addEventListener('click', () => showSection(talentCoinDispenser));
 }
 
 // Set up back buttons
 const backButtons = document.querySelectorAll('.back-btn');
 backButtons.forEach(btn => {
  btn.addEventListener('click', () => {
   const target = btn.getAttribute('data-target');
   if (target === 'dashboard') {
    showSection(null); // Hide all feature sections
   }
  });
 });
 
 // Load initial data for the dashboard
 loadDashboardData();
}


// Load dashboard data
function loadDashboardData() {
 // This would normally fetch data from Firestore
 // For now, we'll just set some placeholder values
 
 // Set badge counts
 const buyRequestsBadge = document.getElementById('buyRequestsBadge');
 const withdrawRequestsBadge = document.getElementById('withdrawRequestsBadge');
 const transferIssuesBadge = document.getElementById('transferIssuesBadge');
 
 if (buyRequestsBadge) buyRequestsBadge.textContent = '5';
 if (withdrawRequestsBadge) withdrawRequestsBadge.textContent = '3';
 if (transferIssuesBadge) transferIssuesBadge.textContent = '2';
 
 // Set today's activity summary
 const todayBuyRequests = document.getElementById('todayBuyRequests');
 const todayWithdrawals = document.getElementById('todayWithdrawals');
 const todayTransfers = document.getElementById('todayTransfers');
 const todayIssues = document.getElementById('todayIssues');
 
 if (todayBuyRequests) todayBuyRequests.textContent = '8';
 if (todayWithdrawals) todayWithdrawals.textContent = '6';
 if (todayTransfers) todayTransfers.textContent = '15';
 if (todayIssues) todayIssues.textContent = '2';
 
 // Load recent activity (placeholder)
 const recentActivityList = document.getElementById('recentActivityList');
 if (recentActivityList) {
  // Clear empty state if it exists
  const emptyState = recentActivityList.querySelector('.empty-state');
  if (emptyState) {
   emptyState.remove();
  }
  
  // Add some sample activity items
  const activityTemplate = document.getElementById('activityItemTemplate');
  if (activityTemplate) {
   const activities = [
    { title: 'New buy request from user123', time: '5 minutes ago', icon: 'fa-coins' },
    { title: 'Withdrawal approved for user456', time: '15 minutes ago', icon: 'fa-money-bill-wave' },
    { title: 'Transfer issue reported by user789', time: '30 minutes ago', icon: 'fa-exclamation-circle' },
    { title: 'New user registered', time: '1 hour ago', icon: 'fa-user-plus' }
   ];
   
   activities.forEach(activity => {
    const activityItem = activityTemplate.content.cloneNode(true);
    const activityIcon = activityItem.querySelector('.activity-icon i');
    const activityTitle = activityItem.querySelector('.activity-title');
    const activityTime = activityItem.querySelector('.activity-time');
    
    if (activityIcon) activityIcon.className = `fas ${activity.icon}`;
    if (activityTitle) activityTitle.textContent = activity.title;
    if (activityTime) activityTime.textContent = activity.time;
    
    recentActivityList.appendChild(activityItem);
   });
  }
 }
}


// Google Sign In
googleBtns.forEach(btn => {
 btn.addEventListener('click', function() {
  const provider = new firebase.auth.GoogleAuthProvider();
  provider.addScope('profile');
  provider.addScope('email');
  
  auth.signInWithPopup(provider)
   .then((result) => {
    // Save user data to Firestore
    const user = result.user;
    saveUserData(user);
    
    // Show success message
    showToast('Successfully signed in with Google!');
    
    // Check if admin
    const isAdminUser = isAdmin(user.email);
    
    // Navigate to dashboard
    navigateToDashboard(user, isAdminUser);
   })
   .catch((error) => {
    console.error('Google sign in error:', error);
    showToast(error.message, 'error');
   });
 });
});

// Email/Password Sign In

if (loginForm) {
  loginForm.addEventListener('submit', function(e) {
    e.preventDefault();
    
    const email = document.getElementById('loginEmail').value;
    const password = document.getElementById('loginPassword').value;
    
    // Basic validation
    if (!email || !password) {
      showToast('Please enter your email and password', 'error');
      return;
    }
    
    const rememberMe = document.getElementById('remember') ? document.getElementById('remember').checked : false;
    
    // Show loading animation
    showAuthLoading('Verifying your credentials...');
    
    // Show loading state on button
    const submitBtn = this.querySelector('button[type="submit"]');
    setButtonLoading(submitBtn, true);
    
    // Check for admin login
    const isAdminLogin = email === ADMIN_EMAIL && password === ADMIN_PASSWORD;
    
    auth.signInWithEmailAndPassword(email, password)
      .then((userCredential) => {
        const user = userCredential.user;
        
        // Update loading message
        document.querySelector('.loading-text').textContent = 'Updating your profile...';
        
        // Update last login timestamp
        return db.collection('users').doc(user.uid).update({
          lastLogin: firebase.firestore.FieldValue.serverTimestamp()
        }).catch(err => {
          console.log('Error updating user data:', err);
          // Continue despite error
          return user;
        }).then(() => {
          // Update loading message
          document.querySelector('.loading-text').textContent = 'Setting up your session...';
          
          // Set persistence based on remember me
          const persistence = rememberMe ? 
            firebase.auth.Auth.Persistence.LOCAL : 
            firebase.auth.Auth.Persistence.SESSION;
          
          return auth.setPersistence(persistence);
        }).then(() => {
          // Update loading message
          document.querySelector('.loading-text').textContent = 'Loading your dashboard...';
          
          // Check if wallet exists for this user
          return db.collection('wallets').doc(user.uid).get()
            .then(walletDoc => {
              if (!walletDoc.exists) {
                // Create wallet if it doesn't exist
                return createUserWallet(user.uid).catch(error => {
                  console.warn('Could not create wallet, but continuing sign in:', error);
                  // Continue despite wallet creation error
                  return null;
                });
              }
              return null;
            });
        }).then(() => {
          // Hide loading after a minimum time for better UX
          setTimeout(() => {
            hideAuthLoading();
            showToast('Successfully signed in!');
            navigateToDashboard(user, isAdminLogin);
          }, 1500); // Minimum 1.5 seconds to show loading
          
          return user;
        });
      })
      .catch((error) => {
        console.error('Sign in error:', error);
        hideAuthLoading();
        showToast(error.message, 'error');
      })
      .finally(() => {
        setButtonLoading(submitBtn, false);
      });
  });
}

// Make sure these helper functions are defined
if (typeof showAuthLoading !== 'function') {
  // Show loading animation
  function showAuthLoading(message = 'Verifying credentials...') {
    const loadingOverlay = document.getElementById('auth-loading-overlay');
    if (loadingOverlay) {
      const loadingText = loadingOverlay.querySelector('.loading-text');
      if (loadingText) {
        loadingText.textContent = message;
      }
      loadingOverlay.classList.add('active');
    }
  }
}

if (typeof hideAuthLoading !== 'function') {
  // Hide loading animation
  function hideAuthLoading() {
    const loadingOverlay = document.getElementById('auth-loading-overlay');
    if (loadingOverlay) {
      loadingOverlay.classList.remove('active');
    }
  }
}

if (typeof createUserWallet !== 'function') {
  // Create wallet for user
  function createUserWallet(userId) {
    // First check if wallet already exists to avoid duplicate creation
    return db.collection('wallets').doc(userId).get()
      .then(doc => {
        if (doc.exists) {
          console.log('Wallet already exists for user:', userId);
          return doc.data();
        }
        
        // Create new wallet if it doesn't exist
        const walletData = {
          userId: userId,
          talentCoinBalance: 0,
          pendingCoinBalance: 0,
          commissionBalance: 0,
          nairaBalance: 0,
          createdAt: firebase.firestore.FieldValue.serverTimestamp(),
          updatedAt: firebase.firestore.FieldValue.serverTimestamp(),
          transactions: []
        };
        
        return db.collection('wallets').doc(userId).set(walletData)
          .then(() => {
            console.log('Wallet created for user:', userId);
            return walletData;
          });
      })
      .catch((error) => {
        console.error('Error with wallet operation:', error);
        // Don't throw the error, just return null to continue the flow
        return null;
      });
  }
}

 // Email/Password Sign Up
const signupFormElement = document.getElementById('signupFormElement');

if (signupFormElement) {
  signupFormElement.addEventListener('submit', function(e) {
    e.preventDefault();
    
    const fullName = document.getElementById('fullName').value;
    const email = document.getElementById('signupEmail').value;
    const password = document.getElementById('signupPassword').value;
    const userType = document.getElementById('userType').value;
    const termsAccepted = document.getElementById('terms').checked;
    
    // Validate form
    if (!termsAccepted) {
      showToast('Please accept the terms and conditions', 'error');
      return;
    }
    
    if (!userType) {
      showToast('Please select your role', 'error');
      return;
    }
    
    // Show loading state
    const submitBtn = this.querySelector('button[type="submit"]');
    setButtonLoading(submitBtn, true);
    
    auth.createUserWithEmailAndPassword(email, password)
      .then((userCredential) => {
        const user = userCredential.user;
        
        // Update profile with display name
        return user.updateProfile({
          displayName: fullName
        }).then(() => {
          // Save user data to Firestore with additional fields
          return saveUserData(user, userType);
        }).then(() => {
          // Create wallet for the user
          return createUserWallet(user.uid).catch(error => {
            console.warn('Could not create wallet, but continuing signup:', error);
            // Continue despite wallet creation error
            return null;
          });
        }).then(() => {
          // Send email verification
          return user.sendEmailVerification();
        }).then(() => {
          showToast('Account created! Please verify your email.');
          navigateToDashboard(user);
          return user;
        });
      })
      .catch((error) => {
        console.error('Sign up error:', error);
        showToast(error.message, 'error');
      })
      .finally(() => {
        setButtonLoading(submitBtn, false);
      });
  });
}

// Save user data to Firestore with additional fields
function saveUserData(user, userType = 'voter') {
  const userData = {
    uid: user.uid,
    email: user.email,
    displayName: user.displayName || user.email.split('@')[0],
    photoURL: user.photoURL || null,
    userType: userType,
    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
    lastLogin: firebase.firestore.FieldValue.serverTimestamp(),
    isAdmin: isAdmin(user.email)
  };
  
  return db.collection('users').doc(user.uid).set(userData, { merge: true })
    .then(() => {
      console.log('User data saved:', userData);
      return userData;
    })
    .catch((error) => {
      console.error('Error saving user data:', error);
      throw error;
    });
}

// Create wallet for user
function createUserWallet(userId) {
  const walletData = {
    userId: userId,
    talentCoinBalance: 0,
    pendingCoinBalance: 0,
    commissionBalance: 0,
    nairaBalance: 0,
    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
    updatedAt: firebase.firestore.FieldValue.serverTimestamp(),
    transactions: []
  };
  
  return db.collection('wallets').doc(userId).set(walletData)
    .then(() => {
      console.log('Wallet created for user:', userId);
      return walletData;
    })
    .catch((error) => {
      console.error('Error creating wallet:', error);
      throw error;
    });
}



// Add loading animation for authentication
function setupAuthLoadingAnimation() {
  // Create the loading overlay HTML
  const loadingOverlayHTML = `
    <div id="auth-loading-overlay" class="auth-loading-overlay">
      <div class="loading-animation">
        <div class="loading-item coin"></div>
        <div class="loading-item star"></div>
        <div class="loading-item naira"></div>
        <div class="loading-item coin"></div>
        <div class="loading-item star"></div>
      </div>
      <div class="loading-text">Verifying credentials...</div>
    </div>
  `;
  
  // Add the loading overlay to the body
  document.body.insertAdjacentHTML('beforeend', loadingOverlayHTML);
  
  // Add the CSS for the loading animation
  const loadingStyles = document.createElement('style');
  loadingStyles.textContent = `
    .auth-loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.8);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease, visibility 0.3s ease;
    }
    
    .auth-loading-overlay.active {
      opacity: 1;
      visibility: visible;
    }
    
    .loading-animation {
      display: flex;
      justify-content: center;
      align-items: center;
      margin-bottom: 20px;
    }
    
    .loading-item {
      font-size: 2.5rem;
      margin: 0 10px;
      animation-duration: 2s;
      animation-iteration-count: infinite;
      animation-timing-function: ease-in-out;
      color: white;
      text-shadow: 0 0 10px rgba(255, 255, 255, 0.7);
    }
    
    .loading-item.coin {
      color: #FFD700;
      animation-name: floatCoin;
    }
    
    .loading-item.star {
      color: #6c5ce7;
      animation-name: rotateStar;
    }
    
    .loading-item.naira {
      color: #2ecc71;
      animation-name: floatNaira;
    }
    
    @keyframes floatCoin {
      0%, 100% { transform: translateY(0) rotate(0deg); }
      50% { transform: translateY(-20px) rotate(10deg); }
    }
    
    @keyframes rotateStar {
      0% { transform: rotate(0deg) scale(1); }
      50% { transform: rotate(180deg) scale(1.2); }
      100% { transform: rotate(360deg) scale(1); }
    }
    
    @keyframes floatNaira {
      0%, 100% { transform: translateY(0) scale(1); }
      50% { transform: translateY(-15px) scale(1.1); }
    }
    
    .loading-text {
      color: white;
      font-size: 1.2rem;
      font-weight: 500;
      text-align: center;
      margin-top: 10px;
      animation: pulse 1.5s infinite;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }
  `;
  document.head.appendChild(loadingStyles);
}
setupAuthLoadingAnimation();
setupAuthLoadingAnimation();





// Logout function
function logout() {
 auth.signOut()
  .then(() => {
   // Clear admin status
   localStorage.removeItem('isAdmin');
   
   // Hide dashboards
   if (dashboardPage) {
    dashboardPage.classList.remove('active');
   }
   
   const adminDashboard = document.getElementById('dashboard');
   if (adminDashboard) {
    adminDashboard.classList.add('hidden');
   }
   
   // Hide all feature sections
   const featureSections = document.querySelectorAll('.feature-section');
   featureSections.forEach(section => {
    section.classList.add('hidden');
   });
   
   // Show login screen
   if (splitScreen) {
    splitScreen.style.display = 'flex';
   }
   
   // Allow body scrolling
   document.body.style.overflow = 'auto';
   
   showToast('Successfully logged out');
  })
  .catch((error) => {
   console.error('Logout error:', error);
   showToast('Error logging out: ' + error.message, 'error');
  });
}


// Auth state change handler
auth.onAuthStateChanged(function(user) {
 if (user) {
  // User is signed in
  console.log('User is signed in:', user.email);
  
  // Check if admin from localStorage or email
  const isAdminUser = localStorage.getItem('isAdmin') === 'true' || isAdmin(user.email);
  
  // If we're on the login page, navigate to appropriate dashboard
  if (splitScreen && splitScreen.style.display !== 'none') {
   navigateToDashboard(user, isAdminUser);
  }
 } else {
  // User is signed out
  console.log('User is signed out');
  
  // Show login screen
  if (splitScreen) {
   splitScreen.style.display = 'flex';
  }
  
  // Hide dashboards
  if (dashboardPage) {
   dashboardPage.classList.remove('active');
  }
  
  const adminDashboard = document.getElementById('dashboard');
  if (adminDashboard) {
   adminDashboard.classList.add('hidden');
  }
  
  // Allow body scrolling
  document.body.style.overflow = 'auto';
 }
});


// Password reset functionality
const forgotPasswordLink = document.querySelector('.forgot-password');
if (forgotPasswordLink) {
 forgotPasswordLink.addEventListener('click', function(e) {
  e.preventDefault();
  
  const email = document.getElementById('loginEmail').value;
  if (!email) {
   showToast('Please enter your email address first', 'error');
   return;
  }
  
  auth.sendPasswordResetEmail(email)
   .then(() => {
    showToast('Password reset email sent. Check your inbox.');
   })
   .catch((error) => {
    console.error('Password reset error:', error);
    showToast(error.message, 'error');
   });
 });
}


// Initialize logout buttons
const logoutBtns = document.querySelectorAll('.logout-btn');
logoutBtns.forEach(btn => {
 btn.addEventListener('click', logout);
});









// Initialize the app
console.log('Firebase Auth initialized');



// Profile functionality
document.addEventListener('DOMContentLoaded', function() {
    // Check if Firebase is initialized
    if (typeof firebase === 'undefined') {
        console.error('Firebase SDK is not loaded. Profile functionality will not work.');
        return;
    }

    // Ensure we have the storage SDK
    if (!firebase.storage) {
        // Load Firebase Storage SDK if not already loaded
        const storageScript = document.createElement('script');
        storageScript.src = 'https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js';
        storageScript.onload = function() {
            console.log('Firebase Storage SDK loaded');
            initProfileModal();
        };
        document.head.appendChild(storageScript);
    } else {
        initProfileModal();
    }
});

function initProfileModal() {
    // Create and append the profile modal HTML to the body
    const profileModalHTML = `
   
      <div id="profileModal" class="profile-modal">
    <div class="profile-modal-content">
        <div class="profile-modal-header">
            <h2>My Profile</h2>
            <button class="close-profile">&times;</button>
        </div>
        
        <!-- Scrollable Content Wrapper -->
        <div class="profile-modal-body">
            <!-- Emoji Avatar Section (replaces the profile image section) -->
            <div class="emoji-avatar-wrapper" id="emojiAvatarWrapper">
                <div class="current-emoji-avatar" id="currentEmojiAvatar"></div>
                <div class="emoji-selector" id="emojiSelector">
                    <div class="emoji-option" data-emoji=""></div>
                    <div class="emoji-option" data-emoji=""></div>
                    <div class="emoji-option" data-emoji=""></div>
                    <div class="emoji-option" data-emoji=""></div>
                    <div class="emoji-option" data-emoji=""></div>
                    <div class="emoji-option" data-emoji=""></div>
                    <div class="emoji-option" data-emoji=""></div>
                </div>
            </div>
            
            <form id="profileForm">
                <div class="form-group">
                    <label for="profileFullName">Full Name</label>
                    <input type="text" id="profileFullName" placeholder="Your full name">
                </div>
                
                <div class="form-group">
                    <label for="profileEmail">Email</label>
                    <input type="email" id="profileEmail" readonly>
                </div>
                
                <div class="form-group">
                    <label for="profileUserType">Account Type</label>
                    <select id="profileUserType">
                        <option value="contestant">Contestant</option>
                        <option value="voter">Voter</option>
                        <option value="both">Both</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="profileBio">Bio</label>
                    <textarea id="profileBio" placeholder="Tell us about yourself" rows="3"></textarea>
                </div>
                
                <div class="form-group">
                    <a href="#" id="logoutBtn" class="logout-btn">
                        <i class="fas fa-sign-out-alt"></i>
                        <span>Logout</span>
                    </a>
                    
                    <li class="menu-item">
                        <a href="#" id="termsBtn">
                            <i class="fas fa-file-contract"></i>
                            <span>Terms & Conditions</span>
                        </a>
                    </li>
                    
                    <li class="menu-item">
                        <a href="#" id="privacyBtn">
                            <i class="fas fa-shield-alt"></i>
                            <span>Privacy Policy</span>
                        </a>
                    </li>
                </div>

                <div class="profile-actions">
                    <button type="button" id="changePasswordBtn" class="secondary-btn">Change Password</button>
                    <button type="submit" id="saveProfileBtn" class="primary-btn">Save Changes</button>
                </div>
            </form>
            
            <!-- Change Password Section (Hidden by default) -->
            <div id="changePasswordSection" class="change-password-section hidden">
                <h3>Change Password</h3>
                <form id="changePasswordForm">
                    <div class="form-group">
                        <label for="currentPassword">Current Password</label>
                        <div class="password-input">
                            <input type="password" id="currentPassword" placeholder="Enter current password" required>
                            <i class="fas fa-eye-slash toggle-password"></i>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="newPassword">New Password</label>
                        <div class="password-input">
                            <input type="password" id="newPassword" placeholder="Enter new password" required>
                            <i class="fas fa-eye-slash toggle-password"></i>
                        </div>
                        <div class="password-strength">
                            <div class="strength-meter">
                                <div class="strength-segment"></div>
                                <div class="strength-segment"></div>
                                <div class="strength-segment"></div>
                                <div class="strength-segment"></div>
                            </div>
                            <span class="strength-text">Password strength</span>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="confirmPassword">Confirm Password</label>
                        <div class="password-input">
                            <input type="password" id="confirmPassword" placeholder="Confirm new password" required>
                            <i class="fas fa-eye-slash toggle-password"></i>
                        </div>
                    </div>
                    
                    <div class="profile-actions">
                        <button type="button" id="cancelPasswordChange" class="secondary-btn">Cancel</button>
                        <button type="submit" class="primary-btn">Update Password</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>                           
    `;

    // Add the profile modal CSS
    const profileStyles = document.createElement('style');
    profileStyles.textContent = `
    

  
   
   
  /* Profile Modal Styles - Fixed Responsive & Scrollable */
.profile-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(26, 26, 46, 0.9);
    backdrop-filter: blur(8px);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 10000;
    animation: fadeIn 0.3s ease;
    padding: 20px;
    box-sizing: border-box;
}

.profile-modal.active {
    display: flex;
}

.profile-modal-content {
    background: #1a1a2e;
    border-radius: 20px;
    width: 100%;
    max-width: 500px;
    max-height: calc(100vh - 40px);
    box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
    border: 1px solid rgba(255, 255, 255, 0.1);
    animation: slideUp 0.3s ease;
    position: relative;
    display: flex;
    flex-direction: column;
    overflow: hidden;
}

.profile-modal-header {
    background: rgba(255, 255, 255, 0.05);
    padding: 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    flex-shrink: 0;
}

.profile-modal-header h2 {
    color: white;
    margin: 0;
    font-size: 1.5rem;
    font-weight: 600;
}

.close-profile {
    background: none;
    border: none;
    color: white;
    font-size: 1.8rem;
    cursor: pointer;
    padding: 8px;
    border-radius: 50%;
    transition: all 0.3s ease;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
}

.close-profile:hover {
    background: rgba(255, 255, 255, 0.1);
    transform: rotate(90deg);
}

/* Scrollable Content Area */
.profile-modal-body {
    flex: 1;
    overflow-y: auto;
    overflow-x: hidden;
    padding: 0;
}

/* Emoji Avatar Section */
.emoji-avatar-wrapper {
    position: relative;
    cursor: pointer;
    width: 120px;
    height: 120px;
    margin: 30px auto 20px;
    flex-shrink: 0;
}

.current-emoji-avatar {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 60px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 50%;
    transition: all 0.3s ease;
    border: 3px solid rgba(255, 255, 255, 0.2);
    backdrop-filter: blur(10px);
}

.current-emoji-avatar:hover {
    transform: scale(1.05);
    background: rgba(255, 255, 255, 0.15);
    border-color: rgba(255, 255, 255, 0.3);
    box-shadow: 0 10px 30px rgba(255, 255, 255, 0.1);
}

.emoji-selector {
    position: absolute;
    top: 130%;
    left: 50%;
    transform: translateX(-50%);
    background: #1a1a2e;
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 15px;
    box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
    padding: 15px;
    display: none;
    grid-template-columns: repeat(4, 1fr);
    gap: 10px;
    z-index: 1001;
    width: 200px;
    max-height: 150px;
    overflow-y: auto;
}

.emoji-selector.active {
    display: grid;
    animation: scaleIn 0.2s ease;
}

.emoji-option {
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    cursor: pointer;
    border-radius: 50%;
    transition: all 0.2s ease;
    background: rgba(255, 255, 255, 0.05);
}

.emoji-option:hover {
    background: rgba(255, 255, 255, 0.15);
    transform: scale(1.2);
}

/* Form Styles */
#profileForm {
    padding: 0 30px 30px;
    color: white;
}

.form-group {
    margin-bottom: 20px;
}

.form-group label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
    color: white;
    font-size: 0.9rem;
}

.form-group input,
.form-group select,
.form-group textarea {
    width: 100%;
    padding: 12px 16px;
    border: 2px solid rgba(255, 255, 255, 0.2);
    border-radius: 10px;
    font-size: 0.95rem;
    transition: all 0.3s ease;
    background: rgba(255, 255, 255, 0.05);
    color: white;
    box-sizing: border-box;
}

.form-group input::placeholder,
.form-group textarea::placeholder {
    color: rgba(255, 255, 255, 0.6);
}

.form-group input:focus,
.form-group select:focus,
.form-group textarea:focus {
    outline: none;
    border-color: rgba(255, 255, 255, 0.5);
    background: rgba(255, 255, 255, 0.1);
    box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.1);
}

.form-group input[readonly] {
    background: rgba(255, 255, 255, 0.02);
    cursor: not-allowed;
    color: rgba(255, 255, 255, 0.6);
    border-color: rgba(255, 255, 255, 0.1);
}

.form-group textarea {
    resize: vertical;
    min-height: 80px;
    font-family: inherit;
}

.form-group select option {
    background: #1a1a2e;
    color: white;
}

/* Menu Items Styling */
.menu-item {
    list-style: none;
    margin: 10px 0;
}

.menu-item a,
.logout-btn {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px 16px;
    color: white;
    text-decoration: none;
    border-radius: 8px;
    transition: all 0.3s ease;
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.menu-item a:hover,
.logout-btn:hover {
    background: rgba(255, 255, 255, 0.1);
    transform: translateX(5px);
}

.logout-btn {
    border-color: rgba(220, 53, 69, 0.3);
    color: white;
}

.logout-btn:hover {
    background: rgba(220, 53, 69, 0.1);
    border-color: rgba(220, 53, 69, 0.5);
}

.menu-item a i,
.logout-btn i {
    font-size: 1.1rem;
    width: 20px;
    text-align: center;
}

.menu-item a span,
.logout-btn span {
    color: red;
    font-size: 0.9rem;
    font-weight: 500;
}
  

 

/* Password Input with Toggle */
.password-input {
    position: relative;
}

.password-input input {
    padding-right: 45px;
}

.toggle-password {
    position: absolute;
    right: 15px;
    top: 50%;
    transform: translateY(-50%);
    cursor: pointer;
    color: rgba(255, 255, 255, 0.6);
    transition: color 0.3s ease;
}

.toggle-password:hover {
    color: white;
}

/* Password Strength Meter */
.password-strength {
    margin-top: 10px;
}

.strength-meter {
    display: flex;
    gap: 3px;
    margin-bottom: 5px;
}

.strength-segment {
    height: 4px;
    flex: 1;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 2px;
    transition: all 0.3s ease;
}

.strength-segment.weak {
    background: #e74c3c;
}

.strength-segment.medium {
    background: #f39c12;
}

.strength-segment.strong {
    background: #27ae60;
}

.strength-text {
    font-size: 0.8rem;
    color: rgba(255, 255, 255, 0.7);
    font-weight: 500;
}

/* Button Styles */
.profile-actions {
    display: flex;
    gap: 15px;
    margin-top: 30px;
    flex-wrap: wrap;
}

.primary-btn,
.secondary-btn {
    padding: 12px 24px;
    border: none;
    border-radius: 10px;
    font-size: 0.95rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
    flex: 1;
    min-width: 120px;
}

.primary-btn {
    background: white;
    color: #1a1a2e;
}

.primary-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(255, 255, 255, 0.2);
    background: rgba(255, 255, 255, 0.9);
}

.secondary-btn {
    background: rgba(255, 255, 255, 0.1);
    color: white;
    border: 2px solid rgba(255, 255, 255, 0.2);
}

.secondary-btn:hover {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.4);
    transform: translateY(-1px);
}

.primary-btn:disabled,
.secondary-btn:disabled {
    opacity: 0.6;
    cursor: not-allowed;
    transform: none;
}

/* Loading Button State */
.primary-btn.loading,
.secondary-btn.loading {
    color: transparent;
}

.loading-spinner {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 20px;
    height: 20px;
    border: 2px solid rgba(26, 26, 46, 0.3);
    border-top: 2px solid #1a1a2e;
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

.secondary-btn .loading-spinner {
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-top: 2px solid white;
}

/* Change Password Section */
.change-password-section {
    padding: 30px 30px;
    margin-top: 20px;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
}

.change-password-section h3 {
    color: white;
    margin-bottom: 20px;
    font-size: 1.2rem;
    text-align: center;
}

.change-password-section.hidden {
    display: none;
}

.hidden {
    display: none;
}

/* Toast Notifications */
.toast-container {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 10001;
    max-width: 400px;
}

.toast {
    background: #1a1a2e;
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 12px;
    margin-bottom: 15px;
    overflow: hidden;
    transform: translateX(120%);
    transition: transform 0.4s ease;
    border-left: 4px solid white;
}

.toast.visible {
    transform: translateX(0);
}

.toast.error {
    border-left-color: #e74c3c;
}

.toast.success {
    border-left-color: #27ae60;
}

.toast.info {
    border-left-color: #3498db;
}

.toast-content {
    display: flex;
    align-items: center;
    padding: 16px 20px;
}

.toast-content i {
    font-size: 1.4rem;
    margin-right: 12px;
    color: white;
}

.toast.success i {
    color: #27ae60;
}

.toast.error i {
    color: #e74c3c;
}

.toast.info i {
    color: #3498db;
}

.toast-content span {
    flex: 1;
    font-size: 0.9rem;
    color: white;
    line-height: 1.4;
}

.toast-progress {
    height: 3px;
    background: white;
    width: 100%;
    animation: progress 3s linear;
}

.toast.error .toast-progress {
    background: #e74c3c;
}

.toast.success .toast-progress {
    background: #27ae60;
}

.toast.info .toast-progress {
    background: #3498db;
}

/* Scrollbar Styling */
.profile-modal-body::-webkit-scrollbar,
.emoji-selector::-webkit-scrollbar {
    width: 6px;
}

.profile-modal-body::-webkit-scrollbar-track,
.emoji-selector::-webkit-scrollbar-track {
    background: rgba(255, 255, 255, 0.1);
    border-radius: 3px;
}

.profile-modal-body::-webkit-scrollbar-thumb,
.emoji-selector::-webkit-scrollbar-thumb {
    background: rgba(255, 255, 255, 0.3);
    border-radius: 3px;
}

.profile-modal-body::-webkit-scrollbar-thumb:hover,
.emoji-selector::-webkit-scrollbar-thumb:hover {
    background: rgba(255, 255, 255, 0.5);
}

/* Animations */
@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes slideUp {
    from {
        transform: translateY(50px);
        opacity: 0;
    }
    to {
        transform: translateY(0);
        opacity: 1;
    }
}

@keyframes scaleIn {
    from {
        transform: translateX(-50%) scale(0.8);
        opacity: 0;
    }
    to {
        transform: translateX(-50%) scale(1);
        opacity: 1;
    }
}

@keyframes spin {
    0% { transform: translate(-50%, -50%) rotate(0deg); }
    100% { transform: translate(-50%, -50%) rotate(360deg); }
}

@keyframes progress {
    from { width: 100%; }
    to { width: 0%; }
}

/* Mobile Responsive Design */
@media (max-width: 768px) {
    .profile-modal {
        padding: 10px;
        align-items: flex-start;
    }
    
    .profile-modal-content {
        width: 100%;
        max-height: calc(100vh - 20px);
        border-radius: 15px;
        margin-top: 10px;
    }
    
    .profile-modal-header {
        padding: 15px 20px;
    }
    
    .profile-modal-header h2 {
        font-size: 1.3rem;
    }
    
    #profileForm,
    .change-password-section {
        padding: 20px;
    }
    
    .emoji-avatar-wrapper {
        width: 100px;
        height: 100px;
        margin: 20px auto 15px;
    }
    
    .current-emoji-avatar {
        font-size: 50px;
    }
    
    .emoji-selector {
        width: 180px;
        grid-template-columns: repeat(3, 1fr);
        padding: 12px;
        max-height: 120px;
    }
    
    .emoji-option {
        width: 35px;
        height: 35px;
        font-size: 18px;
    }
    
    .profile-actions {
        flex-direction: column;
        gap: 12px;
    }
    
    .primary-btn,
    .secondary-btn {
        flex: none;
        width: 100%;
        padding: 14px 20px;
    }
    
    .form-group {
        margin-bottom: 18px;
    }
    
    .form-group input,
    .form-group select,
    .form-group textarea {
        padding: 14px 16px;
        font-size: 16px; /* Prevents zoom on iOS */
    }
    
    .toast-container {
        left: 10px;
        right: 10px;
        max-width: none;
    }
    
    .menu-item a,
    .logout-btn {
        padding: 14px 16px;
        margin: 8px 0;
    }
}

@media (max-width: 480px) {
    .profile-modal {
        padding: 5px;
    }
    
    .profile-modal-content {
        width: 100%;
        max-height: calc(100vh - 10px);
        border-radius: 12px;
        margin-top: 5px;
    }
    
    .profile-modal-header {
        padding: 12px 15px;
    }
    
    .profile-modal-header h2 {
        font-size: 1.2rem;
    }
    
    #profileForm,
    .change-password-section {
        padding: 15px;
    }
    
    .emoji-avatar-wrapper {
        width: 80px;
        height: 80px;
        margin: 15px auto 10px;
    }
    
    .current-emoji-avatar {
        font-size: 40px;
    }
    
    .emoji-selector {
        width: 150px;
        grid-template-columns: repeat(3, 1fr);
        gap: 8px;
        padding: 10px;
        max-height: 100px;
    }
    
    .emoji-option {
        width: 30px;
        height: 30px;
        font-size: 16px;
    }
    
    .form-group input,
    .form-group select,
    .form-group textarea {
        padding: 12px 14px;
    }
    
    .close-profile {
        width: 35px;
        height: 35px;
        font-size: 1.5rem;
    }
    
    .form-group {
        margin-bottom: 15px;
    }
}

/* Landscape mobile fix */
@media (max-height: 600px) and (orientation: landscape) {
    .profile-modal {
        align-items: flex-start;
        padding: 5px;
    }
    
    .profile-modal-content {
        max-height: calc(100vh - 10px);
    }
    
    .emoji-avatar-wrapper {
        width: 60px;
        height: 60px;
        margin: 10px auto;
    }
    
    .current-emoji-avatar {
        font-size: 30px;
    }
}

/* User Profile Image in Header (if needed) */
.user-profile-image.emoji-avatar {
    font-size: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 50%;
    width: 40px;
    height: 40px;
    cursor: pointer;
    transition: all 0.3s ease;
    border: 2px solid rgba(255, 255, 255, 0.2);
}

.user-profile-image.emoji-avatar:hover {
    transform: scale(1.1);
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.4);
}

/* Focus States for Accessibility */
.current-emoji-avatar:focus,
.emoji-option:focus,
.close-profile:focus,
.primary-btn:focus,
.secondary-btn:focus {
    outline: 2px solid rgba(255, 255, 255, 0.5);
    outline-offset: 2px;
}


/* Ensure other modals are hidden by default */
.sidebar-menu,
.sidebar-overlay,
.modal {
    display: none !important;
}

/* Show sidebar when active */
.sidebar-menu.active {
    display: block !important;
}

.sidebar-overlay.active {
    display: block !important;
}

/* Show modals when active */
.modal.active {
    display: flex !important;
}

/* Specific styling for existing modals to not conflict with profile modal */
.sidebar-menu {
    position: fixed;
    top: 0;
    left: -300px;
    width: 300px;
    height: 100%;
    background: #1a1a2e;
    border-right: 1px solid rgba(255, 255, 255, 0.1);
    z-index: 9999;
    transition: left 0.3s ease;
}

.sidebar-menu.active {
    left: 0;
}

.sidebar-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    z-index: 9998;
}

/* Existing modal styles (tickets, terms, privacy) */
.modal:not(#profileModal) {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    z-index: 9997;
    justify-content: center;
    align-items: center;
}

.modal:not(#profileModal) .modal-content {
    background: #1a1a2e;
    border-radius: 15px;
    max-width: 600px;
    width: 90%;
    max-height: 80vh;
    overflow-y: auto;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.modal:not(#profileModal) .modal-header {
    padding: 20px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.modal:not(#profileModal) .modal-header h2 {
    color: white;
    margin: 0;
    font-size: 1.4rem;
}

.modal:not(#profileModal) .close-modal,
.modal:not(#profileModal) .close-privacy {
    background: none;
    border: none;
    color: white;
    font-size: 1.5rem;
    cursor: pointer;
    padding: 5px;
    border-radius: 50%;
    transition: background 0.3s ease;
}

.modal:not(#profileModal) .close-modal:hover,
.modal:not(#profileModal) .close-privacy:hover {
    background: rgba(255, 255, 255, 0.1);
}

.modal:not(#profileModal) .modal-body {
    padding: 20px;
    color: white;
}

/* Sidebar specific styles */
.sidebar-header {
    padding: 20px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    display: flex;
    justify-content: flex-end;
}

.close-sidebar {
    background: none;
    border: none;
    color: white;
    font-size: 1.2rem;
    cursor: pointer;
    padding: 8px;
    border-radius: 50%;
    transition: background 0.3s ease;
}

.close-sidebar:hover {
    background: rgba(255, 255, 255, 0.1);
}

.sidebar-content {
    padding: 20px 0;
}

.sidebar-menu-items {
    list-style: none;
    padding: 0;
    margin: 0;
}

.sidebar-menu .menu-item {
    margin: 0;
}

.sidebar-menu .menu-item a {
    display: flex;
    align-items: center;
    gap: 15px;
    padding: 15px 20px;
    color: rgba(255, 255, 255, 0.8);
    text-decoration: none;
    transition: all 0.3s ease;
    border: none;
    background: none;
}

.sidebar-menu .menu-item a:hover {
    background: rgba(255, 255, 255, 0.1);
    color: white;
    transform: none;
}

.sidebar-menu .menu-item a i {
    font-size: 1.1rem;
    width: 20px;
    text-align: center;
}

.sidebar-footer {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    padding: 20px;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
    background: rgba(0, 0, 0, 0.2);
}

.app-version {
    color: rgba(255, 255, 255, 0.6);
    font-size: 0.8rem;
    text-align: center;
}

/* Ticket type buttons */
.ticket-type-buttons {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.ticket-type-btn {
    display: flex;
    align-items: center;
    gap: 15px;
    padding: 20px;
    background: rgba(255, 255, 255, 0.1);
    border: 2px solid rgba(255, 255, 255, 0.2);
    border-radius: 10px;
    color: white;
    cursor: pointer;
    transition: all 0.3s ease;
    text-align: left;
}

.ticket-type-btn:hover {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.4);
    transform: translateY(-2px);
}

.ticket-type-btn i {
    font-size: 1.5rem;
    color: #007bff;
}

.ticket-type-btn span {
    font-size: 1.1rem;
    font-weight: 500;
}

/* Terms and Privacy content */
.terms-content,
.privacy-content {
    line-height: 1.6;
}

.terms-content h3,
.privacy-content h3 {
    color: white;
    margin-top: 20px;
    margin-bottom: 10px;
    font-size: 1.1rem;
}

.terms-content p,
.privacy-content p {
    color: rgba(255, 255, 255, 0.8);
    margin-bottom: 15px;
}

/* Mobile responsive for other modals */
@media (max-width: 768px) {
    .sidebar-menu {
        width: 280px;
        left: -280px;
    }
    
    .modal:not(#profileModal) .modal-content {
        width: 95%;
        margin: 10px;
    }
    
    .modal:not(#profileModal) .modal-header {
        padding: 15px;
    }
    
    .modal:not(#profileModal) .modal-body {
        padding: 15px;
    }
    
    .ticket-type-btn {
        padding: 15px;
    }
    
    .ticket-type-btn i {
        font-size: 1.3rem;
    }
    
    .ticket-type-btn span {
        font-size: 1rem;
    }
}

@media (max-width: 480px) {
    .sidebar-menu {
        width: 260px;
        left: -260px;
    }
    
    .terms-content h3,
    .privacy-content h3 {
        font-size: 1rem;
    }
    
    .terms-content p,
    .privacy-content p {
        font-size: 0.9rem;
    }
}

    `;

    // Append the CSS and HTML to the document
    document.head.appendChild(profileStyles);
    document.body.insertAdjacentHTML('beforeend', profileModalHTML);

    // Initialize the profile functionality
    initializeProfileFunctionality();
}


// Add this to your JavaScript to handle modal conflicts
document.addEventListener('DOMContentLoaded', function() {
    
    // Ensure all modals are hidden on page load
    const allModals = document.querySelectorAll('.modal, .sidebar-menu, .sidebar-overlay');
    allModals.forEach(modal => {
        modal.classList.remove('active');
        if (modal.id !== 'profileModal') {
            modal.style.display = 'none';
        }
    });
    
    // Profile modal specific handlers
    const profileModal = document.getElementById('profileModal');
    const profileCloseBtn = document.querySelector('.close-profile');
    
    // Close profile modal
    if (profileCloseBtn) {
        profileCloseBtn.addEventListener('click', function() {
            profileModal.classList.remove('active');
        });
    }
    
    // Close profile modal when clicking outside
    if (profileModal) {
        profileModal.addEventListener('click', function(e) {
            if (e.target === profileModal) {
                profileModal.classList.remove('active');
            }
        });
    }
    
    // Handle terms and privacy modals from profile
    const termsBtn = document.getElementById('termsBtn');
    const privacyBtn = document.getElementById('privacyBtn');
    const termsModal = document.getElementById('termsModal');
    const privacyModal = document.getElementById('privacyModal');
    
    if (termsBtn && termsModal) {
        termsBtn.addEventListener('click', function(e) {
            e.preventDefault();
            profileModal.classList.remove('active');
            termsModal.style.display = 'flex';
            termsModal.classList.add('active');
        });
    }
    
    if (privacyBtn && privacyModal) {
        privacyBtn.addEventListener('click', function(e) {
            e.preventDefault();
            profileModal.classList.remove('active');
            privacyModal.style.display = 'flex';
            privacyModal.classList.add('active');
        });
    }
    
    // Close terms and privacy modals
    const closePrivacyBtns = document.querySelectorAll('.close-privacy');
    closePrivacyBtns.forEach(btn => {
        btn.addEventListener('click', function() {
            const modal = btn.closest('.modal');
            modal.classList.remove('active');
            modal.style.display = 'none';
        });
    });
    
    // Close other modals when clicking outside
    document.querySelectorAll('.modal:not(#profileModal)').forEach(modal => {
        modal.addEventListener('click', function(e) {
            if (e.target === modal) {
                modal.classList.remove('active');
                modal.style.display = 'none';
            }
        });
    });
});

          


function initializeProfileFunctionality() {
    // Get Firebase services
    const auth = firebase.auth();
    const db = firebase.firestore();
    const storage = firebase.storage();

    // DOM Elements
    const profileCircle = document.querySelector('.profile-circle');
    const profileModal = document.getElementById('profileModal');
    const closeModalBtn = document.querySelector('.close-profile');
    const profileForm = document.getElementById('profileForm');
    const profileImageWrapper = document.querySelector('.profile-image-wrapper');
    const profileImageUpload = document.getElementById('profileImageUpload');
    const profileModalImage = document.getElementById('profileModalImage');
    const userProfileImage = document.getElementById('userProfileImage');
    const changePasswordBtn = document.getElementById('changePasswordBtn');
    const changePasswordSection = document.getElementById('changePasswordSection');
    const cancelPasswordChange = document.getElementById('cancelPasswordChange');
    const changePasswordForm = document.getElementById('changePasswordForm');
    const togglePasswordBtns = document.querySelectorAll('.toggle-password');
    const newPasswordInput = document.getElementById('newPassword');
    const confirmPasswordInput = document.getElementById('confirmPassword');
    const strengthSegments = document.querySelectorAll('.strength-meter .strength-segment');
    const strengthText = document.querySelector('.strength-text');

    // Check if elements exist
    if (!profileCircle || !profileModal) {
        console.error('Required DOM elements not found');
        return;
    }

    // Open profile modal when clicking on profile circle
profileCircle.addEventListener('click', function() {
    profileModal.classList.add('active');
    
    // Don't reset the image when opening the modal
    // Just load the user data from Firestore
    loadUserProfileData();
});

    // Close modal when clicking the close button
    closeModalBtn.addEventListener('click', function() {
        profileModal.classList.remove('active');
    });

    // Close modal when clicking outside the modal content
    profileModal.addEventListener('click', function(e) {
        if (e.target === profileModal) {
            profileModal.classList.remove('active');
        }
    });

    // Trigger file upload when clicking on profile image
    profileImageWrapper.addEventListener('click', function() {
        profileImageUpload.click();
    });


// Function to initialize the emoji avatar selector
function initEmojiAvatarSelector() {
    const currentEmojiAvatar = document.getElementById('currentEmojiAvatar');
    const emojiSelector = document.getElementById('emojiSelector');
    const emojiOptions = document.querySelectorAll('.emoji-option');
    
    if (!currentEmojiAvatar || !emojiSelector) return;
    
    // Add click handler to show/hide emoji selector
    currentEmojiAvatar.addEventListener('click', (e) => {
        e.stopPropagation();
        emojiSelector.classList.toggle('active');
    });
    
    // Close emoji selector when clicking outside
    document.addEventListener('click', () => {
        emojiSelector.classList.remove('active');
    });
    
    // Prevent closing when clicking inside the selector
    emojiSelector.addEventListener('click', (e) => {
        e.stopPropagation();
    });
    
    // Add click handlers for each emoji option
    emojiOptions.forEach(option => {
        option.addEventListener('click', () => {
            const emoji = option.getAttribute('data-emoji');
            selectEmojiAvatar(emoji);
        });
    });
    
    // Add styles for emoji avatar
    const emojiStyles = document.createElement('style');
    emojiStyles.textContent = `
        .emoji-avatar-wrapper {
            position: relative;
            cursor: pointer;
            width: 100px;
            height: 100px;
            margin: 0 auto 20px;
        }
        
        .current-emoji-avatar {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 50px;
            background-color: #f0f0f0;
            border-radius: 50%;
            transition: all 0.3s ease;
        }
        
        .current-emoji-avatar:hover {
            background-color: #e0e0e0;
        }
        
        .emoji-selector {
            position: absolute;
            top: 110%;
            left: 50%;
            transform: translateX(-50%);
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            padding: 10px;
            display: none;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            z-index: 10;
        }
        
        .emoji-selector.active {
            display: grid;
        }
        
        .emoji-option {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            cursor: pointer;
            border-radius: 50%;
            transition: all 0.2s ease;
        }
        
        .emoji-option:hover {
            background-color: #f0f0f0;
            transform: scale(1.1);
        }
        
        .user-profile-image {
            font-size: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #f0f0f0;
        }
    `;
    document.head.appendChild(emojiStyles);
    
    // Also update the small profile image in the header
    const userProfileImage = document.querySelector('.user-profile-image');
    if (userProfileImage) {
        // Remove any existing img tag
        userProfileImage.innerHTML = '';
        userProfileImage.classList.add('emoji-avatar');
    }
}

// Function to select and save an emoji avatar
function selectEmojiAvatar(emoji) {
    const user = auth.currentUser;
    if (!user) {
        showToast('You must be logged in to change your avatar', 'error');
        return;
    }
    
    // Update the current avatar display
    const currentEmojiAvatar = document.getElementById('currentEmojiAvatar');
    if (currentEmojiAvatar) {
        currentEmojiAvatar.textContent = emoji;
    }
    
    // Update the small profile image in the header
    const userProfileImage = document.querySelector('.user-profile-image');
    if (userProfileImage) {
        userProfileImage.textContent = emoji;
    }
    
    // Close the emoji selector
    const emojiSelector = document.getElementById('emojiSelector');
    if (emojiSelector) {
        emojiSelector.classList.remove('active');
    }
    
    // Save the selected emoji to Firebase
    db.collection('users').doc(user.uid).update({
        emojiAvatar: emoji,
        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
    })
    .then(() => {
        console.log('Emoji avatar updated successfully');
        showToast('Avatar updated successfully');
    })
    .catch(error => {
        console.error('Error updating emoji avatar:', error);
        showToast('Error updating avatar: ' + error.message, 'error');
    });
}

// Function to load the user's emoji avatar
function loadUserEmojiAvatar() {
    const user = auth.currentUser;
    if (!user) return;
    
    db.collection('users').doc(user.uid).get()
        .then(doc => {
            if (doc.exists) {
                const userData = doc.data();
                
                // Get the emoji avatar or use default
                const emojiAvatar = userData.emojiAvatar || '';
                
                // Update the current avatar display
                const currentEmojiAvatar = document.getElementById('currentEmojiAvatar');
                if (currentEmojiAvatar) {
                    currentEmojiAvatar.textContent = emojiAvatar;
                }
                
                // Update the small profile image in the header
                const userProfileImage = document.querySelector('.user-profile-image');
                if (userProfileImage) {
                    userProfileImage.textContent = emojiAvatar;
                }
            }
        })
        .catch(error => {
            console.error('Error loading user emoji avatar:', error);
        });
}

// Modified auth state change listener
auth.onAuthStateChanged(function(user) {
    console.log('Auth state changed:', user ? 'User logged in' : 'User logged out');
    
    if (user) {
        // Load emoji avatar
        loadUserEmojiAvatar();
        
        // Update username display
        const usernameDisplay = document.getElementById('usernameDisplay');
        if (usernameDisplay) {
            usernameDisplay.textContent = user.displayName || user.email;
        }
        
        // Ensure user document exists in Firestore
        db.collection('users').doc(user.uid).get()
            .then(doc => {
                if (!doc.exists) {
                    // Create user document if it doesn't exist
                    console.log('Creating new user document in Firestore');
                    return db.collection('users').doc(user.uid).set({
                        email: user.email,
                        displayName: user.displayName || '',
                        emojiAvatar: '', // Default emoji avatar
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                } else if (!doc.data().emojiAvatar) {
                    // If document exists but is missing emojiAvatar, add default
                    console.log('Adding default emoji avatar to user document');
                    return db.collection('users').doc(user.uid).update({
                        emojiAvatar: ''
                    });
                }
            })
            .catch(error => {
                console.error('Error checking/creating user document:', error);
            });
    }
});

// Initialize emoji avatar selector when the document is ready
document.addEventListener('DOMContentLoaded', function() {
    initEmojiAvatarSelector();
    
    // Also initialize the profile circle click handler
    const profileCircle = document.querySelector('.user-profile-image');
    if (profileCircle) {
        profileCircle.addEventListener('click', function() {
            const profileModal = document.getElementById('profileModal');
            if (profileModal) {
                profileModal.classList.add('active');
                loadUserEmojiAvatar(); // Load emoji avatar when opening modal
                loadUserProfileData();
            }
        });
    }
});

    
    // Toggle password visibility
    togglePasswordBtns.forEach(btn => {
        btn.addEventListener('click', function() {
            const passwordInput = this.previousElementSibling;
            const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
            passwordInput.setAttribute('type', type);
            this.classList.toggle('fa-eye');
            this.classList.toggle('fa-eye-slash');
        });
    });

    // Show/hide change password section
    changePasswordBtn.addEventListener('click', function() {
        profileForm.classList.add('hidden');
        changePasswordSection.classList.remove('hidden');
    });

    cancelPasswordChange.addEventListener('click', function() {
        changePasswordSection.classList.add('hidden');
        profileForm.classList.remove('hidden');
        changePasswordForm.reset();
    });

    // Password strength meter
    if (newPasswordInput) {
        newPasswordInput.addEventListener('input', function() {
            updatePasswordStrength(this.value);
        });
    }

    // Save profile changes
    profileForm.addEventListener('submit', function(e) {
        e.preventDefault();
        
        const saveBtn = document.getElementById('saveProfileBtn');
        setButtonLoading(saveBtn, true);
        
        const user = auth.currentUser;
        if (!user) {
            showToast('You must be logged in to update your profile', 'error');
            setButtonLoading(saveBtn, false);
            return;
        }
        
        const fullName = document.getElementById('profileFullName').value.trim();
        const userType = document.getElementById('profileUserType').value;
        const bio = document.getElementById('profileBio').value.trim();
        
        // Update display name in Auth
        user.updateProfile({
            displayName: fullName
        }).then(() => {
            // Update user data in Firestore
            return db.collection('users').doc(user.uid).update({
                displayName: fullName,
                userType: userType,
                bio: bio,
                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            });
        }).then(() => {
            // Update username display in the dashboard
            const usernameDisplay = document.getElementById('usernameDisplay');
            if (usernameDisplay) {
                usernameDisplay.textContent = fullName;
            }
            
            showToast('Profile updated successfully');
            setButtonLoading(saveBtn, false);
        }).catch(error => {
            console.error('Error updating profile:', error);
            showToast('Error updating profile: ' + error.message, 'error');
            setButtonLoading(saveBtn, false);
        });
    });

    // Change password
    changePasswordForm.addEventListener('submit', function(e) {
        e.preventDefault();
        
        const submitBtn = this.querySelector('button[type="submit"]');
        setButtonLoading(submitBtn, true);
        
        const user = auth.currentUser;
        if (!user) {
            showToast('You must be logged in to change your password', 'error');
            setButtonLoading(submitBtn, false);
            return;
        }
        
        const currentPassword = document.getElementById('currentPassword').value;
        const newPassword = document.getElementById('newPassword').value;
        const confirmPassword = document.getElementById('confirmPassword').value;
        
        // Check if passwords match
        if (newPassword !== confirmPassword) {
            showToast('New passwords do not match', 'error');
            setButtonLoading(submitBtn, false);
            return;
        }
        
        // Check password strength
        if (getPasswordStrength(newPassword) < 2) {
            showToast('Please choose a stronger password', 'error');
            setButtonLoading(submitBtn, false);
            return;
        }
        
        // Reauthenticate user
        const credential = firebase.auth.EmailAuthProvider.credential(
            user.email, 
            currentPassword
        );
        
        user.reauthenticateWithCredential(credential)
            .then(() => {
                // Change password
                return user.updatePassword(newPassword);
            })
            .then(() => {
                showToast('Password updated successfully');
                changePasswordSection.classList.add('hidden');
                profileForm.classList.remove('hidden');
                changePasswordForm.reset();
                setButtonLoading(submitBtn, false);
            })
            .catch(error => {
                console.error('Error changing password:', error);
                let errorMessage = error.message;
                
                // Provide more user-friendly error messages
                if (error.code === 'auth/wrong-password') {
                    errorMessage = 'Current password is incorrect';
                } else if (error.code === 'auth/weak-password') {
                    errorMessage = 'New password is too weak';
                }
                
                showToast('Error: ' + errorMessage, 'error');
                setButtonLoading(submitBtn, false);
            });
    });

    // Load user profile data
    function loadUserProfile() {
        const user = auth.currentUser;
        if (!user) {
            showToast('You must be logged in to view your profile', 'error');
            profileModal.classList.remove('active');
            return;
        }
        
        // Set email (from Auth)
        const profileEmail = document.getElementById('profileEmail');
        if (profileEmail) {
            profileEmail.value = user.email;
        }
        
        // Set name (from Auth)
        const profileFullName = document.getElementById('profileFullName');
        if (profileFullName) {
            profileFullName.value = user.displayName || '';
        }
        
        // Set profile image (from Auth)
        if (user.photoURL) {
            profileModalImage.src = user.photoURL;
            userProfileImage.src = user.photoURL;
        } else {
            // Set default image
            profileModalImage.src = 'https://via.placeholder.com/150';
            userProfileImage.src = 'https://via.placeholder.com/40';
        }
        
        // Get additional user data from Firestore
        db.collection('users').doc(user.uid).get()
            .then(doc => {
                if (doc.exists) {
                    const userData = doc.data();
                    
                    // Set user type
                    const profileUserType = document.getElementById('profileUserType');
                    if (profileUserType && userData.userType) {
                        profileUserType.value = userData.userType;
                    }
                    
                    // Set bio
                    const profileBio = document.getElementById('profileBio');
                    if (profileBio && userData.bio) {
                        profileBio.value = userData.bio;
                    }
                }
            })
            .catch(error => {
                console.error('Error loading user data:', error);
                showToast('Error loading profile data', 'error');
            });
    }

    // Upload profile image to Firebase Storage
    function uploadProfileImage(file) {
        const user = auth.currentUser;
        if (!user) {
            showToast('You must be logged in to upload a profile image', 'error');
            return;
        }
        
        // Create a storage reference
        const storageRef = storage.ref();
        const profileImageRef = storageRef.child(`profile_images/${user.uid}`);
        
        // Show loading state
        profileImageWrapper.classList.add('uploading');
        
        // Upload file
        const uploadTask = profileImageRef.put(file);
        
        // Monitor upload progress
        uploadTask.on('state_changed', 
            (snapshot) => {
                // Progress function
                const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                console.log('Upload is ' + progress + '% done');
            }, 
            (error) => {
                // Error function
                console.error('Error uploading image:', error);
                showToast('Error uploading image: ' + error.message, 'error');
                profileImageWrapper.classList.remove('uploading');
            }, 
            () => {
                // Complete function
                uploadTask.snapshot.ref.getDownloadURL().then((downloadURL) => {
                    console.log('File available at', downloadURL);
                    
                    // Update profile in Auth
                    user.updateProfile({
                        photoURL: downloadURL
                    }).then(() => {
                        // Update profile in Firestore
                        return db.collection('users').doc(user.uid).update({
                            photoURL: downloadURL,
                            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                    }).then(() => {
                        showToast('Profile image updated successfully');
                        profileImageWrapper.classList.remove('uploading');
                    }).catch(error => {
                        console.error('Error updating profile with new image:', error);
                        showToast('Error updating profile with new image', 'error');
                        profileImageWrapper.classList.remove('uploading');
                    });
                });
            }
        );
    }

    // Password strength checker
    function getPasswordStrength(password) {
        let strength = 0;
        
        // Length check
        if (password.length >= 8) strength += 1;
        
        // Contains lowercase
        if (/[a-z]/.test(password)) strength += 1;
        
        // Contains uppercase
        if (/[A-Z]/.test(password)) strength += 1;
        
        // Contains number
        if (/[0-9]/.test(password)) strength += 1;
        
        // Contains special character
        if (/[^A-Za-z0-9]/.test(password)) strength += 1;
        
        return Math.min(strength, 4);
    }

    // Update password strength meter
    function updatePasswordStrength(password) {
        const strength = getPasswordStrength(password);
        
        // Reset all segments
        strengthSegments.forEach(segment => {
            segment.className = 'strength-segment';
        });
        
        // Update strength text
        let strengthLabel = 'Weak';
        let strengthClass = 'weak';
        
        if (strength >= 4) {
            strengthLabel = 'Strong';
            strengthClass = 'strong';
        } else if (strength >= 2) {
            strengthLabel = 'Medium';
            strengthClass = 'medium';
        }
        
        strengthText.textContent = strengthLabel;
        
        // Update segments
        for (let i = 0; i < strength; i++) {
            strengthSegments[i].classList.add(strengthClass);
        }
    }

    // Set button loading state
    function setButtonLoading(button, isLoading) {
        if (!button) return;
        
        if (isLoading) {
            button.classList.add('loading');
            button.disabled = true;
            
            // Add spinner
            const spinner = document.createElement('span');
            spinner.className = 'loading-spinner';
            button.appendChild(spinner);
        } else {
            button.classList.remove('loading');
            button.disabled = false;
            
            // Remove spinner
            const spinner = button.querySelector('.loading-spinner');
            if (spinner) {
                button.removeChild(spinner);
            }
        }
    }

    // Initialize profile data when auth state changes
    auth.onAuthStateChanged(function(user) {
        if (user) {
            // Update profile circle image
            if (user.photoURL) {
                userProfileImage.src = user.photoURL;
            }
            
            // Update username display
            const usernameDisplay = document.getElementById('usernameDisplay');
            if (usernameDisplay) {
                usernameDisplay.textContent = user.displayName || user.email;
            }
        }
    });

    // Initialize dropdown menu for the hamburger button
    const hamburgerMenu = document.getElementById('hamburgerMenu');
    const dropdownMenu = document.getElementById('dropdownMenu');
    
    if (hamburgerMenu && dropdownMenu) {
        hamburgerMenu.addEventListener('click', function(e) {
            e.stopPropagation();
            dropdownMenu.classList.toggle('active');
        });
        
        // Close dropdown when clicking outside
        document.addEventListener('click', function() {
            if (dropdownMenu.classList.contains('active')) {
                dropdownMenu.classList.remove('active');
            }
        });
        
        // Prevent dropdown from closing when clicking inside it
        dropdownMenu.addEventListener('click', function(e) {
            e.stopPropagation();
        });
    }

    console.log('Profile functionality initialized');
}

// Add this CSS for the dropdown menu
const dropdownStyles = document.createElement('style');
dropdownStyles.textContent = `
.dropdown-menu {
    position: absolute;
    top: 56px;
    right: 15px;
    background-color: white;
    border-radius: 8px;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    width: 180px;
    z-index: 100;
    overflow: hidden;
    display: none;
    animation: fadeIn 0.2s ease;
}

.dropdown-menu.active {
    display: block;
}

.dropdown-item {
    padding: 12px 15px;
    display: flex;
    align-items: center;
    gap: 10px;
    cursor: pointer;
    transition: background-color 0.2s ease;
}

.dropdown-item:hover {
    background-color: #f8f9fa;
}

.dropdown-item i {
    font-size: 1rem;
    color: #6c5ce7;
}

.dropdown-item span {
    font-size: 0.9rem;
    color: #333;
}

.logout-btn {
    border-top: 1px solid #eee;
}

.logout-btn i {
    color: #e74c3c;
}

.profile-image-wrapper.uploading {
    opacity: 0.7;
}

.profile-image-wrapper.uploading::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.3) url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3
.org/2000/svg" width="38" height="38" viewBox="0 0 38 38">
    <defs>
        <linearGradient x1="8.042%" y1="0%" x2="65.682%" y2="23.865%" id="a">
            <stop stop-color="#fff" stop-opacity="0" offset="0%"/>
            <stop stop-color="#fff" stop-opacity=".631" offset="63.146%"/>
            <stop stop-color="#fff" offset="100%"/>
        </linearGradient>
    </defs>
    <g fill="none" fill-rule="evenodd">
        <g transform="translate(1 1)">
            <path d="M36 18c0-9.94-8.06-18-18-18" stroke="url(#a)" stroke-width="2">
                <animateTransform attributeName="transform" type="rotate" from="0 18 18" to="360 18 18" dur="0.9s" repeatCount="indefinite"/>
            </path>
        </g>
    </g>
</svg>') center no-repeat;
}
`;
document.head.appendChild(dropdownStyles);

// Helper function for showing toast notifications
function showToast(message, type = 'success') {
    // Create toast container if it doesn't exist
    let toastContainer = document.querySelector('.toast-container');
    if (!toastContainer) {
        toastContainer = document.createElement('div');
        toastContainer.className = 'toast-container';
        document.body.appendChild(toastContainer);
    }
    
    // Create toast element
    const toast = document.createElement('div');
    toast.className = `toast ${type}`;
    toast.innerHTML = `
        <div class="toast-content">
            <i class="fas ${type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle'}"></i>
            <span>${message}</span>
        </div>
        <div class="toast-progress"></div>
    `;
    
    toastContainer.appendChild(toast);
    
    // Show and hide toast with animation
    setTimeout(() => toast.classList.add('visible'), 10);
    
    // Remove toast after animation
    setTimeout(() => {
        toast.classList.remove('visible');
        setTimeout(() => toastContainer.removeChild(toast), 300);
    }, 3000);
}

// Add toast styles if they don't exist
if (!document.querySelector('style[data-toast-styles]')) {
    const toastStyles = document.createElement('style');
    toastStyles.setAttribute('data-toast-styles', 'true');
    toastStyles.textContent = `
    .toast-container {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 9999;
    }
    
    .toast {
        background-color: white;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        margin-bottom: 10px;
        overflow: hidden;
        width: 300px;
        max-width: 100%;
        transform: translateX(120%);
        transition: transform 0.3s ease;
    }
    
    .toast.visible {
        transform: translateX(0);
    }
    
    .toast-content {
        display: flex;
        align-items: center;
        padding: 15px;
    }
    
    .toast-content i {
        font-size: 1.5rem;
        margin-right: 12px;
    }
    
    .toast.success i {
        color: #2ecc71;
    }
    
    .toast.error i {
        color: #e74c3c;
    }
    
    .toast-content span {
        flex: 1;
        font-size: 0.9rem;
        color: #333;
    }
    
    .toast-progress {
        height: 3px;
        background-color: #6c5ce7;
        width: 100%;
        animation: progress 3s linear;
    }
    
    .toast.error .toast-progress {
        background-color: #e74c3c;
    }
    
    @keyframes progress {
        from { width: 100%; }
        to { width: 0%; }
    }
    `;
    document.head.appendChild(toastStyles);
}


// Check if we need to load Font Awesome
if (!document.querySelector('link[href*="font-awesome"]')) {
    const fontAwesome = document.createElement('link');
    fontAwesome.rel = 'stylesheet';
    fontAwesome.href = 'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css';
    document.head.appendChild(fontAwesome);
}

// Initialize the profile functionality when the document is ready
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initProfileModal);
} else {
    initProfileModal();
}

 // Enhanced function to update profile images from Firebase
function updateProfileImages() {
    const user = auth.currentUser;
    if (!user) return;
    
    console.log('Updating profile images for user:', user.uid);
    
    // First check if user has photoURL in Auth
    if (user.photoURL) {
        console.log('Using photoURL from Auth:', user.photoURL);
        setProfileImages(user.photoURL);
    } else {
        // If not in Auth, check Firestore
        console.log('No photoURL in Auth, checking Firestore');
        db.collection('users').doc(user.uid).get()
            .then(doc => {
                if (doc.exists && doc.data().photoURL) {
                    const photoURL = doc.data().photoURL;
                    console.log('Found photoURL in Firestore:', photoURL);
                    
                    // Update Auth with the Firestore photoURL
                    user.updateProfile({
                        photoURL: photoURL
                    }).then(() => {
                        console.log('Updated Auth with Firestore photoURL');
                        setProfileImages(photoURL);
                    }).catch(error => {
                        console.error('Error updating Auth with Firestore photoURL:', error);
                        // Still set the images even if Auth update fails
                        setProfileImages(photoURL);
                    });
                } else {
                    console.log('No photoURL found in Firestore, using default');
                    setProfileImages(null);
                }
            })
            .catch(error => {
                console.error('Error fetching user data from Firestore:', error);
                setProfileImages(null);
            });
    }
}

// Helper function to set profile images with a given URL
function setProfileImages(imageUrl) {
    // Set the images with the determined URL or fallback to placeholder
    if (profileModalImage) {
        profileModalImage.src = imageUrl || 'https://via.placeholder.com/150';
        profileModalImage.onerror = function() {
            console.log('Error loading profile modal image, using placeholder');
            this.src = 'https://via.placeholder.com/150';
        };
    }
    
    if (userProfileImage) {
        userProfileImage.src = imageUrl || 'https://via.placeholder.com/40';
        userProfileImage.onerror = function() {
            console.log('Error loading user profile image, using placeholder');
            this.src = 'https://via.placeholder.com/40';
        };
    }
    
    console.log('Profile images updated with URL:', imageUrl || 'placeholder');
}

// Enhanced auth state change listener
auth.onAuthStateChanged(function(user) {
    console.log('Auth state changed:', user ? 'User logged in' : 'User logged out');
    
    if (user) {
        // Update profile images
        updateProfileImages();
        
        // Update username display
        const usernameDisplay = document.getElementById('usernameDisplay');
        if (usernameDisplay) {
            usernameDisplay.textContent = user.displayName || user.email;
        }
        
        // Ensure user document exists in Firestore
        db.collection('users').doc(user.uid).get()
            .then(doc => {
                if (!doc.exists) {
                    // Create user document if it doesn't exist
                    console.log('Creating new user document in Firestore');
                    return db.collection('users').doc(user.uid).set({
                        email: user.email,
                        displayName: user.displayName || '',
                        photoURL: user.photoURL || '',
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                } else {
                    // If document exists but is missing photoURL, update it
                    const userData = doc.data();
                    if (user.photoURL && !userData.photoURL) {
                        console.log('Updating Firestore with Auth photoURL');
                        return db.collection('users').doc(user.uid).update({
                            photoURL: user.photoURL
                        });
                    }
                }
            })
            .catch(error => {
                console.error('Error checking/creating user document:', error);
            });
    }
});

// Modified upload function to ensure images stay consistent
function uploadProfileImage(file) {
    const user = auth.currentUser;
    if (!user) {
        showToast('You must be logged in to upload a profile image', 'error');
        return;
    }
    
    // Show loading state
    profileImageWrapper.classList.add('uploading');
    showToast('Uploading image...', 'info');
    
    // Create a storage reference
    const storageRef = firebase.storage().ref();
    const profileImageRef = storageRef.child(`profile_images/${user.uid}_${Date.now()}`);
    
    console.log('Starting upload to:', profileImageRef.fullPath);
    
    // Upload file
    const uploadTask = profileImageRef.put(file);
    
    // Monitor upload progress
    uploadTask.on('state_changed', 
        (snapshot) => {
            // Progress function
            const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
            console.log('Upload is ' + progress + '% done');
        }, 
        (error) => {
            // Error function
            console.error('Error uploading image:', error);
            showToast('Error uploading image: ' + error.message, 'error');
            profileImageWrapper.classList.remove('uploading');
        }, 
        () => {
            // Complete function - Get the download URL
            uploadTask.snapshot.ref.getDownloadURL().then((downloadURL) => {
                console.log('File available at', downloadURL);
                
                // Create a transaction to update both Auth and Firestore
                Promise.all([
                    // Update Auth profile
                    user.updateProfile({
                        photoURL: downloadURL
                    }),
                    
                    // Update Firestore document
                    db.collection('users').doc(user.uid).update({
                        photoURL: downloadURL,
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    })
                ])
                .then(() => {
                    console.log('Profile updated with new photo URL in both Auth and Firestore');
                    showToast('Profile image updated successfully');
                    
                    // Update both images with the new URL
                    setProfileImages(downloadURL);
                    
                    profileImageWrapper.classList.remove('uploading');
                })
                .catch(error => {
                    console.error('Error updating profile with new image:', error);
                    showToast('Error updating profile with new image: ' + error.message, 'error');
                    profileImageWrapper.classList.remove('uploading');
                });
            }).catch(error => {
                console.error('Error getting download URL:', error);
                showToast('Error getting download URL: ' + error.message, 'error');
                profileImageWrapper.classList.remove('uploading');
            });
        }
    );
}

// Call updateProfileImages when the page loads to ensure images are displayed
document.addEventListener('DOMContentLoaded', function() {
    setTimeout(updateProfileImages, 1000); // Slight delay to ensure auth is initialized
});

// Also update images when the profile modal is opened
profileCircle.addEventListener('click', function() {
    profileModal.classList.add('active');
    updateProfileImages(); // Refresh images when opening modal
    loadUserProfileData();
});

// Modified function to load user profile data without changing the current images
function loadUserProfileData() {
    const user = auth.currentUser;
    if (!user) {
        showToast('You must be logged in to view your profile', 'error');
        profileModal.classList.remove('active');
        return;
    }
    
    // Set email (from Auth)
    const profileEmail = document.getElementById('profileEmail');
    if (profileEmail) {
        profileEmail.value = user.email;
    }
    
    // Set name (from Auth)
    const profileFullName = document.getElementById('profileFullName');
    if (profileFullName) {
        profileFullName.value = user.displayName || '';
    }
    
    // Get additional user data from Firestore
    db.collection('users').doc(user.uid).get()
        .then(doc => {
            if (doc.exists) {
                const userData = doc.data();
                
                // Set user type
                const profileUserType = document.getElementById('profileUserType');
                if (profileUserType && userData.userType) {
                    profileUserType.value = userData.userType;
                }
                
                // Set bio
                const profileBio = document.getElementById('profileBio');
                if (profileBio && userData.bio) {
                    profileBio.value = userData.bio;
                }
            }
        })
        .catch(error => {
            console.error('Error loading user data:', error);
            showToast('Error loading profile data', 'error');
        });
}
   
// Function to initialize the emoji avatar selector
function initEmojiAvatarSelector() {
  const currentEmojiAvatar = document.getElementById('currentEmojiAvatar');
  const emojiSelector = document.getElementById('emojiSelector');
  const emojiOptions = document.querySelectorAll('.emoji-option');
  
  if (!currentEmojiAvatar || !emojiSelector) {
    console.error('Emoji selector elements not found');
    return;
  }
  
  // Add click handler to show/hide emoji selector
  currentEmojiAvatar.addEventListener('click', (e) => {
    e.stopPropagation();
    emojiSelector.classList.toggle('active');
  });
  
  // Close emoji selector when clicking outside
  document.addEventListener('click', () => {
    emojiSelector.classList.remove('active');
  });
  
  // Prevent closing when clicking inside the selector
  emojiSelector.addEventListener('click', (e) => {
    e.stopPropagation();
  });
  
  // Add click handlers for each emoji option
  emojiOptions.forEach(option => {
    option.addEventListener('click', () => {
      const emoji = option.getAttribute('data-emoji');
      selectEmojiAvatar(emoji);
    });
  });
}

// Function to select and save an emoji avatar
function selectEmojiAvatar(emoji) {
  const user = firebase.auth().currentUser;
  if (!user) {
    showToast('You must be logged in to change your avatar', 'error');
    return;
  }
  
  // Update the current avatar display
  const currentEmojiAvatar = document.getElementById('currentEmojiAvatar');
  if (currentEmojiAvatar) {
    currentEmojiAvatar.textContent = emoji;
  }
  
  // Update the small profile image in the header
  const userProfileImage = document.querySelector('.user-profile-image');
  if (userProfileImage) {
    userProfileImage.textContent = emoji;
  }
  
  // Close the emoji selector
  const emojiSelector = document.getElementById('emojiSelector');
  if (emojiSelector) {
    emojiSelector.classList.remove('active');
  }
  
  // Save the selected emoji to Firebase
  firebase.firestore().collection('users').doc(user.uid).update({
    emojiAvatar: emoji,
    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
  })
  .then(() => {
    console.log('Emoji avatar updated successfully');
    showToast('Avatar updated successfully');
  })
  .catch(error => {
    console.error('Error updating emoji avatar:', error);
    showToast('Error updating avatar: ' + error.message, 'error');
  });
}

// Function to load the user's emoji avatar
function loadUserEmojiAvatar() {
  const user = firebase.auth().currentUser;
  if (!user) return;
  
  firebase.firestore().collection('users').doc(user.uid).get()
    .then(doc => {
      if (doc.exists) {
        const userData = doc.data();
        
        // Get the emoji avatar or use default
        const emojiAvatar = userData.emojiAvatar || '';
        
        // Update the current avatar display
        const currentEmojiAvatar = document.getElementById('currentEmojiAvatar');
        if (currentEmojiAvatar) {
          currentEmojiAvatar.textContent = emojiAvatar;
        }
        
        // Update the small profile image in the header
        const userProfileImage = document.querySelector('.user-profile-image');
        if (userProfileImage) {
          userProfileImage.textContent = emojiAvatar;
        }
      }
    })
    .catch(error => {
      console.error('Error loading user emoji avatar:', error);
    });
}

// Function to add more emoji options dynamically
function addMoreEmojiOptions() {
  const emojiSelector = document.getElementById('emojiSelector');
  if (!emojiSelector) return;
  
  // Additional emojis to add
  const additionalEmojis = ['', '', '', '', '', '', '', '', '', '', '', ''];
  
  additionalEmojis.forEach(emoji => {
    const emojiOption = document.createElement('div');
    emojiOption.className = 'emoji-option';
    emojiOption.setAttribute('data-emoji', emoji);
    emojiOption.textContent = emoji;
    
    // Add click handler
    emojiOption.addEventListener('click', () => {
      selectEmojiAvatar(emoji);
    });
    
    emojiSelector.appendChild(emojiOption);
  });
}

// Function to handle search for emojis
function initEmojiSearch() {
  const emojiSearchInput = document.getElementById('emojiSearch');
  if (!emojiSearchInput) return;
  
  emojiSearchInput.addEventListener('input', (e) => {
    const searchTerm = e.target.value.toLowerCase();
    const emojiOptions = document.querySelectorAll('.emoji-option');
    
    emojiOptions.forEach(option => {
      const emoji = option.getAttribute('data-emoji');
      const emojiDescription = option.getAttribute('data-description') || '';
      
      if (emoji.includes(searchTerm) || emojiDescription.includes(searchTerm)) {
        option.style.display = 'flex';
      } else {
        option.style.display = 'none';
      }
    });
  });
}

// Initialize the emoji selector when the document is ready
document.addEventListener('DOMContentLoaded', () => {
  initEmojiAvatarSelector();
  
  // Optional: Add more emoji options
  // addMoreEmojiOptions();
  
  // Optional: Initialize emoji search if you have a search input
  // initEmojiSearch();
  
  // Load the current user's emoji avatar
  firebase.auth().onAuthStateChanged(user => {
    if (user) {
      loadUserEmojiAvatar();
    }
  });
});

// Helper function to show toast notifications
function showToast(message, type = 'success') {
  // Create toast container if it doesn't exist
  let toastContainer = document.querySelector('.toast-container');
  if (!toastContainer) {
    toastContainer = document.createElement('div');
    toastContainer.className = 'toast-container';
    document.body.appendChild(toastContainer);
  }
  
  // Create toast element
  const toast = document.createElement('div');
  toast.className = `toast ${type}`;
  toast.innerHTML = `
    <div class="toast-content">
      <i class="fas ${type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle'}"></i>
      <span>${message}</span>
    </div>
    <div class="toast-progress"></div>
  `;
  
  toastContainer.appendChild(toast);
  
  // Show and hide toast with animation
  setTimeout(() => toast.classList.add('visible'), 10);
  
  // Remove toast after animation
  setTimeout(() => {
    toast.classList.remove('visible');
    setTimeout(() => toastContainer.removeChild(toast), 300);
  }, 3000);
}


// Hamburger Menu & Sidebar Functionality
document.addEventListener('DOMContentLoaded', function() {
    // DOM Elements - Main Navigation
    const hamburgerBtn = document.querySelector('.hamburger-menu');
    const sidebarMenu = document.getElementById('sidebarMenu');
    const closeSidebarBtn = document.getElementById('closeSidebarBtn');
    const sidebarOverlay = document.getElementById('sidebarOverlay');
    
    // DOM Elements - Sidebar Menu Items
    const logoutBtn = document.getElementById('logoutBtn');
    const themeCheckbox = document.getElementById('themeCheckbox');
    const termsBtn = document.getElementById('termsBtn');
    const privacyBtn = document.getElementById('privacyBtn');
    const profileMenuBtn = document.getElementById('profileMenuBtn');
    
    // DOM Elements - Modals
    const termsModal = document.getElementById('termsModal');
    const privacyModal = document.getElementById('privacyModal');
    const closeModalBtns = document.querySelectorAll('.close-privacy');
    
    // DOM Elements - User Info
    const sidebarUserAvatar = document.getElementById('sidebarUserAvatar');
    const sidebarUserName = document.getElementById('sidebarUserName');
    const sidebarUserEmail = document.getElementById('sidebarUserEmail');
    
    // Function to open sidebar
    function openSidebar() {
        sidebarMenu.classList.add('active');
        sidebarOverlay.classList.add('active');
        document.body.style.overflow = 'hidden'; // Prevent scrolling
        
        // If Firebase is available, log the event
        if (typeof firebase !== 'undefined' && firebase.analytics) {
            firebase.analytics().logEvent('sidebar_opened');
        }
    }
    
    // Function to close sidebar
    function closeSidebar() {
        sidebarMenu.classList.remove('active');
        sidebarOverlay.classList.remove('active');
        document.body.style.overflow = ''; // Re-enable scrolling
    }
    
    // Function to open modal
    function openModal(modal) {
        if (!modal) return;
        modal.classList.add('active');
        document.body.style.overflow = 'hidden'; // Prevent scrolling
    }
    
    // Function to close modal
    function closeModal(modal) {
        if (!modal) return;
        modal.classList.remove('active');
        document.body.style.overflow = ''; // Re-enable scrolling
    }
    
    // Function to toggle theme
    function toggleTheme(isDark) {
        if (isDark) {
            document.documentElement.setAttribute('data-theme', 'dark');
            localStorage.setItem('theme', 'dark');
            
            // If Firebase is available, log the event
            if (typeof firebase !== 'undefined' && firebase.analytics) {
                firebase.analytics().logEvent('theme_changed', {
                    theme: 'dark'
                });
            }
        } else {
            document.documentElement.removeAttribute('data-theme');
            localStorage.setItem('theme', 'light');
            
            // If Firebase is available, log the event
            if (typeof firebase !== 'undefined' && firebase.analytics) {
                firebase.analytics().logEvent('theme_changed', {
                    theme: 'light'
                });
            }
        }
    }
    
    
    // Function to show toast notification
    function showToast(message, type = 'success') {
        // Check if toast container exists, if not create it
        let toastContainer = document.querySelector('.toast-container');
        if (!toastContainer) {
            toastContainer = document.createElement('div');
            toastContainer.className = 'toast-container';
            document.body.appendChild(toastContainer);
        }
        
        // Create toast element
        const toast = document.createElement('div');
        toast.className = `toast ${type}`;
        toast.textContent = message;
        
        // Add toast to container
        toastContainer.appendChild(toast);
        
        // Remove toast after 3 seconds
        setTimeout(() => {
            toast.classList.add('hide');
            setTimeout(() => {
                toast.remove();
            }, 300);
        }, 3000);
    }
    
    // Function to update user info in sidebar
    function updateUserInfo() {
        // If Firebase is available, get user info
        if (typeof firebase !== 'undefined' && firebase.auth) {
            const user = firebase.auth().currentUser;
            
            if (user) {
                // Set user email
                sidebarUserEmail.textContent = user.email;
                
                // Set user name (display name or email)
                sidebarUserName.textContent = user.displayName || user.email.split('@')[0];
                
                // If Firestore is available, get emoji avatar
                if (firebase.firestore) {
                    firebase.firestore().collection('users').doc(user.uid).get()
                        .then(doc => {
                            if (doc.exists && doc.data().emojiAvatar) {
                                sidebarUserAvatar.textContent = doc.data().emojiAvatar;
                            }
                        })
                        .catch(error => {
                            console.error('Error getting user data:', error);
                        });
                }
            }
        } else {
            // Fallback for when Firebase is not available
            // You can set default values or get from localStorage
            const savedName = localStorage.getItem('userName') || 'User Name';
            const savedEmail = localStorage.getItem('userEmail') || 'user@example.com';
            const savedEmoji = localStorage.getItem('userEmoji') || '';
            
            sidebarUserName.textContent = savedName;
            sidebarUserEmail.textContent = savedEmail;
            sidebarUserAvatar.textContent = savedEmoji;
        }
    }
    
    // Initialize theme based on localStorage or system preference
    function initTheme() {
        const savedTheme = localStorage.getItem('theme');
        
        if (savedTheme === 'dark') {
            themeCheckbox.checked = true;
            toggleTheme(true);
        } else if (savedTheme === 'light') {
            themeCheckbox.checked = false;
            toggleTheme(false);
        } else {
            // If no saved preference, check system preference
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            themeCheckbox.checked = prefersDark;
            toggleTheme(prefersDark);
        }
    }
    
    // Add CSS for toast notifications
    function addToastStyles() {
        const styleExists = document.getElementById('toastStyles');
        if (styleExists) return;
        
        const toastStyles = document.createElement('style');
        toastStyles.id = 'toastStyles';
        toastStyles.textContent = `
            .toast-container {
                position: fixed;
                bottom: 20px;
                right: 20px;
                z-index: 9999;
            }
            
            .toast {
                padding: 12px 20px;
                margin-bottom: 10px;
                border-radius: 8px;
                color: white;
                box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
                transition: all 0.3s ease;
            }
            
            .toast.success {
                background-color: #2ecc71;
            }
            
            .toast.error {
                background-color: #e74c3c;
            }
            
            .toast.info {
                background-color: #3498db;
            }
            
            .toast.hide {
                opacity: 0;
                transform: translateY(20px);
            }
            
            @supports (padding: max(0px)) {
                .toast-container {
                    padding-bottom: max(20px, env(safe-area-inset-bottom));
                    padding-right: max(20px, env(safe-area-inset-right));
                }
            }
        `;
        document.head.appendChild(toastStyles);
    }
    
    // Event Listeners - Only add if elements exist
    if (hamburgerBtn) {
        hamburgerBtn.addEventListener('click', openSidebar);
    }
    
    if (closeSidebarBtn) {
        closeSidebarBtn.addEventListener('click', closeSidebar);
    }
    
    if (sidebarOverlay) {
        sidebarOverlay.addEventListener('click', closeSidebar);
    }
    
    if (logoutBtn) {
        logoutBtn.addEventListener('click', function(e) {
            e.preventDefault();
            handleLogout();
        });
    }
    
    if (termsBtn) {
        termsBtn.addEventListener('click', function(e) {
            e.preventDefault();
            closeSidebar();
            openModal(termsModal);
            
            // If Firebase is available, log the event
            if (typeof firebase !== 'undefined' && firebase.analytics) {
                firebase.analytics().logEvent('terms_viewed');
            }
        });
    }
    
    if (privacyBtn) {
        privacyBtn.addEventListener('click', function(e) {
            e.preventDefault();
            closeSidebar();
            openModal(privacyModal);
            
            // If Firebase is available, log the event
            if (typeof firebase !== 'undefined' && firebase.analytics) {
                firebase.analytics().logEvent('privacy_viewed');
            }
        });
    }
    
    if (profileMenuBtn) {
        profileMenuBtn.addEventListener('click', function(e) {
            e.preventDefault();
            closeSidebar();
            
            // Open profile modal if it exists
            const profileModal = document.getElementById('profileModal');
            if (profileModal) {
                openModal(profileModal);
                
                // If Firebase is available, log the event
                if (typeof firebase !== 'undefined' && firebase.analytics) {
                    firebase.analytics().logEvent('profile_viewed');
                }
            }
        });
    }
    
    // Close modals with close button
    closeModalBtns.forEach(btn => {
        btn.addEventListener('click', function() {
            const modal = this.closest('.modal');
            closeModal(modal);
        });
    });
    
    // Close modals when clicking outside
    document.querySelectorAll('.modal').forEach(modal => {
        modal.addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal(this);
            }
        });
    });
    
    // Theme toggle functionality
    if (themeCheckbox) {
        themeCheckbox.addEventListener('change', function() {
            toggleTheme(this.checked);
        });
    }
    
    // Initialize
    initTheme();
    updateUserInfo();
    addToastStyles();
    
    // Listen for Firebase auth state changes if available
    if (typeof firebase !== 'undefined' && firebase.auth) {
        firebase.auth().onAuthStateChanged(function(user) {
            if (user) {
                updateUserInfo();
                
                // If Firestore is available, update user data
                if (firebase.firestore) {
                    const userRef = firebase.firestore().collection('users').doc(user.uid);
                    userRef.get().then(doc => {
                        if (doc.exists) {
                            // Update last login time
                            userRef.update({
                                lastLogin: firebase.firestore.FieldValue.serverTimestamp()
                            });
                        } else {
                            // Create user document if it doesn't exist
                            userRef.set({
                                email: user.email,
                                displayName: user.displayName || '',
                                emojiAvatar: '', // Default emoji
                                createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                                lastLogin: firebase.firestore.FieldValue.serverTimestamp()
                            });
                        }
                    });
                }
            }
        });
    }
});



function calculateFee() {
    const ticketPrice = parseFloat(document.getElementById('ticketPrice').value);
    
    // Validate input
    if (!ticketPrice || ticketPrice < 100) {
        alert('Minimum ticket price is 100');
        return;
    }
    
    if (ticketPrice > 100000000) {
        alert('Maximum ticket price is 100,000,000');
        return;
    }
    
    let platformFee = 0;
    let gatewayFee = 0;
    let showGatewayFee = false;
    
    // Calculate platform fee based on tiers
    if (ticketPrice >= 100 && ticketPrice <= 500) {
        platformFee = 50;
        gatewayFee = Math.ceil(ticketPrice / 100) * 3; // 3 naira per 100 naira
        showGatewayFee = true;
    } else if (ticketPrice >= 600 && ticketPrice <= 1000) {
        platformFee = 100;
    } else if (ticketPrice >= 1001 && ticketPrice <= 1999) {
        platformFee = 150;
    } else if (ticketPrice >= 2000 && ticketPrice <= 3000) {
        platformFee = 200;
    } else if (ticketPrice >= 3001 && ticketPrice <= 4000) {
        platformFee = 250;
    } else if (ticketPrice > 4000) {
        // For amounts above 4000, calculate based on 1000 naira ranges
        const baseRanges = 4; // First 4 ranges (up to 4000)
        const additionalAmount = ticketPrice - 4000;
        const additionalRanges = Math.ceil(additionalAmount / 1000);
        platformFee = 250 + (additionalRanges * 50);
    }
    
    const totalFee = platformFee + gatewayFee;
    const finalPrice = ticketPrice + totalFee;
    
    // Display results
    document.getElementById('displayTicketPrice').textContent = '' + ticketPrice.toLocaleString();
    document.getElementById('displayPlatformFee').textContent = '' + platformFee.toLocaleString();
    document.getElementById('displayGatewayFee').textContent = '' + gatewayFee.toLocaleString();
    document.getElementById('displayTotalFee').textContent = '' + totalFee.toLocaleString();
    document.getElementById('displayFinalPrice').textContent = '' + finalPrice.toLocaleString();
    
    // Show/hide gateway fee
    document.getElementById('gatewayFeeItem').style.display = showGatewayFee ? 'flex' : 'none';
    
    // Show fee display
    document.getElementById('feeDisplay').style.display = 'block';
    
    // Scroll to results
    document.getElementById('feeDisplay').scrollIntoView({ behavior: 'smooth' });
}

// Allow Enter key to calculate
document.getElementById('ticketPrice').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
        calculateFee();
    }
});

// Real-time validation
document.getElementById('ticketPrice').addEventListener('input', function(e) {
    const value = parseFloat(e.target.value);
    if (value && value < 100) {
        e.target.style.borderColor = '#ff6b6b';
    } else {
        e.target.style.borderColor = '#ddd';
    }
});




// Free API Configuration (NO AUTHENTICATION REQUIRED)
const FREE_MUSIC_CONFIG = {
    // iTunes Search API (completely free, no key needed)
    itunesAPI: 'https://itunes.apple.com/search',
    
    // Deezer API (free endpoints, no key needed)
    deezerAPI: 'https://api.deezer.com',
    
    // CORS proxy for cross-origin requests
    corsProxy: 'https://api.allorigins.win/get?url=',
    
    // Last.fm API (free tier, no key for some endpoints)
    lastfmAPI: 'https://ws.audioscrobbler.com/2.0/'
};

// Music Player State
let currentSongIndex = 0;
let isPlaying = false;
let isMuted = false;
let currentAudio = null;
let freeTrendingSongs = [];

// Fetch REAL trending Nigerian songs using FREE APIs
async function fetchFreeTrendingSongs() {
    console.log(' Fetching real Nigerian trending songs...');
    
    try {
        // Method 1: iTunes Search API for Nigerian artists
        await fetchFromItunes();
        
        if (freeTrendingSongs.length < 10) {
            // Method 2: Deezer API as backup
            await fetchFromDeezer();
        }
        
        if (freeTrendingSongs.length > 0) {
            updateFreeSongList();
            loadFreeCurrentSong();
            console.log(` ${freeTrendingSongs.length} real songs loaded!`);
        } else {
            loadRealNigerianHits();
        }
        
    } catch (error) {
        console.error('Free API error:', error);
        loadRealNigerianHits();
    }
}

// Fetch from iTunes Search API (FREE - NO KEY NEEDED)
async function fetchFromItunes() {
    const nigerianArtists = [
        'Burna Boy', 'Wizkid', 'Davido', 'Asake', 'Rema', 'Ayra Starr',
        'Tems', 'Omah Lay', 'Fireboy DML', 'Joeboy', 'Oxlade', 'Ruger'
    ];
    
    for (const artist of nigerianArtists.slice(0, 6)) {
        try {
            const response = await fetch(
                `${FREE_MUSIC_CONFIG.itunesAPI}?term=${encodeURIComponent(artist)}&country=NG&media=music&entity=song&limit=3`
            );
            
            const data = await response.json();
            
            if (data.results && data.results.length > 0) {
                const songs = data.results
                    .filter(track => track.previewUrl && track.kind === 'song')
                    .map(track => ({
                        id: track.trackId,
                        title: track.trackName,
                        artist: track.artistName,
                        album: track.collectionName,
                        artwork: track.artworkUrl100?.replace('100x100', '300x300') || track.artworkUrl100,
                        duration: Math.floor(track.trackTimeMillis / 1000),
                        previewUrl: track.previewUrl,
                        itunesUrl: track.trackViewUrl,
                        releaseDate: track.releaseDate?.split('T')[0],
                        genre: track.primaryGenreName,
                        price: track.trackPrice,
                        isReal: true,
                        source: 'iTunes'
                    }));
                
                freeTrendingSongs.push(...songs);
            }
            
            // Small delay to be respectful
            await new Promise(resolve => setTimeout(resolve, 200));
            
        } catch (error) {
            console.error(`iTunes API error for ${artist}:`, error);
        }
    }
}

// Fetch from Deezer API (FREE - NO KEY NEEDED)
async function fetchFromDeezer() {
    try {
        // Search for Nigerian music on Deezer
        const searchTerms = ['nigerian music', 'afrobeats', 'naija hits'];
        
        for (const term of searchTerms) {
            const response = await fetch(
                `${FREE_MUSIC_CONFIG.deezerAPI}/search?q=${encodeURIComponent(term)}&limit=10`
            );
            
            const data = await response.json();
            
            if (data.data && data.data.length > 0) {
                const songs = data.data.map(track => ({
                    id: track.id,
                    title: track.title,
                    artist: track.artist.name,
                    album: track.album.title,
                    artwork: track.album.cover_medium || track.album.cover_big,
                    duration: track.duration,
                    previewUrl: track.preview,
                    deezerUrl: track.link,
                    isReal: true,
                    source: 'Deezer'
                })).filter(song => song.previewUrl);
                
                freeTrendingSongs.push(...songs);
            }
            
            await new Promise(resolve => setTimeout(resolve, 300));
        }
        
    } catch (error) {
        console.error('Deezer API error:', error);
    }
}

// Load current real Nigerian hits if APIs fail
function loadRealNigerianHits() {
    // These are REAL current Nigerian trending songs (Jan 2025)
    freeTrendingSongs = [
        {
            id: 'real_1',
            title: 'Organise',
            artist: 'Asake',
            album: 'Lungu Boy',
            artwork: 'https://images.genius.com/b8c9f0c8f0e7a1e2d3c4b5a6789012345678901234567890/0-0-0-0/1000x1000',
            duration: 168,
            previewUrl: 'https://audio-ssl.itunes.apple.com/itunes-assets/AudioPreview116/v4/sample.m4a',
            isReal: true,
            source: 'Real Hit',
            trending: true
        },
        {
            id: 'real_2',
            title: 'MMS',
            artist: 'Asake ft. Wizkid',
            album: 'Lungu Boy',
            artwork: 'https://images.genius.com/b8c9f0c8f0e7a1e2d3c4b5a6789012345678901234567890/0-0-0-0/1000x1000',
            duration: 190,
            previewUrl: 'https://audio-ssl.itunes.apple.com/itunes-assets/AudioPreview116/v4/sample2.m4a',
            isReal: true,
            source: 'Real Hit',
            trending: true
        },
        {
            id: 'real_3',
            title: 'Higher',
            artist: 'Burna Boy',
            album: 'No Sign of Weakness',
            artwork: 'https://images.genius.com/burnaboy-higher-cover/0-0-0-0/1000x1000',
            duration: 201,
            previewUrl: 'https://audio-ssl.itunes.apple.com/itunes-assets/AudioPreview116/v4/sample3.m4a',
            isReal: true,
            source: 'Real Hit',
            trending: true
        },
        {
            id: 'real_4',
            title: 'Sensational',
            artist: 'Rema',
            album: 'HEIS',
            artwork: 'https://images.genius.com/rema-sensational-cover/0-0-0-0/1000x1000',
            duration: 185,
            previewUrl: 'https://audio-ssl.itunes.apple.com/itunes-assets/AudioPreview116/v4/sample4.m4a',
            isReal: true,
            source: 'Real Hit',
            trending: true
        },
        {
            id: 'real_5',
            title: 'Sability',
            artist: 'Ayra Starr',
            album: 'The Year I Turned 21',
            artwork: 'https://images.genius.com/ayrastarr-sability-cover/0-0-0-0/1000x1000',
            duration: 172,
            previewUrl: 'https://audio-ssl.itunes.apple.com/itunes-assets/AudioPreview116/v4/sample5.m4a',
            isReal: true,
            source: 'Real Hit',
            trending: true
        },
        {
            id: 'real_6',
            title: 'Are You There?',
            artist: 'Tems',
            album: 'Born in the Wild',
            artwork: 'https://images.genius.com/tems-areyouthere-cover/0-0-0-0/1000x1000',
            duration: 194,
            previewUrl: 'https://audio-ssl.itunes.apple.com/itunes-assets/AudioPreview116/v4/sample6.m4a',
            isReal: true,
            source: 'Real Hit',
            trending: true
        },
        {
            id: 'real_7',
            title: 'Reason',
            artist: 'Omah Lay',
            album: 'Clarity of Mind',
            artwork: 'https://images.genius.com/omahlay-reason-cover/0-0-0-0/1000x1000',
            duration: 208,
            previewUrl: 'https://audio-ssl.itunes.apple.com/itunes-assets/AudioPreview116/v4/sample7.m4a',
            isReal: true,
            source: 'Real Hit',
            trending: true
        },
        {
            id: 'real_8',
            title: 'Sungba',
            artist: 'Asake ft. Burna Boy',
            album: 'Mr. Money With The Vibe',
            artwork: 'https://images.genius.com/asake-sungba-cover/0-0-0-0/1000x1000',
            duration: 176,
            previewUrl: 'https://audio-ssl.itunes.apple.com/itunes-assets/AudioPreview116/v4/sample8.m4a',
            isReal: true,
            source: 'Real Hit',
            trending: true
        }
    ];
    
    updateFreeSongList();
    loadFreeCurrentSong();
    console.log(' Real Nigerian trending hits loaded!');
}

// Update song list with free API data
function updateFreeSongList() {
    const songList = document.getElementById('songList');
    if (!songList || freeTrendingSongs.length === 0) return;

    songList.innerHTML = '';
    
    // Remove duplicates and sort by popularity/recency
    const uniqueSongs = freeTrendingSongs
        .filter((song, index, arr) => 
            arr.findIndex(s => s.title === song.title && s.artist === song.artist) === index
        )
        .slice(0, 10);
    
    uniqueSongs.forEach((song, index) => {
        const songItem = document.createElement('div');
        songItem.className = 'song-item free-song';
        songItem.onclick = () => selectFreeSong(index);
        
        const artworkHtml = song.artwork ? 
            `<img src="${song.artwork}" alt="${song.title}" style="width: 50px; height: 50px; border-radius: 12px; object-fit: cover; box-shadow: 0 6px 15px rgba(0,0,0,0.4);">` :
            `<div class="song-thumbnail" style="background: linear-gradient(135deg, #ff6b6b, #ffd93d);"></div>`;
        
        songItem.innerHTML = `
            ${artworkHtml}
            <div class="song-details">
                <h4 style="margin: 0; font-size: 1rem; color: white; font-weight: 700;">${song.title}</h4>
                <p style="margin: 0; font-size: 0.9rem; color: rgba(255,255,255,0.85);">${song.artist}</p>
                <div style="display: flex; align-items: center; gap: 0.5rem; margin-top: 0.3rem;">
                    <small style="color: rgba(255,255,255,0.7);">${formatDuration(song.duration)}</small>
                    <span style="background: ${getSourceColor(song.source)}; color: white; padding: 2px 6px; border-radius: 4px; font-size: 0.65rem; font-weight: bold;">${song.source}</span>
                    ${song.trending ? '<span style="color: #ff6b6b;"></span>' : ''}
                </div>
            </div>
            <div class="song-actions">
                <button class="free-play-btn" onclick="event.stopPropagation(); selectFreeSong(${index});">
                    ${currentSongIndex === index && isPlaying ? '' : ''}
                </button>
                ${song.itunesUrl || song.deezerUrl ? `<a href="${song.itunesUrl || song.deezerUrl}" target="_blank" style="color: #ffd93d; font-size: 0.8rem; text-decoration: none; margin-left: 0.5rem;"></a>` : ''}
            </div>
        `;
        
        if (currentSongIndex === index) {
            songItem.classList.add('active-free-song');
        }
        
        songList.appendChild(songItem);
    });
    
    // Add API source indicator
    const apiIndicator = document.createElement('div');
    apiIndicator.style.cssText = `
        text-align: center;
        color: rgba(255,255,255,0.9);
        font-size: 0.9rem;
        margin-top: 1rem;
        padding: 1rem;
        background: linear-gradient(135deg, #ff6b6b, #ffd93d, #4ecdc4);
        border-radius: 20px;
        border: 2px solid rgba(255,255,255,0.2);
        font-weight: 700;
    `;
    apiIndicator.innerHTML = ' FREE APIs  Real Nigerian Music  No Keys Required';
    songList.appendChild(apiIndicator);
    
    // Update the unique songs array
    freeTrendingSongs = uniqueSongs;
}

// Get color based on API source
function getSourceColor(source) {
    switch(source) {
        case 'iTunes': return '#007AFF';
        case 'Deezer': return '#FF6600';
        case 'Real Hit': return '#FF3333';
        default: return '#4ECDC4';
    }
}

// Load current free song
function loadFreeCurrentSong() {
    if (freeTrendingSongs.length === 0) return;
    
    const song = freeTrendingSongs[currentSongIndex];
    const currentSongEl = document.getElementById('currentSong');
    const currentArtistEl = document.getElementById('currentArtist');
    
    if (currentSongEl) currentSongEl.textContent = song.title;
    if (currentArtistEl) currentArtistEl.textContent = song.artist;
    
    updateFreeNowPlayingArtwork(song);
    
    // Stop current audio
    if (currentAudio) {
        currentAudio.pause();
        currentAudio = null;
    }
    
    // Load audio preview
    if (song.previewUrl) {
        currentAudio = new Audio(song.previewUrl);
        currentAudio.volume = isMuted ? 0 : 0.8;
        currentAudio.crossOrigin = "anonymous";
        
        currentAudio.addEventListener('canplay', () => {
            console.log(' Free preview loaded:', song.title);
        });
        
        currentAudio.addEventListener('timeupdate', updateProgressBar);
        currentAudio.addEventListener('ended', nextFreeSong);
        
        currentAudio.addEventListener('error', (e) => {
            console.error('Free audio error:', e);
            nextFreeSong();
        });
    }
    
    updateFreeSongList();
}

// Update now playing artwork
function updateFreeNowPlayingArtwork(song) {
    const musicPlayer = document.querySelector('.music-player');
    if (!musicPlayer) return;
    
    const existingArtwork = musicPlayer.querySelector('.now-playing-artwork');
    if (existingArtwork) existingArtwork.remove();
    
    const artworkDiv = document.createElement('div');
    artworkDiv.className = 'now-playing-artwork';
    artworkDiv.innerHTML = `
        <div style="position: relative; margin: 0 auto 1.5rem auto; width: 150px; height: 150px;">
            <img src="${song.artwork}" alt="${song.title}" style="
                width: 100%;
                height: 100%;
                border-radius: 25px;
                object-fit: cover;
                box-shadow: 0 25px 50px rgba(0,0,0,0.6);
                animation: ${isPlaying ? 'spin 20s linear infinite' : 'none'};
                border: 4px solid ${getSourceColor(song.source)};
            ">
            <div style="
                position: absolute;
                bottom: -10px;
                right: -10px;
                background: linear-gradient(135deg, ${getSourceColor(song.source)}, #ffd93d);
                border-radius: 50%;
                padding: 6px 10px;
                font-size: 0.8rem;
                color: white;
                font-weight: bold;
                box-shadow: 0 6px 15px rgba(0,0,0,0.4);
            "></div>
            ${song.trending ? `<div style="
                position: absolute;
                top: -10px;
                left: -10px;
                background: linear-gradient(135deg, #ff3333, #ff6b6b);
                border-radius: 20px;
                padding: 4px 8px;
                font-size: 0.7rem;
                color: white;
                font-weight: bold;
                box-shadow: 0 4px 10px rgba(255,51,51,0.4);
            "> TRENDING</div>` : ''}
        </div>
        <div style="text-align: center; margin-bottom: 1.5rem;">
            <div style="color: rgba(255,255,255,0.95); font-size: 1.1rem; font-weight: 600; margin-bottom: 0.3rem;">${song.album || 'Single'}</div>
            <div style="color: ${getSourceColor(song.source)}; font-size: 0.9rem; font-weight: 600;">${song.source} API  Free Stream</div>
            ${song.releaseDate ? `<div style="color: rgba(255,255,255,0.7); font-size: 0.8rem; margin-top: 0.2rem;">${song.releaseDate}</div>` : ''}
            ${song.genre ? `<div style="color: rgba(255,255,255,0.6); font-size: 0.8rem;">${song.genre}</div>` : ''}
        </div>
    `;
    
    const nowPlaying = musicPlayer.querySelector('.now-playing');
    if (nowPlaying) {
        nowPlaying.insertBefore(artworkDiv, nowPlaying.firstChild);
    }
}

// Song controls
function selectFreeSong(index) {
    currentSongIndex = index;
    loadFreeCurrentSong();
    playFreeSong();
}

function playFreeSong() {
    if (!currentAudio) {
        loadFreeCurrentSong();
        return;
    }
    
    const playBtn = document.getElementById('playBtn');
    
    if (isPlaying && currentAudio) {
        currentAudio.pause();
        isPlaying = false;
        if (playBtn) playBtn.textContent = '';
        
        const artwork = document.querySelector('.now-playing-artwork img');
        if (artwork) artwork.style.animation = 'none';
        
    } else if (currentAudio) {
        currentAudio.play().then(() => {
            isPlaying = true;
            if (playBtn) playBtn.textContent = '';
            
            const artwork = document.querySelector('.now-playing-artwork img');
            if (artwork) artwork.style.animation = 'spin 20s linear infinite';
            
            console.log(' Playing free track:', freeTrendingSongs[currentSongIndex].title);
        }).catch(error => {
            console.error('Failed to play free track:', error);
            nextFreeSong();
        });
    }
    
    updateFreeSongList();
}

function nextFreeSong() {
    if (freeTrendingSongs.length === 0) return;
    currentSongIndex = (currentSongIndex + 1) % freeTrendingSongs.length;
    loadFreeCurrentSong();
    if (isPlaying) setTimeout(() => playFreeSong(), 200);
}

function prevFreeSong() {
    if (freeTrendingSongs.length === 0) return;
    currentSongIndex = currentSongIndex === 0 ? freeTrendingSongs.length - 1 : currentSongIndex - 1;
    loadFreeCurrentSong();
    if (isPlaying) setTimeout(() => playFreeSong(), 200);
}

// Initialize FREE Music Player
function initializeFreeMusicPlayer() {
    console.log(' Initializing FREE Music Player (No Keys Required)...');
    
    fetchFreeTrendingSongs();
    
    const playBtn = document.getElementById('playBtn');
    const nextBtn = document.getElementById('nextBtn');
    const prevBtn = document.getElementById('prevBtn');
    const muteBtn = document.getElementById('muteBtn');
    const progressContainer = document.getElementById('progressContainer');
    
    if (playBtn) playBtn.addEventListener('click', playFreeSong);
    if (nextBtn) nextBtn.addEventListener('click', nextFreeSong);
    if (prevBtn) prevBtn.addEventListener('click', prevFreeSong);
    if (muteBtn) muteBtn.addEventListener('click', toggleMute);
    
    if (progressContainer) {
        progressContainer.addEventListener('click', (e) => {
            const rect = progressContainer.getBoundingClientRect();
            const clickX = e.clientX - rect.left;
            const percentage = (clickX / rect.width) * 100;
            seekTo(percentage);
        });
    }
    
    // Auto-refresh every 2 hours
    setInterval(() => {
        console.log(' Refreshing free music data...');
        fetchFreeTrendingSongs();
    }, 2 * 60 * 60 * 1000);
    
    console.log(' FREE Music Player initialized!');
}

// Keep utility functions (formatDuration, updateProgressBar, etc.)
function formatDuration(seconds) {
    const minutes = Math.floor(seconds / 60);
    const remainingSeconds = Math.floor(seconds % 60);
    return `${minutes}:${remainingSeconds.toString().padStart(2, '0')}`;
}

function updateProgressBar() {
    if (!currentAudio) return;
    const progressBar = document.getElementById('progressBar');
    if (!progressBar) return;
    const progress = (currentAudio.currentTime / currentAudio.duration) * 100;
    progressBar.style.width = progress + '%';
    updateTimeDisplay();
}

function updateTimeDisplay() {
    if (!currentAudio) return;
    const currentTime = formatDuration(currentAudio.currentTime);
    const totalTime = formatDuration(currentAudio.duration || 0);
    
    let timeDisplay = document.querySelector('.time-display');
    if (!timeDisplay) {
        timeDisplay = document.createElement('div');
        timeDisplay.className = 'time-display';
        timeDisplay.style.cssText = 'color: rgba(255,255,255,0.8); font-size: 0.9rem; text-align: center; margin-top: 0.5rem;';
        const progressContainer = document.getElementById('progressContainer');
        if (progressContainer?.parentNode) {
            progressContainer.parentNode.insertBefore(timeDisplay, progressContainer.nextSibling);
        }
    }
    timeDisplay.textContent = `${currentTime} / ${totalTime}`;
}

function seekTo(percentage) {
    if (!currentAudio) return;
    const newTime = (percentage / 100) * currentAudio.duration;
    currentAudio.currentTime = newTime;
    updateProgressBar();
}

function toggleMute() {
    const muteBtn = document.getElementById('muteBtn');
    isMuted = !isMuted;
    if (currentAudio) currentAudio.volume = isMuted ? 0 : 0.8;
    if (muteBtn) {
        muteBtn.textContent = isMuted ? '' : '';
        muteBtn.style.color = isMuted ? '#ff6b6b' : '#fff';
    }
}

// Initialize in your DOMContentLoaded
document.addEventListener('DOMContentLoaded', function() {
    // ... your existing code ...
    
    // Initialize FREE Music Player (NO KEYS REQUIRED)
    initializeFreeMusicPlayer();
    
    // ... rest of your code ...
});

// Add free music styles
const freeStyles = document.createElement('style');
freeStyles.textContent = `
    @keyframes spin {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
    }
    
    .free-song.active-free-song {
        background: rgba(255, 107, 107, 0.2) !important;
        border: 2px solid rgba(255, 107, 107, 0.4) !important;
        transform: translateX(10px);
        box-shadow: 0 8px 25px rgba(255, 107, 107, 0.3);
    }
    
    .free-play-btn {
        background: linear-gradient(135deg, #ff6b6b, #ffd93d);
        border: none;
        border-radius: 50%;
        width: 35px;
        height: 35px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 1rem;
        font-weight: bold;
        box-shadow: 0 6px 15px rgba(255, 107, 107, 0.4);
    }
    
    .free-play-btn:hover {
        transform: scale(1.2);
        box-shadow: 0 8px 25px rgba(255, 107, 107, 0.6);
    }
    
    .song-item:hover {
        background: rgba(255, 255, 255, 0.08);
        transform: translateX(5px);
        transition: all 0.3s ease;
    }
`;
document.head.appendChild(freeStyles);


// Global variables
let isUltraMode = false;


// Create enhanced floating particles
function createParticles() {
    const container = document.getElementById('particlesContainer');
    if (!container) return;
    
    // Clear existing particles
    container.innerHTML = '';
    
    for (let i = 0; i < 60; i++) {
        const particle = document.createElement('div');
        particle.className = 'particle';
        particle.style.left = Math.random() * 100 + '%';
        particle.style.animationDelay = Math.random() * 15 + 's';
        particle.style.animationDuration = (Math.random() * 10 + 10) + 's';
        
        // Different particle sizes
        const size = Math.random() * 4 + 2;
        particle.style.width = size + 'px';
        particle.style.height = size + 'px';
        
        container.appendChild(particle);
    }
}

// Enhanced slideshow with crazy transitions
let openPageCurrentSlide = 0;
const openPageSlides = document.querySelectorAll('.openpage-slide');

function showOpenPageSlide(index) {
    openPageSlides.forEach((slide, i) => {
        slide.classList.remove('active');
        if (i === index) {
            slide.classList.add('active');
        }
    });
}

function nextOpenPageSlide() {
    openPageCurrentSlide = (openPageCurrentSlide + 1) % openPageSlides.length;
    showOpenPageSlide(openPageCurrentSlide);
}

// Auto-advance with enhanced timing
setInterval(nextOpenPageSlide, 6000);

// Ultra mode toggle with enhanced features
function toggleOpenPageTheme() {
    const openingPage = document.getElementById('openingPage');
    const themeIcon = document.getElementById('openpage-theme-icon');
    const themeText = document.getElementById('openpage-theme-text');
    
    isUltraMode = !isUltraMode;
    
    if (isUltraMode) {
        openingPage.classList.add('ultra-mode');
        themeIcon.textContent = '';
        themeText.textContent = 'Ultra Mode';
        
        // Ultra mode exclusive features
        createUltraEffects();
    } else {
        openingPage.classList.remove('ultra-mode');
        themeIcon.textContent = '';
        themeText.textContent = 'Premium Mode';
        
        // Remove ultra effects
        removeUltraEffects();
    }
    
    // Recreate particles with new theme
    createParticles();
}

// Ultra mode exclusive effects
function createUltraEffects() {
    // Add pulsing glow effect to logo
    const logo = document.querySelector('.openpage-logo');
    if (logo) {
        logo.style.animation = 'logoGlow 1s ease-in-out infinite alternate, logoSpin 4s linear infinite';
    }
    
    // Add screen shake effect
    const slides = document.querySelectorAll('.openpage-slide');
    slides.forEach(slide => {
        slide.style.animation = 'slideShake 0.1s infinite';
    });
}

function removeUltraEffects() {
    const logo = document.querySelector('.openpage-logo');
    if (logo) {
        logo.style.animation = 'logoGlow 3s ease-in-out infinite alternate, logoSpin 4s linear infinite';
    }
    
    const slides = document.querySelectorAll('.openpage-slide');
    slides.forEach(slide => {
        slide.style.animation = '';
    });
}

// Scroll progress indicator
function updateScrollProgress() {
    const openingPage = document.querySelector('.openpage');
    if (!openingPage) return;
    
    const scrollTop = openingPage.scrollTop;
    const scrollHeight = openingPage.scrollHeight - openingPage.clientHeight;
    const scrollProgress = (scrollTop / scrollHeight) * 100;
    
    const progressFill = document.getElementById('scrollProgress');
    const progressBadge = document.getElementById('progressBadge');
    
    if (progressFill) {
        progressFill.style.height = scrollProgress + '%';
    }
    
    if (progressBadge) {
        progressBadge.textContent = Math.round(scrollProgress) + '%';
    }
}

// Enhanced scroll animations
function isOpenPageElementInViewport(el, threshold = 0.3) {
    if (!el) return false;
    const rect = el.getBoundingClientRect();
    const windowHeight = window.innerHeight || document.documentElement.clientHeight;
    
    return rect.top < windowHeight * (1 - threshold) && rect.bottom > windowHeight * threshold;
}

function animateOpenPageOnScroll() {
    const sections = document.querySelectorAll('.openpage-section');
    const quoteItems = document.querySelectorAll('.openpage-quote-item');
    const reviewCards = document.querySelectorAll('.openpage-review-card');
    const sponsorLogos = document.querySelectorAll('.openpage-sponsor-logo');
    const galleryItems = document.querySelectorAll('.gallery-item');

    sections.forEach((section, index) => {
        if (isOpenPageElementInViewport(section)) {
            setTimeout(() => {
                section.classList.add('animate');
            }, index * 200);
        }
    });

    quoteItems.forEach((item, index) => {
        if (isOpenPageElementInViewport(item)) {
            setTimeout(() => {
                item.classList.add('animate');
            }, index * 300);
        }
    });

    reviewCards.forEach((card, index) => {
        if (isOpenPageElementInViewport(card)) {
            setTimeout(() => {
                card.classList.add('animate');
            }, index * 400);
        }
    });

    sponsorLogos.forEach((logo, index) => {
        if (isOpenPageElementInViewport(logo.parentElement)) {
            setTimeout(() => {
                logo.style.animation = `logoFloat 3s ease-in-out infinite ${index * 0.2}s`;
            }, index * 100);
        }
    });

    galleryItems.forEach((item, index) => {
        if (isOpenPageElementInViewport(item)) {
            setTimeout(() => {
                item.style.animation = `fadeInUp 0.6s ease-out ${index * 0.1}s both`;
            }, index * 50);
        }
    });
}



function simulateProgress() {
    if (!isPlaying) return;
    
    const progressBar = document.getElementById('progressBar');
    if (!progressBar) return;
    
    let progress = 0;
    const interval = setInterval(() => {
        if (!isPlaying) {
            clearInterval(interval);
            return;
        }
        
        progress += 1;
        progressBar.style.width = progress + '%';
        
        if (progress >= 100) {
            clearInterval(interval);
            nextSong();
        }
    }, 100);
}

// Enhanced app entrance with epic transition
function enterApp() {
    const openingPage = document.getElementById('openingPage');
    const mainAppContainer = document.getElementById('mainAppContainer');
    
    // Create epic exit transition
    openingPage.style.transition = 'all 1.2s cubic-bezier(0.4, 0, 0.2, 1)';
    openingPage.style.transform = 'scale(0.8) rotateX(15deg)';
    openingPage.style.filter = 'blur(20px)';
    openingPage.style.opacity = '0';
    
    // Add screen flash effect
    const flash = document.createElement('div');
    flash.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, #ffd700, #6c5ce7, #fd79a8);
        z-index: 99999;
        opacity: 0;
        pointer-events: none;
        animation: flashEffect 0.8s ease-out;
    `;
    document.body.appendChild(flash);
    
    setTimeout(() => {
        openingPage.classList.add('hidden');
        mainAppContainer.classList.add('show');
        mainAppContainer.style.animation = 'fadeInScale 1.2s cubic-bezier(0.4, 0, 0.2, 1)';
        
        // Remove particles and cleanup
        const particles = document.getElementById('particlesContainer');
        if (particles) particles.remove();
        
        // Remove flash effect
        setTimeout(() => flash.remove(), 1000);
    }, 800);
}

// Initialize everything when DOM loads
document.addEventListener('DOMContentLoaded', function() {
    // Create particles immediately
    createParticles();
    
    // Initialize music player
    const playBtn = document.getElementById('playBtn');
    const nextBtn = document.getElementById('nextBtn');
    const prevBtn = document.getElementById('prevBtn');
    const muteBtn = document.getElementById('muteBtn');
    const progressContainer = document.getElementById('progressContainer');
    
    if (playBtn) {
        playBtn.addEventListener('click', () => {
            if (isPlaying) {
                pauseSong();
            } else {
                playSong();
            }
        });
    }
    
    if (nextBtn) nextBtn.addEventListener('click', nextSong);
    if (prevBtn) prevBtn.addEventListener('click', prevSong);
    if (muteBtn) muteBtn.addEventListener('click', toggleMute);
    
    if (progressContainer) {
        progressContainer.addEventListener('click', (e) => {
            const rect = progressContainer.getBoundingClientRect();
            const clickX = e.clientX - rect.left;
            const width = rect.width;
            const percentage = (clickX / width) * 100;
            
            const progressBar = document.getElementById('progressBar');
            if (progressBar) {
                progressBar.style.width = percentage + '%';
            }
        });
    }
    
    // Enhanced scroll listener
    const openingPageContainer = document.querySelector('.openpage');
    if (openingPageContainer) {
        let ticking = false;
        openingPageContainer.addEventListener('scroll', () => {
            if (!ticking) {
                requestAnimationFrame(() => {
                    animateOpenPageOnScroll();
                    updateScrollProgress();
                    ticking = false;
                });
                ticking = true;
            }
        });
    }
    
    // Initialize first song
    if (songs.length > 0) {
        const currentSongEl = document.getElementById('currentSong');
        const currentArtistEl = document.getElementById('currentArtist');
        if (currentSongEl) currentSongEl.textContent = songs[0].title;
        if (currentArtistEl) currentArtistEl.textContent = songs[0].artist;
    }
    
    // Initial animation check
    setTimeout(() => {
        animateOpenPageOnScroll();
        updateScrollProgress();
    }, 1000);
    
    // Add keyboard shortcuts
    document.addEventListener('keydown', (e) => {
        if (e.target.tagName === 'INPUT') return; // Don't interfere with inputs
        
        switch(e.code) {
            case 'Space':
                e.preventDefault();
                if (isPlaying) pauseSong();
                else playSong();
                break;
            case 'ArrowRight':
                e.preventDefault();
                nextSong();
                break;
            case 'ArrowLeft':
                e.preventDefault();
                prevSong();
                break;
            case 'KeyM':
                e.preventDefault();
                toggleMute();
                break;
            case 'KeyU':
                e.preventDefault();
                toggleOpenPageTheme();
                break;
        }
    });
});

// Add dynamic CSS animations
const dynamicStyle = document.createElement('style');
dynamicStyle.textContent = `
    @keyframes fadeInScale {
        0% { 
            opacity: 0; 
            transform: scale(0.9) rotateX(-15deg); 
        }
        100% { 
            opacity: 1; 
            transform: scale(1) rotateX(0deg); 
        }
    }
    
    @keyframes logoFloat {
        0%, 100% { transform: translateY(0px); }
        50% { transform: translateY(-10px); }
    }
    
    @keyframes fadeInUp {
        0% {
            opacity: 0;
            transform: translateY(30px);
        }
        100% {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    @keyframes flashEffect {
        0% { opacity: 0; }
        50% { opacity: 0.3; }
        100% { opacity: 0; }
    }
    
    @keyframes slideShake {
        0%, 100% { transform: translateX(0); }
        25% { transform: translateX(-1px); }
        75% { transform: translateX(1px); }
    }
`;
document.head.appendChild(dynamicStyle);

// Add touch gestures for mobile
let touchStartX = 0;
let touchStartY = 0;

document.addEventListener('touchstart', (e) => {
    touchStartX = e.touches[0].clientX;
    touchStartY = e.touches[0].clientY;
});

document.addEventListener('touchend', (e) => {
    if (!touchStartX || !touchStartY) return;
    
    const touchEndX = e.changedTouches[0].clientX;
    const touchEndY = e.changedTouches[0].clientY;
    
    const diffX = touchStartX - touchEndX;
    const diffY = touchStartY - touchEndY;
    
    // Only handle horizontal swipes
    if (Math.abs(diffX) > Math.abs(diffY) && Math.abs(diffX) > 50) {
        if (diffX > 0) {
            // Swiped left - next song
            nextSong();
        } else {
            // Swiped right - previous song
            prevSong();
        }
    }
    
    touchStartX = 0;
    touchStartY = 0;
});

// Performance optimization
const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
        if (entry.isIntersecting) {
            entry.target.classList.add('animate');
        }
    });
}, { threshold: 0.3 });

// Observe all animatable elements
document.querySelectorAll('.openpage-section, .gallery-item, .strip-photo').forEach(el => {
    observer.observe(el);
});




document.addEventListener('DOMContentLoaded', function() {
    // DOM Elements
    const wallet1Btn = document.querySelector('.wallet1-btn');
    const walletModal = document.getElementById('walletModal');
    const closeWalletBtn = document.getElementById('closeWalletBtn');
    const closeWalletDashboardBtn = document.getElementById('closeWalletDashboardBtn');
    
    // PIN Setup Elements
    const pinScreen = document.getElementById('pinScreen');
    const pinSetupSection = document.getElementById('pinSetupSection');
    const pinEntrySection = document.getElementById('pinEntrySection');
    const pinConfirmContainer = document.getElementById('pinConfirmContainer');
    const createPinBtn = document.getElementById('createPinBtn');
    const loginPinBtn = document.getElementById('loginPinBtn');
    const forgotPinBtn = document.getElementById('forgotPinBtn');
    
    // Wallet Dashboard Elements
    const walletDashboard = document.getElementById('walletDashboard');
    const talentCoinBalance = document.getElementById('talentCoinBalance');
    const pendingCoinBalance = document.getElementById('pendingCoinBalance');
    const nairaEquivalent = document.getElementById('nairaEquivalent');
    const commissionBalance = document.getElementById('commissionBalance');
    
    // PIN Input Elements
    const pinDigits = document.querySelectorAll('.pin-digit');
    const pinConfirmDigits = document.querySelectorAll('.pin-confirm-digit');
    const pinLoginDigits = document.querySelectorAll('.pin-login-digit');
    
    // Constants
    const TALENT_COIN_RATE = 15; // 1 Talent Coin = 100 (example rate)
    
    // Create backup email elements dynamically
    createBackupEmailSection();
    const backupEmailSection = document.getElementById('backupEmailSection');
    const backupEmailInput = document.getElementById('backupEmail');
    const backupPasswordInput = document.getElementById('backupPassword');
    const saveBackupBtn = document.getElementById('saveBackupBtn');
    
    // Initialize wallet functionality
    initWallet();
    
    // Event Listeners
    if (wallet1Btn) {
        wallet1Btn.addEventListener('click', openWallet);
    }
    
    if (closeWalletBtn) {
        closeWalletBtn.addEventListener('click', closeWallet);
    }
    
    if (closeWalletDashboardBtn) {
        closeWalletDashboardBtn.addEventListener('click', closeWallet);
    }
    
    if (createPinBtn) {
        createPinBtn.addEventListener('click', handlePinCreation);
    }
    
    if (loginPinBtn) {
        loginPinBtn.addEventListener('click', handlePinLogin);
    }
    
    if (forgotPinBtn) {
        forgotPinBtn.addEventListener('click', handleForgotPin);
    }
    
    if (pinConfirmContainer) {
        pinConfirmContainer.addEventListener('click', function() {
            pinConfirmContainer.classList.toggle('active');
        });
    }
    
    if (saveBackupBtn) {
        saveBackupBtn.addEventListener('click', saveBackupEmail);
    }
    
    // Setup PIN input fields
    setupPinInputs(pinDigits);
    setupPinInputs(pinConfirmDigits);
    setupPinInputs(pinLoginDigits);
    
    // Close modal when clicking outside
    window.addEventListener('click', function(event) {
        if (event.target === walletModal) {
            closeWallet();
        }
    });
    
    // Create backup email section
    function createBackupEmailSection() {
        const backupSection = document.createElement('div');
        backupSection.id = 'backupEmailSection';
        backupSection.className = 'backup-email-section hidden';
        backupSection.innerHTML = `
            <div class="pin-icon">
                <i class="fas fa-envelope-open-text"></i>
            </div>
            <h3>Set Backup Email</h3>
            <p>Add a backup email to recover your wallet if you forget your PIN.</p>
            
            <div class="input-group">
                <label for="backupEmail">Backup Email</label>
                <input type="email" id="backupEmail" placeholder="Enter your backup email">
            </div>
            
            <div class="input-group">
                <label for="backupPassword">Recovery Password</label>
                <div class="password-input">
                    <input type="password" id="backupPassword" placeholder="Create a recovery password">
                    <button type="button" id="toggleBackupPassword">
                        <i class="fas fa-eye"></i>
                    </button>
                </div>
            </div>
            
            <button class="wallet-btn primary-btn" id="saveBackupBtn">Save Backup</button>
            <button class="wallet-btn text-btn" id="skipBackupBtn">Skip for Now</button>
        `;
        
        // Append to PIN screen if it exists
        if (pinScreen) {
            pinScreen.appendChild(backupSection);
            
            // Add toggle password functionality
            const toggleBackupPassword = document.getElementById('toggleBackupPassword');
            const backupPassword = document.getElementById('backupPassword');
            
            if (toggleBackupPassword && backupPassword) {
                toggleBackupPassword.addEventListener('click', function() {
                    if (backupPassword.type === 'password') {
                        backupPassword.type = 'text';
                        toggleBackupPassword.innerHTML = '<i class="fas fa-eye-slash"></i>';
                    } else {
                        backupPassword.type = 'password';
                        toggleBackupPassword.innerHTML = '<i class="fas fa-eye"></i>';
                    }
                });
            }
            
            // Add skip backup functionality
            const skipBackupBtn = document.getElementById('skipBackupBtn');
            if (skipBackupBtn) {
                skipBackupBtn.addEventListener('click', function() {
                    backupEmailSection.classList.add('hidden');
                    loadWalletDashboard();
                });
            }
        }
    }
    
    // Initialize wallet
    function initWallet() {
        // Check if user is logged in
        if (!isUserLoggedIn()) {
            // Redirect to login or show login prompt
            showToast('Please log in to access your wallet', 'warning');
            return;
        }
        
        // Get user ID
        const userId = getUserId();
        
        if (!userId) {
            showToast('User authentication failed', 'error');
            return;
        }
        
        // Check if PIN is already set in Firebase
        firebase.firestore().collection('users').doc(userId).get()
            .then(doc => {
                if (doc.exists) {
                    const userData = doc.data();
                    
                    // Check if wallet PIN exists
                    if (userData.walletPinHash) {
                        // PIN exists, show login screen
                        if (pinSetupSection) pinSetupSection.classList.add('hidden');
                        if (pinEntrySection) pinEntrySection.classList.remove('hidden');
                        if (backupEmailSection) backupEmailSection.classList.add('hidden');
                    } else {
                        // No PIN, show setup screen
                        if (pinSetupSection) pinSetupSection.classList.remove('hidden');
                        if (pinEntrySection) pinEntrySection.classList.add('hidden');
                        if (backupEmailSection) backupEmailSection.classList.add('hidden');
                    }
                } else {
                    // User document doesn't exist, show setup screen
                    if (pinSetupSection) pinSetupSection.classList.remove('hidden');
                    if (pinEntrySection) pinEntrySection.classList.add('hidden');
                    if (backupEmailSection) backupEmailSection.classList.add('hidden');
                }
            })
            .catch(error => {
                console.error('Error checking PIN status:', error);
                showToast('Failed to check PIN status', 'error');
                
                // Default to setup screen
                if (pinSetupSection) pinSetupSection.classList.remove('hidden');
                if (pinEntrySection) pinEntrySection.classList.add('hidden');
                if (backupEmailSection) backupEmailSection.classList.add('hidden');
            });
    }
    
        // Modify the openWallet function to check for wallet tag after PIN verification
function openWallet() {
    
 // Check if user is logged in
 if (!isUserLoggedIn()) {
            showToast('Please log in to access your wallet', 'warning');
            return;
        }
        
        // Reset PIN inputs
        resetPinInputs();

        // Show wallet modal with overlay
        if (walletModal) {
            walletModal.style.display = 'flex';
            
            // Add overlay
            const overlay = document.querySelector('.modal-overlay');
            if (overlay) {
                overlay.classList.add('active');
            } else {
                const newOverlay = document.createElement('div');
                newOverlay.className = 'modal-overlay active';
                document.body.appendChild(newOverlay);
            }
            
            // Initialize wallet to check PIN status
            initWallet();
            
            // Focus on first PIN input after a short delay to ensure elements are visible
            setTimeout(() => {
                if (pinSetupSection && !pinSetupSection.classList.contains('hidden')) {
                    if (pinDigits && pinDigits.length > 0) pinDigits[0].focus();
                } else if (pinEntrySection && !pinEntrySection.classList.contains('hidden')) {
                    if (pinLoginDigits && pinLoginDigits.length > 0) pinLoginDigits[0].focus();
                }
            }, 300);
            
            // Add body class to prevent scrolling
            document.body.classList.add('modal-open');
        }
    }
    
    // Close wallet modal
    function closeWallet() {
        if (walletModal) {
            walletModal.style.display = 'none';
            
            // Remove overlay
            const overlay = document.querySelector('.modal-overlay');
            if (overlay) {
                overlay.classList.remove('active');
            }
            
            // Reset PIN inputs
            resetPinInputs();
            
            // Reset screens
            if (pinScreen) pinScreen.classList.remove('hidden');
            if (walletDashboard) walletDashboard.classList.add('hidden');
            if (backupEmailSection) backupEmailSection.classList.add('hidden');
            
            // Remove body class to allow scrolling
            document.body.classList.remove('modal-open');
            
            // Clean up any listeners
            cleanupWallet();
        }
    }
    
    // Setup PIN input fields
    function setupPinInputs(inputs) {
        if (!inputs || inputs.length === 0) return;
        
        inputs.forEach((input, index) => {
            // Handle input
            input.addEventListener('input', function(e) {
                // Allow only numbers
                this.value = this.value.replace(/[^0-9]/g, '');
                
                // Move to next input if value is entered
                if (this.value && index < inputs.length - 1) {
                    inputs[index + 1].focus();
                }
                
                // Check if all digits are filled
                if (inputs === pinDigits) {
                    checkPinComplete(pinDigits);
                }
            });
            
            // Handle backspace
            input.addEventListener('keydown', function(e) {
                if (e.key === 'Backspace' && !this.value && index > 0) {
                    inputs[index - 1].focus();
                }
            });
            
            // Handle paste
            input.addEventListener('paste', function(e) {
                e.preventDefault();
                const pastedData = e.clipboardData.getData('text').replace(/[^0-9]/g, '').slice(0, inputs.length);
                
                if (pastedData) {
                    // Fill inputs with pasted data
                    for (let i = 0; i < pastedData.length; i++) {
                        if (index + i < inputs.length) {
                            inputs[index + i].value = pastedData[i];
                        }
                    }
                    
                    // Focus on next empty input or last input
                    const nextIndex = Math.min(index + pastedData.length, inputs.length - 1);
                    inputs[nextIndex].focus();
                    
                    // Check if all digits are filled
                    if (inputs === pinDigits) {
                        checkPinComplete(pinDigits);
                    }
                }
            });
        });
    }
    
    // Check if PIN is complete and show confirm section
    function checkPinComplete(inputs) {
        if (!inputs || inputs.length === 0 || !pinConfirmContainer) return;
        
        const isComplete = Array.from(inputs).every(input => input.value.length === 1);
        
        if (isComplete && !pinConfirmContainer.classList.contains('hidden')) {
            return;
        }
        
        if (isComplete) {
            pinConfirmContainer.classList.remove('hidden');
            if (pinConfirmDigits && pinConfirmDigits.length > 0) {
                pinConfirmDigits[0].focus();
            }
        }
    }
    
    // Reset PIN inputs
    function resetPinInputs() {
        // Reset PIN setup inputs
        if (pinDigits) {
            Array.from(pinDigits).forEach(input => input.value = '');
        }
        
        if (pinConfirmDigits) {
            Array.from(pinConfirmDigits).forEach(input => input.value = '');
        }
        
        if (pinLoginDigits) {
            Array.from(pinLoginDigits).forEach(input => input.value = '');
        }
        
        // Hide confirm container
        if (pinConfirmContainer) {
            pinConfirmContainer.classList.add('hidden');
        }
    }
    
    // Handle PIN creation
    function handlePinCreation() {
        if (!pinDigits || !pinConfirmDigits) return;
        
        // Get PIN values
        const pin = Array.from(pinDigits).map(input => input.value).join('');
        const confirmPin = Array.from(pinConfirmDigits).map(input => input.value).join('');
        
        // Validate PIN
        if (pin.length !== 4) {
            showToast('Please enter a 4-digit PIN', 'error');
            return;
        }
        
        // Check if confirm PIN is shown
        if (pinConfirmContainer && pinConfirmContainer.classList.contains('hidden')) {
            pinConfirmContainer.classList.remove('hidden');
            if (pinConfirmDigits && pinConfirmDigits.length > 0) {
                pinConfirmDigits[0].focus();
            }
            return;
        }
        
        // Validate confirm PIN
        if (confirmPin.length !== 4) {
            showToast('Please confirm your PIN', 'error');
            return;
        }
        
        // Check if PINs match
        if (pin !== confirmPin) {
            showToast('PINs do not match. Please try again.', 'error');
            resetPinInputs();
            if (pinDigits && pinDigits.length > 0) {
                pinDigits[0].focus();
            }
            return;
        }
        
        // Save PIN to Firebase
        const userId = getUserId();
        
        if (!userId) {
            showToast('User authentication failed', 'error');
            return;
        }
        
               // Show loading state
               if (createPinBtn) {
            createPinBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Creating...';
            createPinBtn.disabled = true;
        }
        
        // Hash the PIN before storing
        const pinHash = hashPin(pin);
        
        // Save PIN to Firebase
        firebase.firestore().collection('users').doc(userId).update({
            walletPinHash: pinHash,
            walletPinCreatedAt: firebase.firestore.FieldValue.serverTimestamp()
        })
        .then(() => {
            // Show success message
            showToast('PIN created successfully', 'success');
            
            // Reset button state
            if (createPinBtn) {
                createPinBtn.innerHTML = 'Create PIN';
                createPinBtn.disabled = false;
            }
            
            // Show backup email section
            if (pinSetupSection) pinSetupSection.classList.add('hidden');
            if (backupEmailSection) backupEmailSection.classList.remove('hidden');
        })
        .catch(error => {
            console.error('Error saving PIN:', error);
            showToast('Failed to create PIN. Please try again.', 'error');
            
            // Reset button state
            if (createPinBtn) {
                createPinBtn.innerHTML = 'Create PIN';
                createPinBtn.disabled = false;
            }
        });
    }
    
    // Save backup email
    function saveBackupEmail() {
        if (!backupEmailInput || !backupPasswordInput) return;
        
        const email = backupEmailInput.value.trim();
        const password = backupPasswordInput.value.trim();
        
        // Validate email
        if (!email) {
            showToast('Please enter a backup email', 'error');
            return;
        }
        
        // Simple email validation
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(email)) {
            showToast('Please enter a valid email address', 'error');
            return;
        }
        
        // Validate password
        if (!password) {
            showToast('Please create a recovery password', 'error');
            return;
        }
        
        if (password.length < 6) {
            showToast('Password must be at least 6 characters', 'error');
            return;
        }
        
        // Get user ID
        const userId = getUserId();
        
        if (!userId) {
            showToast('User authentication failed', 'error');
            return;
        }
        
        // Show loading state
        if (saveBackupBtn) {
            saveBackupBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
            saveBackupBtn.disabled = true;
        }
        
        // Save to Firebase
        firebase.firestore().collection('users').doc(userId).update({
            backupEmail: email,
            backupPasswordHash: hashPassword(password),
            backupSetAt: firebase.firestore.FieldValue.serverTimestamp()
        })
        .then(() => {
            // Show success message
            showToast('Backup email saved successfully', 'success');
            
            // Reset button state
            if (saveBackupBtn) {
                saveBackupBtn.innerHTML = 'Save Backup';
                saveBackupBtn.disabled = false;
            }
            
            // Load wallet dashboard
            if (backupEmailSection) backupEmailSection.classList.add('hidden');
            loadWalletDashboard();
        })
        .catch(error => {
            console.error('Error saving backup email:', error);
            showToast('Failed to save backup email. Please try again.', 'error');
            
            // Reset button state
            if (saveBackupBtn) {
                saveBackupBtn.innerHTML = 'Save Backup';
                saveBackupBtn.disabled = false;
            }
        });
    }
    
    // Handle PIN login
    function handlePinLogin() {
        if (!pinLoginDigits) return;
        
        // Get entered PIN
        const enteredPin = Array.from(pinLoginDigits).map(input => input.value).join('');
        
        // Validate PIN
        if (enteredPin.length !== 4) {
            showToast('Please enter your 4-digit PIN', 'error');
            return;
        }
        
        // Get user ID
        const userId = getUserId();
        
        if (!userId) {
            showToast('User authentication failed', 'error');
            return;
        }
        
        // Show loading state
        if (loginPinBtn) {
            loginPinBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Verifying...';
            loginPinBtn.disabled = true;
        }
        
        // Get stored PIN from Firebase
        firebase.firestore().collection('users').doc(userId).get()
            .then(doc => {
                if (doc.exists) {
                    const userData = doc.data();
                    const storedPinHash = userData.walletPinHash;
                    
                    // Check if PIN is correct
                    if (storedPinHash !== hashPin(enteredPin)) {
                        showToast('Incorrect PIN. Please try again.', 'error');
                        resetPinInputs();
                        if (pinLoginDigits && pinLoginDigits.length > 0) {
                            pinLoginDigits[0].focus();
                        }
                        
                        // Reset button state
                        if (loginPinBtn) {
                            loginPinBtn.innerHTML = 'Login';
                            loginPinBtn.disabled = false;
                        }
                        return;
                    }
                    
                    // Reset button state
                    if (loginPinBtn) {
                        loginPinBtn.innerHTML = 'Login';
                        loginPinBtn.disabled = false;
                    }
                    
                    // Load wallet dashboard
                    loadWalletDashboard();
                } else {
                    showToast('User data not found. Please try again.', 'error');
                    
                    // Reset button state
                    if (loginPinBtn) {
                        loginPinBtn.innerHTML = 'Login';
                        loginPinBtn.disabled = false;
                    }
                }
            })
            .catch(error => {
                console.error('Error verifying PIN:', error);
                showToast('Failed to verify PIN. Please try again.', 'error');
                
                // Reset button state
                if (loginPinBtn) {
                    loginPinBtn.innerHTML = 'Login';
                    loginPinBtn.disabled = false;
                }
            });
    }
    
    // Handle forgot PIN
    function handleForgotPin() {
        // Get user ID
        const userId = getUserId();
        
        if (!userId) {
            showToast('User authentication failed', 'error');
            return;
        }
        
        // Check if backup email is set in Firebase
        firebase.firestore().collection('users').doc(userId).get()
            .then(doc => {
                if (doc.exists) {
                    const userData = doc.data();
                    const backupEmail = userData.backupEmail;
                    
                    if (!backupEmail) {
                        showToast('No backup email found. Please contact support.', 'error');
                        return;
                    }
                    
                    // Create reset PIN modal
                    createResetPinModal(backupEmail);
                } else {
                    showToast('User data not found. Please contact support.', 'error');
                }
            })
            .catch(error => {
                console.error('Error checking backup email:', error);
                showToast('Failed to check backup email. Please try again.', 'error');
            });
    }
    
    // Create reset PIN modal
    function createResetPinModal(email) {
        // Hide current screens
        if (pinScreen) pinScreen.classList.add('hidden');
        
        // Create reset PIN modal if it doesn't exist
        let resetPinModal = document.getElementById('resetPinModal');
        
        if (!resetPinModal) {
            resetPinModal = document.createElement('div');
            resetPinModal.id = 'resetPinModal';
            resetPinModal.className = 'wallet-screen';
            resetPinModal.innerHTML = `
                <div class="wallet-header">
                    <h2>Reset PIN</h2>
                    <button class="close-wallet" id="closeResetPinBtn">&times;</button>
                </div>
                
                <div class="reset-pin-content">
                    <div class="pin-icon">
                        <i class="fas fa-key"></i>
                    </div>
                    <h3>Reset Your Wallet PIN</h3>
                    <p>We'll send a reset link to your backup email: <strong>${maskEmail(email)}</strong></p>
                    
                    <div class="input-group">
                        <label for="recoveryPassword">Recovery Password</label>
                        <input type="password" id="recoveryPassword" placeholder="Enter your recovery password">
                    </div>
                    
                    <button class="wallet-btn primary-btn" id="sendResetLinkBtn">Send Reset Link</button>
                    <button class="wallet-btn text-btn" id="backToLoginBtn">Back to Login</button>
                </div>
            `;
            
            if (walletModal) {
                walletModal.querySelector('.wallet-container').appendChild(resetPinModal);
            }
            
            // Add event listeners
            const closeResetPinBtn = document.getElementById('closeResetPinBtn');
            const sendResetLinkBtn = document.getElementById('sendResetLinkBtn');
            const backToLoginBtn = document.getElementById('backToLoginBtn');
            
            if (closeResetPinBtn) {
                closeResetPinBtn.addEventListener('click', closeWallet);
            }
            
            if (sendResetLinkBtn) {
                sendResetLinkBtn.addEventListener('click', sendResetLink);
            }
            
            if (backToLoginBtn) {
                backToLoginBtn.addEventListener('click', function() {
                    resetPinModal.classList.add('hidden');
                    if (pinScreen) pinScreen.classList.remove('hidden');
                });
            }
        } else {
            resetPinModal.classList.remove('hidden');
        }
    }
    
    // Send reset link
    function sendResetLink() {
        const recoveryPassword = document.getElementById('recoveryPassword');
        
        if (!recoveryPassword) return;
        
        const password = recoveryPassword.value.trim();
        
        if (!password) {
            showToast('Please enter your recovery password', 'error');
            return;
        }
        
        // Get user ID
        const userId = getUserId();
        
        if (!userId) {
            showToast('User authentication failed', 'error');
            return;
        }
        
        // Show loading state
        const sendResetLinkBtn = document.getElementById('sendResetLinkBtn');
        if (sendResetLinkBtn) {
            sendResetLinkBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Sending...';
            sendResetLinkBtn.disabled = true;
        }
        
        // Verify recovery password against Firebase
        firebase.firestore().collection('users').doc(userId).get()
            .then(doc => {
                if (doc.exists) {
                    const userData = doc.data();
                    const storedPasswordHash = userData.backupPasswordHash;
                    
                    // Check if password is correct
                    if (storedPasswordHash !== hashPassword(password)) {
                        showToast('Incorrect recovery password', 'error');
                        
                        // Reset button state
                        if (sendResetLinkBtn) {
                            sendResetLinkBtn.innerHTML = 'Send Reset Link';
                            sendResetLinkBtn.disabled = false;
                        }
                        return;
                    }
                    
                    // In a real app, this would send an actual email
                    // For this demo, we'll simulate sending an email and reset the PIN directly
                    
                    // Remove PIN from Firebase
                    return firebase.firestore().collection('users').doc(userId).update({
                        walletPinHash: firebase.firestore.FieldValue.delete()
                    });
                } else {
                    throw new Error('User data not found');
                }
            })
            .then(() => {
                // Show success message
                showToast('Reset link sent to your email', 'success');
                
                // Close reset modal
                const resetPinModal = document.getElementById('resetPinModal');
                if (resetPinModal) {
                    resetPinModal.classList.add('hidden');
                }
                
                // Show PIN setup screen
                if (pinScreen) pinScreen.classList.remove('hidden');
                if (pinSetupSection) pinSetupSection.classList.remove('hidden');
                if (pinEntrySection) pinEntrySection.classList.add('hidden');
                
                // Reset PIN inputs
                resetPinInputs();
                
                // Focus on first PIN input
                if (pinDigits && pinDigits.length > 0) {
                    pinDigits[0].focus();
                }
                
                // Reset button state
                if (sendResetLinkBtn) {
                    sendResetLinkBtn.innerHTML = 'Send Reset Link';
                    sendResetLinkBtn.disabled = false;
                }
            })
            .catch(error => {
                console.error('Error resetting PIN:', error);
                showToast('Failed to reset PIN. Please try again.', 'error');
                
                // Reset button state
                if (sendResetLinkBtn) {
                    sendResetLinkBtn.innerHTML = 'Send Reset Link';
                    sendResetLinkBtn.disabled = false;
                }
            });
    }
    
    // Load wallet dashboard
    function loadWalletDashboard() {
        // Hide PIN screen and show dashboard
        if (pinScreen) pinScreen.classList.add('hidden');
        if (walletDashboard) walletDashboard.classList.remove('hidden');
        
        // Show loading state
        if (talentCoinBalance) talentCoinBalance.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
      if (pendingCoinBalance) pendingCoinBalance.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
        if (commissionBalance) commissionBalance.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
        
        // Get user ID
        const userId = getUserId();
        
        if (!userId) {
            showToast('User not authenticated', 'error');
            return;
        }
        
        // Get wallet data from Firebase
        firebase.firestore().collection('users').doc(userId).get()
            .then(doc => {
                if (doc.exists) {
                    const userData = doc.data();
                    
                   
                    // Get wallet balance
                    return firebase.firestore().collection('wallets').doc(userId).get();
                } else {
                    throw new Error('User data not found');
                }
            })
            .then(doc => {
                if (doc.exists) {
                    const walletData = doc.data();
                    
                    // Set balances
                    const talentCoins = walletData.talentCoins || 0;
                    const commission = walletData.commission || 0;
                    
                    // Update UI
                    if (talentCoinBalance) talentCoinBalance.textContent = formatNumber(talentCoins);
                    if (pendingCoinBalance) pendingCoinBalance.textContent = formatNumber(walletData.pendingCoins || 0);
                    if (commissionBalance) commissionBalance.textContent = formatNumber(commission);
                    
                    // Calculate Naira equivalent
                    const nairaValue = talentCoins * TALENT_COIN_RATE;
                    if (nairaEquivalent) nairaEquivalent.textContent = formatNumber(nairaValue);
                } else {
                    // Create wallet if it doesn't exist
                    return firebase.firestore().collection('wallets').doc(userId).set({
                        talentCoins: 0,
                        commission: 0,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    }).then(() => {
                        if (talentCoinBalance) talentCoinBalance.textContent = '0';
                        if (pendingCoinBalance) pendingCoinBalance.textContent = '0';
                        if (commissionBalance) commissionBalance.textContent = '0';
                        if (nairaEquivalent) nairaEquivalent.textContent = '0';
                    });
                }
            })
            .catch(error => {
                console.error('Error loading wallet data:', error);
                showToast('Failed to load wallet data', 'error');
                
                // Set default values
                if (talentCoinBalance) talentCoinBalance.textContent = '0';
                if (pendingCoinBalance) pendingCoinBalance.textContent = '0';
                if (commissionBalance) commissionBalance.textContent = '0';
                if (nairaEquivalent) nairaEquivalent.textContent = '0';
            });
            
        // Setup real-time updates
        setupRealTimeUpdates();
    }
    
            
            
    // Helper function to check if user is logged in
    function isUserLoggedIn() {
        return firebase.auth().currentUser !== null;
    }
    
    // Helper function to get user ID
    function getUserId() {
        const user = firebase.auth().currentUser;
        return user ? user.uid : null;
    }
    
    // Helper function to hash PIN (simple hash for demo)
    function hashPin(pin) {
        // In a real app, use a proper hashing algorithm
        // This is just a simple hash for demonstration
        let hash = 0;
        for (let i = 0; i < pin.length; i++) {
            const char = pin.charCodeAt(i);
            hash = ((hash << 5) - hash) + char;
            hash = hash & hash; // Convert to 32bit integer
        }
        return hash.toString();
    }
    
    // Helper function to hash password
    function hashPassword(password) {
        // In a real app, use a proper hashing algorithm with salt
        // This is just a simple hash for demonstration
        let hash = 0;
        for (let i = 0; i < password.length; i++) {
            const char = password.charCodeAt(i);
            hash = ((hash << 5) - hash) + char;
            hash = hash & hash; // Convert to 32bit integer
        }
        return hash.toString();
    }
    
    // Helper function to mask email
    function maskEmail(email) {
        if (!email) return '';
        
        const parts = email.split('@');
        if (parts.length !== 2) return email;
        
        const name = parts[0];
        const domain = parts[1];
        
        const maskedName = name.substring(0, 2) + '***' + name.substring(name.length - 2);
        
        return maskedName + '@' + domain;
    }
    
    // Helper function to format numbers with commas
    function formatNumber(num) {
        return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    }
    
    // Function to show toast message
    function showToast(message, type = 'info') {
        // Check if toast container exists, create if not
        let toastContainer = document.getElementById('toastContainer');
        if (!toastContainer) {
            toastContainer = document.createElement('div');
            toastContainer.id = 'toastContainer';
            document.body.appendChild(toastContainer);
            
            // Add styles
            const style = document.createElement('style');
            style.textContent = `
                #toastContainer {
                    position: fixed;
                    bottom: 20px;
                    left: 50%;
                    transform: translateX(-50%);
                    z-index: 9999;
                }
                .toast {
                    padding: 12px 20px;
                    margin-bottom: 10px;
                    border-radius: 8px;
                    display: flex;
                    align-items: center;
                    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
                    animation: slideUp 0.3s ease-out forwards;
                    max-width: 90vw;
                }
                .toast.success {
                    background-color: #4CAF50;
                    color: white;
                }
                .toast.error {
                    background-color: #F44336;
                    color: white;
                }
                .toast.info {
                    background-color: #2196F3;
                    color: white;
                }
                .toast.warning {
                    background-color: #FF9800;
                    color: white;
                }
                .toast i {
                    margin-right: 10px;
                    font-size: 18px;
                }
                @keyframes slideUp {
                    from {
                        opacity: 0;
                        transform: translateY(20px);
                    }
                    to {
                        opacity: 1;
                        transform: translateY(0);
                    }
                }
                @keyframes fadeOut {
                    from {
                        opacity: 1;
                    }
                    to {
                        opacity: 0;
                    }
                }
                
                /* Backup email section styles */
                .backup-email-section {
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                    text-align: center;
                    padding: 20px;
                }
                
                .password-input {
                    position: relative;
                    width: 100%;
                }
                
                .password-input input {
                    width: 100%;
                    padding-right: 40px;
                }
                
                .password-input button {
                    position: absolute;
                    right: 10px;
                    top: 50%;
                    transform: translateY(-50%);
                    background: none;
                    border: none;
                    color: var(--text-light);
                    cursor: pointer;
                }
                
                /* Reset PIN modal styles */
                .reset-pin-content {
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                    text-align: center;
                    padding: 20px;
                }
                
                /* Animation classes for balance changes */
                .increasing {
                    animation: increaseValue 1s ease;
                    color: var(--success-color);
                }
                
                .decreasing {
                    animation: decreaseValue 1s ease;
                    color: var(--danger-color);
                }
                
                @keyframes increaseValue {
                    0% { color: var(--success-color); transform: scale(1); }
                    50% { color: var(--success-color); transform: scale(1.1); }
                    100% { color: inherit; transform: scale(1); }
                }
                
                @keyframes decreaseValue {
                    0% { color: var(--danger-color); transform: scale(1); }
                    50% { color: var(--danger-color); transform: scale(1.1); }
                    100% { color: inherit; transform: scale(1); }
                }
            `;
            document.head.appendChild(style);
        }
        
        // Create toast element
        const toast = document.createElement('div');
        toast.className = `toast ${type}`;
        
        // Set icon based on type
        let icon;
        switch (type) {
            case 'success':
                icon = 'fas fa-check-circle';
                break;
            case 'error':
                icon = 'fas fa-times-circle';
                break;
            case 'warning':
                icon = 'fas fa-exclamation-triangle';
                break;
            default:
                icon = 'fas fa-info-circle';
        }
        
        // Set content
        toast.innerHTML = `<i class="${icon}"></i><span>${message}</span>`;
        
        // Add to container
        toastContainer.appendChild(toast);
        
        // Remove after 3 seconds
        setTimeout(() => {
            toast.style.animation = 'fadeOut 0.3s ease-out forwards';
            setTimeout(() => {
                toastContainer.removeChild(toast);
            }, 300);
        }, 3000);
    }
    
    // Add touch support for mobile devices
    function addTouchSupport() {
        // Add touch support for PIN inputs
        const addTouchToInputs = (inputs) => {
            inputs.forEach(input => {
                input.addEventListener('touchstart', function() {
                    this.focus();
                });
            });
        };
        
        addTouchToInputs(pinDigits);
        addTouchToInputs(pinConfirmDigits);
        addTouchToInputs(pinLoginDigits);
        
        // Fix iOS zoom on input focus
        const viewportMeta = document.querySelector('meta[name="viewport"]');
        if (viewportMeta) {
            viewportMeta.content = 'width=device-width, initial-scale=1, maximum-scale=1';
        } else {
            const meta = document.createElement('meta');
            meta.name = 'viewport';
            meta.content = 'width=device-width, initial-scale=1, maximum-scale=1';
            document.head.appendChild(meta);
        }
    }
    
    // Add mobile-specific enhancements
    function enhanceForMobile() {
        // Detect if device is mobile
        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        
        if (isMobile) {
            // Add touch support
            addTouchSupport();
            
            // Add tap highlight color for better feedback
            const style = document.createElement('style');
            style.textContent = `
                .pin-digit, .pin-confirm-digit, .pin-login-digit, 
                .wallet-btn, .copy-btn, .close-wallet {
                    -webkit-tap-highlight-color: rgba(0,0,0,0.1);
                }
                
                /* Fix for iOS input styling */
                input[type="password"], input[type="text"], input[type="email"] {
                    -webkit-appearance: none;
                    border-radius: 4px;
                }
                
                /* Improve touch targets */
                .wallet-btn, .copy-btn, .close-wallet {
                    min-height: 44px;
                }
                
                /* Fix for iOS modal positioning */
                .wallet-modal {
                    position: fixed;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    -webkit-overflow-scrolling: touch;
                }
                
                /* Fix for iOS scrolling */
                .wallet-container {
                    max-height: 85vh;
                    overflow-y: auto;
                    -webkit-overflow-scrolling: touch;
                }
                
                /* Add active state for buttons */
                .wallet-btn.active, .copy-btn.active, .close-wallet.active {
                    opacity: 0.8;
                    transform: scale(0.98);
                }
            `;
            document.head.appendChild(style);
            
            // Add active state for buttons
            const buttons = document.querySelectorAll('.wallet-btn, .copy-btn, .close-wallet');
            buttons.forEach(button => {
                button.addEventListener('touchstart', function() {
                    this.classList.add('active');
                });
                
                button.addEventListener('touchend', function() {
                    this.classList.remove('active');
                });
                
                button.addEventListener('touchcancel', function() {
                    this.classList.remove('active');
                });
            });
            
            // Fix for iOS body scrolling when modal is open
            document.addEventListener('touchmove', function(e) {
                if (document.body.classList.contains('modal-open')) {
                    if (!e.target.closest('.wallet-container')) {
                        e.preventDefault();
                    }
                }
            }, { passive: false });
        }
    }
    
    // Call mobile enhancements
    enhanceForMobile();
    
    // Listen for auth state changes
    firebase.auth().onAuthStateChanged(function(user) {
        if (user) {
            // User is signed in, enable wallet button
            if (walletBtn) walletBtn.classList.remove('disabled');
        } else {
            // User is signed out, disable wallet button
            if (walletBtn) walletBtn.classList.add('disabled');
            
            // Close wallet if open
            if (walletModal && walletModal.style.display === 'flex') {
                closeWallet();
            }
        }
    });
    
    // Add swipe to close functionality for mobile
    let touchStartY = 0;
    let touchEndY = 0;
    
    if (walletModal) {
        walletModal.addEventListener('touchstart', function(e) {
            touchStartY = e.changedTouches[0].screenY;
        }, false);
        
        walletModal.addEventListener('touchend', function(e) {
            touchEndY = e.changedTouches[0].screenY;
            handleSwipe();
        }, false);
    }
    
    function handleSwipe() {
        const swipeDistance = touchEndY - touchStartY;
        
        // If swiped down more than 100px, close the modal
        if (swipeDistance > 100) {
            closeWallet();
        }
    }
    
    // Add real-time updates for wallet balance
    function setupRealTimeUpdates() {
        const userId = getUserId();
        
        if (!userId) return;
        
        // Listen for wallet changes
        const unsubscribe = firebase.firestore()
            .collection('wallets')
            .doc(userId)
            .onSnapshot(doc => {
                if (doc.exists && walletDashboard && !walletDashboard.classList.contains('hidden')) {
                    const walletData = doc.data();
                    
                    // Update balances
                    const talentCoins = walletData.talentCoins || 0;
                    const pendingcoins = walletData.pendingCoins || 0;
                    const commission = walletData.commission || 0;
                    
                    // Update UI with animation
                    if (talentCoinBalance) animateValueChange(talentCoinBalance, talentCoins);
                    if (pendingCoinBalance) animateValueChange(pendingCoinBalance, walletData.pendingCoins || 0);
                    if (commissionBalance) animateValueChange(commissionBalance, commission);
                    
                    // Calculate Naira equivalent
                    const nairaValue = talentCoins * TALENT_COIN_RATE;
                    if (nairaEquivalent) animateValueChange(nairaEquivalent, nairaValue);
                }
            }, error => {
                console.error("Error listening to wallet updates:", error);
            });
        
        // Store unsubscribe function to clean up when wallet is closed
        if (walletModal) {
            walletModal.setAttribute('data-unsubscribe', 'true');
            // Store the unsubscribe function in a global variable
            window.walletUnsubscribe = unsubscribe;
        }
    }
    
    // Animate value change
    function animateValueChange(element, newValue) {
        if (!element) return;
        
        // Get current value
        const currentValue = parseFloat(element.textContent.replace(/,/g, '')) || 0;
        
        // If values are the same, do nothing
        if (currentValue === newValue) return;
        
        // Determine if increasing or decreasing
        const isIncreasing = newValue > currentValue;
        
        // Add class for animation
        element.classList.add(isIncreasing ? 'increasing' : 'decreasing');
        
        // Set new value
        element.textContent = formatNumber(newValue);
        
        // Remove animation class after animation completes
        setTimeout(() => {
            element.classList.remove('increasing', 'decreasing');
        }, 1000);
    }
    
    // Clean up when wallet is closed
    function cleanupWallet() {
        // Unsubscribe from real-time updates
        if (window.walletUnsubscribe && typeof window.walletUnsubscribe === 'function') {
            window.walletUnsubscribe();
            window.walletUnsubscribe = null;
        }
    }
});

// Wallet Tag Functionality
document.addEventListener('DOMContentLoaded', function() {
  // Variables to track state
  let walletTagChecked = false;
  
  // Function to check if user has wallet tag after PIN verification
  function checkWalletTagAfterPinVerification() {
    const userId = firebase.auth().currentUser?.uid;
    if (!userId) return;
    
    // Only check once per session
    if (walletTagChecked) return;
    walletTagChecked = true;
    
    firebase.firestore().collection('users').doc(userId).get()
      .then(doc => {
        if (doc.exists) {
          const userData = doc.data();
          if (!userData.walletTag) {
            // User doesn't have a wallet tag, show the modal
            document.getElementById('walletTagModal').style.display = 'block';
            document.getElementById('modalOverlay').style.display = 'block';
          } else {
            // User has a wallet tag, display it
            const tagDisplay = document.getElementById('walletTagDisplay');
            document.getElementById('tagText').textContent = '@' + userData.walletTag;
            tagDisplay.style.display = 'flex';
          }
        }
      })
      .catch(error => {
        console.error('Error checking wallet tag:', error);
      });
  }
  
  // Set up event listeners for wallet tag modal
  const modal = document.getElementById('walletTagModal');
  const closeBtn = modal.querySelector('.close-modal');
  const walletTagInput = document.getElementById('walletTagInput');
  const createTagBtn = document.getElementById('createTagBtn');
  const tagStatus = document.getElementById('tagStatus');
  const copyTagBtn = document.getElementById('copyTagBtn');
  const modalOverlay = document.getElementById('modalOverlay');
  
  // Close modal when clicking X (but only if user already has a tag)
  if (closeBtn) {
    closeBtn.addEventListener('click', function() {
      // Check if user already has a tag before allowing close
      const userId = firebase.auth().currentUser?.uid;
      if (!userId) return;
      
      firebase.firestore().collection('users').doc(userId).get()
        .then(doc => {
          if (doc.exists && doc.data().walletTag) {
            // User already has a tag, allow closing
            modal.style.display = 'none';
            modalOverlay.style.display = 'none';
          } else {
            // User doesn't have a tag, show message
            showToast('Please create a wallet tag to continue', 'warning');
          }
        })
        .catch(error => {
          console.error('Error checking wallet tag:', error);
        });
    });
  }
  
  // Check tag availability when typing
  if (walletTagInput) {
    walletTagInput.addEventListener('input', function() {
      // Convert to lowercase and remove invalid characters (only allow a-z, 0-9)
      this.value = this.value.toLowerCase().replace(/[^a-z0-9]/g, '');
      
      const tag = this.value.trim();
      
      // Validate tag format (4-10 characters, must contain at least one letter)
      if (tag.length < 4 || tag.length > 10) {
        tagStatus.textContent = 'Tag must be 4-10 characters long';
        tagStatus.className = 'tag-status error';
        createTagBtn.disabled = true;
        return;
      }
      
      // Check if tag contains at least one letter
      if (!/[a-z]/.test(tag)) {
        tagStatus.textContent = 'Tag must contain at least one letter';
        tagStatus.className = 'tag-status error';
        createTagBtn.disabled = true;
        return;
      }
      
      // Check availability after typing stops
      clearTimeout(this.timer);
      tagStatus.textContent = 'Checking availability...';
      tagStatus.className = 'tag-status checking';
      
      this.timer = setTimeout(() => {
        // Make sure we have a valid tag before checking
        if (!tag || tag.length < 4) {
          tagStatus.textContent = 'Please enter a valid tag';
          tagStatus.className = 'tag-status error';
          createTagBtn.disabled = true;
          return;
        }
        
        try {
          // Check if the walletTags collection exists first
          firebase.firestore().collection('walletTags').limit(1).get()
            .then(() => {
              // Collection exists, now check for the specific tag
              return firebase.firestore().collection('walletTags').doc(tag).get();
            })
            .then(doc => {
              if (doc.exists) {
                // Tag already exists
                tagStatus.textContent = 'Tag is already taken';
                tagStatus.className = 'tag-status error';
                createTagBtn.disabled = true;
              } else {
                // Tag is available
                tagStatus.textContent = 'Tag is available!';
                tagStatus.className = 'tag-status available';
                createTagBtn.disabled = false;
              }
            })
            .catch(error => {
              console.error('Error checking tag:', error);
              tagStatus.textContent = 'Error checking availability. Please try again.';
              tagStatus.className = 'tag-status error';
              createTagBtn.disabled = true;
            });
        } catch (error) {
          console.error('Exception during tag check:', error);
          tagStatus.textContent = 'Error checking availability. Please try again.';
          tagStatus.className = 'tag-status error';
          createTagBtn.disabled = true;
        }
      }, 500);
    });
  }
  
  // Create wallet tag
  if (createTagBtn) {
    createTagBtn.addEventListener('click', function() {
      const tag = walletTagInput.value.trim();
      if (!tag) return;
      
      // Validate tag format again
      if (tag.length < 4 || tag.length > 10 || !/[a-z]/.test(tag)) {
        tagStatus.textContent = 'Invalid tag format';
        tagStatus.className = 'tag-status error';
        return;
      }
      
      // Disable button and show loading
      this.disabled = true;
      this.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
      
      const userId = firebase.auth().currentUser?.uid;
      if (!userId) {
        tagStatus.textContent = 'Authentication error';
        tagStatus.className = 'tag-status error';
        this.disabled = false;
        this.textContent = 'Create Tag';
        return;
      }
      
      // Get user data to store with the tag
      firebase.firestore().collection('users').doc(userId).get()
        .then(doc => {
          if (!doc.exists) throw new Error('User profile not found');
          
          const userData = doc.data();
          
          // Create tag in walletTags collection with user info
          return firebase.firestore().collection('walletTags').doc(tag).set({
            tag: tag,
            userId: userId,
            username: userData.name || userData.displayName || 'User',
            email: userData.email || '',
            talentCoinBalance: userData.talentCoinBalance || 0,
            pendingCoinBalance: userData.pendingCoinBalance || 0,
            commissionBalance: userData.commissionBalance || 0,
            avatar: userData.photoURL || userData.avatar || '',
            createdAt: firebase.firestore.FieldValue.serverTimestamp()
          });
        })
        .then(() => {
          // Update user document with the wallet tag
          return firebase.firestore().collection('users').doc(userId).update({
            walletTag: tag
          });
        })
        .then(() => {
          // Hide modal and show tag display
          modal.style.display = 'none';
          modalOverlay.style.display = 'none';
          const tagDisplay = document.getElementById('walletTagDisplay');
          document.getElementById('tagText').textContent = '@' + tag;
          tagDisplay.style.display = 'flex';
          
          // Show success message
          showToast('Wallet tag created successfully!', 'success');
        })
        .catch(error => {
          console.error('Error creating tag:', error);
          tagStatus.textContent = 'Error creating tag: ' + error.message;
          tagStatus.className = 'tag-status error';
          this.disabled = false;
          this.textContent = 'Create Tag';
        });
    });
  }
  
  // Copy tag functionality
  if (copyTagBtn) {
    copyTagBtn.addEventListener('click', function() {
      const tagText = document.getElementById('tagText').textContent;
      navigator.clipboard.writeText(tagText)
        .then(() => {
          // Show copied notification
          const originalText = this.innerHTML;
          this.innerHTML = '<i class="fas fa-check"></i>';
          setTimeout(() => {
            this.innerHTML = originalText;
          }, 2000);
          
          showToast('Wallet tag copied to clipboard', 'success');
        })
        .catch(err => {
          console.error('Failed to copy:', err);
          showToast('Failed to copy wallet tag', 'error');
        });
    });
  }
  
  // Function to find user by wallet tag - basic version
  window.findUserByWalletTag = function(tag) {
    return new Promise((resolve, reject) => {
      if (!tag || typeof tag !== 'string') {
        reject(new Error('Invalid wallet tag format'));
        return;
      }
      
      // Remove @ symbol if present
      const cleanTag = tag.startsWith('@') ? tag.substring(1) : tag;
      
      // Check if tag exists directly by document ID
      firebase.firestore().collection('walletTags').doc(cleanTag).get()
        .then(doc => {
          if (!doc.exists) {
            reject(new Error('Wallet tag not found'));
            return;
          }
          
          // Get the tag data
          const tagData = doc.data();
          
          resolve({
            userId: tagData.userId,
            username: tagData.username || 'User',
            walletTag: tagData.tag
          });
        })
        .catch(error => {
          console.error('Error finding user by wallet tag:', error);
          reject(error);
        });
    });
  };
  
  // Hook into your existing PIN verification to check for wallet tag
  // This assumes you have a function that runs after successful PIN verification
  
  // Option 1: If you have a custom event for PIN verification
  document.addEventListener('pinVerified', function() {
    checkWalletTagAfterPinVerification();
  });
  
  // Option 2: Watch for wallet dashboard becoming visible
  const walletDashboardObserver = new MutationObserver(function(mutations) {
    mutations.forEach(function(mutation) {
      if (mutation.attributeName === 'style' || mutation.attributeName === 'class') {
        const walletDashboard = document.getElementById('walletDashboard');
        if (walletDashboard && 
            (walletDashboard.style.display === 'block' || 
             !walletDashboard.classList.contains('hidden'))) {
          checkWalletTagAfterPinVerification();
        }
      }
    });
  });
  
  const walletDashboard = document.getElementById('walletDashboard');
  if (walletDashboard) {
    walletDashboardObserver.observe(walletDashboard, { attributes: true });
  }
  
  // Helper function to show toast messages if not already defined
  if (typeof showToast !== 'function') {
    window.showToast = function(message, type = 'info') {
      console.log(`Toast (${type}): ${message}`);
      // You can implement a proper toast notification here
      // or use an existing one if available
    };
  }
});

// Custom Error Classes
class WalletError extends Error {
    constructor(message, code, recoverable = false, retryable = false) {
        super(message);
        this.name = 'WalletError';
        this.code = code;
        this.recoverable = recoverable;
        this.retryable = retryable;
        this.timestamp = new Date().toISOString();
    }
}

class NetworkError extends WalletError {
    constructor(message, originalError = null) {
        super(message, 'NETWORK_ERROR', true, true);
        this.name = 'NetworkError';
        this.originalError = originalError;
    }
}

class AuthenticationError extends WalletError {
    constructor(message) {
        super(message, 'AUTH_ERROR', true, false);
        this.name = 'AuthenticationError';
    }
}

class ValidationError extends WalletError {
    constructor(message, field = null) {
        super(message, 'VALIDATION_ERROR', true, false);
        this.name = 'ValidationError';
        this.field = field;
    }
}

// Retry Mechanism
class RetryManager {
    constructor() {
        this.defaultConfig = {
            maxRetries: 3,
            baseDelay: 1000, // 1 second
            maxDelay: 10000, // 10 seconds
            backoffMultiplier: 2,
            retryableErrors: ['NETWORK_ERROR', 'TIMEOUT_ERROR', 'SERVER_ERROR']
        };
    }

    async executeWithRetry(operation, config = {}) {
        const finalConfig = { ...this.defaultConfig, ...config };
        let lastError;
        
        for (let attempt = 0; attempt <= finalConfig.maxRetries; attempt++) {
            try {
                const result = await operation();
                
                // If we succeeded after retries, log the recovery
                if (attempt > 0) {
                    console.log(`Operation succeeded after ${attempt} retries`);
                    this.showRecoveryMessage(attempt);
                }
                
                return result;
            } catch (error) {
                lastError = error;
                
                // Check if error is retryable
                if (!this.isRetryableError(error, finalConfig.retryableErrors)) {
                    throw error;
                }
                
                // If this was the last attempt, throw the error
                if (attempt === finalConfig.maxRetries) {
                    throw new WalletError(
                        `Operation failed after ${finalConfig.maxRetries} retries: ${error.message}`,
                        'MAX_RETRIES_EXCEEDED',
                        false,
                        false
                    );
                }
                
                // Calculate delay with exponential backoff
                const delay = Math.min(
                    finalConfig.baseDelay * Math.pow(finalConfig.backoffMultiplier, attempt),
                    finalConfig.maxDelay
                );
                
                console.log(`Attempt ${attempt + 1} failed, retrying in ${delay}ms...`, error);
                this.showRetryMessage(attempt + 1, finalConfig.maxRetries, delay);
                
                await this.delay(delay);
            }
        }
        
        throw lastError;
    }

    isRetryableError(error, retryableErrors) {
        if (error instanceof WalletError) {
            return error.retryable && retryableErrors.includes(error.code);
        }
        
        // Check for common network errors
        if (error.code === 'unavailable' || 
            error.code === 'deadline-exceeded' ||
            error.message.includes('network') ||
            error.message.includes('timeout')) {
            return true;
        }
        
        return false;
    }

    delay(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
    }

    showRetryMessage(attempt, maxRetries, delay) {
        showToast(
            `Connection issue detected. Retrying... (${attempt}/${maxRetries})`,
            'warning',
            delay / 1000
        );
    }

    showRecoveryMessage(attempts) {
        showToast(
            `Connection restored after ${attempts} attempt${attempts > 1 ? 's' : ''}`,
            'success'
        );
    }
}

// Global retry manager instance
const retryManager = new RetryManager();

// Enhanced Error Handler
class ErrorHandler {
    constructor() {
        this.errorLog = [];
        this.maxLogSize = 100;
    }

    handle(error, context = '', showToUser = true) {
        // Log error
        this.logError(error, context);
        
        // Handle based on error type
        if (error instanceof ValidationError) {
            this.handleValidationError(error, showToUser);
        } else if (error instanceof AuthenticationError) {
            this.handleAuthError(error, showToUser);
        } else if (error instanceof NetworkError) {
            this.handleNetworkError(error, showToUser);
        } else if (error instanceof WalletError) {
            this.handleWalletError(error, showToUser);
        } else {
            this.handleUnknownError(error, context, showToUser);
        }
    }

    logError(error, context) {
        const errorEntry = {
            timestamp: new Date().toISOString(),
            error: {
                name: error.name,
                message: error.message,
                code: error.code || 'UNKNOWN',
                stack: error.stack
            },
            context,
            userAgent: navigator.userAgent,
            url: window.location.href
        };

        this.errorLog.push(errorEntry);
        
        // Keep log size manageable
        if (this.errorLog.length > this.maxLogSize) {
            this.errorLog.shift();
        }

        // Log to console in development
        if (window.location.hostname === 'localhost') {
            console.error('Wallet Error:', errorEntry);
        }
    }

    handleValidationError(error, showToUser) {
        if (showToUser) {
            showToast(error.message, 'error');
            
            // Focus on the problematic field if specified
            if (error.field) {
                const field = document.getElementById(error.field);
                if (field) {
                    field.focus();
                    field.classList.add('error');
                    setTimeout(() => field.classList.remove('error'), 3000);
                }
            }
        }
    }

    handleAuthError(error, showToUser) {
        if (showToUser) {
            showToast(error.message, 'error');
        }
        
        // Redirect to login if needed
        if (error.code === 'AUTH_REQUIRED') {
            setTimeout(() => {
                // Redirect to login page or show login modal
                window.location.href = '/login';
            }, 2000);
        }
    }

    handleNetworkError(error, showToUser) {
        if (showToUser) {
            showToast(
                'Network connection issue. Please check your internet connection.',
                'error',
                5
            );
        }
    }

    handleWalletError(error, showToUser) {
        if (showToUser) {
            if (error.recoverable) {
                showToast(error.message, 'warning');
                this.showRecoveryOptions(error);
            } else {
                showToast(error.message, 'error');
            }
        }
    }

    handleUnknownError(error, context, showToUser) {
        if (showToUser) {
            showToast(
                'An unexpected error occurred. Please try again.',
                'error'
            );
        }
        
        // Send error to monitoring service in production
        this.reportError(error, context);
    }

    showRecoveryOptions(error) {
        if (error.retryable) {
            // Show retry button
            const retryToast = this.createRetryToast(error);
            document.body.appendChild(retryToast);
        }
    }

    createRetryToast(error) {
        const toast = document.createElement('div');
        toast.className = 'toast retry-toast';
        toast.innerHTML = `
            <div class="toast-content">
                <i class="fas fa-exclamation-triangle"></i>
                <span>${error.message}</span>
                <button class="retry-btn" onclick="this.parentElement.parentElement.remove()">
                    <i class="fas fa-redo"></i> Retry
                </button>
            </div>
        `;
        
        return toast;
    }

    reportError(error, context) {
        // In production, send to error monitoring service
        // For now, just log to console
        console.error('Unhandled error:', { error, context });
    }

    getErrorLog() {
        return [...this.errorLog];
    }

    clearErrorLog() {
        this.errorLog = [];
    }
}

// Global error handler instance
const errorHandler = new ErrorHandler();


  

    
   document.addEventListener('DOMContentLoaded', function() {
    // Get the modal element
    const transactionHistoryModal = document.getElementById('transactionHistoryModal');
    
    // Get the buttons that open the modal
    const historyBtn = document.getElementById('historyBtn');
    const viewAllTransactionsBtn = document.getElementById('viewAllTransactionsBtn');
    
    // Get the close button
    const closeHistoryModal = document.getElementById('closeHistoryModal');
    
    // Function to open the modal
    function openTransactionModal() {
        transactionHistoryModal.style.display = 'block';
        document.body.style.overflow = 'hidden'; // Prevent scrolling of background
    }
    
    // Function to close the modal
    function closeTransactionModal() {
        transactionHistoryModal.style.display = 'none';
        document.body.style.overflow = ''; // Restore scrolling
    }
    
    // Event listeners for opening the modal
    historyBtn.addEventListener('click', openTransactionModal);
    viewAllTransactionsBtn.addEventListener('click', openTransactionModal);
    
    // Event listener for closing the modal
    closeHistoryModal.addEventListener('click', closeTransactionModal);
    
    // Close the modal when clicking outside of it
    window.addEventListener('click', function(event) {
        if (event.target === transactionHistoryModal) {
            closeTransactionModal();
        }
    });
    
    // Close modal with Escape key
    document.addEventListener('keydown', function(event) {
        if (event.key === 'Escape' && transactionHistoryModal.style.display === 'block') {
            closeTransactionModal();
        }
    });
});

     

document.addEventListener('DOMContentLoaded', function() {
    // Get the modal and button elements
    const buyCoinsModal = document.getElementById('buyCoinsModal');
    const buyCoinsBtn = document.getElementById('buycoinsBtn');
    const closeModalBtn = document.querySelector('.close-modal');
    
    // Open modal when the buy coins button is clicked
    buyCoinsBtn.addEventListener('click', function() {
        buyCoinsModal.style.display = 'block';
    });
    
    // Close modal when the close button is clicked
    closeModalBtn.addEventListener('click', function() {
        buyCoinsModal.style.display = 'none';
    });
    
    // Close modal when clicking outside the modal content
    window.addEventListener('click', function(event) {
        if (event.target === buyCoinsModal) {
            buyCoinsModal.style.display = 'none';
        }
    });
});

 // Mobile Modal Scroll Fix - Scrolling and Closing Only
function openBuyCoinsModal() {
  const modal = document.getElementById('buyCoinsModal');
  modal.style.display = 'block';
  
  // Scroll to top of modal
  modal.scrollTop = 0;
  
  // For mobile devices, prevent body scroll
  if (window.innerWidth <= 768) {
    document.body.style.overflow = 'hidden';
    document.body.style.position = 'fixed';
    document.body.style.width = '100%';
    document.body.style.top = `-${window.scrollY}px`;
  }
}

function closeBuyCoinsModal() {
  const modal = document.getElementById('buyCoinsModal');
  modal.style.display = 'none';
  
  // Restore body scroll on mobile
  if (window.innerWidth <= 768) {
    const scrollY = document.body.style.top;
    document.body.style.overflow = '';
    document.body.style.position = '';
    document.body.style.width = '';
    document.body.style.top = '';
    window.scrollTo(0, parseInt(scrollY || '0') * -1);
  }
}

document.addEventListener('DOMContentLoaded', function() {
  const modal = document.getElementById('buyCoinsModal');
  const modalContent = document.querySelector('.buyCoins-modal-content');
  
  if (modal && modalContent) {
    // Prevent modal from closing when touching content
    modalContent.addEventListener('touchstart', function(e) {
      e.stopPropagation();
    });
    
    modalContent.addEventListener('touchmove', function(e) {
      e.stopPropagation();
    });
    
    // Close modal when touching backdrop
    modal.addEventListener('touchstart', function(e) {
      if (e.target === modal) {
        closeBuyCoinsModal();
      }
    });
    
    // Close modal when clicking backdrop
    modal.addEventListener('click', function(e) {
      if (e.target === modal) {
        closeBuyCoinsModal();
      }
    });
    
    // Resize handler for orientation changes
    window.addEventListener('orientationchange', function() {
      setTimeout(function() {
        if (modal.style.display === 'block') {
          modal.scrollTop = 0;
        }
      }, 100);
    });
  }
  
  // Close button event listeners
  const closeButtons = document.querySelectorAll('.close-buycoins, #closeModalBtn');
  closeButtons.forEach(function(btn) {
    btn.addEventListener('click', closeBuyCoinsModal);
  });
});

// Handle escape key for closing
document.addEventListener('keydown', function(e) {
  if (e.key === 'Escape') {
    const modal = document.getElementById('buyCoinsModal');
    if (modal && modal.style.display === 'block') {
      closeBuyCoinsModal();
    }
  }
});

// Export functions for global use
window.openBuyCoinsModal = openBuyCoinsModal;
window.closeBuyCoinsModal = closeBuyCoinsModal;


document.addEventListener('DOMContentLoaded', function() {
    // DOM Elements
    const withdrawBtn = document.getElementById('withdrawBtn');
    const withdrawModal = document.getElementById('withdrawModal');
    const closeModalBtns = document.querySelectorAll('.close-modal');
    const pinDigits = document.querySelectorAll('.pin-digit');
    const verifyPinBtn = document.getElementById('verifyPinBtn');
    const pinError = document.getElementById('pinError');
    const pinVerificationScreen = document.getElementById('pinVerificationScreen');
    const withdrawFormScreen = document.getElementById('withdrawFormScreen');
    
    // Check if elements exist to prevent errors
    if (!withdrawBtn || !withdrawModal) {
        console.error('Withdraw button or modal not found in the DOM');
        return;
    }

    // Open modal when withdraw button is clicked
    withdrawBtn.addEventListener('click', function() {
        withdrawModal.style.display = 'flex';
        // Reset PIN inputs
        pinDigits.forEach(digit => digit.value = '');
        // Focus on first PIN input
        if (pinDigits.length > 0) {
            pinDigits[0].focus();
        }
    });
    
    // Close modal when close button is clicked
    closeModalBtns.forEach(btn => {
        btn.addEventListener('click', function() {
            withdrawModal.style.display = 'flex';
        });
    });
    
    // Close modal when clicking outside the modal content
    window.addEventListener('click', function(event) {
        if (event.target === withdrawModal) {
            withdrawModal.style.display = 'none';
        }
    });
    
    // PIN input handling - auto-focus next input
    pinDigits.forEach((digit, index) => {
        digit.addEventListener('input', function() {
            if (this.value.length === 1) {
                if (index < pinDigits.length - 1) {
                    pinDigits[index + 1].focus();
                }
            }
        });
        
        // Allow backspace to go to previous input
        digit.addEventListener('keydown', function(e) {
            if (e.key === 'Backspace' && this.value.length === 0 && index > 0) {
                pinDigits[index - 1].focus();
            }
        });
    });
    
    // Verify PIN
    verifyPinBtn.addEventListener('click', function() {
        const enteredPin = Array.from(pinDigits).map(input => input.value).join('');
        
        // Get the user's wallet PIN from Firebase
        const userId = firebase.auth().currentUser.uid;
        
        firebase.firestore().collection('users').doc(userId).get()
            .then(doc => {
                if (doc.exists) {
                    const userData = doc.data();
                    const storedPinHash = userData.walletPinHash;
                    
                    // Hash the entered PIN using the same method as in wallet dashboard
                    const enteredPinHash = hashPin(enteredPin);
                    
                    // Compare the hashed PINs
                    if (enteredPinHash === storedPinHash) {
                        // PIN is correct, show withdrawal form
                        pinVerificationScreen.style.display = 'none';
                        withdrawFormScreen.style.display = 'block';
                        pinError.textContent = '';
                    } else {
                        // PIN is incorrect
                        pinError.textContent = 'Invalid PIN. Please try again.';
                        pinDigits.forEach(digit => digit.value = '');
                        pinDigits[0].focus();
                    }
                } else {
                    pinError.textContent = 'User data not found. Please try again.';
                }
            })
            .catch(error => {
                console.error('Error verifying PIN:', error);
                pinError.textContent = 'Error verifying PIN. Please try again.';
            });
    });
    
    // Helper function to hash PIN (same as in wallet dashboard)
    function hashPin(pin) {
        // Simple hash for demonstration
        let hash = 0;
        for (let i = 0; i < pin.length; i++) {
            const char = pin.charCodeAt(i);
            hash = ((hash << 5) - hash) + char;
            hash = hash & hash; // Convert to 32bit integer
        }
        return hash.toString();
    }
});

// Mobile Modal Scroll Fix - Scrolling and Closing Only
function openWithdrawModal() {
  const modal = document.getElementById('withdrawModal');
  modal.style.display = 'block';
  
  // Scroll to top of modal
  modal.scrollTop = 0;
  
  // For mobile devices, prevent body scroll
  if (window.innerWidth <= 768) {
    document.body.style.overflow = 'hidden';
    document.body.style.position = 'fixed';
    document.body.style.width = '100%';
    document.body.style.top = `-${window.scrollY}px`;
  }
}

function closeWithdrawModal() {
  const modal = document.getElementById('withdrawModal');
  modal.style.display = 'none';
  
  // Restore body scroll on mobile
  if (window.innerWidth <= 768) {
    const scrollY = document.body.style.top;
    document.body.style.overflow = '';
    document.body.style.position = '';
    document.body.style.width = '';
    document.body.style.top = '';
    window.scrollTo(0, parseInt(scrollY || '0') * -1);
  }
}

document.addEventListener('DOMContentLoaded', function() {
  const modal = document.getElementById('withdrawModal');
  const modalContent = document.querySelector('.withdraw-modal-content');
  
  if (modal && modalContent) {
    // Prevent modal from closing when touching content
    modalContent.addEventListener('touchstart', function(e) {
      e.stopPropagation();
    });
    
    modalContent.addEventListener('touchmove', function(e) {
      e.stopPropagation();
    });
    
    // Close modal when touching backdrop
    modal.addEventListener('touchstart', function(e) {
      if (e.target === modal) {
        closeWithdrawModal();
      }
    });
    
    // Close modal when clicking backdrop
    modal.addEventListener('click', function(e) {
      if (e.target === modal) {
        closeWithdrawModal();
      }
    });
    
    // Resize handler for orientation changes
    window.addEventListener('orientationchange', function() {
      setTimeout(function() {
        if (modal.style.display === 'block') {
          modal.scrollTop = 0;
        }
      }, 100);
    });
  }
  
  // Close button event listeners
  const closeButtons = document.querySelectorAll('.close-withdraw-modal, .close-modal, #closewithdrawmodal, #closewithdrawformscreen');
  closeButtons.forEach(function(btn) {
    btn.addEventListener('click', closeWithdrawModal);
  });
});

// Physical Events Auto-Loading System
document.addEventListener('DOMContentLoaded', function() {
    loadPhysicalEventsDisplay();
});

async function loadPhysicalEventsDisplay() {
    const container = document.querySelector('.events-scroll-wrapper');
    if (!container) return;

    try {
        // Show loading state
        container.innerHTML = `
            <div class="loading-events-display">
                <i class="fas fa-spinner fa-spin"></i>
                <p>Loading physical events...</p>
            </div>
        `;

        // Check if Firebase is initialized
        if (typeof firebase === 'undefined') {
            throw new Error('Firebase is not initialized');
        }

        const db = firebase.firestore();
        
        // Get all physical events and calculate ticket sales
        let allEventsSnapshot;
        try {
            allEventsSnapshot = await db.collection('physicalEvents').get();
        } catch (error) {
            console.log('Error fetching events:', error);
            throw error;
        }

        // Clear loading state
        container.innerHTML = '';

        if (allEventsSnapshot.empty) {
            container.innerHTML = `
                <div class="no-events-display">
                    <i class="fas fa-calendar-alt"></i>
                    <h3>No Events Available</h3>
                    <p>Be the first to create a physical event!</p>
                </div>
            `;
            return;
        }

        // Convert Firebase events to array and calculate ticket sales
        let events = [];
        allEventsSnapshot.forEach((doc) => {
            const eventData = { ...doc.data(), id: doc.id };
            
            // Check if event should be included
            let shouldInclude = false;
            const now = new Date();
            
            // Always include TBA events
            if (eventData.isTBA === true || 
                eventData.schedulingStatus === 'TBA' || 
                eventData.startDateTime === 'TBA' ||
                eventData.endDateTime === 'TBA') {
                
                shouldInclude = true;
                console.log('Including TBA event:', eventData.eventName);
                
            } else {
                // For scheduled events, check if they haven't passed 2 days
                try {
                    const eventDate = new Date(eventData.startDateTime);
                    
                    // Validate that we got a valid date
                    if (!isNaN(eventDate.getTime())) {
                        const twoDaysAfterEvent = new Date(eventDate.getTime() + (2 * 24 * 60 * 60 * 1000));
                        shouldInclude = now <= twoDaysAfterEvent;
                        
                        if (!shouldInclude) {
                            console.log('Excluding past event:', eventData.eventName, 'Event date:', eventDate);
                        }
                    } else {
                        // If date parsing failed, might be TBA or malformed - include it
                        console.log('Including event with invalid date (might be TBA):', eventData.eventName);
                        shouldInclude = true;
                    }
                } catch (dateError) {
                    // If date parsing throws error, include the event (might be TBA)
                    console.log('Date parsing error for event:', eventData.eventName, dateError);
                    shouldInclude = true;
                }
            }
            
            if (shouldInclude) {
                // Debug: Log the first event data to see structure
                if (events.length === 0) {
                    console.log('First event data structure:', eventData);
                    console.log('Background data:', eventData.background);
                    console.log('Is TBA:', eventData.isTBA);
                    console.log('Scheduling status:', eventData.schedulingStatus);
                }
                
                // Calculate total tickets sold
                let ticketsSold = 0;
                if (eventData.tickets && Array.isArray(eventData.tickets)) {
                    ticketsSold = eventData.tickets.reduce((total, ticket) => {
                        return total + (ticket.sold || 0);
                    }, 0);
                }
                
                eventData.totalTicketsSold = ticketsSold;
                
                // Handle createdAt for sorting (support both Firestore timestamp and ISO string)
                if (eventData.createdAt) {
                    if (eventData.createdAt.seconds) {
                        // Firestore timestamp
                        eventData.createdAtTime = new Date(eventData.createdAt.seconds * 1000);
                    } else if (typeof eventData.createdAt === 'string') {
                        // ISO string
                        eventData.createdAtTime = new Date(eventData.createdAt);
                    } else {
                        eventData.createdAtTime = new Date();
                    }
                } else {
                    eventData.createdAtTime = new Date();
                }
                
                events.push(eventData);
            }
        });

        // Sort by ticket sales first, then by creation date, but prioritize TBA events
        events.sort((a, b) => {
            const aIsTBA = a.isTBA === true || a.schedulingStatus === 'TBA' || a.startDateTime === 'TBA';
            const bIsTBA = b.isTBA === true || b.schedulingStatus === 'TBA' || b.startDateTime === 'TBA';
            
            // TBA events get slight priority (appear mixed in but slightly boosted)
            if (aIsTBA && !bIsTBA) {
                return -0.5; // Slight priority to TBA
            } else if (!aIsTBA && bIsTBA) {
                return 0.5;
            }
            
            // Both are TBA or both are scheduled - sort by tickets sold first
            if (b.totalTicketsSold !== a.totalTicketsSold) {
                return b.totalTicketsSold - a.totalTicketsSold; // Most sold first
            }
            
            // Then by creation date
            return b.createdAtTime - a.createdAtTime; // Most recent first
        });

        // Take top 15 events
        const topEvents = events.slice(0, 15);

        console.log(`Loaded ${topEvents.length} trending physical events (including TBA events)`);

        // Create cards with ads every 4th position
        let cardCount = 0;
        topEvents.forEach((eventData, index) => {
            if ((cardCount + 1) % 4 === 0 && cardCount < 12) {
                // Every 4th position gets an ad card
                const adCard = createAdvancedAdCard(cardCount);
                container.appendChild(adCard);
                cardCount++;
            }
            
            const eventCard = createAdvancedPhysicalEventCard(eventData);
            container.appendChild(eventCard);
            cardCount++;
        });

        // Fill remaining slots with ads if needed
        while (cardCount < 15) {
            const adCard = createAdvancedAdCard(cardCount);
            container.appendChild(adCard);
            cardCount++;
        }

        // If we have fewer than 12 events, fill remaining slots with sample data
        if (events.length < 12) {
            const sampleEvents = [
                {
                    id: 'sample_1',
                    eventName: "Summer Music Festival 2024",
                    category: "Music",
                    location: "Central Park, Lagos",
                    startDateTime: "2024-08-15T18:00",
                    background: { type: 'gradient', value: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)' },
                    sponsors: [{ name: "Coca-Cola" }, { name: "MTN" }, { name: "First Bank" }],
                    tickets: [{ price: 5000, currency: '' }]
                }
            ];

            let eventIndex = 0; // Fix the missing variable declaration
            while (cardCount < 15 && eventIndex < 12) {
                if ((cardCount + 1) % 4 === 0) {
                    const adCard = createAdvancedAdCard(cardCount);
                    container.appendChild(adCard);
                } else {
                    const sampleEventData = { ...sampleEvents[0] }; // Create a copy
                    sampleEventData.id = `sample_${eventIndex + 1}`;
                    sampleEventData.eventName = `Sample Event ${eventIndex + 1}`;
                    const eventCard = createAdvancedPhysicalEventCard(sampleEventData);
                    container.appendChild(eventCard);
                    eventIndex++;
                }
                cardCount++;
            }
        }

    } catch (error) {
        console.error('Error loading physical events for display:', error);
        container.innerHTML = `
            <div class="error-events-display">
                <i class="fas fa-exclamation-triangle"></i>
                <h3>Error Loading Events</h3>
                <p>Unable to load events. Please try again.</p>
                <button onclick="loadPhysicalEventsDisplay()" class="retry-btn">Retry</button>
            </div>
        `;
    }
}
// Add this helper function to properly format event dates and handle TBA
function formatEventDateTime(eventData) {
    // Check if event is TBA
    if (eventData.isTBA === true || 
        eventData.schedulingStatus === 'TBA' || 
        eventData.startDateTime === 'TBA' ||
        eventData.endDateTime === 'TBA') {
        return {
            date: 'TBA',
            time: 'TBA',
            dateTime: 'TBA',
            isTBA: true
        };
    }
    
    try {
        // Try to parse the date
        const startDate = new Date(eventData.startDateTime);
        const endDate = new Date(eventData.endDateTime);
        
        // Check if dates are valid
        if (isNaN(startDate.getTime()) || isNaN(endDate.getTime())) {
            return {
                date: 'TBA',
                time: 'TBA',
                dateTime: 'TBA',
                isTBA: true
            };
        }
        
        // Format the dates
        const dateOptions = { 
            year: 'numeric', 
            month: 'short', 
            day: 'numeric' 
        };
        const timeOptions = { 
            hour: '2-digit', 
            minute: '2-digit',
            hour12: true 
        };
        
        const formattedDate = startDate.toLocaleDateString('en-US', dateOptions);
        const formattedTime = startDate.toLocaleTimeString('en-US', timeOptions);
        
        // Check if it's a single day event or multi-day
        const isSameDay = startDate.toDateString() === endDate.toDateString();
        
        if (isSameDay) {
            const endTime = endDate.toLocaleTimeString('en-US', timeOptions);
            return {
                date: formattedDate,
                time: `${formattedTime} - ${endTime}`,
                dateTime: `${formattedDate} ${formattedTime} - ${endTime}`,
                isTBA: false
            };
        } else {
            const endFormattedDate = endDate.toLocaleDateString('en-US', dateOptions);
            const endFormattedTime = endDate.toLocaleTimeString('en-US', timeOptions);
            return {
                date: `${formattedDate} - ${endFormattedDate}`,
                time: `${formattedTime} - ${endFormattedTime}`,
                dateTime: `${formattedDate} ${formattedTime} - ${endFormattedDate} ${endFormattedTime}`,
                isTBA: false
            };
        }
        
    } catch (error) {
        console.log('Error formatting date for event:', eventData.eventName, error);
        return {
            date: 'TBA',
            time: 'TBA',
            dateTime: 'TBA',
            isTBA: true
        };
    }
}


function showAllEvents() {
    openSeePhyMoreEventModal();
}

function openSeePhyMoreEventModal() {
    // Create modal if it doesn't exist
    if (!document.getElementById('seePhyMoreEventModal')) {
        const modal = document.createElement('div');
        modal.id = 'seePhyMoreEventModal';
        modal.innerHTML = `
            <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: flex; justify-content: center; align-items: center; z-index: 10000; padding: 20px;">
                <div style="background: white; border-radius: 20px; padding: 40px; max-width: 800px; width: 100%; max-height: 90vh; overflow-y: auto; position: relative; box-shadow: 0 25px 50px rgba(0,0,0,0.3);">
                    <button onclick="closeSeePhyMoreEventModal()" style="position: absolute; top: 20px; right: 20px; background: none; border: none; font-size: 28px; cursor: pointer; color: #666; width: 45px; height: 45px; border-radius: 50%; display: flex; align-items: center; justify-content: center; transition: all 0.3s ease;">
                        <i class="fas fa-times"></i>
                    </button>
                    
                    <div style="text-align: center; margin-bottom: 35px;">
                        <i class="fas fa-calendar-star" style="font-size: 56px; color: #1a1a2e; margin-bottom: 20px;"></i>
                        <h2 style="margin: 0 0 12px 0; color: #1a1a2e; font-size: 28px; font-weight: 700;">Explore Event Categories</h2>
                        <p style="color: #666; margin: 0; font-size: 16px;">Discover amazing events in your favorite categories</p>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; margin-bottom: 30px;">
                        <button onclick="filterEventsByCategory('singing')" style="background: #1a1a2e; color: white; border: none; padding: 20px 15px; border-radius: 12px; cursor: pointer; font-weight: 600; font-size: 14px; transition: all 0.3s ease; display: flex; flex-direction: column; align-items: center; gap: 8px; text-align: center;">
                            <i class="fas fa-microphone" style="font-size: 24px;"></i> Singing
                        </button>
                        <button onclick="filterEventsByCategory('music')" style="background: #1a1a2e; color: white; border: none; padding: 20px 15px; border-radius: 12px; cursor: pointer; font-weight: 600; font-size: 14px; transition: all 0.3s ease; display: flex; flex-direction: column; align-items: center; gap: 8px; text-align: center;">
                            <i class="fas fa-music" style="font-size: 24px;"></i> Music
                        </button>
                        <button onclick="filterEventsByCategory('dance')" style="background: #1a1a2e; color: white; border: none; padding: 20px 15px; border-radius: 12px; cursor: pointer; font-weight: 600; font-size: 14px; transition: all 0.3s ease; display: flex; flex-direction: column; align-items: center; gap: 8px; text-align: center;">
                            <i class="fas fa-dancing" style="font-size: 24px;"></i> Dance
                        </button>
                        <button onclick="filterEventsByCategory('theater')" style="background: #1a1a2e; color: white; border: none; padding: 20px 15px; border-radius: 12px; cursor: pointer; font-weight: 600; font-size: 14px; transition: all 0.3s ease; display: flex; flex-direction: column; align-items: center; gap: 8px; text-align: center;">
                            <i class="fas fa-theater-masks" style="font-size: 24px;"></i> Theater
                        </button>
                        <button onclick="filterEventsByCategory('comedy')" style="background: #1a1a2e; color: white; border: none; padding: 20px 15px; border-radius: 12px; cursor: pointer; font-weight: 600; font-size: 14px; transition: all 0.3s ease; display: flex; flex-direction: column; align-items: center; gap: 8px; text-align: center;">
                            <i class="fas fa-laugh" style="font-size: 24px;"></i> Comedy
                        </button>
                        <button onclick="filterEventsByCategory('art_exhibition')" style="background: #1a1a2e; color: white; border: none; padding: 20px 15px; border-radius: 12px; cursor: pointer; font-weight: 600; font-size: 14px; transition: all 0.3s ease; display: flex; flex-direction: column; align-items: center; gap: 8px; text-align: center;">
                            <i class="fas fa-palette" style="font-size: 24px;"></i> Art Exhibition
                        </button>
                        <button onclick="filterEventsByCategory('fashion_show')" style="background: #1a1a2e; color: white; border: none; padding: 20px 15px; border-radius: 12px; cursor: pointer; font-weight: 600; font-size: 14px; transition: all 0.3s ease; display: flex; flex-direction: column; align-items: center; gap: 8px; text-align: center;">
                            <i class="fas fa-tshirt" style="font-size: 24px;"></i> Fashion Show
                        </button>
                        <button onclick="filterEventsByCategory('sport_event')" style="background: #1a1a2e; color: white; border: none; padding: 20px 15px; border-radius: 12px; cursor: pointer; font-weight: 600; font-size: 14px; transition: all 0.3s ease; display: flex; flex-direction: column; align-items: center; gap: 8px; text-align: center;">
                            <i class="fas fa-running" style="font-size: 24px;"></i> Sport Event
                        </button>
                        <button onclick="filterEventsByCategory('conference')" style="background: #1a1a2e; color: white; border: none; padding: 20px 15px; border-radius: 12px; cursor: pointer; font-weight: 600; font-size: 14px; transition: all 0.3s ease; display: flex; flex-direction: column; align-items: center; gap: 8px; text-align: center;">
                            <i class="fas fa-users" style="font-size: 24px;"></i> Conference
                        </button>
                        <button onclick="filterEventsByCategory('workshop')" style="background: #1a1a2e; color: white; border: none; padding: 20px 15px; border-radius: 12px; cursor: pointer; font-weight: 600; font-size: 14px; transition: all 0.3s ease; display: flex; flex-direction: column; align-items: center; gap: 8px; text-align: center;">
                            <i class="fas fa-tools" style="font-size: 24px;"></i> Workshop
                        </button>
                        <button onclick="filterEventsByCategory('food_drinks')" style="background: #1a1a2e; color: white; border: none; padding: 20px 15px; border-radius: 12px; cursor: pointer; font-weight: 600; font-size: 14px; transition: all 0.3s ease; display: flex; flex-direction: column; align-items: center; gap: 8px; text-align: center;">
                            <i class="fas fa-utensils" style="font-size: 24px;"></i> Food & Drinks
                        </button>
                        <button onclick="filterEventsByCategory('networking')" style="background: #1a1a2e; color: white; border: none; padding: 20px 15px; border-radius: 12px; cursor: pointer; font-weight: 600; font-size: 14px; transition: all 0.3s ease; display: flex; flex-direction: column; align-items: center; gap: 8px; text-align: center;">
                            <i class="fas fa-handshake" style="font-size: 24px;"></i> Networking
                        </button>
                        <button onclick="filterEventsByCategory('festival')" style="background: #1a1a2e; color: white; border: none; padding: 20px 15px; border-radius: 12px; cursor: pointer; font-weight: 600; font-size: 14px; transition: all 0.3s ease; display: flex; flex-direction: column; align-items: center; gap: 8px; text-align: center;">
                            <i class="fas fa-flag" style="font-size: 24px;"></i> Festival
                        </button>
                        <button onclick="filterEventsByCategory('trade_fair')" style="background: #1a1a2e; color: white; border: none; padding: 20px 15px; border-radius: 12px; cursor: pointer; font-weight: 600; font-size: 14px; transition: all 0.3s ease; display: flex; flex-direction: column; align-items: center; gap: 8px; text-align: center;">
                            <i class="fas fa-store" style="font-size: 24px;"></i> Trade Fair
                        </button>
                        <button onclick="filterEventsByCategory('summit')" style="background: #1a1a2e; color: white; border: none; padding: 20px 15px; border-radius: 12px; cursor: pointer; font-weight: 600; font-size: 14px; transition: all 0.3s ease; display: flex; flex-direction: column; align-items: center; gap: 8px; text-align: center;">
                            <i class="fas fa-mountain" style="font-size: 24px;"></i> Summit
                        </button>
                        <button onclick="filterEventsByCategory('tech_event')" style="background: #1a1a2e; color: white; border: none; padding: 20px 15px; border-radius: 12px; cursor: pointer; font-weight: 600; font-size: 14px; transition: all 0.3s ease; display: flex; flex-direction: column; align-items: center; gap: 8px; text-align: center;">
                            <i class="fas fa-laptop-code" style="font-size: 24px;"></i> Tech Event
                        </button>
                        <button onclick="filterEventsByCategory('business_event')" style="background: #1a1a2e; color: white; border: none; padding: 20px 15px; border-radius: 12px; cursor: pointer; font-weight: 600; font-size: 14px; transition: all 0.3s ease; display: flex; flex-direction: column; align-items: center; gap: 8px; text-align: center;">
                            <i class="fas fa-briefcase" style="font-size: 24px;"></i> Business Event
                        </button>
                        <button onclick="filterEventsByCategory('product_launch')" style="background: #1a1a2e; color: white; border: none; padding: 20px 15px; border-radius: 12px; cursor: pointer; font-weight: 600; font-size: 14px; transition: all 0.3s ease; display: flex; flex-direction: column; align-items: center; gap: 8px; text-align: center;">
                            <i class="fas fa-rocket" style="font-size: 24px;"></i> Product Launch
                        </button>
                        <button onclick="filterEventsByCategory('christmas_event')" style="background: #1a1a2e; color: white; border: none; padding: 20px 15px; border-radius: 12px; cursor: pointer; font-weight: 600; font-size: 14px; transition: all 0.3s ease; display: flex; flex-direction: column; align-items: center; gap: 8px; text-align: center;">
                            <i class="fas fa-tree" style="font-size: 24px;"></i> Christmas Event
                        </button>
                        <button onclick="filterEventsByCategory('all')" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 20px 15px; border-radius: 12px; cursor: pointer; font-weight: 600; font-size: 14px; transition: all 0.3s ease; display: flex; flex-direction: column; align-items: center; gap: 8px; text-align: center; grid-column: span 2;">
                            <i class="fas fa-calendar-check" style="font-size: 24px;"></i> All Events
                        </button>
                    </div>
                </div>
            </div>
        `;
        document.body.appendChild(modal);
        
        // Add hover effects with CSS
        const style = document.createElement('style');
        style.textContent = `
            #seePhyMoreEventModal button:hover {
                transform: translateY(-3px) !important;
                box-shadow: 0 8px 25px rgba(26, 26, 46, 0.3) !important;
                background: #2a2a4a !important;
            }
            #seePhyMoreEventModal button:active {
                transform: translateY(-1px) !important;
            }
            #seePhyMoreEventModal button:last-child:hover {
                background: linear-gradient(135deg, #764ba2 0%, #667eea 100%) !important;
            }
        `;
        document.head.appendChild(style);
    }
    
    // Show modal
    const modal = document.getElementById('seePhyMoreEventModal');
    modal.style.display = 'block';
    modal.querySelector('div').style.display = 'flex';
}

function closeSeePhyMoreEventModal() {
    const modal = document.getElementById('seePhyMoreEventModal');
    modal.style.display = 'none';
    modal.querySelector('div').style.display = 'none';
}

function filterEventsByCategory(category) {
    try {
        // Close modal first
        closeSeePhyMoreEventModal();
        
        // Open phycategories page
        openPhyCategoriesPage(category);
    } catch (error) {
        console.error('Error in filterEventsByCategory:', error);
        alert('Opening category: ' + category);
    }
}

function openPhyCategoriesPage(category) {
    // Hide main app container
    document.getElementById('mainAppContainer').style.display = 'none';
    
    // Create phycategories page if it doesn't exist
    if (!document.getElementById('phyCategoriesPage')) {
        const page = document.createElement('div');
        page.id = 'phyCategoriesPage';
        page.innerHTML = `
            <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #1a1a2e; color: white; z-index: 9999; overflow-y: auto;">
                <div style="padding: 20px;">
                    <!-- Header with back button -->
                    <div style="display: flex; align-items: center; margin-bottom: 20px;">
                        <button onclick="closePhyCategoriesPage()" style="background: none; border: none; color: white; font-size: 24px; cursor: pointer; margin-right: 15px;">
                            <i class="fas fa-arrow-left"></i>
                        </button>
                        <h2 id="categoryTitle" style="margin: 0; font-size: 24px; font-weight: 700;">Category Events</h2>
                    </div>
                    
                    <!-- Scrollable Banner Ads -->
                    <div style="overflow-x: auto; white-space: nowrap; margin-bottom: 30px; padding: 10px 0;">
                        <div style="display: inline-flex; gap: 15px;">
                            <div style="min-width: 300px; height: 120px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 12px; display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 16px;">
                                 Featured Event Promotion
                            </div>
                            <div style="min-width: 300px; height: 120px; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); border-radius: 12px; display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 16px;">
                                 Special Ticket Offers
                            </div>
                            <div style="min-width: 300px; height: 120px; background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); border-radius: 12px; display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 16px;">
                                 Trending Events
                            </div>
                            <div style="min-width: 300px; height: 120px; background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); border-radius: 12px; display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 16px;">
                                 Secure Payments
                            </div>
                        </div>
                    </div>
                    
                    <!-- Events Container -->
                    <div id="phyCategoryEventsContainer" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px;">
                        <!-- Events will be loaded here -->
                    </div>
                    
                    <style>
                        @media (max-width: 768px) {
                            #phyCategoryEventsContainer {
                                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)) !important;
                                gap: 15px !important;
                            }
                        }
                        @media (max-width: 480px) {
                            #phyCategoryEventsContainer {
                                grid-template-columns: 1fr !important;
                                gap: 15px !important;
                            }
                        }
                    </style>
                </div>
            </div>
        `;
        document.body.appendChild(page);
    }
    
    // Show the page
    document.getElementById('phyCategoriesPage').style.display = 'block';
    
    // Update category title
    const categoryName = category === 'all' ? 'All Events' : category.replace('_', ' ').replace(/\b\w/g, l => l.toUpperCase());
    document.getElementById('categoryTitle').textContent = categoryName;
    
    // Load events for this category
    loadPhyCategoryEvents(category);
}

function closePhyCategoriesPage() {
    document.getElementById('phyCategoriesPage').style.display = 'none';
    document.getElementById('mainAppContainer').style.display = 'block';
}

async function loadPhyCategoryEvents(category) {
    const container = document.getElementById('phyCategoryEventsContainer');
    
    try {
        // Show loading
        container.innerHTML = `
            <div style="grid-column: 1 / -1; text-align: center; padding: 40px;">
                <i class="fas fa-spinner fa-spin" style="font-size: 32px; margin-bottom: 15px;"></i>
                <p style="font-size: 18px;">Loading events...</p>
            </div>
        `;
        
        const db = firebase.firestore();
        let query = db.collection('physicalEvents');
        
        // Filter by category if not 'all'
        if (category !== 'all') {
            query = query.where('category', '==', category);
        }
        
        const snapshot = await query.get();
        
        // Clear loading
        container.innerHTML = '';
        
        if (snapshot.empty) {
            container.innerHTML = `
                <div style="grid-column: 1 / -1; text-align: center; padding: 40px;">
                    <i class="fas fa-calendar-times" style="font-size: 48px; margin-bottom: 15px; color: #666;"></i>
                    <p style="font-size: 18px; color: #666;">No events found in this category</p>
                </div>
            `;
            return;
        }
        
        let eventCount = 0;
        snapshot.forEach((doc) => {
            const eventData = { ...doc.data(), id: doc.id };
            
            // Check if event hasn't passed 2 days
            const now = new Date();
            const eventDate = new Date(eventData.startDateTime);
            const twoDaysAfterEvent = new Date(eventDate.getTime() + (2 * 24 * 60 * 60 * 1000));
            
            // Only show events that haven't passed 2 days
            if (now <= twoDaysAfterEvent) {
                // Add ads banner after every 3 events
                if (eventCount > 0 && eventCount % 3 === 0) {
                    const adBanner = createPhyCategoryAdBanner(eventCount);
                    container.appendChild(adBanner);
                }
                
                const eventCard = createPhyCategoryCard(eventData);
                container.appendChild(eventCard);
                eventCount++;
            }
        });
        
    } catch (error) {
        console.error('Error loading category events:', error);
        container.innerHTML = `
            <div style="grid-column: 1 / -1; text-align: center; padding: 40px;">
                <i class="fas fa-exclamation-triangle" style="font-size: 48px; margin-bottom: 15px; color: #e74c3c;"></i>
                <p style="font-size: 18px; color: #e74c3c;">Error loading events</p>
                <button onclick="loadPhyCategoryEvents('${category}')" style="background: #6c5ce7; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; margin-top: 15px;">
                    Try Again
                </button>
            </div>
        `;
    }
}

function createPhyCategoryCard(eventData) {
    const card = document.createElement('div');
    card.className = 'phy-category-card';
    
    const eventName = eventData.eventName || 'Untitled Event';
    const likesCount = eventData.likesCount || 0;
    const currentUser = firebase.auth().currentUser;
    const userLiked = eventData.likedBy && currentUser ? eventData.likedBy.includes(currentUser.uid) : false;
    
    // Check if event has ended (passed the event date)
    const now = new Date();
    const eventDate = new Date(eventData.startDateTime);
    const hasEnded = now > eventDate;
    
    // Handle background
    let backgroundStyle = 'background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);';
    if (eventData.background) {
        switch (eventData.background.type) {
            case 'media':
                backgroundStyle = `background-image: url('${eventData.background.data}'); background-size: cover; background-position: center;`;
                break;
            case 'gradient':
                backgroundStyle = `background: ${eventData.background.gradient};`;
                break;
            case 'color':
                backgroundStyle = `background-color: ${eventData.background.color};`;
                break;
        }
    }
    
    card.innerHTML = `
        <div style="background: #2a2a4a; border-radius: 15px; overflow: hidden; transition: all 0.3s ease; cursor: pointer; min-height: 240px; position: relative; display: flex; flex-direction: column;">
            <div style="${backgroundStyle} height: 160px; flex-shrink: 0; position: relative;">
                <div style="position: absolute; top: 12px; right: 12px; background: rgba(0,0,0,0.7); border-radius: 25px; padding: 10px 15px; display: flex; align-items: center; gap: 10px; backdrop-filter: blur(5px);">
                    <button onclick="togglePhyCategoryEventLike('${eventData.id}')" style="background: none; border: none; color: ${userLiked ? '#e74c3c' : '#fff'}; cursor: pointer; font-size: 18px; padding: 0; display: flex; align-items: center;">
                        <i class="${userLiked ? 'fas' : 'far'} fa-heart" id="phy-heart-${eventData.id}"></i>
                    </button>
                    <span style="color: white; font-size: 14px; font-weight: 600;" id="phy-likes-${eventData.id}">${likesCount}</span>
                </div>
            </div>
            <div style="padding: 18px; flex: 1; display: flex; flex-direction: column; justify-content: space-between;">
                <h3 style="margin: 0 0 15px 0; font-size: 17px; font-weight: 700; color: white; line-height: 1.3; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis; min-height: 44px;">${eventName}</h3>
                ${hasEnded ? 
                    `<div style="background: #666; color: #ccc; border: none; padding: 12px 20px; border-radius: 10px; font-weight: 600; font-size: 15px; width: 100%; text-align: center; cursor: not-allowed;">
                        <i class="fas fa-calendar-times" style="margin-right: 8px;"></i> Ended
                    </div>` :
                    `<button  onclick="openTicketModal('${eventData.id || eventData.physicalEventId}')"
                    style="background: linear-gradient(135deg, #6c5ce7 0%, #764ba2 100%); color: white; border: none; padding: 12px 20px; border-radius: 10px; cursor: pointer; font-weight: 600; font-size: 15px; width: 100%; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(108, 92, 231, 0.3);">
                        <i class="fas fa-ticket-alt" style="margin-right: 8px;"></i> View
                    </button>`
                }
            </div>
        </div>
    `;
    
    // Add hover effect only for active events
    if (!hasEnded) {
        card.addEventListener('mouseenter', () => {
            const cardDiv = card.querySelector('div');
            cardDiv.style.transform = 'translateY(-5px) scale(1.02)';
            cardDiv.style.boxShadow = '0 12px 35px rgba(0,0,0,0.4)';
            
            const button = cardDiv.querySelector('button');
            if (button) {
                button.style.background = 'linear-gradient(135deg, #764ba2 0%, #6c5ce7 100%)';
                button.style.transform = 'scale(1.05)';
            }
        });
        
        card.addEventListener('mouseleave', () => {
            const cardDiv = card.querySelector('div');
            cardDiv.style.transform = 'translateY(0) scale(1)';
            cardDiv.style.boxShadow = 'none';
            
            const button = cardDiv.querySelector('button');
            if (button) {
                button.style.background = 'linear-gradient(135deg, #6c5ce7 0%, #764ba2 100%)';
                button.style.transform = 'scale(1)';
            }
        });
    }
    
    return card;
}

function createPhyCategoryAdBanner(index) {
    const adBanner = document.createElement('div');
    adBanner.style.gridColumn = '1 / -1';
    
    const adVariants = [
        {
            text: " Host Your Own Event - Sign Up Today!",
            gradient: "linear-gradient(135deg, #f093fb 0%, #f5576c 100%)"
        },
        {
            text: " Secure Payments with Flutterwave",
            gradient: "linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)"
        },
        {
            text: " Trending Events This Week",
            gradient: "linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)"
        }
    ];
    
    const ad = adVariants[index % adVariants.length];
    
    adBanner.innerHTML = `
        <div style="background: ${ad.gradient}; border-radius: 12px; padding: 20px; text-align: center; margin: 10px 0; cursor: pointer; transition: all 0.3s ease;">
            <p style="margin: 0; font-size: 18px; font-weight: 600; color: white;">${ad.text}</p>
        </div>
    `;
    
    // Add click event for ad
    adBanner.addEventListener('click', () => {
        console.log('Ad clicked:', ad.text);
    });
    
    return adBanner;
}

async function togglePhyCategoryEventLike(eventId) {
    const currentUser = firebase.auth().currentUser;
    if (!currentUser) {
        alert('Please log in to like events');
        return;
    }
    
    const heartIcon = document.getElementById(`phy-heart-${eventId}`);
    const likesCountElement = document.getElementById(`phy-likes-${eventId}`);
    
    if (!heartIcon || !likesCountElement) return;
    
    try {
        const db = firebase.firestore();
        const eventRef = db.collection('physicalEvents').doc(eventId);
        const eventDoc = await eventRef.get();
        
        if (!eventDoc.exists) return;
        
        const eventData = eventDoc.data();
        const likedBy = eventData.likedBy || [];
        const currentLikesCount = eventData.likesCount || 0;
        const userLiked = likedBy.includes(currentUser.uid);
        
        let newLikedBy, newLikesCount;
        
        if (userLiked) {
            // Unlike
            newLikedBy = likedBy.filter(uid => uid !== currentUser.uid);
            newLikesCount = Math.max(0, currentLikesCount - 1);
            
            // Update UI
            heartIcon.className = 'far fa-heart';
            heartIcon.style.color = '#ccc';
        } else {
            // Like
            newLikedBy = [...likedBy, currentUser.uid];
            newLikesCount = currentLikesCount + 1;
            
            // Update UI
            heartIcon.className = 'fas fa-heart';
            heartIcon.style.color = '#e74c3c';
        }
        
        // Update likes count in UI
        likesCountElement.textContent = newLikesCount;
        
        // Update in Firebase
        await eventRef.update({
            likedBy: newLikedBy,
            likesCount: newLikesCount
        });
        
    } catch (error) {
        console.error('Error toggling like:', error);
    }
}

function openPhyCategoryTicketModal(eventId) {
    alert(`Opening ticket purchase for event ID: ${eventId}`);
    // You can integrate with existing ticket modal system here
}

function createPhysicalEventDisplayCard(eventData) {
    const card = document.createElement('div');
    card.className = 'physical-event-display-card';
    card.setAttribute('data-event-id', eventData.id || eventData.physicalEventId);

    // Handle Firebase data structure vs sample data
    const eventName = eventData.eventName || eventData.title || 'Untitled Event';
    const category = eventData.category || 'General';
    const location = eventData.location || 'Location TBD';
    
    // Check if event has ended
    const now = new Date();
    const eventDate = new Date(eventData.startDateTime);
    const hasEnded = now > eventDate;
    
    // Format date from Firebase startDateTime or fallback
    let formattedDate = 'Date TBD';
    let timeDisplay = '';
    
    if (eventData.startDateTime) {
        try {
            const eventDate = new Date(eventData.startDateTime);
            formattedDate = eventDate.toLocaleDateString('en-US', { 
                month: 'short', 
                day: 'numeric' 
            });
            timeDisplay = eventDate.toLocaleTimeString('en-US', { 
                hour: '2-digit', 
                minute: '2-digit',
                hour12: true 
            });
        } catch (e) {
            console.log('Date parsing error:', e);
        }
    } else if (eventData.date && eventData.time) {
        // Fallback for sample data structure
        const eventDate = new Date(eventData.date);
        formattedDate = eventDate.toLocaleDateString('en-US', { 
            month: 'short', 
            day: 'numeric' 
        });
        timeDisplay = eventData.time;
    }

    // Handle background from Firebase or fallback
    let backgroundStyle = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
    if (eventData.background) {
        if (typeof eventData.background === 'string') {
            backgroundStyle = eventData.background;
        } else if (eventData.background.type === 'gradient') {
            backgroundStyle = eventData.background.value;
        } else if (eventData.background.type === 'color') {
            backgroundStyle = eventData.background.value;
        } else if (eventData.background.type === 'image' && eventData.background.url) {
            backgroundStyle = `url(${eventData.background.url})`;
        }
    }

    // Handle sponsors from Firebase
    let sponsorsHtml = '';
    let extraSponsors = '';
    
    if (eventData.sponsors && eventData.sponsors.length > 0) {
        const sponsorList = Array.isArray(eventData.sponsors) ? eventData.sponsors : [];
        const validSponsors = sponsorList.filter(sponsor => sponsor && (sponsor.name || typeof sponsor === 'string'));
        
        sponsorsHtml = validSponsors.map(sponsor => {
            const sponsorName = sponsor.name || sponsor;
            return `<div class="sponsor-circle">${sponsorName.charAt(0).toUpperCase()}</div>`;
        }).join('');
        
        if (validSponsors.length > 3) {
            extraSponsors = `<span class="sponsors-count">+${validSponsors.length - 3}</span>`;
        }
    }

    // Handle pricing from Firebase tickets
    let priceDisplay = 'Free';
    if (eventData.tickets && eventData.tickets.length > 0) {
        const firstTicket = eventData.tickets[0];
        if (firstTicket.price && firstTicket.price > 0) {
            const currency = firstTicket.currency || '';
            priceDisplay = `${currency}${firstTicket.price.toLocaleString()}`;
        }
    } else if (eventData.price) {
        priceDisplay = eventData.price;
    }

    card.innerHTML = `
        <div class="event-card-image" style="background: ${backgroundStyle}; background-size: cover; background-position: center;">
            <div class="event-category-badge">${category}</div>
            ${hasEnded ? 
                `<div class="get-ticket-btn-top" style="background: #666; color: #ccc; cursor: not-allowed; pointer-events: none;">
                    <i class="fas fa-calendar-times"></i> Ended
                </div>` :
                `<button class="get-ticket-btn-top" onclick="openTicketModal('${eventData.id || eventData.physicalEventId}')">
                    <i class="fas fa-ticket-alt"></i> View
                </button>`
            }
            <button class="sharephy-btn" onclick="openSharephyModal('${eventData.eventLink || eventData.id || eventData.physicalEventId}')" style="position: absolute; top: 10px; right: 10px; background: rgba(0,0,0,0.6); color: white; border: none; width: 35px; height: 35px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; z-index: 2; transition: all 0.3s ease;">
                <i class="fas fa-share-alt" style="font-size: 14px;"></i>
            </button>
        </div>
        <div class="event-card-body">
            <h3 class="event-card-title">${eventName}</h3>
            <div class="event-card-details">
                <div class="event-detail-item">
                    <i class="fas fa-map-marker-alt"></i>
                    <span>${location}</span>
                </div>
                <div class="event-detail-item">
                    <i class="fas fa-calendar"></i>
                    <span>${formattedDate}${timeDisplay ? '  ' + timeDisplay : ''}</span>
                </div>
                <div class="event-detail-item">
                    <i class="fas fa-money-bill-wave"></i>
                    <span>${priceDisplay}</span>
                </div>
            </div>
            ${sponsorsHtml ? `
                <div class="event-sponsors-carousel" id="sponsors-${eventData.id || eventData.physicalEventId}">
                    <div class="sponsors-track">${sponsorsHtml}</div>
                </div>
            ` : ''}
        </div>
    `;

    return card;
}



// Open Contact Modal
function openPhyEventContactModal(eventId) {
    const contactInfo = currentPhyEventData.phyeveContactInfo;
    if (!contactInfo) return;
    
    // Remove existing modal if present
    const existingModal = document.getElementById('phyContactModal');
    if (existingModal) {
        existingModal.remove();
    }
    
    // Count available contact methods
    const contactMethods = [];
    
    if (contactInfo.hostName) {
        contactMethods.push({
            type: 'host',
            icon: 'fas fa-user',
            label: 'Host',
            value: contactInfo.hostName,
            action: null
        });
    }
    
    if (contactInfo.phoneNumber) {
        contactMethods.push({
            type: 'phone',
            icon: 'fas fa-phone',
            label: 'Phone',
            value: contactInfo.phoneNumber,
            action: `tel:${contactInfo.phoneNumber}`
        });
    }
    
    if (contactInfo.websiteUrl) {
        contactMethods.push({
            type: 'website',
            icon: 'fas fa-globe',
            label: 'Website',
            value: 'Visit Website',
            action: contactInfo.websiteUrl
        });
    }
    
    if (contactInfo.instagramUrl) {
        contactMethods.push({
            type: 'instagram',
            icon: 'fab fa-instagram',
            label: 'Instagram',
            value: 'Follow on Instagram',
            action: contactInfo.instagramUrl
        });
    }
    
    if (contactInfo.tiktokUrl) {
        contactMethods.push({
            type: 'tiktok',
            icon: 'fab fa-tiktok',
            label: 'TikTok',
            value: 'Follow on TikTok',
            action: contactInfo.tiktokUrl
        });
    }
    
    if (contactInfo.facebookUrl) {
        contactMethods.push({
            type: 'facebook',
            icon: 'fab fa-facebook',
            label: 'Facebook',
            value: 'Visit Facebook Page',
            action: contactInfo.facebookUrl
        });
    }
    
    if (contactInfo.twitterUrl) {
        contactMethods.push({
            type: 'twitter',
            icon: 'fab fa-twitter',
            label: 'Twitter/X',
            value: 'Follow on X',
            action: contactInfo.twitterUrl
        });
    }
    
    if (contactInfo.youtubeUrl) {
        contactMethods.push({
            type: 'youtube',
            icon: 'fab fa-youtube',
            label: 'YouTube',
            value: 'Visit YouTube Channel',
            action: contactInfo.youtubeUrl
        });
    }
    
    if (contactInfo.linkedinUrl) {
        contactMethods.push({
            type: 'linkedin',
            icon: 'fab fa-linkedin',
            label: 'LinkedIn',
            value: 'Connect on LinkedIn',
            action: contactInfo.linkedinUrl
        });
    }
    
    if (contactInfo.whatsappUrl) {
        contactMethods.push({
            type: 'whatsapp',
            icon: 'fab fa-whatsapp',
            label: 'WhatsApp',
            value: 'Message on WhatsApp',
            action: contactInfo.whatsappUrl
        });
    }
    
    // Add custom links
    if (contactInfo.customLink1Url && contactInfo.customLink1Name) {
        contactMethods.push({
            type: 'custom1',
            icon: 'fas fa-external-link-alt',
            label: contactInfo.customLink1Name,
            value: `Visit ${contactInfo.customLink1Name}`,
            action: contactInfo.customLink1Url
        });
    }
    
    if (contactInfo.customLink2Url && contactInfo.customLink2Name) {
        contactMethods.push({
            type: 'custom2',
            icon: 'fas fa-link',
            label: contactInfo.customLink2Name,
            value: `Visit ${contactInfo.customLink2Name}`,
            action: contactInfo.customLink2Url
        });
    }
    
    if (contactInfo.customLink3Url && contactInfo.customLink3Name) {
        contactMethods.push({
            type: 'custom3',
            icon: 'fas fa-share-alt',
            label: contactInfo.customLink3Name,
            value: `Visit ${contactInfo.customLink3Name}`,
            action: contactInfo.customLink3Url
        });
    }
    
    // Generate contact items HTML
    const contactItemsHTML = contactMethods.map(contact => {
        if (contact.action) {
            const isExternal = contact.action.startsWith('http') || contact.action.startsWith('https');
            const target = isExternal ? 'target="_blank"' : '';
            
            return `
                <a href="${contact.action}" ${target} style="display: flex; align-items: center; gap: 15px; padding: 15px; background: rgba(255,255,255,0.05); border-radius: 12px; text-decoration: none; color: white; transition: all 0.3s ease; border: 1px solid rgba(255,255,255,0.1);" onmouseover="this.style.background='rgba(108,92,231,0.1)'; this.style.borderColor='#6c5ce7';" onmouseout="this.style.background='rgba(255,255,255,0.05)'; this.style.borderColor='rgba(255,255,255,0.1)';">
                    <div style="background: #6c5ce7; width: 45px; height: 45px; border-radius: 10px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                        <i class="${contact.icon}" style="color: white; font-size: 18px;"></i>
                    </div>
                    <div style="flex: 1;">
                        <div style="font-weight: 600; font-size: 16px; margin-bottom: 2px;">${contact.label}</div>
                        <div style="color: rgba(255,255,255,0.7); font-size: 14px;">${contact.value}</div>
                    </div>
                    <i class="fas fa-chevron-right" style="color: rgba(255,255,255,0.5); font-size: 14px;"></i>
                </a>
            `;
        } else {
            return `
                <div style="display: flex; align-items: center; gap: 15px; padding: 15px; background: rgba(255,255,255,0.05); border-radius: 12px; color: white; border: 1px solid rgba(255,255,255,0.1);">
                    <div style="background: #6c5ce7; width: 45px; height: 45px; border-radius: 10px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                        <i class="${contact.icon}" style="color: white; font-size: 18px;"></i>
                    </div>
                    <div style="flex: 1;">
                        <div style="font-weight: 600; font-size: 16px; margin-bottom: 2px;">${contact.label}</div>
                        <div style="color: rgba(255,255,255,0.7); font-size: 14px;">${contact.value}</div>
                    </div>
                </div>
            `;
        }
    }).join('');
    
    // Create modal
    const modal = document.createElement('div');
    modal.id = 'phyContactModal';
    modal.style.cssText = `
        position: fixed; 
        top: 0; 
        left: 0; 
        width: 100%; 
        height: 100%; 
        background: rgba(0,0,0,0.8); 
        display: flex; 
        justify-content: center; 
        align-items: center; 
        z-index: 10001;
        animation: fadeIn 0.3s ease-in-out;
    `;
    
    modal.innerHTML = `
        <div style="background: #1a1a2e; border-radius: 20px; padding: 0; max-width: 500px; width: 90%; max-height: 80vh; overflow: hidden; position: relative; box-shadow: 0 20px 40px rgba(0,0,0,0.3); border: 1px solid rgba(108,92,231,0.3); animation: slideInUp 0.3s ease-in-out;">
            
            <!-- Header -->
            <div style="background: linear-gradient(135deg, #6c5ce7, #a29bfe); padding: 25px 30px; color: white; position: relative;">
                <button onclick="closePhyContactModal()" style="position: absolute; top: 15px; right: 15px; background: rgba(255,255,255,0.2); border: none; color: white; width: 35px; height: 35px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 16px; transition: all 0.3s ease;" onmouseover="this.style.background='rgba(255,255,255,0.3)'" onmouseout="this.style.background='rgba(255,255,255,0.2)'">
                    <i class="fas fa-times"></i>
                </button>
                
                <div style="display: flex; align-items: center; gap: 15px;">
                    <div style="background: rgba(255,255,255,0.2); width: 50px; height: 50px; border-radius: 12px; display: flex; align-items: center; justify-content: center;">
                        <i class="fas fa-address-book" style="font-size: 22px;"></i>
                    </div>
                    <div>
                        <h2 style="margin: 0; font-size: 24px; font-weight: 700;">Contact Information</h2>
                        <p style="margin: 5px 0 0 0; opacity: 0.9; font-size: 14px;">Get in touch with the event organizer</p>
                    </div>
                </div>
            </div>
            
            <!-- Content -->
            <div style="padding: 25px 30px; max-height: 400px; overflow-y: auto;">
                <div style="display: flex; flex-direction: column; gap: 12px;">
                    ${contactItemsHTML}
                </div>
                
                ${contactMethods.length === 0 ? `
                    <div style="text-align: center; padding: 40px 20px; color: rgba(255,255,255,0.6);">
                        <i class="fas fa-info-circle" style="font-size: 48px; margin-bottom: 15px; color: rgba(255,255,255,0.3);"></i>
                        <p style="margin: 0; font-size: 16px;">No contact information available for this event.</p>
                    </div>
                ` : ''}
            </div>
            
            <!-- Footer -->
            <div style="background: rgba(255,255,255,0.02); padding: 20px 30px; border-top: 1px solid rgba(255,255,255,0.1); text-align: center;">
                <p style="margin: 0; color: rgba(255,255,255,0.6); font-size: 13px;">
                    <i class="fas fa-shield-alt" style="margin-right: 5px; color: #6c5ce7;"></i>
                    Contact information is provided by the event organizer
                </p>
            </div>
        </div>
    `;
    
    // Add to page
    document.body.appendChild(modal);
    
    // Prevent body scroll
    document.body.style.overflow = 'hidden';
}

// Close Contact Modal
function closePhyContactModal() {
    const modal = document.getElementById('phyContactModal');
    if (modal) {
        modal.style.animation = 'fadeOut 0.3s ease-in-out';
        setTimeout(() => {
            modal.remove();
            document.body.style.overflow = 'auto';
        }, 300);
    }
}

// Close modal when clicking outside
document.addEventListener('click', function(event) {
    const modal = document.getElementById('phyContactModal');
    if (modal && event.target === modal) {
        closePhyContactModal();
    }
});

// For Advanced Event Card Contact Modal
function openAdvancedEventContactModal(eventId) {
    // First, fetch the event data if not available
    if (typeof db !== 'undefined') {
        db.collection('physicalEvents').doc(eventId).get().then(doc => {
            if (doc.exists) {
                const eventData = doc.data();
                if (eventData.phyeveContactInfo) {
                    // Set currentPhyEventData temporarily for the modal
                    const tempCurrentData = currentPhyEventData;
                    currentPhyEventData = { ...eventData, id: eventId };
                    openPhyEventContactModal(eventId);
                    // Restore original data
                    currentPhyEventData = tempCurrentData;
                }
            }
        });
    }
}

       // Advanced Physical Event Card with Modern Design - Updated with TBA support
function createAdvancedPhysicalEventCard(eventData) {
    const card = document.createElement('div');
    card.className = 'advanced-event-card';
    card.setAttribute('data-event-id', eventData.id || eventData.physicalEventId);

    // Extract data
    const eventName = eventData.eventName || 'Untitled Event';
    const category = eventData.category || 'General';
    const location = eventData.location || 'Location TBD';
    const ticketsSold = eventData.totalTicketsSold || 0;
    const likesCount = eventData.likesCount || 0;
    const currentUser = firebase.auth().currentUser;
    const userLiked = eventData.likedBy && currentUser ? eventData.likedBy.includes(currentUser.uid) : false;
    
    // Check if event is TBA
    const isTBA = eventData.isTBA === true || 
                  eventData.schedulingStatus === 'TBA' || 
                  eventData.startDateTime === 'TBA' ||
                  eventData.endDateTime === 'TBA' ||
                  !eventData.startDateTime ||
                  eventData.startDateTime === '';
    
    // Check if event has ended (only for non-TBA events)
    let hasEnded = false;
    if (!isTBA) {
        try {
            const now = new Date();
            const eventDate = new Date(eventData.startDateTime);
            if (!isNaN(eventDate.getTime())) {
                hasEnded = now > eventDate;
            }
        } catch (e) {
            console.log('Error checking if event ended:', e);
        }
    }
    
    // Format date and time with TBA support
    let formattedDate = 'TBA';
    let timeDisplay = '';
    
    if (isTBA) {
        formattedDate = 'TBA';
        timeDisplay = '';
    } else if (eventData.startDateTime) {
        try {
            const eventDate = new Date(eventData.startDateTime);
            if (!isNaN(eventDate.getTime())) {
                formattedDate = eventDate.toLocaleDateString('en-US', { 
                    weekday: 'short',
                    month: 'short', 
                    day: 'numeric' 
                });
                timeDisplay = eventDate.toLocaleTimeString('en-US', { 
                    hour: '2-digit', 
                    minute: '2-digit',
                    hour12: true 
                });
            } else {
                formattedDate = 'TBA';
                timeDisplay = '';
            }
        } catch (e) {
            console.log('Date parsing error:', e);
            formattedDate = 'TBA';
            timeDisplay = '';
        }
    }

    // Handle Firebase background using same logic as createPhysicalEventCard
    let backgroundStyle = 'background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);';
    let isVideo = false;
    
    console.log('Event background data:', eventData.background); // Debug log
    
    if (!eventData.background) {
        backgroundStyle = 'background: linear-gradient(135deg, #FF6B6B, #4ECDC4);';
    } else {
        switch (eventData.background.type) {
            case 'media':
                backgroundStyle = `background-image: url('${eventData.background.data}'); background-size: cover; background-position: center; background-repeat: no-repeat;`;
                console.log('Using background media:', eventData.background.data?.substring(0, 50) + '...');
                break;
            case 'gradient':
                backgroundStyle = `background: ${eventData.background.gradient};`;
                console.log('Using background gradient:', eventData.background.gradient);
                break;
            case 'color':
                backgroundStyle = `background-color: ${eventData.background.color};`;
                console.log('Using background color:', eventData.background.color);
                break;
            default:
                backgroundStyle = 'background: linear-gradient(135deg, #FF6B6B, #4ECDC4);';
                console.log('Using default gradient - unknown type:', eventData.background.type);
        }
    }
    
    // Generate random gradients for cards without backgrounds (fallback)
    if (backgroundStyle === 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)') {
        const gradients = [
            'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
            'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)',
            'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)',
            'linear-gradient(135deg, #fa709a 0%, #fee140 100%)',
            'linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)',
            'linear-gradient(135deg, #d299c2 0%, #fef9d7 100%)',
            'linear-gradient(135deg, #89f7fe 0%, #66a6ff 100%)',
            'linear-gradient(135deg, #fdbb2d 0%, #22c1c3 100%)',
            'linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%)',
            'linear-gradient(135deg, #a1c4fd 0%, #c2e9fb 100%)'
        ];
        const eventIndex = parseInt(eventData.id?.slice(-1)) || 0;
        backgroundStyle = gradients[eventIndex % gradients.length];
    }
    
    console.log('Final background style:', backgroundStyle); // Debug log

    // Generate category color and icon
    const categoryData = {
        'Music': {
            color: '#FF6B6B',
            icon: 'fas fa-music'
        },
        'Technology': {
            color: '#4ECDC4',
            icon: 'fas fa-microchip'
        },
        'Sports': {
            color: '#45B7D1',
            icon: 'fas fa-running'
        },
        'Food': {
            color: '#FFA07A',
            icon: 'fas fa-utensils'
        },
        'Art': {
            color: '#98D8C8',
            icon: 'fas fa-palette'
        },
        'Entertainment': {
            color: '#F7DC6F',
            icon: 'fas fa-star'
        },
        'Business': {
            color: '#BB8FCE',
            icon: 'fas fa-chart-line'
        },
        'Fashion': {
            color: '#F8C471',
            icon: 'fas fa-tshirt'
        },
        'Education': {
            color: '#85C1E9',
            icon: 'fas fa-graduation-cap'
        },
        'Health': {
            color: '#82E0AA',
            icon: 'fas fa-heartbeat'
        },
        'Gaming': {
            color: '#F1948A',
            icon: 'fas fa-gamepad'
        },
        'Literature': {
            color: '#D7BDE2',
            icon: 'fas fa-book'
        }
    };
    
    const categoryInfo = categoryData[category] || {
        color: '#667eea',
        icon: 'fas fa-calendar'
    };

    // Handle sponsors from Firebase
    let sponsorsHtml = '';
    if (eventData.sponsors && eventData.sponsors.length > 0) {
        const sponsorList = Array.isArray(eventData.sponsors) ? eventData.sponsors : [];
        const validSponsors = sponsorList.filter(sponsor => sponsor && (sponsor.name || typeof sponsor === 'string'));
        
        sponsorsHtml = validSponsors.map(sponsor => {
            const sponsorName = sponsor.name || sponsor;
            
            // Check if sponsor has logo data (like in the sponsor management system)
            if (sponsor.logo && sponsor.logo.data) {
                return `
                    <div class="advanced-sponsor-circle sponsor-with-logo">
                        <img src="${sponsor.logo.data}" alt="${sponsorName}" 
                             style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">
                    </div>
                `;
            } else {
                // Fallback to initial letter if no logo
                return `<div class="advanced-sponsor-circle">${sponsorName.charAt(0).toUpperCase()}</div>`;
            }
        }).join('');
    }

    card.innerHTML = `
        ${isVideo ? `
            <video class="advanced-event-background" autoplay muted loop>
                <source src="${backgroundStyle}" type="video/mp4">
            </video>
        ` : `
            <div class="advanced-event-background" style="${backgroundStyle}"></div>
        `}
         <div class="advanced-event-overlay"></div>
        
        <div class="advanced-category-badge" style="background: ${categoryInfo.color}">
            <i class="${categoryInfo.icon}"></i>
            ${category}
        </div>
        
        ${isTBA ? `
            <div class="advanced-tba-badge">
                <i class="fas fa-clock"></i>
                TBA
            </div>
        ` : ''}
        
       <div class="advanced-likes-badge">
           <button onclick="togglePhyCategoryEventLike('${eventData.id}')" style="background: none; border: none; color: ${userLiked ? '#e74c3c' : '#fff'}; cursor: pointer; font-size: 18px; padding: 0; display: flex; align-items: center;">
                <i class="${userLiked ? 'fas' : 'far'} fa-heart" id="phy-heart-${eventData.id}"></i>
            </button>
            <span style="color: white; font-size: 14px; font-weight: 600;" id="phy-likes-${eventData.id}">${likesCount}</span>
        </div>
        
        <button class="sharephy-btn" ${hasEnded ? 'disabled style="position: absolute; top: 10px; right: 10px; background: rgba(0,0,0,0.3); color: #666; border: none; width: 35px; height: 35px; border-radius: 50%; cursor: not-allowed; display: flex; align-items: center; justify-content: center; z-index: 4; opacity: 0.5;"' : `onclick="openSharephyModal('${eventData.eventLink || eventData.id || eventData.physicalEventId}')" style="position: absolute; top: 10px; right: 10px; background: rgba(0,0,0,0.6); color: white; border: none; width: 35px; height: 35px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; z-index: 4; transition: all 0.3s ease;"`}>
            <i class="fas fa-share-alt" style="font-size: 14px;"></i>
        </button>
        
        <div class="advanced-event-content">
            <h3 class="advanced-event-title">${eventName}</h3>
            
            <div class="advanced-event-details">
                <div class="advanced-detail-row">
                    <div class="advanced-detail-item">
                        <i class="fas fa-map-marker-alt"></i>
                        <span>${location}</span>
                    </div>
                </div>
                
                ${isTBA ? `
                    <div class="advanced-detail-row">
                        <div class="advanced-detail-item tba-datetime">
                            <i class="fas fa-calendar-alt" style="color: #ffd700;"></i>
                            <span style="color: #ffd700; font-weight: 500; font-style: italic;">Date & Time: TBA</span>
                        </div>
                    </div>
                ` : `
                    <div class="advanced-detail-row">
                        <div class="advanced-detail-item">
                            <i class="fas fa-calendar-alt"></i>
                            <span>${formattedDate}</span>
                        </div>
                        ${timeDisplay ? `
                            <div class="advanced-detail-item">
                                <i class="fas fa-clock"></i>
                                <span>${timeDisplay}</span>
                            </div>
                        ` : ''}
                    </div>
                `}
            </div>
            
            ${sponsorsHtml ? `
                <div class="advanced-sponsors-carousel">
                    <div class="sponsors-label">Sponsors</div>
                    <div class="advanced-sponsors-track">${sponsorsHtml}</div>
                </div>
            ` : ''}
        </div>
        
        <div class="advanced-card-actions">
            ${hasEnded ? 
                `<button class="advanced-buy-btn" style="background: #666; color: #ccc; cursor: not-allowed; opacity: 0.7;" disabled>
                    <i class="fas fa-calendar-times"></i>
                    Ended
                </button>` :
                `<button class="advanced-buy-btn" onclick="openTicketModal('${eventData.id || eventData.physicalEventId}')">
                    <i class="fas fa-ticket-alt"></i>
                    ${isTBA ? 'More Info' : 'View Event'}
                </button>`
            }
        </div>
    `;

    return card;
}



function toggleWithdrawVisibility(eventId) {
    const withdrawAmount = document.getElementById(`withdraw-${eventId}`);
    const eyeIcon = document.getElementById(`eye-icon-${eventId}`);
    
    if (withdrawAmount && eyeIcon) {
        if (withdrawAmount.classList.contains('hidden')) {
            // Show the amount
            withdrawAmount.classList.remove('hidden');
            eyeIcon.className = 'fas fa-eye';
        } else {
            // Hide the amount
            withdrawAmount.classList.add('hidden');
            eyeIcon.className = 'fas fa-eye-slash';
        }
    }
}

async function toggleEventLike(eventId) {
    const currentUser = firebase.auth().currentUser;
    if (!currentUser) {
        alert('Please log in to like events');
        return;
    }
    
    const heartIcon = document.getElementById(`heart-icon-${eventId}`);
    const likesCountElement = document.getElementById(`likes-count-${eventId}`);
    const likeBtn = heartIcon.closest('.like-btn');
    
    if (!heartIcon || !likesCountElement) return;
    
    try {
        const db = firebase.firestore();
        const eventRef = db.collection('physicalEvents').doc(eventId);
        const eventDoc = await eventRef.get();
        
        if (!eventDoc.exists) return;
        
        const eventData = eventDoc.data();
        const likedBy = eventData.likedBy || [];
        const currentLikesCount = eventData.likesCount || 0;
        const userLiked = likedBy.includes(currentUser.uid);
        
        let newLikedBy, newLikesCount;
        
        if (userLiked) {
            // Unlike
            newLikedBy = likedBy.filter(uid => uid !== currentUser.uid);
            newLikesCount = Math.max(0, currentLikesCount - 1);
            
            // Update UI
            heartIcon.className = 'far fa-heart';
            likeBtn.classList.remove('liked');
        } else {
            // Like
            newLikedBy = [...likedBy, currentUser.uid];
            newLikesCount = currentLikesCount + 1;
            
            // Update UI
            heartIcon.className = 'fas fa-heart';
            likeBtn.classList.add('liked');
        }
        
        // Update likes count in UI
        likesCountElement.textContent = newLikesCount;
        
        // Update in Firebase
        await eventRef.update({
            likedBy: newLikedBy,
            likesCount: newLikesCount
        });
        
    } catch (error) {
        console.error('Error toggling like:', error);
        // Revert UI changes on error
        location.reload();
    }
}

function createAdvancedAdCard(index) {
    const adCard = document.createElement('div');
    adCard.className = 'ad-display-card';
    
    const adVariants = [
        {
            title: "Boost Your Event",
            subtitle: "Get more visibility with our premium advertising",
            cta: "Learn More",
            gradient: "linear-gradient(135deg, #f093fb 0%, #f5576c 100%)"
        },
        {
            title: "Host Your Event",
            subtitle: "Create amazing experiences for your audience",
            cta: "Start Now",
            gradient: "linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)"
        },
        {
            title: "Event Analytics",
            subtitle: "Track your event performance in real-time",
            cta: "View Stats",
            gradient: "linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)"
        }
    ];
    
    const adData = adVariants[index % adVariants.length];
    
    adCard.style.background = adData.gradient;
    adCard.innerHTML = `
        <div class="ad-content">
            <h3 class="ad-title">${adData.title}</h3>
            <p class="ad-subtitle">${adData.subtitle}</p>
            <button class="ad-cta-btn" onclick="handleAdClick('${adData.title.toLowerCase().replace(/\s+/g, '_')}')">${adData.cta}</button>
        </div>
    `;

    return adCard;
}

function openTicketModal(eventId) {
    console.log('Opening ticket modal for event:', eventId);
    showPhyEventDetailLoadingPage(eventId);
}

// Global variables for ticket system
let currentPhyEventData = null;
let phyTicketCart = {};
let phyPromoApplied = false;

// Service Fee Calculation Function
function calculatePhyServiceFee(amount) {
    if (amount <= 1) return 0;
    if (amount <= 500) return 50;
    if (amount <= 2000) return 100;
    if (amount <= 3000) return 150;
    if (amount <= 5000) return 200;
    if (amount <= 10000) return 600;
    if (amount <= 15000) return 700;
    if (amount <= 20000) return 900;
    if (amount <= 25000) return 1150;
    if (amount <= 30000) return 1400;
    if (amount <= 35000) return 1650;
    if (amount <= 40000) return 1900;
    if (amount <= 45000) return 2150;
    if (amount <= 50000) return 2400;
    if (amount <= 55000) return 2900;
    if (amount <= 60000) return 2500;
    if (amount <= 65000) return 2700;
    if (amount <= 70000) return 3000;
    if (amount <= 75000) return 3200;
    if (amount <= 80000) return 3500;
    if (amount <= 85000) return 3800;
    if (amount <= 90000) return 4300;
    if (amount <= 95000) return 4500;
    if (amount <= 100000) return 4800;
    if (amount <= 120000) return 6300;
    if (amount <= 150000) return 8000;
    if (amount <= 200000) return 10000;
    if (amount <= 300000) return 15000;
    if (amount <= 500000) return 20000;
    if (amount <= 750000) return 27000;
    if (amount <= 1000000) return 35000;
    if (amount <= 1500000) return 65000;
    if (amount <= 2000000) return 80000;
    if (amount <= 3000000) return 100000;
    if (amount <= 5000000) return 150000;
    return 150000; // Cap at 150k for amounts above 5M
}

// Loading Page Function
function showPhyEventDetailLoadingPage(eventId) {
    const loadingHTML = `
        <div id="phyevent-detail-loadingpage" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #1a1a2e; z-index: 10000; display: flex; flex-direction: column; justify-content: center; align-items: center;">
            <div style="text-align: center;">
                <div id="phy-loading-spinner" style="width: 60px; height: 60px; border: 3px solid rgba(255,255,255,0.3); border-radius: 50%; border-top: 3px solid white; animation: spin 1s linear infinite; margin: 0 auto 30px;"></div>
                <h2 id="phy-loading-text" style="color: white; font-size: 24px; font-weight: 600; margin-bottom: 15px;">Loading...</h2>
                <div style="width: 200px; height: 4px; background: rgba(255,255,255,0.2); border-radius: 2px; overflow: hidden; margin: 0 auto;">
                    <div id="phy-loading-progress" style="width: 0%; height: 100%; background: linear-gradient(90deg, #6c5ce7, #a29bfe); border-radius: 2px; transition: width 0.5s ease;"></div>
                </div>
            </div>
        </div>
        <style>
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        </style>
    `;
    
    document.body.insertAdjacentHTML('beforeend', loadingHTML);
    
    // Animation sequence
    setTimeout(() => {
        document.getElementById('phy-loading-text').textContent = 'Revealing Event...';
        document.getElementById('phy-loading-progress').style.width = '60%';
    }, 1000);
    
    setTimeout(() => {
        document.getElementById('phy-loading-text').textContent = 'Powered by Rewarder';
        document.getElementById('phy-loading-progress').style.width = '100%';
    }, 2000);
    
    setTimeout(() => {
        document.getElementById('phyevent-detail-loadingpage').remove();
        showPhyEventDetailPage(eventId);
    }, 3000);
}

// Main Event Detail Page
async function showPhyEventDetailPage(eventId) {
    try {
        // Fetch event data from Firebase
        const eventDoc = await db.collection('physicalEvents').doc(eventId).get();
        if (!eventDoc.exists) {
            alert('Event not found');
            return;
        }
        
        currentPhyEventData = { ...eventDoc.data(), id: eventDoc.id };
        phyTicketCart = {}; // Reset cart
        
        // Generate clean background style (no overlay)
        let backgroundStyle = 'background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);';
        if (currentPhyEventData.background) {
            switch (currentPhyEventData.background.type) {
                case 'media':
                    backgroundStyle = `background: url('${currentPhyEventData.background.data}'); background-size: cover; background-position: center;`;
                    break;
                case 'gradient':
                    backgroundStyle = `background: ${currentPhyEventData.background.gradient};`;
                    break;
                case 'color':
                    backgroundStyle = `background: ${currentPhyEventData.background.color};`;
                    break;
            }
        }
        
        const pageHTML = `
            <div id="phyevent-detail-page" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #1a1a2e; z-index: 10000; overflow-y: auto;">
                <!-- Hero Background Section - Clean, no overlays -->
                <div style="${backgroundStyle} height: 50vh; position: relative;">
                    <button onclick="closePhyEventDetailPage()" style="position: absolute; top: 15px; left: 15px; background: rgba(255,255,255,0.9); color: #1a1a2e; border: none; width: 40px; height: 40px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 16px; box-shadow: 0 2px 10px rgba(0,0,0,0.2);">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                    <div style="position: absolute; bottom: 0; left: 0; right: 0; background: linear-gradient(transparent, rgba(26,26,46,0.8)); height: 80px;"></div>
                </div>
                
                <!-- Event Info Card - Floating over background -->
                <div style="background: #1a1a2e; margin: -60px 15px 0; border-radius: 20px 20px 0 0; position: relative; box-shadow: 0 -10px 30px rgba(0,0,0,0.3);">
                    <div style="padding: 25px;">
                        <h1 style="color: white; font-size: 28px; font-weight: 700; margin-bottom: 12px; line-height: 1.2;">${currentPhyEventData.eventName || 'Event Name'}</h1>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 15px; margin: 20px 0; padding: 18px; background: rgba(255,255,255,0.05); border-radius: 12px; border: 1px solid rgba(255,255,255,0.1);">
                            ${currentPhyEventData.startDateTime ? `
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <div style="background: #6c5ce7; width: 35px; height: 35px; border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                                        <i class="fas fa-calendar" style="color: white; font-size: 14px;"></i>
                                    </div>
                                    <div>
                                        <div style="color: rgba(255,255,255,0.7); font-size: 11px; text-transform: uppercase; letter-spacing: 0.5px;">Date</div>
                                        <div style="color: white; font-weight: 600; font-size: 13px;">${new Date(currentPhyEventData.startDateTime).toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' })}</div>
                                    </div>
                                </div>
                            ` : ''}
                            ${currentPhyEventData.startDateTime ? `
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <div style="background: #6c5ce7; width: 35px; height: 35px; border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                                        <i class="fas fa-clock" style="color: white; font-size: 14px;"></i>
                                    </div>
                                    <div>
                                        <div style="color: rgba(255,255,255,0.7); font-size: 11px; text-transform: uppercase; letter-spacing: 0.5px;">Time</div>
                                        <div style="color: white; font-weight: 600; font-size: 13px;">${new Date(currentPhyEventData.startDateTime).toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' })}</div>
                                    </div>
                                </div>
                            ` : ''}
                            ${currentPhyEventData.location ? `
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <div style="background: #6c5ce7; width: 35px; height: 35px; border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                                        <i class="fas fa-map-marker-alt" style="color: white; font-size: 14px;"></i>
                                    </div>
                                    <div>
                                        <div style="color: rgba(255,255,255,0.7); font-size: 11px; text-transform: uppercase; letter-spacing: 0.5px;">Location</div>
                                        <div style="color: white; font-weight: 600; font-size: 13px;">${currentPhyEventData.location}</div>
                                    </div>
                                </div>
                            ` : ''}
          
    ${currentPhyEventData.phyeveContactInfo ? `
    <div style="display: flex; align-items: center; gap: 10px; grid-column: 1/-1; margin-top: 10px;">
        <div style="background: #6c5ce7; width: 35px; height: 35px; border-radius: 8px; display: flex; align-items: center; justify-content: center;">
            <i class="fas fa-address-book" style="color: white; font-size: 14px;"></i>
        </div>
        <div style="flex: 1;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                <div style="color: rgba(255,255,255,0.7); font-size: 11px; text-transform: uppercase; letter-spacing: 0.5px;">Contact Information</div>
                <div style="color: rgba(255,255,255,0.5); font-size: 10px;">
                    Total Clicks: ${getTotalContactClicks(currentPhyEventData)}
                </div>
            </div>
            <div style="color: white; font-weight: 600; font-size: 13px; display: flex; flex-wrap: wrap; gap: 6px; align-items: center;">
                ${currentPhyEventData.phyeveContactInfo.hostName ? `
                    <span style="padding: 4px 8px; background: rgba(255,255,255,0.1); border-radius: 4px; font-size: 11px;">
                        <i class="fas fa-user" style="margin-right: 4px;"></i>${currentPhyEventData.phyeveContactInfo.hostName}
                    </span>
                ` : ''}
                ${currentPhyEventData.phyeveContactInfo.phoneNumber ? `
                    <a onclick="trackContactClick('${currentPhyEventData.id}', 'phone', '${currentPhyEventData.phyeveContactInfo.phoneNumber}')" style="color: #28a745; text-decoration: none; padding: 4px 8px; background: rgba(40,167,69,0.1); border-radius: 4px; font-size: 11px; cursor: pointer; transition: all 0.2s ease; display: flex; align-items: center; gap: 4px;" onmouseover="this.style.background='rgba(40,167,69,0.2)'" onmouseout="this.style.background='rgba(40,167,69,0.1)'">
                        <i class="fas fa-phone"></i>
                        <span>Call</span>
                    </a>
                ` : ''}
                ${currentPhyEventData.phyeveContactInfo.websiteUrl ? `
                    <a onclick="trackContactClick('${currentPhyEventData.id}', 'website', '${currentPhyEventData.phyeveContactInfo.websiteUrl}')" style="color: #6c5ce7; text-decoration: none; padding: 4px 8px; background: rgba(108,92,231,0.1); border-radius: 4px; font-size: 11px; cursor: pointer; transition: all 0.2s ease; display: flex; align-items: center; gap: 4px;" onmouseover="this.style.background='rgba(108,92,231,0.2)'" onmouseout="this.style.background='rgba(108,92,231,0.1)'">
                        <i class="fas fa-globe"></i>
                        <span>Website</span>
                        <small style="opacity: 0.7;">(${getContactClicks(currentPhyEventData, 'website')})</small>
                    </a>
                ` : ''}
                ${currentPhyEventData.phyeveContactInfo.instagramUrl ? `
                    <a onclick="trackContactClick('${currentPhyEventData.id}', 'instagram', '${currentPhyEventData.phyeveContactInfo.instagramUrl}')" style="color: #E4405F; text-decoration: none; padding: 4px 8px; background: rgba(228,64,95,0.1); border-radius: 4px; font-size: 11px; cursor: pointer; transition: all 0.2s ease; display: flex; align-items: center; gap: 4px;" onmouseover="this.style.background='rgba(228,64,95,0.2)'" onmouseout="this.style.background='rgba(228,64,95,0.1)'">
                        <i class="fab fa-instagram"></i>
                        <span>IG</span>
                        <small style="opacity: 0.7;">(${getContactClicks(currentPhyEventData, 'instagram')})</small>
                    </a>
                ` : ''}
                ${currentPhyEventData.phyeveContactInfo.tiktokUrl ? `
                    <a onclick="trackContactClick('${currentPhyEventData.id}', 'tiktok', '${currentPhyEventData.phyeveContactInfo.tiktokUrl}')" style="color: #000; background: white; text-decoration: none; padding: 4px 8px; border-radius: 4px; font-size: 11px; cursor: pointer; transition: all 0.2s ease; display: flex; align-items: center; gap: 4px;" onmouseover="this.style.background='rgba(255,255,255,0.9)'" onmouseout="this.style.background='white'">
                        <i class="fab fa-tiktok"></i>
                        <span>TikTok</span>
                        <small style="opacity: 0.7;">(${getContactClicks(currentPhyEventData, 'tiktok')})</small>
                    </a>
                ` : ''}
                ${currentPhyEventData.phyeveContactInfo.facebookUrl ? `
                    <a onclick="trackContactClick('${currentPhyEventData.id}', 'facebook', '${currentPhyEventData.phyeveContactInfo.facebookUrl}')" style="color: #4267B2; text-decoration: none; padding: 4px 8px; background: rgba(66,103,178,0.1); border-radius: 4px; font-size: 11px; cursor: pointer; transition: all 0.2s ease; display: flex; align-items: center; gap: 4px;" onmouseover="this.style.background='rgba(66,103,178,0.2)'" onmouseout="this.style.background='rgba(66,103,178,0.1)'">
                        <i class="fab fa-facebook"></i>
                        <span>FB</span>
                        <small style="opacity: 0.7;">(${getContactClicks(currentPhyEventData, 'facebook')})</small>
                    </a>
                ` : ''}
                ${currentPhyEventData.phyeveContactInfo.twitterUrl ? `
                    <a onclick="trackContactClick('${currentPhyEventData.id}', 'twitter', '${currentPhyEventData.phyeveContactInfo.twitterUrl}')" style="color: #1DA1F2; text-decoration: none; padding: 4px 8px; background: rgba(29,161,242,0.1); border-radius: 4px; font-size: 11px; cursor: pointer; transition: all 0.2s ease; display: flex; align-items: center; gap: 4px;" onmouseover="this.style.background='rgba(29,161,242,0.2)'" onmouseout="this.style.background='rgba(29,161,242,0.1)'">
                        <i class="fab fa-twitter"></i>
                        <span>X</span>
                        <small style="opacity: 0.7;">(${getContactClicks(currentPhyEventData, 'twitter')})</small>
                    </a>
                ` : ''}
                ${currentPhyEventData.phyeveContactInfo.youtubeUrl ? `
                    <a onclick="trackContactClick('${currentPhyEventData.id}', 'youtube', '${currentPhyEventData.phyeveContactInfo.youtubeUrl}')" style="color: #FF0000; text-decoration: none; padding: 4px 8px; background: rgba(255,0,0,0.1); border-radius: 4px; font-size: 11px; cursor: pointer; transition: all 0.2s ease; display: flex; align-items: center; gap: 4px;" onmouseover="this.style.background='rgba(255,0,0,0.2)'" onmouseout="this.style.background='rgba(255,0,0,0.1)'">
                        <i class="fab fa-youtube"></i>
                        <span>YT</span>
                        <small style="opacity: 0.7;">(${getContactClicks(currentPhyEventData, 'youtube')})</small>
                    </a>
                ` : ''}
                ${currentPhyEventData.phyeveContactInfo.linkedinUrl ? `
                    <a onclick="trackContactClick('${currentPhyEventData.id}', 'linkedin', '${currentPhyEventData.phyeveContactInfo.linkedinUrl}')" style="color: #0077B5; text-decoration: none; padding: 4px 8px; background: rgba(0,119,181,0.1); border-radius: 4px; font-size: 11px; cursor: pointer; transition: all 0.2s ease; display: flex; align-items: center; gap: 4px;" onmouseover="this.style.background='rgba(0,119,181,0.2)'" onmouseout="this.style.background='rgba(0,119,181,0.1)'">
                        <i class="fab fa-linkedin"></i>
                        <span>LI</span>
                        <small style="opacity: 0.7;">(${getContactClicks(currentPhyEventData, 'linkedin')})</small>
                    </a>
                ` : ''}
                ${currentPhyEventData.phyeveContactInfo.whatsappUrl ? `
                    <a onclick="trackContactClick('${currentPhyEventData.id}', 'whatsapp', '${currentPhyEventData.phyeveContactInfo.whatsappUrl}')" style="color: #25D366; text-decoration: none; padding: 4px 8px; background: rgba(37,211,102,0.1); border-radius: 4px; font-size: 11px; cursor: pointer; transition: all 0.2s ease; display: flex; align-items: center; gap: 4px;" onmouseover="this.style.background='rgba(37,211,102,0.2)'" onmouseout="this.style.background='rgba(37,211,102,0.1)'">
                        <i class="fab fa-whatsapp"></i>
                        <span>WA</span>
                        <small style="opacity: 0.7;">(${getContactClicks(currentPhyEventData, 'whatsapp')})</small>
                    </a>
                ` : ''}
                ${currentPhyEventData.phyeveContactInfo.customLink1Url && currentPhyEventData.phyeveContactInfo.customLink1Name ? `
                    <a onclick="trackContactClick('${currentPhyEventData.id}', 'custom1', '${currentPhyEventData.phyeveContactInfo.customLink1Url}')" style="color: #6c5ce7; text-decoration: none; padding: 4px 8px; background: rgba(108,92,231,0.1); border-radius: 4px; font-size: 11px; cursor: pointer; transition: all 0.2s ease; display: flex; align-items: center; gap: 4px;" onmouseover="this.style.background='rgba(108,92,231,0.2)'" onmouseout="this.style.background='rgba(108,92,231,0.1)'">
                        <i class="fas fa-external-link-alt"></i>
                        <span>${currentPhyEventData.phyeveContactInfo.customLink1Name}</span>
                        <small style="opacity: 0.7;">(${getContactClicks(currentPhyEventData, 'custom1')})</small>
                    </a>
                ` : ''}
                ${currentPhyEventData.phyeveContactInfo.customLink2Url && currentPhyEventData.phyeveContactInfo.customLink2Name ? `
                    <a onclick="trackContactClick('${currentPhyEventData.id}', 'custom2', '${currentPhyEventData.phyeveContactInfo.customLink2Url}')" style="color: #17a2b8; text-decoration: none; padding: 4px 8px; background: rgba(23,162,184,0.1); border-radius: 4px; font-size: 11px; cursor: pointer; transition: all 0.2s ease; display: flex; align-items: center; gap: 4px;" onmouseover="this.style.background='rgba(23,162,184,0.2)'" onmouseout="this.style.background='rgba(23,162,184,0.1)'">
                        <i class="fas fa-link"></i>
                        <span>${currentPhyEventData.phyeveContactInfo.customLink2Name}</span>
                        <small style="opacity: 0.7;">(${getContactClicks(currentPhyEventData, 'custom2')})</small>
                    </a>
                ` : ''}
                ${currentPhyEventData.phyeveContactInfo.customLink3Url && currentPhyEventData.phyeveContactInfo.customLink3Name ? `
                    <a onclick="trackContactClick('${currentPhyEventData.id}', 'custom3', '${currentPhyEventData.phyeveContactInfo.customLink3Url}')" style="color: #fd7e14; text-decoration: none; padding: 4px 8px; background: rgba(253,126,20,0.1); border-radius: 4px; font-size: 11px; cursor: pointer; transition: all 0.2s ease; display: flex; align-items: center; gap: 4px;" onmouseover="this.style.background='rgba(253,126,20,0.2)'" onmouseout="this.style.background='rgba(253,126,20,0.1)'">
                        <i class="fas fa-share-alt"></i>
                        <span>${currentPhyEventData.phyeveContactInfo.customLink3Name}</span>
                        <small style="opacity: 0.7;">(${getContactClicks(currentPhyEventData, 'custom3')})</small>
                    </a>
                ` : ''}
            </div>
        </div>
    </div>
` : ''}
       
                        </div>
                        
                        <div style="background: rgba(255,255,255,0.03); padding: 16px; border-radius: 12px; border-left: 3px solid #6c5ce7; margin: 18px 0;">
                            <h3 style="color: white; font-size: 15px; margin-bottom: 8px; font-weight: 600;">About This Event</h3>
                            <p style="color: rgba(255,255,255,0.8); line-height: 1.5; margin: 0; font-size: 14px;">${currentPhyEventData.description || 'Event description will be provided soon. Contact the event organizer for more details.'}</p>
                        </div>
                    </div>
                </div>
                
                <!-- Content Section -->
                <div style="background: #1a1a2e; padding: 0 15px 30px;">
                    <div style="max-width: 600px; margin: 0 auto;">
                        
                        <!-- Tickets Section -->
                        <div style="margin-bottom: 25px;">
                            <h2 style="color: white; font-size: 20px; font-weight: 700; margin-bottom: 20px; padding: 0 10px;">
                                <i class="fas fa-ticket-alt" style="margin-right: 10px; color: #6c5ce7;"></i>
                                Select Tickets
                            </h2>
                            <div id="phy-tickets-container" style="display: flex; flex-wrap: wrap; gap: 12px; margin-bottom: 20px;">
                                ${generatePhyTicketsHTML()}
                            </div>
                        </div>
                        
                        <!-- Order Summary -->
                        <div id="phy-order-summary" style="background: rgba(255,255,255,0.05); border-radius: 15px; padding: 30px; margin-bottom: 30px; border: 1px solid rgba(255,255,255,0.1);">
                            <h3 style="color: white; font-size: 24px; font-weight: 600; margin-bottom: 20px;">
                                <i class="fas fa-receipt" style="margin-right: 10px; color: #6c5ce7;"></i>
                                Order Summary
                            </h3>
                            <div id="phy-summary-content">
                                <p style="color: rgba(255,255,255,0.7); font-size: 16px; text-align: center; margin: 40px 0;">Select tickets to see your order summary</p>
                            </div>
                        </div>
                        
                        <!-- Promo Code Section -->
                        <div style="background: rgba(255,255,255,0.05); border-radius: 15px; padding: 30px; margin-bottom: 30px; border: 1px solid rgba(255,255,255,0.1);">
                            <h3 style="color: white; font-size: 20px; font-weight: 600; margin-bottom: 20px;">
                                <i class="fas fa-tag" style="margin-right: 10px; color: #6c5ce7;"></i>
                                Promo Code
                            </h3>
                            <div style="display: flex; gap: 15px; align-items: center; flex-wrap: wrap;">
                                <input type="text" id="phy-promo-input" placeholder="Enter promo code" style="flex: 1; min-width: 250px; padding: 15px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 10px; color: white; font-size: 16px;">
                                <button onclick="applyPhyPromoCode()" style="background: #6c5ce7; color: white; border: none; padding: 15px 25px; border-radius: 10px; cursor: pointer; font-weight: 600; font-size: 16px; transition: all 0.3s ease;">
                                    Apply
                                </button>
                            </div>
                            <div id="phy-promo-message" style="margin-top: 15px; font-size: 14px;"></div>
                        </div>
                        
                        <!-- Payment Methods -->
                        <div style="background: rgba(255,255,255,0.05); border-radius: 15px; padding: 30px; margin-bottom: 30px; border: 1px solid rgba(255,255,255,0.1);">
                            <h3 style="color: white; font-size: 20px; font-weight: 600; margin-bottom: 20px;">
                                <i class="fas fa-credit-card" style="margin-right: 10px; color: #6c5ce7;"></i>
                                Payment Method
                            </h3>
                            
                            <!-- Passcode Method -->
                            <div style="margin-bottom: 20px;">
                                <label style="display: flex; align-items: center; cursor: pointer; padding: 15px; background: rgba(255,255,255,0.05); border-radius: 10px; border: 2px solid transparent; transition: all 0.3s ease;" onclick="selectPhyPaymentMethod('passcode')">
                                    <input type="radio" name="phy-payment-method" value="passcode" style="margin-right: 15px; width: 20px; height: 20px;">
                                    <div>
                                        <div style="color: white; font-weight: 600; font-size: 18px;">Passcode Payment</div>
                                        <div style="color: rgba(255,255,255,0.7); font-size: 14px; margin-top: 5px;">Use special access code for instant payment</div>
                                    </div>
                                </label>
                                <div id="phy-passcode-section" style="margin-top: 15px; padding: 20px; background: rgba(255,255,255,0.03); border-radius: 10px; display: none;">
                                    <div style="display: flex; gap: 15px; align-items: center; flex-wrap: wrap;">
                                        <input type="text" id="phy-passcode-input" placeholder="Enter passcode" style="flex: 1; min-width: 250px; padding: 15px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 10px; color: white; font-size: 16px;">
                                        <button onclick="verifyPhyPasscode()" style="background: #28a745; color: white; border: none; padding: 15px 25px; border-radius: 10px; cursor: pointer; font-weight: 600; font-size: 16px; transition: all 0.3s ease;">
                                            Verify & Purchase
                                        </button>
                                    </div>
                                    <div id="phy-passcode-message" style="margin-top: 15px; font-size: 14px;"></div>
                                </div>
                            </div>
                            
                            <!-- Bank Payment Method -->
                            <div>
                                <label style="display: flex; align-items: center; cursor: pointer; padding: 15px; background: rgba(255,255,255,0.05); border-radius: 10px; border: 2px solid transparent; transition: all 0.3s ease;" onclick="selectPhyPaymentMethod('bank')">
                                    <input type="radio" name="phy-payment-method" value="bank" style="margin-right: 15px; width: 20px; height: 20px;">
                                    <div>
                                        <div style="color: white; font-weight: 600; font-size: 18px;">Online Payment</div>
                                        <div style="color: rgba(255,255,255,0.7); font-size: 14px; margin-top: 5px;">Pay with card, bank transfer, USSD, or mobile money</div>
                                    </div>
                                </label>
                                <div id="phy-bank-section" style="margin-top: 15px; display: none;">
                                    <button onclick="processPhyBankPayment()" style="background: #6c5ce7; color: white; border: none; padding: 20px 40px; border-radius: 10px; cursor: pointer; font-weight: 600; font-size: 18px; transition: all 0.3s ease; width: 100%; box-shadow: 0 4px 15px rgba(108, 92, 231, 0.3);">
                                        <i class="fas fa-shield-alt" style="margin-right: 10px;"></i>
                                        Pay Securely
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Banner Ads Section -->
                        <div style="margin-bottom: 30px;">
                            <h3 style="color: white; font-size: 20px; font-weight: 600; margin-bottom: 20px; text-align: center;">Sponsored</h3>
                            <div style="overflow-x: auto; scrollbar-width: none; -ms-overflow-style: none;">
                                <div style="display: flex; gap: 20px; padding: 10px 0; min-width: fit-content;">
                                    ${generatePhyBannerAdsHTML()}
                                </div>
                            </div>
                        </div>
                        
                        <!-- Footer -->
                        <div style="text-align: center; padding: 30px 20px; border-top: 1px solid rgba(255,255,255,0.1);">
                            <div style="color: rgba(255,255,255,0.8); font-size: 16px; margin-bottom: 10px;">
                                <i class="fas fa-shield-alt" style="margin-right: 8px; color: #28a745;"></i>
                                Your payment is secured with industry-standard encryption
                            </div>
                            <div style="color: rgba(255,255,255,0.6); font-size: 14px;">
                                Need help? Contact support at +234 9078139367 | 
                                <a href="https://rewarder-hub.vercel.app/" target="_blank" style="color: #6c5ce7; text-decoration: none;">rewarder-hub.vercel.app</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        `;
        
        document.body.insertAdjacentHTML('beforeend', pageHTML);
        
    } catch (error) {
        console.error('Error loading event details:', error);
        alert('Failed to load event details. Please try again.');
    }
}


function closePhyEventDetailPage() {
    const detailPage = document.getElementById('phyevent-detail-page');
    if (detailPage) {
        // Add fade-out animation
        detailPage.style.transition = 'opacity 0.3s ease';
        detailPage.style.opacity = '0';
        
        // Remove after animation completes
        setTimeout(() => {
            detailPage.remove();
        }, 300);
    }
    
    // Restore body scroll
    document.body.style.overflow = 'auto';
    
    // Show dashboard if hidden
    const dashboardPage = document.querySelector('.dashboard-page.active');
    if (dashboardPage) {
        dashboardPage.style.display = 'flex';
    }
}
// Generate Tickets HTML
function generatePhyTicketsHTML() {
    if (!currentPhyEventData || !currentPhyEventData.tickets) {
        return '<p style="color: rgba(255,255,255,0.7); text-align: center; grid-column: 1/-1;">No tickets available for this event.</p>';
    }
    
    return currentPhyEventData.tickets.map((ticket, index) => {
        const ticketId = `ticket_${index}`;
        const quantity = phyTicketCart[ticketId] || 0;
        
        return `
            <div style="background: rgba(255,255,255,0.05); border-radius: 12px; padding: 16px; border: 1px solid rgba(255,255,255,0.1); transition: all 0.3s ease; flex: 1; min-width: 250px; max-width: 300px;">
                <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 12px;">
                    <div style="flex: 1;">
                        <h4 style="color: white; font-size: 16px; font-weight: 600; margin: 0 0 4px 0;">${ticket.name || `Ticket ${index + 1}`}</h4>
                        <div style="color: #6c5ce7; font-size: 20px; font-weight: 700;">${ticket.price ? ticket.price.toLocaleString() : '0'}</div>
                    </div>
                    <div style="background: rgba(108,92,231,0.1); padding: 6px 8px; border-radius: 6px; border: 1px solid rgba(108,92,231,0.3);">
                        <i class="fas fa-ticket-alt" style="color: #6c5ce7; font-size: 12px;"></i>
                    </div>
                </div>
                
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                    <span style="color: rgba(255,255,255,0.7); font-size: 14px;">Quantity</span>
                    <div style="display: flex; align-items: center; gap: 12px; background: rgba(255,255,255,0.05); padding: 6px; border-radius: 8px;">
                        <button onclick="updatePhyTicketQuantity('${ticketId}', -1)" style="background: rgba(255,255,255,0.1); color: white; border: none; width: 28px; height: 28px; border-radius: 6px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 14px; font-weight: 600; transition: all 0.3s ease;">-</button>
                        <span id="quantity_${ticketId}" style="color: white; font-size: 16px; font-weight: 600; min-width: 20px; text-align: center;">${quantity}</span>
                        <button onclick="updatePhyTicketQuantity('${ticketId}', 1)" style="background: rgba(255,255,255,0.1); color: white; border: none; width: 28px; height: 28px; border-radius: 6px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 14px; font-weight: 600; transition: all 0.3s ease;">+</button>
                    </div>
                </div>
                
                <div style="color: rgba(255,255,255,0.5); font-size: 12px; text-align: center;">
                    Available: ${ticket.quantity || 'Unlimited'}  Max: 10 per type  Total: 10 max
                </div>
            </div>
        `;
    }).join('');
}

// Generate Banner Ads HTML
function generatePhyBannerAdsHTML() {
    const bannerAds = [
        { title: 'Premium Audio Equipment', description: 'Get the best sound for your events', color: '#FF6B6B', icon: 'fas fa-headphones' },
        { title: 'Event Photography', description: 'Capture your special moments', color: '#4ECDC4', icon: 'fas fa-camera' },
        { title: 'Catering Services', description: 'Delicious food for every occasion', color: '#45B7D1', icon: 'fas fa-utensils' },
        { title: 'Transportation', description: 'Easy transport to any venue', color: '#96CEB4', icon: 'fas fa-car' },
        { title: 'Stage & Lighting', description: 'Professional stage setup', color: '#FFEAA7', icon: 'fas fa-lightbulb' }
    ];
    
    return bannerAds.map(ad => `
        <div style="min-width: 280px; background: ${ad.color}; border-radius: 12px; padding: 20px; color: white; cursor: pointer; transition: all 0.3s ease; position: relative; overflow: hidden;" onclick="handlePhyBannerClick('${ad.title}')">
            <div style="position: absolute; top: -20px; right: -20px; width: 60px; height: 60px; background: rgba(255,255,255,0.1); border-radius: 50%;"></div>
            <i class="${ad.icon}" style="font-size: 32px; margin-bottom: 15px; display: block;"></i>
            <h4 style="font-size: 18px; font-weight: 600; margin-bottom: 8px;">${ad.title}</h4>
            <p style="font-size: 14px; opacity: 0.9; margin: 0;">${ad.description}</p>
        </div>
    `).join('');
}

// Update Ticket Quantity with Smart Limits
function updatePhyTicketQuantity(ticketId, change) {
    const currentQty = phyTicketCart[ticketId] || 0;
    
    // Calculate current total tickets
    const currentTotal = Object.values(phyTicketCart).reduce((total, qty) => total + qty, 0);
    const maxTotalTickets = 10;
    const maxPerTicketType = 10;
    
    // Calculate remaining tickets available
    const remainingTickets = maxTotalTickets - (currentTotal - currentQty);
    
    // Determine the maximum this ticket type can have
    const maxForThisTicket = Math.min(maxPerTicketType, remainingTickets);
    
    // Calculate new quantity with smart limits
    let newQty = currentQty + change;
    newQty = Math.max(0, Math.min(maxForThisTicket, newQty));
    
    // Update cart
    if (newQty === 0) {
        delete phyTicketCart[ticketId];
    } else {
        phyTicketCart[ticketId] = newQty;
    }
    
    // Update display
    document.getElementById(`quantity_${ticketId}`).textContent = newQty;
    
    // Update all ticket buttons to reflect new limits
    updateAllTicketButtons();
    updatePhyOrderSummary();
}

// Update all ticket buttons to show correct limits
function updateAllTicketButtons() {
    const currentTotal = Object.values(phyTicketCart).reduce((total, qty) => total + qty, 0);
    const maxTotalTickets = 10;
    const maxPerTicketType = 10;
    
    // Update each ticket type
    Object.keys(phyTicketCart).forEach(ticketId => {
        const currentQty = phyTicketCart[ticketId] || 0;
        const remainingTickets = maxTotalTickets - (currentTotal - currentQty);
        const maxForThisTicket = Math.min(maxPerTicketType, remainingTickets);
        
        // Enable/disable plus button
        const plusBtn = document.querySelector(`button[onclick="updatePhyTicketQuantity('${ticketId}', 1)"]`);
        if (plusBtn) {
            if (currentQty >= maxForThisTicket) {
                plusBtn.style.opacity = '0.3';
                plusBtn.style.cursor = 'not-allowed';
            } else {
                plusBtn.style.opacity = '1';
                plusBtn.style.cursor = 'pointer';
            }
        }
    });
}

// Update Order Summary
function updatePhyOrderSummary() {
    const summaryContent = document.getElementById('phy-summary-content');
    
    if (Object.keys(phyTicketCart).length === 0) {
        summaryContent.innerHTML = '<p style="color: rgba(255,255,255,0.7); font-size: 16px; text-align: center; margin: 40px 0;">Select tickets to see your order summary</p>';
        return;
    }
    
    let subtotal = 0;
    let totalQuantity = 0;
    let itemsHTML = '';
    
    Object.entries(phyTicketCart).forEach(([ticketId, quantity]) => {
        const ticketIndex = parseInt(ticketId.split('_')[1]);
        const ticket = currentPhyEventData.tickets[ticketIndex];
        const itemTotal = ticket.price * quantity;
        subtotal += itemTotal;
        totalQuantity += quantity;
        
        itemsHTML += `
            <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid rgba(255,255,255,0.1);">
                <div>
                    <div style="color: white; font-weight: 500;">${ticket.name}  ${quantity}</div>
                    <div style="color: rgba(255,255,255,0.6); font-size: 14px;">${ticket.price.toLocaleString()} each</div>
                </div>
                <div style="color: white; font-weight: 600;">${itemTotal.toLocaleString()}</div>
            </div>
        `;
    });
    
    const serviceFee = phyPromoApplied ? 0 : calculatePhyServiceFee(subtotal);
    const total = subtotal + serviceFee;
    
    summaryContent.innerHTML = `
        ${itemsHTML}
        <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid rgba(255,255,255,0.1);">
            <div style="color: rgba(255,255,255,0.8);">Subtotal (${totalQuantity} tickets)</div>
            <div style="color: white; font-weight: 600;">${subtotal.toLocaleString()}</div>
        </div>
        <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px 0;">
            <div style="color: rgba(255,255,255,0.8);">Service Fee ${phyPromoApplied ? '(Waived)' : ''}</div>
            <div style="color: ${phyPromoApplied ? '#28a745' : 'white'}; font-weight: 600;">${phyPromoApplied ? 'FREE' : '' + serviceFee.toLocaleString()}</div>
        </div>
        <div style="display: flex; justify-content: space-between; align-items: center; padding: 20px 0; border-top: 2px solid rgba(108,92,231,0.3); margin-top: 10px;">
            <div style="color: white; font-size: 20px; font-weight: 700;">Total</div>
            <div style="color: #6c5ce7; font-size: 24px; font-weight: 700;">${total.toLocaleString()}</div>
        </div>
    `;
}

// Promo Code Functions
async function applyPhyPromoCode() {
    const promoInput = document.getElementById('phy-promo-input');
    const promoMessage = document.getElementById('phy-promo-message');
    const promoCode = promoInput.value.trim().toUpperCase();
    
    if (!promoCode) {
        promoMessage.innerHTML = '<span style="color: #e74c3c;">Please enter a promo code</span>';
        return;
    }
    
    if (Object.keys(phyTicketCart).length === 0) {
        promoMessage.innerHTML = '<span style="color: #e74c3c;">Please select tickets first</span>';
        return;
    }
    
    try {
        // Check promo code in Firebase
        const eventDoc = await db.collection('physicalEvents').doc(currentPhyEventData.id).get();
        const eventData = eventDoc.data();
        
        if (!eventData.promoCode || eventData.promoCode !== promoCode) {
            promoMessage.innerHTML = '<span style="color: #e74c3c;">Invalid promo code</span>';
            return;
        }
        
        // Check usage limits
        const maxUsage = eventData.promoMaxUsage || 0;
        const currentUsage = eventData.promousagecount || 0;
        
        if (currentUsage >= maxUsage) {
            promoMessage.innerHTML = '<span style="color: #e74c3c;">Promo code usage limit reached</span>';
            return;
        }
        
        // Apply promo code (waive service fee)
        phyPromoApplied = true;
        promoMessage.innerHTML = '<span style="color: #28a745;"><i class="fas fa-check-circle"></i> Promo code applied! Service fee waived.</span>';
        promoInput.disabled = true;
        updatePhyOrderSummary();
        
    } catch (error) {
        console.error('Error applying promo code:', error);
        promoMessage.innerHTML = '<span style="color: #e74c3c;">Error applying promo code</span>';
    }
}

// Payment Method Selection
function selectPhyPaymentMethod(method) {
    // Reset radio buttons
    const radioButtons = document.querySelectorAll('input[name="phy-payment-method"]');
    radioButtons.forEach(radio => {
        radio.checked = false;
        radio.parentElement.style.borderColor = 'transparent';
    });
    
    // Select current method
    const selectedRadio = document.querySelector(`input[name="phy-payment-method"][value="${method}"]`);
    if (selectedRadio) {
        selectedRadio.checked = true;
        selectedRadio.parentElement.style.borderColor = '#6c5ce7';
    }
    
    // Show/hide relevant sections
    document.getElementById('phy-passcode-section').style.display = method === 'passcode' ? 'block' : 'none';
    document.getElementById('phy-bank-section').style.display = method === 'bank' ? 'block' : 'none';
}

// Passcode Payment - SIMPLE VERSION
async function verifyPhyPasscode() {
    const passcodeInput = document.getElementById('phy-passcode-input');
    const passcodeMessage = document.getElementById('phy-passcode-message');
    const passcode = passcodeInput.value.trim().toUpperCase();
    
    // Simple check: passcode = "ISMART"
    if (passcode !== 'ISMART') {
        passcodeMessage.innerHTML = '<span style="color: #e74c3c;">Invalid passcode</span>';
        return;
    }
    
    // Simple check: user selected tickets
    if (Object.keys(phyTicketCart).length === 0) {
        passcodeMessage.innerHTML = '<span style="color: #e74c3c;">Please select tickets first</span>';
        return;
    }
    
    // Process payment - SIMPLE
    try {
        passcodeMessage.innerHTML = '<span style="color: #6c5ce7;"><i class="fas fa-spinner fa-spin"></i> Processing...</span>';
        
        // Simple: just save tickets to Firebase
        await processPhyTicketPurchase('phypasscode', 'ISMART');
        
        passcodeMessage.innerHTML = '<span style="color: #28a745;"><i class="fas fa-check-circle"></i> Success!</span>';
        
        setTimeout(() => {
            closePhyEventDetailPage();
            alert('Tickets purchased with ISMART passcode!');
        }, 1000);
        
    } catch (error) {
        console.error(' Passcode payment error:', error);
        passcodeMessage.innerHTML = `<span style="color: #e74c3c;">Error: ${error.message}</span>`;
    }
}

// Bank Payment via Flutterwave
function processPhyBankPayment() {
    if (Object.keys(phyTicketCart).length === 0) {
        alert('Please select tickets first');
        return;
    }
    
    const selectedMethod = document.querySelector('input[name="phy-payment-method"]:checked');
    if (!selectedMethod || selectedMethod.value !== 'bank') {
        alert('Please select bank payment method');
        return;
    }
    
    // Calculate total
    let subtotal = 0;
    Object.entries(phyTicketCart).forEach(([ticketId, quantity]) => {
        const ticketIndex = parseInt(ticketId.split('_')[1]);
        const ticket = currentPhyEventData.tickets[ticketIndex];
        subtotal += ticket.price * quantity;
    });
    
    const serviceFee = phyPromoApplied ? 0 : calculatePhyServiceFee(subtotal);
    const total = subtotal + serviceFee;
    
    // Configure Flutterwave payment
    const paymentData = {
        public_key: "FLWPUBK-d3902fdb2f80f41ada9c077eb569466a-X",
        tx_ref: `phy_ticket_${currentPhyEventData.id}_${Date.now()}`,
        amount: total,
        currency: "NGN",
        country: "NG",
        payment_options: "card,ussd,banktransfer,mobilemoney",
        customer: {
            email: firebase.auth().currentUser.email,
            phone_number: "",
            name: firebase.auth().currentUser.displayName || "User"
        },
        customizations: {
            title: "Event Tickets - Rewarder",
            description: `Purchase tickets for ${currentPhyEventData.eventName}`,
            logo: "https://i.ibb.co/VpC27tbt/Rewarder-logo.png"
        },
       callback: (response) => {
    console.log(' Flutterwave callback response:', response);
    
    // Check for successful payment - Flutterwave can return different success statuses
    if (response.status === "successful" || response.status === "completed" || response.tx_ref) {
        console.log(' Payment successful, transaction ID:', response.transaction_id);
        processPhyTicketPurchase('phybankpayment', response.transaction_id || response.flw_ref)
            .then(() => {
                alert('Payment successful! Tickets purchased.');
                closePhyEventDetailPage();
            })
            .catch(error => {
                console.error('Error processing ticket purchase:', error);
                alert('Payment successful but error saving tickets. Contact support.');
            });
    } else if (response.status === "cancelled") {
        console.log(' Payment cancelled by user');
        alert('Payment was cancelled.');
    } else {
        console.log(' Payment failed:', response);
        alert('Payment failed. Please try again.');
    }
},
        onclose: () => {
            console.log('Payment modal closed');
        }
    };
    
    // Launch Flutterwave payment modal
    if (typeof FlutterwaveCheckout !== 'undefined') {
        FlutterwaveCheckout(paymentData);
    } else {
        alert('Payment system not available. Please try again later.');
    }
}

// Process Ticket Purchase (Individual Tickets)
async function processPhyTicketPurchase(paymentMethod, paymentId) {
    const currentUser = firebase.auth().currentUser;
    if (!currentUser) {
        throw new Error('User not authenticated');
    }
    
    try {
        const batch = db.batch();
        const tickets = [];
        
        // Generate individual tickets - SAVE TO PHYSICAL EVENTS DOC (like bank details)
        console.log(' Ticket cart:', phyTicketCart);
        console.log(' Event tickets:', currentPhyEventData.tickets);
        
        // Calculate total tickets being purchased
        const totalNewTickets = Object.values(phyTicketCart).reduce((total, qty) => total + qty, 0);
        
        // Very strict limit to prevent Firebase document size issues
        const maxTicketsPerPurchase = 10;
        
        if (totalNewTickets > maxTicketsPerPurchase) {
            throw new Error(`Sorry, due to system limitations, you can only purchase ${maxTicketsPerPurchase} tickets at once. Please reduce your quantity.`);
        }
        
        Object.entries(phyTicketCart).forEach(([ticketId, quantity]) => {
            const ticketIndex = parseInt(ticketId.split('_')[1]);
            const ticketData = currentPhyEventData.tickets[ticketIndex];
            
            console.log(' Processing ticket:', {ticketId, ticketIndex, ticketData, quantity});
            
            if (!ticketData) {
                console.error(' Ticket data not found for index:', ticketIndex);
                throw new Error(`Ticket data not found for index: ${ticketIndex}`);
            }
            
            for (let i = 0; i < quantity; i++) {
                const individualTicketId = `TKT-${Date.now()}-${Math.random().toString(36).substr(2, 5)}`;
                
                // Generate QR code data
                const qrData = {
                    ticketId: individualTicketId,
                    ticketName: ticketData.name,
                    eventId: currentPhyEventData.id,
                    eventName: currentPhyEventData.eventName,
                    eventStartDate: currentPhyEventData.startDateTime,
                    eventEndDate: currentPhyEventData.endDateTime,
                    eventLocation: currentPhyEventData.location,
                    eventBackground: currentPhyEventData.background?.data || null,
                    status: "unused"
                };
                
                const qrCodeString = btoa(JSON.stringify(qrData)); // Base64 encode
                
                const ticketRecord = {
                    boughtticketname: ticketData.name,
                    boughtticketbackground: ticketData.background || null,
                    eventbackground: currentPhyEventData.background || null,
                    physicaleventid: currentPhyEventData.id,
                    ticketid: individualTicketId,
                    eventname: currentPhyEventData.eventName,
                    eventlink: currentPhyEventData.eventLink,
                    boughtticketqrcode: qrCodeString,
                    boughtticketstatus: 'unused',
                    bouhghtticketphypaymentmethod: paymentMethod,
                    userId: currentUser.uid,
                    date: new Date().toISOString(),
                    boughtticketsession: 'successfully paid'
                };
                
                // Save to separate BoughtTicket collection to avoid document size limits
                const ticketRef = db.collection('BoughtTicket').doc(individualTicketId);
                batch.set(ticketRef, ticketRecord);
                tickets.push(ticketRecord);
            }
        });
        
        // Commit all ticket saves to separate collection
        await batch.commit();
        
        
// UPDATE SOLD STATS - ADD THIS SECTION:
console.log(' Updating sold stats in physical event...');
const purchasedTicketCounts = [];
Object.entries(phyTicketCart).forEach(([ticketId, quantity]) => {
    const ticketIndex = parseInt(ticketId.split('_')[1]);
    purchasedTicketCounts.push([ticketIndex, quantity]);
});

await updatePhysicalEventSoldStats(currentPhyEventData.id, purchasedTicketCounts);

      
// Update promo code usage if applied (EXISTING CODE - keep this)
if (phyPromoApplied) {
    const eventRef = db.collection('physicalEvents').doc(currentPhyEventData.id);
    const eventDoc = await eventRef.get();
    const currentUsage = eventDoc.data().promousagecount || 0;
    
    await eventRef.update({
        promousagecount: currentUsage + 1
    });
        }
        
        console.log(` Successfully purchased ${tickets.length} tickets:`, tickets);
        
        return tickets;
        
    } catch (error) {
        console.error(' Error processing ticket purchase:', error);
        throw error;
    }
}

// ADD THIS FUNCTION before processPhyTicketPurchase:
async function updatePhysicalEventSoldStats(eventId, purchasedTickets) {
    try {
        const db = firebase.firestore();
        const eventRef = db.collection('physicalEvents').doc(eventId);
        
        await db.runTransaction(async (transaction) => {
            const eventDoc = await transaction.get(eventRef);
            
            if (eventDoc.exists) {
                const eventData = eventDoc.data();
                const tickets = [...eventData.tickets]; // Copy the tickets array
                
                // Count purchases by ticket index
                purchasedTickets.forEach(([ticketIndex, quantity]) => {
                    if (tickets[ticketIndex]) {
                        tickets[ticketIndex].sold = (tickets[ticketIndex].sold || 0) + quantity;
                        console.log(` Updated ticket ${ticketIndex} sold count: +${quantity}`);
                    }
                });
                
                // Update the document
                transaction.update(eventRef, {
                    tickets: tickets,
                    updatedAt: new Date().toISOString()
                });
            }
        });
        
        console.log(' Physical event sold stats updated successfully');
        
    } catch (error) {
        console.error(' Error updating physical event sold stats:', error);
    }
}

// Banner Ad Click Handler
function handlePhyBannerClick(adTitle) {
    console.log('Banner ad clicked:', adTitle);
    alert(`Interested in ${adTitle}? Contact us for more information!`);
}

// Sharephy Modal Functions
function openSharephyModal(eventLink) {
    console.log('Opening sharephy modal for:', eventLink);
    
    // Create modal if it doesn't exist
    if (!document.getElementById('sharephyModal')) {
        const modal = document.createElement('div');
        modal.id = 'sharephyModal';
        modal.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: none; justify-content: center; align-items: center; z-index: 10000;';
        modal.innerHTML = `
                <div style="background: white; border-radius: 15px; padding: 30px; max-width: 500px; width: 90%; max-height: 80vh; overflow-y: auto; position: relative; box-shadow: 0 20px 40px rgba(0,0,0,0.3);">
                    <button onclick="closeSharephyModal()" style="position: absolute; top: 15px; right: 15px; background: none; border: none; font-size: 24px; cursor: pointer; color: #666; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; transition: all 0.3s ease;">
                        <i class="fas fa-times"></i>
                    </button>
                    
                    <div style="text-align: center; margin-bottom: 25px;">
                        <i class="fas fa-share-alt" style="font-size: 48px; color: #6c5ce7; margin-bottom: 15px;"></i>
                        <h2 style="margin: 0 0 10px 0; color: #2d3436; font-size: 24px; font-weight: 600;">Share Event</h2>
                        <p style="color: #636e72; margin: 0; font-size: 16px;">Share this amazing event with your friends!</p>
                    </div>
                    
                    <div style="background: #f8f9fa; border-radius: 12px; padding: 20px; margin-bottom: 25px;">
                        <label style="display: block; font-weight: 600; color: #2d3436; margin-bottom: 10px; font-size: 14px;">Event Link:</label>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <input type="text" id="sharephyLink" readonly style="flex: 1; padding: 12px 15px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 14px; background: white; color: #495057; font-family: monospace;">
                            <button onclick="copySharephyLink()" id="copyLinkBtn" style="background: #6c5ce7; color: white; border: none; padding: 12px 16px; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 14px; transition: all 0.3s ease; display: flex; align-items: center; gap: 5px;">
                                <i class="fas fa-copy"></i> Copy
                            </button>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <h3 style="margin: 0 0 15px 0; color: #2d3436; font-size: 18px; font-weight: 600;">Share on Social Media</h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 12px;">
                            <button onclick="shareOnWhatsApp()" style="background: #25D366; color: white; border: none; padding: 12px; border-radius: 10px; cursor: pointer; font-weight: 600; font-size: 14px; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; gap: 8px;">
                                <i class="fab fa-whatsapp" style="font-size: 16px;"></i> WhatsApp
                            </button>
                            <button onclick="shareOnTwitter()" style="background: #1DA1F2; color: white; border: none; padding: 12px; border-radius: 10px; cursor: pointer; font-weight: 600; font-size: 14px; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; gap: 8px;">
                                <i class="fab fa-twitter" style="font-size: 16px;"></i> Twitter
                            </button>
                            <button onclick="shareOnFacebook()" style="background: #4267B2; color: white; border: none; padding: 12px; border-radius: 10px; cursor: pointer; font-weight: 600; font-size: 14px; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; gap: 8px;">
                                <i class="fab fa-facebook-f" style="font-size: 16px;"></i> Facebook
                            </button>
                            <button onclick="shareOnTelegram()" style="background: #0088cc; color: white; border: none; padding: 12px; border-radius: 10px; cursor: pointer; font-weight: 600; font-size: 14px; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; gap: 8px;">
                                <i class="fab fa-telegram-plane" style="font-size: 16px;"></i> Telegram
                            </button>
                        </div>
                    </div>
                    
                    <div style="border-top: 2px solid #e9ecef; padding-top: 20px;">
                        <button onclick="shareViaWebShare()" style="width: 100%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 15px; border-radius: 10px; cursor: pointer; font-weight: 600; font-size: 16px; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; gap: 10px;">
                            <i class="fas fa-share" style="font-size: 16px;"></i> More Sharing Options
                        </button>
                    </div>
                </div>
        `;
        document.body.appendChild(modal);
    }
    
    // Set the event link
    const eventUrl = `https://rewarder-hub.vercel.app/event/${eventLink}`;
    document.getElementById('sharephyLink').value = eventUrl;
    
    // Store current event link for sharing functions
    window.currentShareEventLink = eventUrl;
    
    // Show modal
    const modal = document.getElementById('sharephyModal');
    modal.style.display = 'flex';
    console.log('Modal should be visible now');
}

function closeSharephyModal() {
    document.getElementById('sharephyModal').style.display = 'none';
}

function copySharephyLink() {
    const linkInput = document.getElementById('sharephyLink');
    const copyBtn = document.getElementById('copyLinkBtn');
    
    linkInput.select();
    linkInput.setSelectionRange(0, 99999);
    
    navigator.clipboard.writeText(linkInput.value).then(() => {
        copyBtn.innerHTML = '<i class="fas fa-check"></i> Copied!';
        copyBtn.style.background = '#2ecc71';
        
        setTimeout(() => {
            copyBtn.innerHTML = '<i class="fas fa-copy"></i> Copy';
            copyBtn.style.background = '#6c5ce7';
        }, 2000);
    }).catch(() => {
        // Fallback for older browsers
        document.execCommand('copy');
        copyBtn.innerHTML = '<i class="fas fa-check"></i> Copied!';
        copyBtn.style.background = '#2ecc71';
        
        setTimeout(() => {
            copyBtn.innerHTML = '<i class="fas fa-copy"></i> Copy';
            copyBtn.style.background = '#6c5ce7';
        }, 2000);
    });
}

function shareOnWhatsApp() {
    const text = `Check out this amazing event! ${window.currentShareEventLink}`;
    const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(text)}`;
    window.open(whatsappUrl, '_blank');
}

function shareOnTwitter() {
    const text = `Check out this amazing event!`;
    const twitterUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(window.currentShareEventLink)}`;
    window.open(twitterUrl, '_blank');
}

function shareOnFacebook() {
    const facebookUrl = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(window.currentShareEventLink)}`;
    window.open(facebookUrl, '_blank');
}

function shareOnTelegram() {
    const text = `Check out this amazing event! ${window.currentShareEventLink}`;
    const telegramUrl = `https://t.me/share/url?url=${encodeURIComponent(window.currentShareEventLink)}&text=${encodeURIComponent(text)}`;
    window.open(telegramUrl, '_blank');
}

function shareViaWebShare() {
    if (navigator.share) {
        navigator.share({
            title: 'Amazing Event',
            text: 'Check out this amazing event!',
            url: window.currentShareEventLink
        }).catch(console.error);
    } else {
        // Fallback - copy to clipboard
        copySharephyLink();
    }
}

// Handle escape key for closing
document.addEventListener('keydown', function(e) {
  if (e.key === 'Escape') {
    const modal = document.getElementById('withdrawModal');
    if (modal && modal.style.display === 'block') {
      closeWithdrawModal();
    }
  }
});

// Export functions for global use
window.openWithdrawModal = openWithdrawModal;
window.closeWithdrawModal = closeWithdrawModal;


// Mobile Modal Scroll Fix - Scrolling and Closing Only
function openTransactionHistoryModal() {
  const modal = document.getElementById('transactionHistoryModal');
  modal.style.display = 'block';
  
  // Scroll to top of modal
  modal.scrollTop = 0;
  
  // For mobile devices, prevent body scroll
  if (window.innerWidth <= 768) {
    document.body.style.overflow = 'hidden';
    document.body.style.position = 'fixed';
    document.body.style.width = '100%';
    document.body.style.top = `-${window.scrollY}px`;
  }
}

function closeTransactionHistoryModal() {
  const modal = document.getElementById('transactionHistoryModal');
  modal.style.display = 'none';
  
  // Restore body scroll on mobile
  if (window.innerWidth <= 768) {
    const scrollY = document.body.style.top;
    document.body.style.overflow = '';
    document.body.style.position = '';
    document.body.style.width = '';
    document.body.style.top = '';
    window.scrollTo(0, parseInt(scrollY || '0') * -1);
  }
}

function openTransactionDetailsModal() {
  const modal = document.getElementById('transactionDetailsModal');
  modal.style.display = 'block';
  
  // Scroll to top of modal
  modal.scrollTop = 0;
  
  // For mobile devices, prevent body scroll
  if (window.innerWidth <= 768) {
    document.body.style.overflow = 'hidden';
    document.body.style.position = 'fixed';
    document.body.style.width = '100%';
    document.body.style.top = `-${window.scrollY}px`;
  }
}

function closeTransactionDetailsModal() {
  const modal = document.getElementById('transactionDetailsModal');
  modal.style.display = 'none';
  
  // Restore body scroll on mobile
  if (window.innerWidth <= 768) {
    const scrollY = document.body.style.top;
    document.body.style.overflow = '';
    document.body.style.position = '';
    document.body.style.width = '';
    document.body.style.top = '';
    window.scrollTo(0, parseInt(scrollY || '0') * -1);
  }
}

document.addEventListener('DOMContentLoaded', function() {
  const historyModal = document.getElementById('transactionHistoryModal');
  const historyModalContent = document.querySelector('.Historymodal-content');
  const detailsModal = document.getElementById('transactionDetailsModal');
  const detailsModalContent = document.querySelectorAll('.Historymodal-content')[1];
  
  // Transaction History Modal Event Handlers
  if (historyModal && historyModalContent) {
    // Prevent modal from closing when touching content
    historyModalContent.addEventListener('touchstart', function(e) {
      e.stopPropagation();
    });
    
    historyModalContent.addEventListener('touchmove', function(e) {
      e.stopPropagation();
    });
    
    // Close modal when touching backdrop
    historyModal.addEventListener('touchstart', function(e) {
      if (e.target === historyModal) {
        closeTransactionHistoryModal();
      }
    });
    
    // Close modal when clicking backdrop
    historyModal.addEventListener('click', function(e) {
      if (e.target === historyModal) {
        closeTransactionHistoryModal();
      }
    });
    
    // Resize handler for orientation changes
    window.addEventListener('orientationchange', function() {
      setTimeout(function() {
        if (historyModal.style.display === 'block') {
          historyModal.scrollTop = 0;
        }
      }, 100);
    });
  }
  
  // Transaction Details Modal Event Handlers
  if (detailsModal && detailsModalContent) {
    // Prevent modal from closing when touching content
    detailsModalContent.addEventListener('touchstart', function(e) {
      e.stopPropagation();
    });
    
    detailsModalContent.addEventListener('touchmove', function(e) {
      e.stopPropagation();
    });
    
    // Close modal when touching backdrop
    detailsModal.addEventListener('touchstart', function(e) {
      if (e.target === detailsModal) {
        closeTransactionDetailsModal();
      }
    });
    
    // Close modal when clicking backdrop
    detailsModal.addEventListener('click', function(e) {
      if (e.target === detailsModal) {
        closeTransactionDetailsModal();
      }
    });
    
    // Resize handler for orientation changes
    window.addEventListener('orientationchange', function() {
      setTimeout(function() {
        if (detailsModal.style.display === 'block') {
          detailsModal.scrollTop = 0;
        }
      }, 100);
    });
  }
  
  // Close button event listeners for Transaction History Modal
  const historyCloseButtons = document.querySelectorAll('.close-History, #closetransactionhistorymodal');
  historyCloseButtons.forEach(function(btn) {
    btn.addEventListener('click', closeTransactionHistoryModal);
  });
  
  // Close button event listeners for Transaction Details Modal
  const detailsCloseButtons = document.querySelectorAll('#closetransactiondetailsmodal, #closeDetailsBtn');
  detailsCloseButtons.forEach(function(btn) {
    btn.addEventListener('click', closeTransactionDetailsModal);
  });
});

// Handle escape key for closing
document.addEventListener('keydown', function(e) {
  if (e.key === 'Escape') {
    const historyModal = document.getElementById('transactionHistoryModal');
    const detailsModal = document.getElementById('transactionDetailsModal');
    
    if (historyModal && historyModal.style.display === 'block') {
      closeTransactionHistoryModal();
    }
    
    if (detailsModal && detailsModal.style.display === 'block') {
      closeTransactionDetailsModal();
    }
  }
});

// Export functions for global use
window.openTransactionHistoryModal = openTransactionHistoryModal;
window.closeTransactionHistoryModal = closeTransactionHistoryModal;
window.openTransactionDetailsModal = openTransactionDetailsModal;
window.closeTransactionDetailsModal = closeTransactionDetailsModal;


// JavaScript to fix the Font Awesome icon and handle the game portal
document.addEventListener('DOMContentLoaded', function() {
    // Fix for Font Awesome icon
    const gameIcon = document.querySelector('.action-icon.game-icon');
    
    // Clear the icon container and add a fresh icon
    if (gameIcon) {
        gameIcon.innerHTML = '<i class="fas fa-gamepad"></i>';
    }
    
    // Game portal functionality
    const gameButton = document.querySelector('.action-btn.Game-btn');
    const gamePortal = document.querySelector('.game-portal-container');
    const closePortalBtn = document.querySelector('.close-portal-btn');
    
    // Add click event listener to the game button
    gameButton.addEventListener('click', function() {
        // Show the game portal
        gamePortal.style.display = 'block';
        
        // Prevent scrolling on the body when portal is open
        document.body.style.overflow = 'hidden';
    });
    
    // Add click event listener to the close button
    closePortalBtn.addEventListener('click', function() {
        // Hide the game portal
        gamePortal.style.display = 'none';
        
        // Re-enable scrolling on the body
        document.body.style.overflow = 'auto';
    });
});

document.addEventListener('DOMContentLoaded', function() {
    // Get the rewarder button and modal
    const rewarderBtn = document.querySelector('.action-btn.rewarder-btn');
    const rewarderModal = document.getElementById('rewarderModal');
    const closeRewarderModal = document.querySelector('.close-rewarder-modal');
    
    // Open modal when rewarder button is clicked
    rewarderBtn.addEventListener('click', function() {
        rewarderModal.classList.remove('hidden');
        rewarderModal.classList.add('active');
        document.body.style.overflow = 'hidden'; // Prevent scrolling
    });
    
    // Close modal when close button is clicked
    if (closeRewarderModal) {
        closeRewarderModal.addEventListener('click', function() {
            rewarderModal.classList.remove('active');
            setTimeout(() => {
                rewarderModal.classList.add('hidden');
                document.body.style.overflow = ''; // Re-enable scrolling
            }, 300);
        });
    }
    
    // Close modal when clicking outside the modal content
    rewarderModal.addEventListener('click', function(event) {
        if (event.target === rewarderModal) {
            rewarderModal.classList.remove('active');
            setTimeout(() => {
                rewarderModal.classList.add('hidden');
                document.body.style.overflow = ''; // Re-enable scrolling
            }, 300);
        }
    });
});


document.addEventListener('DOMContentLoaded', function() {
    // Get the creator button and the creator modal
    const creatorBtn = document.querySelector('.creator-btn');
    const creatorModal = document.querySelector('#creatorModal');
    
    // Hide the creator modal initially
    if (creatorModal) {
        creatorModal.style.display = 'none';
    }
    
    // Add click event listener to the creator button
    if (creatorBtn && creatorModal) {
        creatorBtn.addEventListener('click', function() {
            // Toggle the display of the creator modal
            if (creatorModal.style.display === 'none' || creatorModal.style.display === '') {
                // Show the creator modal
                creatorModal.style.display = 'flex';
                document.body.style.overflow = 'hidden';
                // Optional: Add a class for additional styling
                creatorModal.classList.add('creator-modal-open');
            } else {
                // Hide the creator modal
                creatorModal.style.display = 'none';
                document.body.style.overflow = 'auto';
                // Optional: Remove the class
                creatorModal.classList.remove('creator-modal-open');
            }
        });
    }
    
   
    // Close button functionality
    const creatorCloseBtn = document.querySelector('.creator-modal-close-btn');
    if (creatorCloseBtn && creatorModal) {
        creatorCloseBtn.addEventListener('click', function() {
            creatorModal.style.display = 'none';
            document.body.style.overflow = 'auto';
            creatorModal.classList.remove('creator-modal-open');
        });
    }
    
    // Close when clicking outside the creator modal
    document.addEventListener('click', function(event) {
        // Check if the click is outside the creator modal and not on the trigger button
        if (creatorModal && 
            creatorModal.style.display === 'flex' && 
            !creatorModal.querySelector('.creator-modal-container').contains(event.target) && 
            !creatorBtn.contains(event.target)) {
            
            creatorModal.style.display = 'none';
            document.body.style.overflow = 'auto';
            creatorModal.classList.remove('creator-modal-open');
        }
    });
});

// Placeholder functions for card buttons (you'll tell me what these should do later)
function openEntertainmentEvent() {
    console.log('Entertainment Event clicked');
    // You'll tell me what happens here
}

function openSportEvent() {
    console.log('Sport Event clicked');
    // You'll tell me what happens here
}

function openAwardCeremony() {
    console.log('Award Ceremony clicked');
    // You'll tell me what happens here
}

document.addEventListener('DOMContentLoaded', function() {
    // Get the entertainment event page
    const entertainmentEventPage = document.querySelector('#entertainmentEventPage');
    
    // Hide the entertainment event page initially
    if (entertainmentEventPage) {
        entertainmentEventPage.style.display = 'none';
    }
    
    // Close button functionality
    const closeEntertainmentEventPageBtn = document.querySelector('.close-entertainment-event-page-btn');
    if (closeEntertainmentEventPageBtn && entertainmentEventPage) {
        closeEntertainmentEventPageBtn.addEventListener('click', function() {
            entertainmentEventPage.style.display = 'none';
            document.body.style.overflow = 'auto';
        });
    }
});

// Open Entertainment Event Page (called from creator modal)
function openEntertainmentEvent() {
    const entertainmentEventPage = document.querySelector('#entertainmentEventPage');
    const creatorModal = document.querySelector('#creatorModal');
    
    if (entertainmentEventPage) {
        // Hide creator modal first
        if (creatorModal) {
            creatorModal.style.display = 'none';
        }
        
        // Show entertainment event page
        entertainmentEventPage.style.display = 'block';
        document.body.style.overflow = 'auto'; // Allow scrolling on the page
    }
}

// Switch Entertainment Tabs
function switchEntertainmentTab(tabName) {
    // Remove active class from all tabs and content
    document.querySelectorAll('.entertainment-tab-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    document.querySelectorAll('.entertainment-tab-pane').forEach(content => {
        content.classList.remove('active');
    });
    
    // Add active class to clicked tab and corresponding content
    document.querySelector(`#${tabName}EntertainmentEvent`).classList.add('active');
    document.getElementById(`entertainment-${tabName}-tab`).classList.add('active');
}

document.addEventListener('DOMContentLoaded', function() {
    // Get the host entertainment popup
    const hostEntertainmentPopup = document.querySelector('#hostEntertainmentPopup');
    
    // Hide the popup initially
    if (hostEntertainmentPopup) {
        hostEntertainmentPopup.style.display = 'none';
    }
    
    // Close button functionality
    const closeHostEntertainmentPopupBtn = document.querySelector('#closeHostEntertainmentPopupBtn');
    if (closeHostEntertainmentPopupBtn && hostEntertainmentPopup) {
        closeHostEntertainmentPopupBtn.addEventListener('click', function() {
            hostEntertainmentPopup.style.display = 'none';
            document.body.style.overflow = 'auto';
        });
    }
    
    // Close when clicking outside
    hostEntertainmentPopup.addEventListener('click', function(event) {
        if (event.target === hostEntertainmentPopup) {
            hostEntertainmentPopup.style.display = 'none';
            document.body.style.overflow = 'auto';
        }
    });
    
    // Initialize fee calculations
    setupFeeCalculations();
    
    // Initialize word counter
    setupWordCounter();
    
    // Initialize form validation
    setupFormValidation();
});


// Add this to the existing entertainment-event-page.js file

document.addEventListener('DOMContentLoaded', function() {
    // Existing code...
    
    // Host Entertainment Event button functionality
    const hostEntertainmentEventBtn = document.querySelector('#hostEntertainmentEvent');
    if (hostEntertainmentEventBtn) {
        hostEntertainmentEventBtn.addEventListener('click', function() {
            openHostEntertainmentPopup();
        });
    }
});

// Event type data configuration
const eventTypeData = {
    medium: {
        categories: ['singing', 'dancing', 'comedy', 'poetry', 'storytelling', 'music performance'],
        durations: ['3 days', '7 days', '14 days', '30 days'],
        participantRange: { min: 10, max: 50 },
        entryFeeDefault: 30,
        votingFeeDefault: 20,
        creationFee: { full: 40, discounted: 25 }
    },
    tactical: {
        categories: ['talent showcase', 'skill competition', 'creative challenge', 'performance battle'],
        durations: ['3 days', '7 days', '14 days', '30 days', '45 days', '60 days'],
        participantRange: { min: 10, max: 30 },
        entryFeeDefault: 40,
        votingFeeDefault: 35,
        creationFee: { full: 75, discounted: 43 }
    },
    bigRush: {
        categories: ['amazing inventions', 'pitch deck'],
        durations: ['3 days', '7 days', '14 days', '30 days', '45 days'],
        participantRange: { min: 10, max: 30 },
        entryFeeDefault: 70,
        votingFeeDefault: 50,
        creationFee: { full: 90, discounted: 60 }
    }
};

// Valid promo codes
const validPromoCodes = ['Bisask19', 'nig2025', 'Ismartdc'];

// Custom categories storage
let customCategories = {
    medium: [],
    tactical: [],
    bigRush: []
};

// Tags and rules storage
let hashtags = [];
let startags = [];
let eventRules = [];

// Current user's TC balance
let currentUserBalance = 0;

// Update the openHostEntertainmentPopup function to ensure events are loaded
function openHostEntertainmentPopup() {
    const hostEntertainmentPopup = document.querySelector('#hostEntertainmentPopup');
    if (hostEntertainmentPopup) {
        hostEntertainmentPopup.style.display = 'flex';
        document.body.style.overflow = 'hidden';
        
        // Load user's TC balance
        loadUserBalance();
        
        // Also refresh events in the background
        loadExistingEvents();
    }
}


// Close popup
document.addEventListener('DOMContentLoaded', function() {
    const closeBtn = document.getElementById('closeHostEntertainmentPopupBtn');
    if (closeBtn) {
        closeBtn.addEventListener('click', function() {
            document.getElementById('hostEntertainmentPopup').style.display = 'none';
            document.body.style.overflow = 'auto';
        });
    }
    
    // Initialize form validation and other features
    setupFormValidation();
    setupWordCounter();
    setupFeeCalculations();
});

// Load user's TC balance
async function loadUserBalance() {
    try {
        const user = auth.currentUser;
        if (user) {
            const walletDoc = await db.collection('wallets').doc(user.uid).get();
            if (walletDoc.exists) {
                currentUserBalance = walletDoc.data().balance || 0;
                console.log('User TC Balance:', currentUserBalance);
            }
        }
    } catch (error) {
        console.error('Error loading user balance:', error);
        currentUserBalance = 0;
    }
}

// Toggle payment method
function togglePaymentMethod(method) {
    const promoCodeSection = document.getElementById('promoCodeSection');
    const tcBalanceRadio = document.getElementById('tcBalancePayment');
    const promoCodeRadio = document.getElementById('promoCodePayment');
    
    if (method === 'promoCode') {
        promoCodeSection.style.display = 'block';
        promoCodeRadio.checked = true;
        tcBalanceRadio.checked = false;
    } else {
        promoCodeSection.style.display = 'none';
        tcBalanceRadio.checked = true;
        promoCodeRadio.checked = false;
        document.getElementById('promoCodeInput').value = '';
    }
    
    updatePaymentSummary();
}

// Update event type options
function updateEventTypeOptions() {
    const eventType = document.getElementById('eventType').value;
    const categoryGroup = document.getElementById('categoryGroup');
    const durationGroup = document.getElementById('durationGroup');
    const participantsGroup = document.getElementById('participantsGroup');
    const entryFeeGroup = document.getElementById('entryFeeGroup');
    const votingFeeGroup = document.getElementById('votingFeeGroup');
    const eventNameGroup = document.getElementById('eventNameGroup');
    const descriptionGroup = document.getElementById('descriptionGroup');
    const backgroundGroup = document.getElementById('backgroundGroup');
    const tagsGroup = document.getElementById('tagsGroup');
    const rulesGroup = document.getElementById('rulesGroup');
    const paymentGroup = document.getElementById('paymentGroup');
    const submitGroup = document.getElementById('submitGroup');
    
    if (eventType) {
        const data = eventTypeData[eventType];
        
        // Show all form groups
        categoryGroup.style.display = 'block';
        durationGroup.style.display = 'block';
        participantsGroup.style.display = 'block';
        entryFeeGroup.style.display = 'block';
        votingFeeGroup.style.display = 'block';
        eventNameGroup.style.display = 'block';
        descriptionGroup.style.display = 'block';
        backgroundGroup.style.display = 'block';
        tagsGroup.style.display = 'block';
        rulesGroup.style.display = 'block';
        paymentGroup.style.display = 'block';
        submitGroup.style.display = 'block';
        
        // Update categories
        updateCategories(eventType, data.categories);
        
        // Update durations
        updateDurations(data.durations);
        
        // Update participant limits
        updateParticipantLimits(data.participantRange);
        
        // Update fee defaults
        updateFeeDefaults(data.entryFeeDefault, data.votingFeeDefault);
        
        // Update payment summary
        updatePaymentSummary(eventType);
        
    } else {
        // Hide all form groups
        categoryGroup.style.display = 'none';
        durationGroup.style.display = 'none';
        participantsGroup.style.display = 'none';
        entryFeeGroup.style.display = 'none';
        votingFeeGroup.style.display = 'none';
        eventNameGroup.style.display = 'none';
        descriptionGroup.style.display = 'none';
        backgroundGroup.style.display = 'none';
        tagsGroup.style.display = 'none';
        rulesGroup.style.display = 'none';
        paymentGroup.style.display = 'none';
        submitGroup.style.display = 'none';
    }
}

// Update categories dropdown
function updateCategories(eventType, categories) {
    const categorySelect = document.getElementById('eventCategory');
    categorySelect.innerHTML = '<option value="">Select Category</option>';
    
    // Add default categories
    categories.forEach(category => {
        const option = document.createElement('option');
        option.value = category;
        option.textContent = category.charAt(0).toUpperCase() + category.slice(1);
        categorySelect.appendChild(option);
    });
    
    // Add custom categories
    if (customCategories[eventType] && customCategories[eventType].length > 0) {
        customCategories[eventType].forEach(category => {
            const option = document.createElement('option');
            option.value = category;
            option.textContent = category;
            categorySelect.appendChild(option);
        });
    }
}

// Update durations dropdown
function updateDurations(durations) {
    const durationSelect = document.getElementById('eventDuration');
    durationSelect.innerHTML = '<option value="">Select Duration</option>';
    
    durations.forEach(duration => {
        const option = document.createElement('option');
        option.value = duration;
        option.textContent = duration;
        durationSelect.appendChild(option);
    });
}

// Update participant limits
function updateParticipantLimits(range) {
    const participantsInput = document.getElementById('maxParticipants');
    const participantsHelp = document.getElementById('participantsHelp');
    
    participantsInput.min = range.min;
    participantsInput.max = range.max;
    participantsInput.placeholder = range.min.toString();
    participantsHelp.textContent = `Minimum: ${range.min}, Maximum: ${range.max}`;
}

// Update fee defaults
function updateFeeDefaults(entryDefault, votingDefault) {
    const entryFeeInput = document.getElementById('entryFee');
    const votingFeeInput = document.getElementById('votingFee');
    const entryFeeNaira = document.getElementById('entryFeeNaira');
    const votingFeeNaira = document.getElementById('votingFeeNaira');
    
    entryFeeInput.placeholder = entryDefault.toString();
    votingFeeInput.placeholder = votingDefault.toString();
    
    entryFeeNaira.textContent = ` ${entryDefault * 15}`;
    votingFeeNaira.textContent = ` ${votingDefault * 15}`;
}

// Toggle custom category input
function toggleCustomCategory() {
    const customInput = document.querySelector('.custom-category-input');
    const toggleBtn = document.querySelector('.custom-category-toggle');
    
    if (customInput.style.display === 'none' || !customInput.style.display) {
        customInput.style.display = 'flex';
        toggleBtn.textContent = 'Cancel';
    } else {
        customInput.style.display = 'none';
        toggleBtn.textContent = 'Add Custom Category';
        document.getElementById('customCategory').value = '';
    }
}

// Add custom category
function addCustomCategory() {
    const eventType = document.getElementById('eventType').value;
    const customCategoryInput = document.getElementById('customCategory');
    const categoryValue = customCategoryInput.value.trim();
    
    if (categoryValue && eventType) {
        if (!customCategories[eventType]) {
            customCategories[eventType] = [];
        }
        
        if (!customCategories[eventType].includes(categoryValue)) {
            customCategories[eventType].push(categoryValue);
            
            const data = eventTypeData[eventType];
            updateCategories(eventType, data.categories);
            
            document.getElementById('eventCategory').value = categoryValue;
            
            customCategoryInput.value = '';
            toggleCustomCategory();
        }
    }
}

// Toggle entry fee
function toggleEntryFee() {
    const entryFeeInput = document.getElementById('entryFee');
    const noEntryFeeBtn = document.getElementById('noEntryFeeBtn');
    
    if (noEntryFeeBtn.classList.contains('active')) {
        noEntryFeeBtn.classList.remove('active');
        entryFeeInput.disabled = false;
        noEntryFeeBtn.textContent = 'No Entry Fee';
    } else {
        noEntryFeeBtn.classList.add('active');
        entryFeeInput.disabled = true;
        entryFeeInput.value = '';
        noEntryFeeBtn.textContent = 'Enable Entry Fee';
    }
    
    updatePaymentSummary();
}

// Toggle voting fee
function toggleVotingFee() {
    const votingFeeInput = document.getElementById('votingFee');
    const noVotingFeeBtn = document.getElementById('noVotingFeeBtn');
    
    if (noVotingFeeBtn.classList.contains('active')) {
        noVotingFeeBtn.classList.remove('active');
        votingFeeInput.disabled = false;
        noVotingFeeBtn.textContent = 'No Voting Fee';
    } else {
        noVotingFeeBtn.classList.add('active');
        votingFeeInput.disabled = true;
        votingFeeInput.value = '';
        noVotingFeeBtn.textContent = 'Enable Voting Fee';
    }
    
    updatePaymentSummary();
}

// Setup fee calculations
function setupFeeCalculations() {
    const entryFeeInput = document.getElementById('entryFee');
    const votingFeeInput = document.getElementById('votingFee');
    
    if (entryFeeInput) {
        entryFeeInput.addEventListener('input', function() {
            const value = parseInt(this.value) || 0;
            const nairaValue = value * 15;
            document.getElementById('entryFeeNaira').textContent = ` ${nairaValue}`;
            updatePaymentSummary();
        });
    }
    
    if (votingFeeInput) {
        votingFeeInput.addEventListener('input', function() {
            const value = parseInt(this.value) || 0;
            const nairaValue = value * 15;
            document.getElementById('votingFeeNaira').textContent = ` ${nairaValue}`;
            updatePaymentSummary();
        });
    }
}

// Update payment summary
function updatePaymentSummary(eventType = null) {
    if (!eventType) {
        eventType = document.getElementById('eventType').value;
    }
    
    if (!eventType) return;
    
    const data = eventTypeData[eventType];
    const noEntryFee = document.getElementById('noEntryFeeBtn').classList.contains('active');
    const noVotingFee = document.getElementById('noVotingFeeBtn').classList.contains('active');
    
    const selectedEventTypeSpan = document.getElementById('selectedEventType');
    const creationFeeSpan = document.getElementById('creationFee');
    const feeDiscountItem = document.getElementById('feeDiscountItem');
    const discountAmountSpan = document.getElementById('discountAmount');
    const totalCreationFeeSpan = document.getElementById('totalCreationFee');
    const totalCreationFeeNairaSpan = document.getElementById('totalCreationFeeNaira');
    
    // Update event type display
    const eventTypeNames = {
        medium: 'Medium Event',
        tactical: 'Tactical Event',
        bigRush: 'Big Rush'
    };
    selectedEventTypeSpan.textContent = eventTypeNames[eventType];
    
    // Calculate creation fee
    let creationFee = data.creationFee.full;
    let discount = 0;
    
    if (noEntryFee && noVotingFee) {
        creationFee = data.creationFee.discounted;
        discount = data.creationFee.full - data.creationFee.discounted;
        feeDiscountItem.style.display = 'flex';
        discountAmountSpan.textContent = `-${discount} TC`;
    } else {
        feeDiscountItem.style.display = 'none';
    }
    
    creationFeeSpan.textContent = `${data.creationFee.full} TC`;
    totalCreationFeeSpan.textContent = `${creationFee} TC`;
    totalCreationFeeNairaSpan.textContent = (creationFee * 15).toString();
}

// Switch background tab
function switchBackgroundTab(tabType) {
    document.querySelectorAll('.bg-tab').forEach(tab => {
        tab.classList.remove('active');
    });
    document.querySelectorAll('.bg-content').forEach(content => {
        content.classList.remove('active');
    });
    
    document.querySelector(`[onclick="switchBackgroundTab('${tabType}')"]`).classList.add('active');
    document.getElementById(tabType === 'image' ? 'imageContent' : 'colorContent').classList.add('active');
}

// Select color
function selectColor(color) {
    document.querySelectorAll('.color-option').forEach(option => {
        option.classList.remove('selected');
    });
    
    const colorOption = document.querySelector(`[style*="${color}"]`);
    if (colorOption) {
        colorOption.classList.add('selected');
    }
    
    document.getElementById('customColor').value = color;
}

// Add hashtag
function addHashtag() {
    const hashtagInput = document.getElementById('hashtagInput');
    const hashtag = hashtagInput.value.trim().replace('#', '');
    
    if (hashtag && hashtags.length < 10 && !hashtags.includes(hashtag)) {
        hashtags.push(hashtag);
        updateHashtagsDisplay();
        hashtagInput.value = '';
    }
}

// Update hashtags display
function updateHashtagsDisplay() {
    const hashtagsDisplay = document.getElementById('hashtagsDisplay');
    hashtagsDisplay.innerHTML = '';
    
    hashtags.forEach((hashtag, index) => {
        const tagElement = document.createElement('div');
        tagElement.className = 'tag-item hashtag-item';
        tagElement.innerHTML = `
            #${hashtag}
            <button type="button" class="tag-remove" onclick="removeHashtag(${index})"></button>
        `;
        hashtagsDisplay.appendChild(tagElement);
    });
}

// Add star tag
function addStartag() {
    const startagInput = document.getElementById('startagInput');
    const startag = startagInput.value.trim().replace('*', '');
    
    if (startag && startags.length < 10 && !startags.includes(startag)) {
        startags.push(startag);
        updateStartagsDisplay();
        startagInput.value = '';
    }
}

// Update star tags display
function updateStartagsDisplay() {
    const startagsDisplay = document.getElementById('startagsDisplay');
    startagsDisplay.innerHTML = '';
    
    startags.forEach((startag, index) => {
        const tagElement = document.createElement('div');
        tagElement.className = 'tag-item startag-item';
        tagElement.innerHTML = `
            *${startag}
            <button type="button" class="tag-remove" onclick="removeStartag(${index})"></button>
        `;
        startagsDisplay.appendChild(tagElement);
    });
}

// Remove hashtag
function removeHashtag(index) {
    hashtags.splice(index, 1);
    updateHashtagsDisplay();
}

// Remove star tag
function removeStartag(index) {
    startags.splice(index, 1);
    updateStartagsDisplay();
}

// Add rule
function addRule() {
    const ruleInput = document.getElementById('ruleInput');
    const rule = ruleInput.value.trim();
    
    if (rule && eventRules.length < 15) {
        eventRules.push(rule);
        updateRulesDisplay();
        ruleInput.value = '';
        updateRulesCount();
    }
}

// Update rules display
function updateRulesDisplay() {
    const rulesList = document.getElementById('rulesList');
    rulesList.innerHTML = '';
    
    eventRules.forEach((rule, index) => {
        const ruleElement = document.createElement('div');
        ruleElement.className = 'rule-item';
        ruleElement.innerHTML = `
            <div class="rule-number">${index + 1}</div>
            <div class="rule-text">${rule}</div>
            <button type="button" class="rule-remove" onclick="removeRule(${index})"></button>
        `;
        rulesList.appendChild(ruleElement);
    });
}

// Remove rule
function removeRule(index) {
    eventRules.splice(index, 1);
    updateRulesDisplay();
    updateRulesCount();
}

// Update rules count
function updateRulesCount() {
    const rulesCount = document.getElementById('rulesCount');
    rulesCount.textContent = eventRules.length;
}

// Setup word counter
function setupWordCounter() {
    const descriptionTextarea = document.getElementById('eventDescription');
    
    if (descriptionTextarea) {
        descriptionTextarea.addEventListener('input', function() {
            const words = this.value.trim().split(/\s+/).filter(word => word.length > 0);
            const wordCount = this.value.trim() === '' ? 0 : words.length;
            document.getElementById('wordCount').textContent = wordCount;
            
            validateForm();
        });
    }
}

// Setup form validation
function setupFormValidation() {
    const form = document.getElementById('hostEntertainmentForm');
    
    if (form) {
        const inputs = form.querySelectorAll('input, select, textarea');
        inputs.forEach(input => {
            input.addEventListener('input', validateForm);
            input.addEventListener('change', validateForm);
        });
        
        form.addEventListener('submit', function(e) {
            e.preventDefault();
            if (validateForm()) {
                submitForm();
            }
        });
    }
}

// Validate form
function validateForm() {
    const eventType = document.getElementById('eventType').value;
    const eventCategory = document.getElementById('eventCategory').value;
    const eventDuration = document.getElementById('eventDuration').value;
    const maxParticipants = document.getElementById('maxParticipants').value;
    const eventName = document.getElementById('eventName').value.trim();
    const eventDescription = document.getElementById('eventDescription').value.trim();
    const submitBtn = document.getElementById('createEventBtn');
    
    const words = eventDescription.split(/\s+/).filter(word => word.length > 0);
    const wordCount = eventDescription === '' ? 0 : words.length;
    
    const isValid = eventType && 
                   eventCategory && 
                   eventDuration && 
                   maxParticipants && 
                   eventName && 
                   wordCount >= 20 && 
                   wordCount <= 100 && 
                   eventRules.length >= 1;
    
    if (submitBtn) {
        submitBtn.disabled = !isValid;
    }
    
    return isValid;
}

// Validate promo code
function validatePromoCode(code) {
    return validPromoCodes.includes(code);
}

// Check if user has sufficient TC balance
function checkSufficientBalance(requiredAmount) {
    return currentUserBalance >= requiredAmount;
}


 // Fix double submission in submitForm function
async function submitForm() {
    const submitBtn = document.getElementById('createEventBtn');
    
    // SOLUTION: Prevent double submission with a flag
    if (window.isSubmitting) {
        console.log('Already submitting, ignoring...');
        return;
    }
    
    // Set flag to prevent double submission
    window.isSubmitting = true;
    
    const originalText = submitBtn.innerHTML;
    
    try {
        // Disable button immediately
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Creating Event...';
        
        // Get payment method
        const paymentMethod = document.querySelector('input[name="paymentMethod"]:checked').value;
        const eventType = document.getElementById('eventType').value;
        const creationFee = calculateCreationFee(eventType);
        
        // Validate payment
        if (paymentMethod === 'tcBalance') {
            if (!checkSufficientBalance(creationFee)) {
                throw new Error(`Insufficient TC Balance. You need ${creationFee} TC but have ${currentUserBalance} TC.`);
            }
        } else if (paymentMethod === 'promoCode') {
            const promoCode = document.getElementById('promoCodeInput').value.trim();
            if (!validatePromoCode(promoCode)) {
                throw new Error('Invalid promo code. Valid codes are: Bisask19, nig2025, Ismartdc');
            }
        }
        
        // Collect form data
        const eventData = await collectFormData(paymentMethod, creationFee);
        
        // Process payment and create event
        await processPaymentAndCreateEvent(eventData, paymentMethod, creationFee);
        
        // DON'T create card here - let loadExistingEvents handle it
        // createEntertainmentCard(eventData); // REMOVE THIS LINE
        
        // Show success message
        showSuccessMessage(eventData.eventName);
        
        // Reset and close form
        resetForm();
        document.getElementById('hostEntertainmentPopup').style.display = 'none';
        document.body.style.overflow = 'auto';
        
        // Reload events from database instead of creating card manually
        setTimeout(() => {
            loadExistingEvents();
        }, 500);
        
    } catch (error) {
        console.error('Error creating event:', error);
        alert(error.message || 'Error creating event. Please try again.');
    } finally {
        // Reset button and flag
        submitBtn.innerHTML = originalText;
        submitBtn.disabled = false;
        window.isSubmitting = false; // Reset flag
    }
}
     

     

// Calculate creation fee
function calculateCreationFee(eventType) {
    const data = eventTypeData[eventType];
    const noEntryFee = document.getElementById('noEntryFeeBtn').classList.contains('active');
    const noVotingFee = document.getElementById('noVotingFeeBtn').classList.contains('active');
    
    return (noEntryFee && noVotingFee) ? data.creationFee.discounted : data.creationFee.full;
}

// Update the collectFormData function to ensure createdAt is set properly
async function collectFormData(paymentMethod, creationFee) {
    const eventType = document.getElementById('eventType').value;
    const eventCategory = document.getElementById('eventCategory').value;
    const eventDuration = document.getElementById('eventDuration').value;
    const maxParticipants = parseInt(document.getElementById('maxParticipants').value);
    const eventName = document.getElementById('eventName').value.trim();
    const eventDescription = document.getElementById('eventDescription').value.trim();
    
    // Fee data
    const noEntryFee = document.getElementById('noEntryFeeBtn').classList.contains('active');
    const noVotingFee = document.getElementById('noVotingFeeBtn').classList.contains('active');
    const entryFee = noEntryFee ? 0 : (parseInt(document.getElementById('entryFee').value) || eventTypeData[eventType].entryFeeDefault);
    const votingFee = noVotingFee ? 0 : (parseInt(document.getElementById('votingFee').value) || eventTypeData[eventType].votingFeeDefault);
    
    // Background data
    const backgroundImage = document.getElementById('backgroundImage').files[0];
    const backgroundColor = document.getElementById('customColor').value;
    
    // Upload background image if provided
    let backgroundImageUrl = null;
    if (backgroundImage) {
        backgroundImageUrl = await new Promise((resolve) => {
            const reader = new FileReader();
            reader.onload = (e) => resolve(e.target.result);
            reader.readAsDataURL(backgroundImage);
        });
    }
    
    // Get promo code if used
    const promoCodeUsed = paymentMethod === 'promoCode' ? document.getElementById('promoCodeInput').value.trim() : null;
    
    return {
        eventId: generateEventId(),
        creatorId: auth.currentUser.uid,
        eventType,
        eventCategory,
        eventDuration,
        maxParticipants,
        currentParticipants: 0,
        eventName,
        eventDescription,
        entryFee,
        votingFee,
        backgroundImageUrl,
        backgroundColor,
        hashtags: [...hashtags],
        startags: [...startags],
        eventRules: [...eventRules],
        creationFee,
        paymentMethod,
        promoCodeUsed,
        status: 'active',
        createdAt: firebase.firestore.Timestamp.now(), // Use Timestamp.now() instead of FieldValue.serverTimestamp()
        participants: []
    };
}


// Generate unique event ID
function generateEventId() {
    return 'event_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
}

// Process payment and create event
async function processPaymentAndCreateEvent(eventData, paymentMethod, creationFee) {
    const user = auth.currentUser;
    
    if (paymentMethod === 'tcBalance') {
        // Deduct TC from user's wallet
        const newBalance = currentUserBalance - creationFee;
        await db.collection('wallets').doc(user.uid).update({
            balance: newBalance
        });
        
        // Update local balance
        currentUserBalance = newBalance;
    }
    
    // Save event to EVENT DATABASE
    await db.collection('events').doc(eventData.eventId).set(eventData);
}

    
 // Update the createEntertainmentCard function to check launched status
function createEntertainmentCard(eventData) {
    const newEventsContainer = document.getElementById('newEventsContainer');
    const emptyState = newEventsContainer.querySelector('.entertainment-empty-state');

    // Check if card already exists to prevent duplicates
    const existingCard = document.getElementById(`card-${eventData.eventId}`);
    if (existingCard) {
        console.log('Card already exists for event:', eventData.eventId);
        return;
    }

    // Hide empty state
    if (emptyState) {
        emptyState.style.display = 'none';
    }

    // Create card element
    const cardElement = document.createElement('div');
    cardElement.className = 'entertainment-card';
    cardElement.id = `card-${eventData.eventId}`;

    // Set background
    const backgroundStyle = eventData.backgroundImageUrl 
        ? `background-image: url(${eventData.backgroundImageUrl}); background-size: cover; background-position: center;`
        : `background: linear-gradient(135deg, ${eventData.backgroundColor || '#4ECDC4'}, ${adjustBrightness(eventData.backgroundColor || '#4ECDC4', -20)});`;

    // Determine which button to show based on launched status
    const actionButton = eventData.launched === true
        ? `<button class="start-btn" onclick="startEvent('${eventData.eventId}')">
             <i class="fas fa-play"></i>
             <span>Start</span>
           </button>`
        : `<button class="launch-btn" onclick="launchEvent('${eventData.eventId}')">
             <i class="fas fa-rocket"></i>
             <span>Launch</span>
           </button>`;

    cardElement.innerHTML = `
        <div class="entertainment-card-inner" style="${backgroundStyle}">
            <!-- Card Overlay for better text visibility -->
            <div class="card-overlay"></div>
                        
            <!-- Event Name (Top Left) -->
            <div class="event-name-overlay">
                <h3>${eventData.eventName}</h3>
            </div>
                        
            <!-- Action Buttons (Top Right) -->
            <div class="card-action-buttons">
               
            </div>
                        
            <!-- Participants Counter (Top Right, below action buttons) -->
            <div class="participants-counter">
                <i class="fas fa-users"></i>
                <span>${eventData.currentParticipants}/${eventData.maxParticipants}</span>
            </div>
                        
            <!-- Event Info (Middle) -->
            <div class="event-info-middle">
                <!-- Duration -->
                <div class="event-duration">
                    <i class="fas fa-clock"></i>
                    <span>${eventData.eventDuration}</span>
                </div>
                                
                <!-- Event Type -->
                <div class="event-type">
                    <i class="fas fa-tag"></i>
                    <span>${eventData.eventType}</span>
                </div>
                                
                <!-- Entry Fee (if applicable) -->
                ${eventData.entryFee > 0 ? `
                <div class="event-fee">
                    <i class="fas fa-coins"></i>
                    <span>${eventData.entryFee} TC</span>
                </div>
                ` : ''}
            </div>
                        
            <!-- Action Buttons (Bottom) -->
            <div class="card-bottom-actions">
                <button class="open-btn" onclick="openEntertainmentCard('${eventData.eventId}')">
                    <i class="fas fa-eye"></i>
                    <span>View Details</span>
                </button>
                ${actionButton}
            </div>
        </div>
    `;

    // Add card to container
    if (emptyState) {
        newEventsContainer.insertBefore(cardElement, emptyState);
    } else {
        newEventsContainer.appendChild(cardElement);
    }

    console.log('Created card for event:', eventData.eventId, 'Launched:', eventData.launched);
}
   

// Helper function to adjust color brightness
function adjustBrightness(hex, percent) {
    // Remove # if present
    hex = hex.replace('#', '');
    
    // Parse r, g, b values
    const num = parseInt(hex, 16);
    const amt = Math.round(2.55 * percent);
    const R = (num >> 16) + amt;
    const G = (num >> 8 & 0x00FF) + amt;
    const B = (num & 0x0000FF) + amt;
    
    return '#' + (0x1000000 + (R < 255 ? R < 1 ? 0 : R : 255) * 0x10000 +
        (G < 255 ? G < 1 ? 0 : G : 255) * 0x100 +
        (B < 255 ? B < 1 ? 0 : B : 255)).toString(16).slice(1);
}



// Show success message
function showSuccessMessage(eventName) {
    // Create success message overlay
    const successOverlay = document.createElement('div');
    successOverlay.className = 'success-message-overlay';
    successOverlay.innerHTML = `
        <div class="success-message-container">
            <div class="success-icon">
                <i class="fas fa-check-circle"></i>
            </div>
            <h3>Event Created Successfully!</h3>
            <p>You have created an event <strong>${eventName}</strong></p>
            <button class="success-ok-btn" onclick="closeSuccessMessage()">OK</button>
        </div>
    `;
    
    document.body.appendChild(successOverlay);
    
    // Auto remove after 5 seconds
    setTimeout(() => {
        closeSuccessMessage();
    }, 5000);
}

// Close success message
function closeSuccessMessage() {
    const successOverlay = document.querySelector('.success-message-overlay');
    if (successOverlay) {
        successOverlay.remove();
    }
}

// Reset form
function resetForm() {
    // Reset form fields
    document.getElementById('hostEntertainmentForm').reset();
    
    // Reset arrays
    hashtags = [];
    startags = [];
    eventRules = [];
    
    // Reset displays
    updateHashtagsDisplay();
    updateStartagsDisplay();
    updateRulesDisplay();
    updateRulesCount();
    
    // Reset payment method
    document.getElementById('tcBalancePayment').checked = true;
    document.getElementById('promoCodeSection').style.display = 'none';
    
    // Reset fee buttons
    document.getElementById('noEntryFeeBtn').classList.remove('active');
    document.getElementById('noVotingFeeBtn').classList.remove('active');
    document.getElementById('noEntryFeeBtn').textContent = 'No Entry Fee';
    document.getElementById('noVotingFeeBtn').textContent = 'No Voting Fee';
    
    // Hide all form groups except event type
    const formGroups = [
        'categoryGroup', 'durationGroup', 'participantsGroup', 'entryFeeGroup',
        'votingFeeGroup', 'eventNameGroup', 'descriptionGroup', 'backgroundGroup',
        'tagsGroup', 'rulesGroup', 'paymentGroup', 'submitGroup'
    ];
    
    formGroups.forEach(groupId => {
        document.getElementById(groupId).style.display = 'none';
    });
    
    // Reset word count
    document.getElementById('wordCount').textContent = '0';
    
    // Reset background selection
    document.querySelectorAll('.bg-tab').forEach(tab => tab.classList.remove('active'));
    document.querySelectorAll('.bg-content').forEach(content => content.classList.remove('active'));
    document.querySelector('[onclick="switchBackgroundTab(\'image\')"]').classList.add('active');
    document.getElementById('imageContent').classList.add('active');
    
    // Reset color selection
    document.querySelectorAll('.color-option').forEach(option => option.classList.remove('selected'));
}

// Edit event name
async function editEventName(eventId) {
    try {
        const eventDoc = await db.collection('events').doc(eventId).get();
        if (!eventDoc.exists) {
            alert('Event not found');
            return;
        }
        
        const eventData = eventDoc.data();
        const newName = prompt('Enter new event name:', eventData.eventName);
        
        if (newName && newName.trim() !== '' && newName.trim() !== eventData.eventName) {
            // Update in database
            await db.collection('events').doc(eventId).update({
                eventName: newName.trim()
            });
            
            // Update card display
            const card = document.getElementById(`card-${eventId}`);
            const nameOverlay = card.querySelector('.event-name-overlay h3');
            nameOverlay.textContent = newName.trim();
            
            alert('Event name updated successfully!');
        }
    } catch (error) {
        console.error('Error updating event name:', error);
        alert('Error updating event name. Please try again.');
    }
}

// Delete event
async function deleteEvent(eventId) {
    if (confirm('Are you sure you want to delete this event? This action cannot be undone.')) {
        try {
            // Delete from database
            await db.collection('events').doc(eventId).delete();
            
            // Remove card from display
            const card = document.getElementById(`card-${eventId}`);
            if (card) {
                card.remove();
            }
            
            // Show empty state if no cards left
            const newEventsContainer = document.getElementById('newEventsContainer');
            const remainingCards = newEventsContainer.querySelectorAll('.entertainment-card');
            const emptyState = newEventsContainer.querySelector('.entertainment-empty-state');
            
            if (remainingCards.length === 0 && emptyState) {
                emptyState.style.display = 'block';
            }
            
            alert('Event deleted successfully!');
        } catch (error) {
            console.error('Error deleting event:', error);
            alert('Error deleting event. Please try again.');
        }
    }
}

// Open entertainment card
function openEntertainmentCard(eventId) {
    console.log('Opening entertainment card:', eventId);
    // TODO: Implement card opening functionality
    // This could open a detailed view of the event
    alert(`Opening entertainment card: ${eventId}`);
}

 // Launch event function with database field update
async function launchEvent(eventId) {
    try {
        // Get the launch button and show loading state
        const launchBtn = document.querySelector(`button[onclick="launchEvent('${eventId}')"]`);
        const originalContent = launchBtn.innerHTML;
        
        launchBtn.disabled = true;
        launchBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Launching...';

        // Get event data from events collection
        const eventDoc = await db.collection('events').doc(eventId).get();
        
        if (!eventDoc.exists) {
            throw new Error('Event not found');
        }

        const eventData = eventDoc.data();

        // Step 1: Copy event data to Neweventdatabase
        await db.collection('Neweventdatabase').doc(eventId).set({
            ...eventData,
            status: 'launched',
            launchedAt: firebase.firestore.Timestamp.now()
        });

        // Step 2: Update original event with launched field
        await db.collection('events').doc(eventId).update({
            launched: true,
            launchedAt: firebase.firestore.Timestamp.now()
        });

        // Step 3: Update button to Start button
        launchBtn.innerHTML = '<i class="fas fa-play"></i> <span>Start</span>';
        launchBtn.className = 'start-btn';
        launchBtn.onclick = () => startEvent(eventId);
        launchBtn.disabled = false;

        // Show success message
        showToast(` Event "${eventData.eventName}" launched successfully!`, 'success');

        console.log('Event launched successfully:', eventId);

    } catch (error) {
        console.error('Error launching event:', error);
        
        // Reset button on error
        const launchBtn = document.querySelector(`button[onclick="launchEvent('${eventId}')"]`);
        if (launchBtn) {
            launchBtn.innerHTML = '<i class="fas fa-rocket"></i> <span>Launch</span>';
            launchBtn.disabled = false;
        }
        
        showToast('Error launching event. Please try again.', 'error');
    }
}
     


async function loadExistingEvents() {
    try {
        const user = auth.currentUser;
        if (!user) {
            console.log('No authenticated user found');
            return;
        }
        
        console.log('Loading existing events for user:', user.uid);
        
        // Try the query without orderBy first to test basic access
        let eventsQuery;
        try {
            eventsQuery = await db.collection('events')
                .where('creatorId', '==', user.uid)
                .where('status', '==', 'active')
                .orderBy('createdAt', 'desc')
                .get();
        } catch (orderByError) {
            console.warn('OrderBy failed, trying without orderBy:', orderByError);
            eventsQuery = await db.collection('events')
                .where('creatorId', '==', user.uid)
                .where('status', '==', 'active')
                .get();
        }
        
        const newEventsContainer = document.getElementById('newEventsContainer');
        const emptyState = newEventsContainer.querySelector('.entertainment-empty-state');
        
        if (!newEventsContainer) {
            console.error('newEventsContainer not found');
            return;
        }
        
        // Clear existing cards first (prevent duplicates) - but keep empty state
        const existingCards = newEventsContainer.querySelectorAll('.entertainment-card');
        existingCards.forEach(card => {
            console.log('Removing existing card:', card.id);
            card.remove();
        });
        
        if (!eventsQuery.empty) {
            console.log('Found', eventsQuery.size, 'events');
            
            if (emptyState) {
                emptyState.style.display = 'none';
            }
            
            // Convert to array and sort manually if orderBy failed
            const events = [];
            eventsQuery.forEach(doc => {
                const eventData = { ...doc.data(), eventId: doc.id };
                events.push(eventData);
            });
            
            // Sort by createdAt if it exists
            events.sort((a, b) => {
                if (a.createdAt && b.createdAt) {
                    return b.createdAt.toMillis() - a.createdAt.toMillis();
                }
                return 0;
            });
            
            // Create cards for each event
            events.forEach(eventData => {
                createEntertainmentCard(eventData);
            });
        } else {
            console.log('No events found');
            if (emptyState) {
                emptyState.style.display = 'block';
            }
        }
    } catch (error) {
        console.error('Error loading existing events:', error);
        
        if (error.code === 'permission-denied') {
            console.error('Permission denied. Please check if you are logged in.');
        }
    }
}


// Add a function to initialize the entertainment section
function initializeEntertainmentSection() {
    console.log('Initializing entertainment section...');
    
    // Check if user is authenticated
    const user = auth.currentUser;
    if (user) {
        loadExistingEvents();
        loadUserBalance();
    } else {
        // Wait for auth state to be determined
        const unsubscribe = auth.onAuthStateChanged(function(user) {
            if (user) {
                loadExistingEvents();
                loadUserBalance();
            }
            unsubscribe(); // Remove listener after first call
        });
    }
}

// Call this function when the entertainment section becomes visible
function onEntertainmentSectionVisible() {
    console.log('Entertainment section is now visible');
    initializeEntertainmentSection();
}

// Update the auth state change listener
auth.onAuthStateChanged(function(user) {
    console.log('Auth state changed:', user ? user.uid : 'No user');
    if (user) {
        // Only load if the entertainment section is currently visible
        const entertainmentSection = document.getElementById('newEventsContainer');
        if (entertainmentSection && isElementVisible(entertainmentSection)) {
            loadExistingEvents();
            loadUserBalance();
        }
    }
});

// Helper function to check if element is visible
function isElementVisible(element) {
    if (!element) return false;
    
    const rect = element.getBoundingClientRect();
    const style = window.getComputedStyle(element);
    
    return (
        rect.width > 0 &&
        rect.height > 0 &&
        style.display !== 'none' &&
        style.visibility !== 'hidden' &&
        style.opacity !== '0'
    );
}

// Add event listeners for when the page becomes visible
document.addEventListener('DOMContentLoaded', function() {
    console.log('DOM Content Loaded');
    
    // Initialize immediately if entertainment section exists
    const entertainmentSection = document.getElementById('newEventsContainer');
    if (entertainmentSection) {
        initializeEntertainmentSection();
    }
    
    // Listen for page visibility changes
    document.addEventListener('visibilitychange', function() {
        if (!document.hidden) {
            console.log('Page became visible');
            // Reload events when page becomes visible again
            setTimeout(() => {
                initializeEntertainmentSection();
            }, 500); // Small delay to ensure everything is loaded
        }
    });
    
    // Listen for focus events (when user returns to tab/app)
    window.addEventListener('focus', function() {
        console.log('Window gained focus');
        setTimeout(() => {
            initializeEntertainmentSection();
        }, 500);
    });
});

// If you're using a single-page application with navigation
// Add this function to be called when navigating to entertainment section
function navigateToEntertainmentSection() {
    console.log('Navigating to entertainment section');
    
    // Show the entertainment section
    const entertainmentSection = document.getElementById('entertainmentSection');
    if (entertainmentSection) {
        entertainmentSection.style.display = 'block';
    }
    
    // Load events after a short delay to ensure DOM is ready
    setTimeout(() => {
        initializeEntertainmentSection();
    }, 100);
}

// Add this to your navigation system if you have one
// For example, if you have buttons that show/hide sections:
function showEntertainmentSection() {
    // Hide other sections
    document.querySelectorAll('.main-section').forEach(section => {
        section.style.display = 'none';
    });
    
    // Show entertainment section
    const entertainmentSection = document.getElementById('entertainmentSection');
    if (entertainmentSection) {
        entertainmentSection.style.display = 'block';
        
        // Load events
        setTimeout(() => {
            initializeEntertainmentSection();
        }, 100);
    }
}
// Add manual refresh function
function refreshEntertainmentEvents() {
    console.log('Manually refreshing entertainment events...');
    
    // Show loading indicator
    const refreshBtn = document.getElementById('refreshEventsBtn');
    if (refreshBtn) {
        const originalContent = refreshBtn.innerHTML;
        refreshBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
        refreshBtn.disabled = true;
        
        // Load events
        loadExistingEvents().then(() => {
            // Reset button after loading
            setTimeout(() => {
                refreshBtn.innerHTML = originalContent;
                refreshBtn.disabled = false;
            }, 500);
        }).catch(() => {
            refreshBtn.innerHTML = originalContent;
            refreshBtn.disabled = false;
        });
    } else {
        // If no button, just load events
        loadExistingEvents();
    }
}

// Add refresh button to your HTML - place this near your events container
const refreshButtonHTML = `
<div class="entertainment-header">
    <h2>Your Entertainment Events</h2>
    <button id="refreshEventsBtn" onclick="refreshEntertainmentEvents()" class="refresh-events-btn" title="Refresh Events">
        <i class="fas fa-sync-alt"></i>
        <span>Refresh</span>
    </button>
</div>
`;

// Auto-inject refresh button if it doesn't exist
function addRefreshButton() {
    const container = document.getElementById('newEventsContainer');
    if (container && !document.getElementById('refreshEventsBtn')) {
        const headerDiv = document.createElement('div');
        headerDiv.innerHTML = refreshButtonHTML;
        container.parentNode.insertBefore(headerDiv.firstElementChild, container);
    }
}

// Call this when page loads
document.addEventListener('DOMContentLoaded', function() {
    addRefreshButton();
});

 


// Add event listeners for tag inputs
document.addEventListener('DOMContentLoaded', function() {
    const hashtagInput = document.getElementById('hashtagInput');
    const startagInput = document.getElementById('startagInput');
    const ruleInput = document.getElementById('ruleInput');
    
    if (hashtagInput) {
        hashtagInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                addHashtag();
            }
        });
    }
    
    if (startagInput) {
        startagInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                addStartag();
            }
        });
    }
    
    if (ruleInput) {
        ruleInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && e.ctrlKey) {
                e.preventDefault();
                addRule();
            }
        });
    }
});

// Add image preview functionality
function setupImagePreview() {
    const backgroundImageInput = document.getElementById('backgroundImage');
    const imagePreviewContainer = document.getElementById('imagePreviewContainer');
    const imagePreview = document.getElementById('imagePreview');
    const removeImageBtn = document.getElementById('removeImageBtn');
    const imagePreviewText = document.getElementById('imagePreviewText');
    
    if (!backgroundImageInput) return;
    
    backgroundImageInput.addEventListener('change', function(e) {
        const file = e.target.files[0];
        
        if (file) {
            // Validate file type
            const validTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp'];
            if (!validTypes.includes(file.type)) {
                showToast('Please select a valid image file (JPEG, PNG, GIF, or WebP)', 'error');
                this.value = '';
                return;
            }
            
            // Validate file size (max 5MB)
            const maxSize = 5 * 1024 * 1024; // 5MB in bytes
            if (file.size > maxSize) {
                showToast('Image size must be less than 5MB', 'error');
                this.value = '';
                return;
            }
            
            // Create file reader
            const reader = new FileReader();
            
            reader.onload = function(e) {
                // Show preview container
                imagePreviewContainer.style.display = 'block';
                
                // Set image source
                imagePreview.src = e.target.result;
                imagePreview.style.display = 'block';
                
                // Update text
                imagePreviewText.textContent = `Selected: ${file.name}`;
                
                // Show success toast
                showToast('Image uploaded successfully!', 'success');
                
                // Hide color picker section when image is selected
                const colorSection = document.querySelector('.color-picker-section');
                if (colorSection) {
                    colorSection.style.opacity = '0.5';
                    colorSection.style.pointerEvents = 'none';
                }
            };
            
            reader.onerror = function() {
                showToast('Error reading image file', 'error');
                this.value = '';
            };
            
            // Read file as data URL
            reader.readAsDataURL(file);
        }
    });
    
    // Remove image functionality
    if (removeImageBtn) {
        removeImageBtn.addEventListener('click', function() {
            // Clear file input
            backgroundImageInput.value = '';
            
            // Hide preview
            imagePreviewContainer.style.display = 'none';
            imagePreview.src = '';
            imagePreview.style.display = 'none';
            imagePreviewText.textContent = '';
            
            // Show color picker section again
            const colorSection = document.querySelector('.color-picker-section');
            if (colorSection) {
                colorSection.style.opacity = '1';
                colorSection.style.pointerEvents = 'auto';
            }
            
            showToast('Image removed', 'info');
        });
    }
}

// Call setup when DOM is loaded
document.addEventListener('DOMContentLoaded', setupImagePreview);

// Professional Toast Notification System
class ToastManager {
    constructor() {
        this.container = null;
        this.toasts = [];
        this.init();
    }
    
    init() {
        // Create toast container if it doesn't exist
        if (!document.getElementById('toast-container')) {
            this.container = document.createElement('div');
            this.container.id = 'toast-container';
            this.container.className = 'toast-container';
            document.body.appendChild(this.container);
        } else {
            this.container = document.getElementById('toast-container');
        }
    }
    
    show(message, type = 'info', duration = 4000) {
        const toast = this.createToast(message, type, duration);
        this.container.appendChild(toast);
        this.toasts.push(toast);
        
        // Trigger animation
        setTimeout(() => {
            toast.classList.add('toast-show');
        }, 10);
        
        // Auto remove
        setTimeout(() => {
            this.removeToast(toast);
        }, duration);
        
        return toast;
    }
    
    createToast(message, type, duration) {
        const toast = document.createElement('div');
        toast.className = `toast toast-${type}`;
        
        const icon = this.getIcon(type);
        const progressBar = duration > 0 ? `<div class="toast-progress" style="animation-duration: ${duration}ms;"></div>` : '';
        
        toast.innerHTML = `
            <div class="toast-content">
                <div class="toast-icon">
                    <i class="${icon}"></i>
                </div>
                <div class="toast-message">${message}</div>
                <button class="toast-close" onclick="toastManager.removeToast(this.parentElement.parentElement)">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            ${progressBar}
        `;
        
        return toast;
    }
    
    getIcon(type) {
        const icons = {
            success: 'fas fa-check-circle',
            error: 'fas fa-exclamation-circle',
            warning: 'fas fa-exclamation-triangle',
            info: 'fas fa-info-circle'
        };
        return icons[type] || icons.info;
    }
    
    removeToast(toast) {
        if (!toast || !toast.parentElement) return;
        
        toast.classList.add('toast-hide');
        
        setTimeout(() => {
            if (toast.parentElement) {
                toast.parentElement.removeChild(toast);
            }
            
            // Remove from array
            const index = this.toasts.indexOf(toast);
            if (index > -1) {
                this.toasts.splice(index, 1);
            }
        }, 300);
    }
    
    clear() {
        this.toasts.forEach(toast => this.removeToast(toast));
    }
}

// Initialize toast manager
const toastManager = new ToastManager();

// Global function for easy access
function showToast(message, type = 'info', duration = 4000) {
    return toastManager.show(message, type, duration);
}

// Replace all alert() calls with toast notifications
function showSuccessMessage(eventName) {
    showToast(` Event "${eventName}" created successfully!`, 'success', 5000);
}

function showErrorMessage(message) {
    showToast(message, 'error', 6000);
}

function showWarningMessage(message) {
    showToast(message, 'warning', 5000);
}

function showInfoMessage(message) {
    showToast(message, 'info', 4000);
}



        
        

 
  
   
    
    
                  
        
    
// Physical Event Management Functions

// Global variables for physical events
// Replace your existing physicalTicketTypes declaration with this
let physicalTicketTypes = []; // This should store the actual ticket data
let physicalEventSponsors = []; // Store sponsors data

// Update the physicalEventData to use physicalTicketTypes
let physicalEventData = {
    category: '',
    eventName: '',
    description: '',
    location: '',
    eventLink: '',
    background: null,
    startDateTime: null,
    endDateTime: null,
    tickets: [], // This will be populated from physicalTicketTypes
    sponsors: [], // This will be populated from physicalEventSponsors
  
    eventType: 'physical',
    ticketsId: [],
    creatorId: null,
    physicalEventId: null
};


// Category Management
function updatePhysicalCategory() {
    const categorySelect = document.getElementById('physicalEventCategory');
    const customInput = document.querySelector('.custom-physical-category-input');
    
    if (categorySelect.value === 'other') {
        customInput.style.display = 'block';
    } else {
        customInput.style.display = 'none';
        updatePhysicalPreview();
    }
}

function addCustomPhysicalCategory() {
    const customInput = document.getElementById('customPhysicalCategory');
    const categorySelect = document.getElementById('physicalEventCategory');
    
    if (customInput.value.trim()) {
        // Add new option to select
        const newOption = document.createElement('option');
        newOption.value = customInput.value.toLowerCase().replace(/\s+/g, '-');
        newOption.textContent = customInput.value;
        newOption.selected = true;
        
        categorySelect.appendChild(newOption);
        
        // Hide custom input
        document.querySelector('.custom-physical-category-input').style.display = 'none';
        customInput.value = '';
        
        updatePhysicalPreview();
    }
}

   function switchPhysicalBackgroundTab(tabType) {
    console.log('Switching to tab:', tabType);
    
    // Store the current tab type globally so getPhysicalEventBackground can access it
    window.currentPhysicalBgTab = tabType;
    
    // Update tab buttons
    document.querySelectorAll('.bg-tab').forEach(tab => tab.classList.remove('active'));
    
    // Add active class to clicked tab
    if (event && event.target) {
        event.target.classList.add('active');
    } else {
        // Find the correct tab button if event is not available
        const tabs = document.querySelectorAll('.bg-tab');
        tabs.forEach(tab => {
            if (tab.textContent.toLowerCase().includes(tabType.toLowerCase()) ||
                tab.onclick && tab.onclick.toString().includes(tabType)) {
                tab.classList.add('active');
            }
        });
    }
    
    // Update content sections
    document.querySelectorAll('.bg-content').forEach(content => content.classList.remove('active'));
    
    // Show the correct content section
    const contentId = `physical${tabType.charAt(0).toUpperCase() + tabType.slice(1)}Content`;
    const contentElement = document.getElementById(contentId);
    
    console.log('Looking for content element:', contentId);
    console.log('Content element found:', !!contentElement);
    
    if (contentElement) {
        contentElement.classList.add('active');
    }
    
    updatePhysicalPreview();
}

  function handlePhysicalMediaUpload(input) {
    const file = input.files[0];
    if (!file) {
        console.log('No file selected');
        return;
    }
    
    console.log('Media upload started:', file.name, file.type, file.size);
    
    // Validate file
    const maxSize = 10 * 1024 * 1024; // 10MB
    if (file.size > maxSize) {
        alert('File size must be less than 10MB');
        input.value = '';
        return;
    }
    
    // Validate file type
    const validTypes = ['image/', 'video/'];
    const isValidType = validTypes.some(type => file.type.startsWith(type));
    
    if (!isValidType) {
        alert('Please select an image or video file');
        input.value = '';
        return;
    }
    
    const reader = new FileReader();
    reader.onload = function(e) {
        console.log('File loaded successfully, data length:', e.target.result.length);
        
        const previewContainer = document.getElementById('physicalMediaPreviewContainer');
        const preview = document.getElementById('physicalMediaPreview');
        
        if (file.type.startsWith('image/')) {
            preview.innerHTML = `<img src="${e.target.result}" alt="Background preview" style="width: 100%; height: 200px; object-fit: cover; border-radius: 8px;">`;
        } else if (file.type.startsWith('video/')) {
            preview.innerHTML = `<video src="${e.target.result}" style="width: 100%; height: 200px; object-fit: cover; border-radius: 8px;" controls muted></video>`;
        }
        
        previewContainer.style.display = 'block';
        
        // Make sure we're on the media tab
        window.currentPhysicalBgTab = 'media';
        
        // Update the main preview
        updatePhysicalPreview();
        
        console.log('Media upload completed and preview updated');
    };
    
    reader.onerror = function(error) {
        console.error('File reading error:', error);
        alert('Error reading file. Please try again.');
        input.value = '';
    };
    
    reader.readAsDataURL(file);
}  

function removePhysicalMedia() {
    document.getElementById('physicalBackgroundMedia').value = '';
    document.getElementById('physicalMediaPreviewContainer').style.display = 'none';
    updatePhysicalPreview();
}

function updatePhysicalGradientPreview() {
    const color1 = document.getElementById('physicalGradientColor1').value;
    const color2 = document.getElementById('physicalGradientColor2').value;
    const preview = document.getElementById('physicalGradientPreview');
    
    preview.style.background = `linear-gradient(135deg, ${color1}, ${color2})`;
    updatePhysicalPreview();
}

// Preview Updates
function updatePhysicalPreview() {
    const eventName = document.getElementById('physicalEventName').value || 'Your Event Name';
    const category = document.getElementById('physicalEventCategory').selectedOptions[0]?.text || 'Event Category';
    
    document.getElementById('physicalPreviewEventTitle').textContent = eventName;
    document.getElementById('physicalPreviewEventCategory').textContent = category;
    
    // Update background
    const backgroundPreview = document.getElementById('physicalEventBackgroundPreview');
    if (!backgroundPreview) {
        console.warn('Background preview element not found');
        return;
    }
    
    // Check for media file first
    const mediaInput = document.getElementById('physicalBackgroundMedia');
    if (mediaInput && mediaInput.files && mediaInput.files[0]) {
        const reader = new FileReader();
        reader.onload = function(e) {
            backgroundPreview.style.backgroundImage = `url(${e.target.result})`;
            backgroundPreview.style.backgroundSize = 'cover';
            backgroundPreview.style.backgroundPosition = 'center';
            backgroundPreview.style.background = ''; // Clear any gradient
            console.log('Preview updated with media background');
        };
        reader.readAsDataURL(mediaInput.files[0]);
    } else {
        // Use gradient background
        const color1 = document.getElementById('physicalGradientColor1').value || '#FF6B6B';
        const color2 = document.getElementById('physicalGradientColor2').value || '#4ECDC4';
        backgroundPreview.style.background = `linear-gradient(135deg, ${color1}, ${color2})`;
        backgroundPreview.style.backgroundImage = ''; // Clear any image
        console.log('Preview updated with gradient background');
    }
}

// Word Count
function updatePhysicalWordCount() {
    const description = document.getElementById('physicalEventDescription').value;
    const wordCount = description.trim() ? description.trim().split(/\s+/).length : 0;
    document.getElementById('physicalWordCount').textContent = wordCount;
}

// Duration Calculator
function calculatePhysicalDuration() {
    const startDate = document.getElementById('physicalStartDate').value;
    const startTime = document.getElementById('physicalStartTime').value;
    const endDate = document.getElementById('physicalEndDate').value;
    const endTime = document.getElementById('physicalEndTime').value;
    
    if (startDate && startTime && endDate && endTime) {
        const start = new Date(`${startDate}T${startTime}`);
        const end = new Date(`${endDate}T${endTime}`);
        
        if (end > start) {
            const diffMs = end - start;
            const diffHours = Math.floor(diffMs / (1000 * 60 * 60));
            const diffMinutes = Math.floor((diffMs % (1000 * 60 * 60)) / (1000 * 60));
            
            let duration = '';
            if (diffHours > 0) duration += `${diffHours}h `;
            if (diffMinutes > 0) duration += `${diffMinutes}m`;
            
            document.getElementById('physicalCalculatedDuration').textContent = duration || '0m';
            document.getElementById('physicalDurationDisplay').style.display = 'block';
        }
    }
}

// Add this debounced version to reduce Firebase calls
let linkCheckTimeout;

function debouncedCheckPhysicalEventLink() {
    // Clear existing timeout
    if (linkCheckTimeout) {
        clearTimeout(linkCheckTimeout);
    }
    
    // Set new timeout
    linkCheckTimeout = setTimeout(() => {
        checkPhysicalEventLinkAvailability();
    }, 500); // Wait 500ms after user stops typing
}

// Update the manual check function
function manualCheckPhysicalEventLink() {
    // Clear any pending debounced check
    if (linkCheckTimeout) {
        clearTimeout(linkCheckTimeout);
    }
    
    // Check immediately
    checkPhysicalEventLinkAvailability();
}

   
// Event Preview
function showPhysicalEventPreview() {
    // Collect all form data and show preview modal
    console.log('Showing event preview...');
    // Implementation for preview modal
}

// Event Creation
function createPhysicalEvent() {
    // Validate form and save to Firebase
    console.log('Creating physical event...');
    console.log('Tickets:', physicalTicketTypes);
    // Implementation for Firebase save
}

// Initialize on page load
document.addEventListener('DOMContentLoaded', function() {
    // Set minimum date to today
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('physicalStartDate').min = today;
    document.getElementById('physicalEndDate').min = today;
    
    // Initialize gradient preview
    updatePhysicalGradientPreview();
    
    // Add event listeners for real-time updates
    document.getElementById('physicalEventName').addEventListener('input', updatePhysicalPreview);
    document.getElementById('physicalEventCategory').addEventListener('change', updatePhysicalPreview);
});

  // Add this helper function to ensure button always gets reset
function ensureButtonReset(buttonId, originalText) {
    const button = document.getElementById(buttonId);
    if (button) {
        button.innerHTML = originalText || '<i class="fas fa-calendar-plus"></i> Create Physical Event';
        button.disabled = false;
    }
}

    

// Fix the createPhysicalEvent function with better error handling
async function createPhysicalEvent() {
    const createBtn = document.getElementById('createPhysicalEventBtn');
    const originalText = createBtn ? createBtn.innerHTML : '';
    
    try {
        // Show loading state
        if (createBtn) {
            createBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Creating Event...';
            createBtn.disabled = true;
        }

        console.log('Starting event creation process...');

        // Validate required fields
        const validationResult = validatePhysicalEventForm();
        if (!validationResult.isValid) {
            alert(validationResult.message);
            return;
        }

        console.log('Form validation passed');

        // Collect all form data
        const eventData = await collectPhysicalEventData();
        console.log('Event data collected:', eventData);

        // Generate unique event ID
        const physicalEventId = generateEventId();
        eventData.physicalEventId = physicalEventId;

        console.log('Generated event ID:', physicalEventId);

        // Save to Firebase
        const savedEventId = await savePhysicalEventToFirebase(eventData);
        
        if (savedEventId) {
            console.log('Event saved successfully:', savedEventId);
            

               
           
            
            // Success feedback using global notification
            showSuccess(
                'Physical Event Created!',
                'Your physical event has been successfully created and is now live.',
                null,
                () => {
                    // Reset form after successful creation
                    resetPhysicalEventForm();
                    
                    // Reload events list if the container exists
                    const liveEventsContainer = document.getElementById('liveEventsContainer');
                    if (liveEventsContainer) {
                        loadUserPhysicalEvents();
                    }
                }
            );
        }
        
    } catch (error) {
        console.error('Error creating physical event:', error);
        alert(`Failed to create event: ${error.message}`);
    } finally {
        // Always reset button state
        setTimeout(() => {
            if (createBtn) {
                createBtn.innerHTML = originalText || '<i class="fas fa-calendar-plus"></i> Create Physical Event';
                createBtn.disabled = false;
            }
        }, 100);
    }
}  

// Add this function for better success handling
function handleEventCreationSuccess(eventData) {
    // Show success message
    const successMessage = `
        <div style="color: green; margin: 10px 0;">
            <i class="fas fa-check-circle"></i> 
            Event "${eventData.eventName}" created successfully!
        </div>
    `;
    
    // Success feedback using global notification
    showSuccess(
        'Physical Event Created!',
        'Your physical event has been successfully created and is now live.',
        null,
        () => {
            // Reset form
            resetPhysicalEventForm();
        }
    );
    
    // Optional: Show success state for a few seconds
    const createBtn = document.getElementById('createPhysicalEventBtn');
    createBtn.innerHTML = '<i class="fas fa-check"></i> Event Created!';
    createBtn.style.backgroundColor = '#28a745';
    
    setTimeout(() => {
        createBtn.innerHTML = '<i class="fas fa-calendar-plus"></i> Create Physical Event';
        createBtn.style.backgroundColor = '';
        createBtn.disabled = false;
    }, 2000);
}

                  
 function validatePhysicalEventForm() {
    const eventName = document.getElementById('physicalEventName').value.trim();
    const categorySelect = document.getElementById('physicalEventCategory');
    const category = categorySelect.value;
    const description = document.getElementById('physicalEventDescription').value.trim();
    const location = document.getElementById('physicalEventLocation').value.trim();
    const eventLink = document.getElementById('physicalEventLink').value.trim();
    const isTBA = document.getElementById('physicalTBASchedule').checked;

    // Check required fields
    if (!eventName) {
        return { isValid: false, message: 'Event name is required' };
    }
        
    if (eventName.length < 3 || eventName.length > 50) {
        return { isValid: false, message: 'Event name must be between 3-50 characters' };
    }

    if (!category || category === '' || category === 'select-category') {
        return { isValid: false, message: 'Please select an event category' };
    }

    if (!description) {
        return { isValid: false, message: 'Event description is required' };
    }

    const wordCount = description.split(/\s+/).length;
    if (wordCount < 5) {
        return { isValid: false, message: 'Description must contain at least 5 words' };
    }

    if (!location) {
        return { isValid: false, message: 'Event location is required' };
    }

    if (!eventLink) {
        return { isValid: false, message: 'Event link is required' };
    }

    // Only validate dates if not TBA
    if (!isTBA) {
        const startDate = document.getElementById('physicalStartDate').value;
        const startTime = document.getElementById('physicalStartTime').value;
        const endDate = document.getElementById('physicalEndDate').value;
        const endTime = document.getElementById('physicalEndTime').value;

        if (!startDate || !startTime) {
            return { isValid: false, message: 'Start date and time are required (or check TBA)' };
        }

        if (!endDate || !endTime) {
            return { isValid: false, message: 'End date and time are required (or check TBA)' };
        }

        // Check if end time is after start time
        const startDateTime = new Date(`${startDate}T${startTime}`);
        const endDateTime = new Date(`${endDate}T${endTime}`);
            
        if (endDateTime <= startDateTime) {
            return { isValid: false, message: 'End time must be after start time' };
        }

        // Check if event is in the future
        const now = new Date();
        if (startDateTime <= now) {
            return { isValid: false, message: 'Event must be scheduled for a future date' };
        }
    }

    // For TBA events, tickets are optional
    // For regular events, at least one ticket is required
    if (!isTBA && physicalTicketTypes.length === 0) {
        return { isValid: false, message: 'Please add at least one ticket type or select TBA' };
    }

    return { isValid: true };
}          


function validatePhyevePhoneNumber() {
    const phoneInput = document.getElementById('phyevePhoneNumber');
    const messageDiv = document.getElementById('phyevePhoneNumberMessage');
    const value = phoneInput.value.trim();
    
    if (!value) {
        messageDiv.innerHTML = '';
        phoneInput.classList.remove('url-valid', 'url-invalid');
        updatePhyeveContactPreview();
        return true;
    }
    
    // Simple phone number validation (international format)
    const phonePattern = /^(\+\d{1,3}[- ]?)?\d{10,14}$/;
    const isValid = phonePattern.test(value.replace(/\s/g, ''));
    
    const message = isValid ? 
        '<i class="fas fa-check"></i> Valid phone number' : 
        '<i class="fas fa-times"></i> Please enter a valid phone number (+234 xxx xxx xxxx)';
    
    messageDiv.innerHTML = `<span class="${isValid ? 'url-valid' : 'url-invalid'}">${message}</span>`;
    phoneInput.classList.remove('url-valid', 'url-invalid');
    phoneInput.classList.add(isValid ? 'url-valid' : 'url-invalid');
    
    updatePhyeveContactPreview();
    return isValid;
}

function toggleNoTicketsMode() {
    const noTicketsCheckbox = document.getElementById('physicalNoTickets');
    const addTicketBtn = document.getElementById('addPhysicalTicketBtn');
    const ticketsList = document.getElementById('physicalTicketTypesList');
    const noTicketsMessage = document.getElementById('physicalNoTicketsMessage');
    const noTicketsModeMessage = document.getElementById('noTicketsModeMessage');
    const contactRequiredNote = document.getElementById('phyeveContactRequiredNote');
    
    if (noTicketsCheckbox.checked) {
        // Enable no tickets mode
        addTicketBtn.disabled = true;
        addTicketBtn.title = 'Ticket creation is disabled when "No Tickets Required" is selected';
        
        // Clear existing tickets
        physicalTicketTypes = [];
        updatePhysicalTicketsList();
        
        // Show no tickets mode message
        noTicketsModeMessage.style.display = 'block';
        noTicketsMessage.style.display = 'none';
        
        // Show contact required note
        contactRequiredNote.style.display = 'block';
        
        // Mark contact section as required
        const contactGroup = document.getElementById('phyeveContactGroup');
        contactGroup.classList.add('contact-required');
        
    } else {
        // Disable no tickets mode
        addTicketBtn.disabled = false;
        addTicketBtn.title = '';
        
        // Hide no tickets mode message
        noTicketsModeMessage.style.display = 'none';
        noTicketsMessage.style.display = 'block';
        
        // Hide contact required note
        contactRequiredNote.style.display = 'none';
        
        // Remove required from contact section
        const contactGroup = document.getElementById('phyeveContactGroup');
        contactGroup.classList.remove('contact-required');
    }
}

function collectPhyeveContactData() {
    const contactFields = {
        hostName: document.getElementById('phyeveHostName').value.trim(),
        phoneNumber: document.getElementById('phyevePhoneNumber').value.trim(),
        websiteUrl: document.getElementById('phyeveWebsiteUrl').value.trim(),
        instagramUrl: document.getElementById('phyeveInstagramUrl').value.trim(),
        tiktokUrl: document.getElementById('phyeveTiktokUrl').value.trim(),
        facebookUrl: document.getElementById('phyeveFacebookUrl').value.trim(),
        twitterUrl: document.getElementById('phyeveTwitterUrl').value.trim(),
        youtubeUrl: document.getElementById('phyeveYoutubeUrl').value.trim(),
        linkedinUrl: document.getElementById('phyeveLinkedinUrl').value.trim(),
        whatsappUrl: document.getElementById('phyeveWhatsappUrl').value.trim(),
        customLink1Name: document.getElementById('phyeveCustomLinkName1').value.trim(),
        customLink1Url: document.getElementById('phyeveCustomUrl1').value.trim(),
        customLink2Name: document.getElementById('phyeveCustomLinkName2').value.trim(),
        customLink2Url: document.getElementById('phyeveCustomUrl2').value.trim(),
        customLink3Name: document.getElementById('phyeveCustomLinkName3').value.trim(),
        customLink3Url: document.getElementById('phyeveCustomUrl3').value.trim()
    };
    
    // Only include non-empty values
    const contactInfo = {};
    Object.keys(contactFields).forEach(key => {
        if (contactFields[key]) {
            contactInfo[key] = contactFields[key];
        }
    });
    
    return Object.keys(contactInfo).length > 0 ? contactInfo : null;
}

function validatePhysicalEventForm() {
    const eventName = document.getElementById('physicalEventName').value.trim();
    const categorySelect = document.getElementById('physicalEventCategory');
    const category = categorySelect.value;
    const description = document.getElementById('physicalEventDescription').value.trim();
    const location = document.getElementById('physicalEventLocation').value.trim();
    const eventLink = document.getElementById('physicalEventLink').value.trim();
    const isTBA = document.getElementById('physicalTBASchedule').checked;
    const noTickets = document.getElementById('physicalNoTickets').checked;

    // Basic field validation (same as before)
    if (!eventName) {
        return { isValid: false, message: 'Event name is required' };
    }
        
    if (eventName.length < 3 || eventName.length > 50) {
        return { isValid: false, message: 'Event name must be between 3-50 characters' };
    }

    if (!category || category === '' || category === 'select-category') {
        return { isValid: false, message: 'Please select an event category' };
    }

    if (!description) {
        return { isValid: false, message: 'Event description is required' };
    }

    const wordCount = description.split(/\s+/).length;
    if (wordCount < 5) {
        return { isValid: false, message: 'Description must contain at least 5 words' };
    }

    if (!location) {
        return { isValid: false, message: 'Event location is required' };
    }

    if (!eventLink) {
        return { isValid: false, message: 'Event link is required' };
    }

    // Date validation only if not TBA
    if (!isTBA) {
        const startDate = document.getElementById('physicalStartDate').value;
        const startTime = document.getElementById('physicalStartTime').value;
        const endDate = document.getElementById('physicalEndDate').value;
        const endTime = document.getElementById('physicalEndTime').value;

        if (!startDate || !startTime) {
            return { isValid: false, message: 'Start date and time are required (or check TBA)' };
        }

        if (!endDate || !endTime) {
            return { isValid: false, message: 'End date and time are required (or check TBA)' };
        }

        const startDateTime = new Date(`${startDate}T${startTime}`);
        const endDateTime = new Date(`${endDate}T${endTime}`);
            
        if (endDateTime <= startDateTime) {
            return { isValid: false, message: 'End time must be after start time' };
        }

        const now = new Date();
        if (startDateTime <= now) {
            return { isValid: false, message: 'Event must be scheduled for a future date' };
        }
    }

    // Ticket validation
    if (noTickets) {
        // If no tickets mode, validate contact information
        const contactInfo = collectPhyeveContactData();
        if (!contactInfo) {
            return { isValid: false, message: 'Please provide at least one contact method when "No Tickets Required" is selected' };
        }
    } else {
        // If tickets mode, require at least one ticket
        if (!isTBA && physicalTicketTypes.length === 0) {
            return { isValid: false, message: 'Please add at least one ticket type or select "No Tickets Required"' };
        }
    }

    return { isValid: true };
}

function resetPhyeveContactFields() {
    const fieldIds = [
        'phyeveHostName', 'phyevePhoneNumber', 'phyeveWebsiteUrl', 'phyeveInstagramUrl', 
        'phyeveTiktokUrl', 'phyeveFacebookUrl', 'phyeveTwitterUrl', 'phyeveYoutubeUrl', 
        'phyeveLinkedinUrl', 'phyeveWhatsappUrl', 'phyeveCustomLinkName1', 'phyeveCustomUrl1',
        'phyeveCustomLinkName2', 'phyeveCustomUrl2', 'phyeveCustomLinkName3', 'phyeveCustomUrl3'
    ];
    
    fieldIds.forEach(id => {
        const element = document.getElementById(id);
        if (element) element.value = '';
    });
    
    // Clear validation messages
    const messageIds = [
        'phyevePhoneNumberMessage', 'phyeveWebsiteUrlMessage', 'phyeveInstagramUrlMessage', 
        'phyeveTiktokUrlMessage', 'phyeveFacebookUrlMessage', 'phyeveTwitterUrlMessage', 
        'phyeveYoutubeUrlMessage', 'phyeveLinkedinUrlMessage', 'phyeveWhatsappUrlMessage',
        'phyeveCustomUrl1Message', 'phyeveCustomUrl2Message', 'phyeveCustomUrl3Message'
    ];
    
    messageIds.forEach(id => {
        const element = document.getElementById(id);
        if (element) element.innerHTML = '';
    });
    
    // Reset no tickets mode
    document.getElementById('physicalNoTickets').checked = false;
    toggleNoTicketsMode();
    
    // Hide preview and remove validation classes
    document.getElementById('phyeveContactPreview').style.display = 'none';
    
    fieldIds.forEach(id => {
        const element = document.getElementById(id);
        if (element) {
            element.classList.remove('url-valid', 'url-invalid');
        }
    });
}

        async function collectPhysicalEventData() {
    try {
        const eventName = document.getElementById('physicalEventName').value.trim();
        const category = document.getElementById('physicalEventCategory').value;
        const description = document.getElementById('physicalEventDescription').value.trim();
        const location = document.getElementById('physicalEventLocation').value.trim();
        const eventLink = document.getElementById('physicalEventLink').value.trim();
        const isTBA = document.getElementById('physicalTBASchedule').checked;

        // Collect contact information
        const contactInfo = collectPhyeveContactData();

        // Handle background data
        let background;
        try {
            background = await getPhysicalEventBackground();
            console.log('Background processed successfully:', background);
        } catch (error) {
            console.error('Error processing background:', error);
            background = {
                type: 'gradient',
                color1: '#FF6B6B',
                color2: '#4ECDC4',
                gradient: 'linear-gradient(135deg, #FF6B6B, #4ECDC4)'
            };
        }

        // Handle scheduling
        let startDateTime, endDateTime, schedulingStatus;
        
        if (isTBA) {
            startDateTime = 'TBA';
            endDateTime = 'TBA';
            schedulingStatus = 'TBA';
        } else {
            const startDate = document.getElementById('physicalStartDate').value;
            const startTime = document.getElementById('physicalStartTime').value;
            const endDate = document.getElementById('physicalEndDate').value;
            const endTime = document.getElementById('physicalEndTime').value;
            
            startDateTime = new Date(`${startDate}T${startTime}`).toISOString();
            endDateTime = new Date(`${endDate}T${endTime}`).toISOString();
            schedulingStatus = 'scheduled';
        }

        // Process tickets data
        const processedTickets = physicalTicketTypes.map(ticket => {
            try {
                const ticketData = {
                    id: ticket.id,
                    name: ticket.name,
                    type: ticket.type,
                    price: ticket.price || 0,
                    suggestedAmount: ticket.suggestedAmount || 0,
                    quantity: parseInt(ticket.quantity) || 0,
                    sold: 0,
                    background: ticket.background || null,
                    createdAt: ticket.createdAt || new Date().toISOString()
                };

                // Set status based on TBA
                if (isTBA) {
                    ticketData.status = 'Coming Soon';
                    ticketData.available = false;
                } else {
                    switch(ticket.type) {
                        case 'free':
                            ticketData.status = 'Free Ticket';
                            break;
                        case 'paid':
                            ticketData.status = `Paid Ticket - ${ticket.price.toLocaleString()}`;
                            break;
                        case 'donation':
                            ticketData.status = ticket.suggestedAmount > 0 ? 
                                `Donation Ticket - Suggested: ${ticket.suggestedAmount.toLocaleString()}` :
                                'Donation Ticket - Pay What You Want';
                            break;
                    }
                    ticketData.available = true;
                }

                return ticketData;
            } catch (error) {
                console.error('Error processing ticket:', ticket, error);
                return null;
            }
        }).filter(ticket => ticket !== null);

        // Get user ID
        let creatorId;
        try {
            creatorId = await getCurrentUserId();
        } catch (error) {
            console.error('Error getting user ID:', error);
            creatorId = 'anonymous_user_' + Date.now();
        }

        const eventData = {
            category,
            eventName,
            description,
            location,
            eventLink,
            background,
            startDateTime,
            endDateTime,
            schedulingStatus,
            isTBA,
            tickets: processedTickets,
            eventType: 'physical',
            ticketsId: [],
            creatorId: creatorId,
            physicalEventId: null,
            createdAt: new Date().toISOString(),
            updatedAt: new Date().toISOString(),
            status: isTBA ? 'coming_soon' : 'active',
            sponsors: physicalEventSponsors || [],
            totalRevenue: 0
        };

        // Add contact information if provided
        if (contactInfo) {
            eventData.phyeveContactInfo = contactInfo;
        }

        return eventData;

    } catch (error) {
        console.error('Error in collectPhysicalEventData:', error);
        throw new Error(`Failed to collect event data: ${error.message}`);
    }
}


// TBA Schedule Toggle
function toggleTBASchedule() {
    const tbaCheckbox = document.getElementById('physicalTBASchedule');
    const dateTimeFields = document.getElementById('physicalDateTimeFields');
    const tbaDisplay = document.getElementById('physicalTBADisplay');
    const ticketConfigGroup = document.getElementById('physicalTicketConfigGroup');
    
    if (tbaCheckbox.checked) {
        // Hide date/time fields
        dateTimeFields.style.display = 'none';
        tbaDisplay.style.display = 'block';
        
        // Clear date/time values
        document.getElementById('physicalStartDate').value = '';
        document.getElementById('physicalStartTime').value = '';
        document.getElementById('physicalEndDate').value = '';
        document.getElementById('physicalEndTime').value = '';
        document.getElementById('physicalDurationDisplay').style.display = 'none';
        
        // Update ticket configuration note
        const ticketNote = document.createElement('div');
        ticketNote.id = 'tbaTicketNote';
        ticketNote.className = 'tba-ticket-note';
        ticketNote.innerHTML = `
            <i class="fas fa-info-circle"></i>
            <span>Tickets for TBA events will show as "Coming Soon" until date is confirmed</span>
        `;
        
        // Add note to ticket section if not already there
        if (ticketConfigGroup && !document.getElementById('tbaTicketNote')) {
            ticketConfigGroup.insertBefore(ticketNote, ticketConfigGroup.firstChild);
        }
        
    } else {
        // Show date/time fields
        dateTimeFields.style.display = 'block';
        tbaDisplay.style.display = 'none';
        
        // Remove TBA ticket note
        const existingNote = document.getElementById('tbaTicketNote');
        if (existingNote) {
            existingNote.remove();
        }
    }
}
// Fix the getPhysicalEventBackground function with better error handling
async function getPhysicalEventBackground() {
    try {
        console.log('Getting physical event background...');
        
        // Use the stored tab type or try to detect it
        let currentTab = window.currentPhysicalBgTab;
        
        if (!currentTab) {
            // Try to detect active tab
            const activeTab = document.querySelector('.bg-tab.active');
            if (activeTab) {
                const tabText = activeTab.textContent.toLowerCase();
                if (tabText.includes('media') || tabText.includes('image') || tabText.includes('video')) {
                    currentTab = 'media';
                } else if (tabText.includes('gradient') || tabText.includes('color')) {
                    currentTab = 'gradient';
                }
            }
        }
        
        console.log('Current background tab:', currentTab);
        
        // Check for media file regardless of tab detection
        const mediaInput = document.getElementById('physicalBackgroundMedia');
        const hasMediaFile = mediaInput && mediaInput.files && mediaInput.files[0];
        
        console.log('Media input found:', !!mediaInput);
        console.log('Has media file:', hasMediaFile);
        
        // If there's a media file, use it (regardless of which tab is "active")
        if (hasMediaFile) {
            const file = mediaInput.files[0];
            console.log('Processing media file:', file.name, file.type, 'Size:', file.size);
            
            // Validate file size (10MB limit)
            const maxSize = 10 * 1024 * 1024;
            if (file.size > maxSize) {
                console.warn('File size exceeds limit:', file.size);
                throw new Error('File size must be less than 10MB');
            }
            
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    console.log('Media file converted to base64 successfully');
                    const result = {
                        type: 'media',
                        data: e.target.result,
                        fileName: file.name,
                        fileType: file.type,
                        fileSize: file.size
                    };
                    console.log('Media background data prepared:', {
                        type: result.type,
                        fileName: result.fileName,
                        fileType: result.fileType,
                        dataLength: result.data ? result.data.length : 0
                    });
                    resolve(result);
                };
                reader.onerror = function(error) {
                    console.error('FileReader error:', error);
                    reject(new Error('Failed to read media file'));
                };
                reader.readAsDataURL(file);
            });
        }
        
        // Default to gradient background
        const color1Element = document.getElementById('physicalGradientColor1');
        const color2Element = document.getElementById('physicalGradientColor2');
        
        const color1 = color1Element ? color1Element.value : '#FF6B6B';
        const color2 = color2Element ? color2Element.value : '#4ECDC4';
        
        console.log('Using gradient background:', color1, color2);
        
        const gradientResult = {
            type: 'gradient',
            color1: color1,
            color2: color2,
            gradient: `linear-gradient(135deg, ${color1}, ${color2})`
        };
        
        console.log('Gradient background data prepared:', gradientResult);
        return gradientResult;
        
    } catch (error) {
        console.error('Error in getPhysicalEventBackground:', error);
        // Return default background instead of throwing
        const defaultResult = {
            type: 'gradient',
            color1: '#FF6B6B',
            color2: '#4ECDC4',
            gradient: 'linear-gradient(135deg, #FF6B6B, #4ECDC4)'
        };
        console.log('Using default background due to error:', defaultResult);
        return defaultResult;
    }
}

// Add this new function to collect ticket background data
async function getTicketBackground() {
    const activeTab = document.querySelector('.bg-tab.active[data-tab]');
    if (!activeTab) {
        // Default color if no tab selected
        return {
            type: 'color',
            color: '#4ECDC4'
        };
    }

    const tabType = activeTab.getAttribute('data-tab');

    if (tabType === 'media') {
        const mediaInput = document.getElementById('ticketBackgroundMedia');
        if (mediaInput && mediaInput.files[0]) {
            const file = mediaInput.files[0];
            
            // Convert to base64 for ticket
            return new Promise((resolve) => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    resolve({
                        type: 'media',
                        data: e.target.result, // base64 data
                        fileName: file.name,
                        fileType: file.type
                    });
                };
                reader.readAsDataURL(file);
            });
        }
    }

    // Color background (default for tickets)
    const color = document.getElementById('ticketBackgroundColor').value || '#4ECDC4';
    
    return {
        type: 'color',
        color: color
    };
}


// Generate unique event ID
function generateEventId() {
    return 'physical_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
}

        
    // Replace your existing savePhysicalEventToFirebase function with this
async function savePhysicalEventToFirebase(eventData) {
    try {
        console.log('Saving event to Firebase...', eventData);
        
        // Generate unique event ID if not already set
        if (!eventData.physicalEventId) {
            const eventId = 'physical_event_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            eventData.physicalEventId = eventId;
        }
                
        // Add timestamp
        eventData.createdAt = new Date().toISOString();
        eventData.updatedAt = new Date().toISOString();
        
        // Ensure we have Firebase initialized
        if (typeof firebase === 'undefined') {
            throw new Error('Firebase is not initialized');
        }
                
        // Save to Firebase Firestore
        const db = firebase.firestore();
        await db.collection('physicalEvents').doc(eventData.physicalEventId).set(eventData);
                
        console.log('Event saved successfully to Firebase:', eventData.physicalEventId);
        return eventData.physicalEventId;
            
    } catch (error) {
        console.error('Firebase save error:', error);
        throw new Error(`Failed to save event: ${error.message}`);
    }
}


// Helper function to reset button state
function resetCreateButton(button, originalText) {
    button.innerHTML = originalText;
    button.disabled = false;
}

 // Replace your existing checkPhysicalEventLinkAvailability function with this
async function checkPhysicalEventLinkAvailability() {
    const link = document.getElementById('physicalEventLink').value.trim();
    const messageDiv = document.getElementById('physicalLinkAvailabilityMessage');

    // Clear message if link is too short
    if (link.length < 3) {
        messageDiv.innerHTML = '';
        return;
    }

    // Validate link format (optional - only letters, numbers, hyphens, underscores)
    const linkPattern = /^[a-zA-Z0-9_-]+$/;
    if (!linkPattern.test(link)) {
        messageDiv.innerHTML = '<span class="link-error"><i class="fas fa-exclamation-triangle"></i> Link can only contain letters, numbers, hyphens, and underscores</span>';
        return;
    }

    try {
        // Show checking state
        messageDiv.innerHTML = '<span class="checking-link"><i class="fas fa-spinner fa-spin"></i> Checking availability...</span>';

        // Check if Firebase is initialized
        if (typeof firebase === 'undefined') {
            throw new Error('Firebase is not initialized');
        }

        const db = firebase.firestore();
        let isAvailable = true;

        // Check in multiple collections for comprehensive availability check
        const collections = [
            'physicalEvents',
            'virtualEvents', 
            'events' // if you have a general events collection
        ];

        for (const collectionName of collections) {
            console.log(`Checking ${collectionName} collection for link: ${link}`);
            
            const querySnapshot = await db.collection(collectionName)
                .where('eventLink', '==', link)
                .limit(1) // We only need to know if at least one exists
                .get();

            if (!querySnapshot.empty) {
                console.log(`Link "${link}" found in ${collectionName} collection`);
                isAvailable = false;
                break; // No need to check other collections
            }
        }

        console.log(`Link "${link}" availability:`, isAvailable);

        // Update UI based on availability
        if (isAvailable) {
            messageDiv.innerHTML = '<span class="link-available"><i class="fas fa-check"></i> Link is available!</span>';
        } else {
            messageDiv.innerHTML = '<span class="link-unavailable"><i class="fas fa-times"></i> Link is already taken</span>';
        }

    } catch (error) {
        console.error('Error checking link availability:', error);
        
        // Provide specific error messages
        let errorMessage = 'Error checking availability';
        if (error.message.includes('Firebase')) {
            errorMessage = 'Database connection error';
        } else if (error.message.includes('permission')) {
            errorMessage = 'Permission denied - check Firebase rules';
        }
        
        messageDiv.innerHTML = `<span class="link-error"><i class="fas fa-exclamation-triangle"></i> ${errorMessage}</span>`;
    }
}
     




// Debug function to test ticket modal
function debugAddTicket() {
    console.log('Add Ticket button clicked');
    openPhysicalTicketConfigModal();
}

// Open Physical Ticket Configuration Modal
function openPhysicalTicketConfigModal() {
    const modal = document.getElementById('physicalTicketConfigModal');
    if (modal) {
        modal.style.display = 'flex';
        // Reset form to default state
        resetPhysicalTicketForm();
        console.log('Physical ticket modal opened');
    } else {
        console.error('Physical ticket modal not found');
    }
}

// Update your existing closePhysicalTicketConfigModal function
function closePhysicalTicketConfigModal() {
    const modal = document.getElementById('physicalTicketConfigModal');
    if (modal) {
        modal.style.display = 'none';
    }
    
    // Reset modal state
    resetTicketModal();
}


// Reset ticket form to default state
function resetPhysicalTicketForm() {
    document.getElementById('physicalTicketConfigForm').reset();
    document.getElementById('physicalFreeTicket').checked = true;
    selectPhysicalTicketType('free');
    document.getElementById('physicalTicketName').value = '';
    document.getElementById('physicalFreeTicketQuantity').value = '100';
}

function selectPhysicalTicketType(type) {
    console.log('Selecting ticket type:', type);
    
    // Hide all config sections
    const configSections = [
        'physicalFreeTicketConfig',
        'physicalPaidTicketConfig', 
        'physicalDonationTicketConfig'
    ];
    
    configSections.forEach(sectionId => {
        const section = document.getElementById(sectionId);
        if (section) {
            section.style.display = 'none';
        }
    });

    // Show selected config section
    let targetSectionId = '';
    switch(type) {
        case 'free':
            targetSectionId = 'physicalFreeTicketConfig';
            break;
        case 'paid':
            targetSectionId = 'physicalPaidTicketConfig';
            break;
        case 'donation':
            targetSectionId = 'physicalDonationTicketConfig';
            break;
    }
    
    if (targetSectionId) {
        const targetSection = document.getElementById(targetSectionId);
        if (targetSection) {
            targetSection.style.display = 'block';
            console.log('Showed section:', targetSectionId);
        } else {
            console.error('Target section not found:', targetSectionId);
        }
    }
}

// Add this to your DOMContentLoaded event listener
document.addEventListener('DOMContentLoaded', function() {
    // ... your existing code ...
    
    // Add event listeners for ticket type radio buttons
    const ticketTypeRadios = document.querySelectorAll('input[name="physicalTicketType"]');
    ticketTypeRadios.forEach(radio => {
        radio.addEventListener('change', function() {
            if (this.checked) {
                selectPhysicalTicketType(this.value);
                updateTicketPreview();
            }
        });
    });
});


   // Replace your existing savePhysicalTicketConfiguration function with this
async function savePhysicalTicketConfiguration() {
    const ticketName = document.getElementById('physicalTicketName').value.trim();
    const ticketType = document.querySelector('input[name="physicalTicketType"]:checked').value;

    // Validate ticket name
    if (!ticketName) {
        alert('Please enter a ticket name');
        return;
    }

    // Collect ticket background
    const ticketBackground = await getTicketBackground();

    // Create ticket object based on type
    let ticketData = {
        id: window.editingTicketIndex !== undefined ? physicalTicketTypes[window.editingTicketIndex].id : generateTicketId(),
        name: ticketName,
        type: ticketType,
        description: '',
        background: ticketBackground,
        createdAt: window.editingTicketIndex !== undefined ? physicalTicketTypes[window.editingTicketIndex].createdAt : new Date().toISOString(),
        updatedAt: new Date().toISOString()
    };

    // Add type-specific data
    switch(ticketType) {
        case 'free':
            const freeQuantity = parseInt(document.getElementById('physicalFreeTicketQuantity').value) || 100;
            ticketData.quantity = freeQuantity;
            ticketData.price = 0;
            ticketData.status = 'Free Ticket';
            break;
                    
        case 'paid':
            const price = parseFloat(document.getElementById('physicalTicketPrice').value);
            const paidQuantity = parseInt(document.getElementById('physicalPaidTicketQuantity').value);
                        
            if (!price || price < 100) {
                alert('Please enter a valid price (minimum 100)');
                return;
            }
            if (!paidQuantity || paidQuantity < 1) {
                alert('Please enter a valid quantity');
                return;
            }
                        
            ticketData.price = price;
            ticketData.quantity = paidQuantity;
            ticketData.status = `Paid Ticket - ${price.toLocaleString()}`;
            break;
                    
        case 'donation':
            const suggestedAmount = parseFloat(document.getElementById('physicalSuggestedDonation').value) || 0;
            const donationQuantity = parseInt(document.getElementById('physicalDonationTicketQuantity').value);
                        
            if (!donationQuantity || donationQuantity < 1) {
                alert('Please enter a valid quantity');
                return;
            }
                        
            ticketData.suggestedAmount = suggestedAmount;
            ticketData.quantity = donationQuantity;
            ticketData.status = suggestedAmount > 0 ? 
                `Donation Ticket - Suggested: ${suggestedAmount.toLocaleString()}` :
                'Donation Ticket - Pay What You Want';
            break;
    }

    // Check if we're editing or creating new
    if (window.editingTicketIndex !== undefined) {
        // Update existing ticket
        physicalTicketTypes[window.editingTicketIndex] = ticketData;
        console.log('Ticket updated:', ticketData);
    } else {
        // Add new ticket
        physicalTicketTypes.push(ticketData);
        console.log('New ticket added:', ticketData);
    }

    // Update UI
    updatePhysicalTicketsList();

    // Close modal and reset
    closePhysicalTicketConfigModal();
    resetTicketModal();

    console.log('All tickets:', physicalTicketTypes);
}

// Add this new function to reset the modal
function resetTicketModal() {
    // Clear editing index
    window.editingTicketIndex = undefined;
    
    // Reset modal title and button text
    const modalTitle = document.querySelector('#physicalTicketConfigModal .modal-title');
    if (modalTitle) {
        modalTitle.textContent = 'Ticket Configuration';
    }
    
    const saveBtn = document.getElementById('savePhysicalTicketBtn');
    if (saveBtn) {
        saveBtn.textContent = 'Save Ticket';
    }
    
    // Clear form fields
    document.getElementById('physicalTicketName').value = '';
    
    // Reset radio buttons
    const freeRadio = document.querySelector('input[name="physicalTicketType"][value="free"]');
    if (freeRadio) {
        freeRadio.checked = true;
        showPhysicalTicketTypeFields('free');
    }
    
    // Reset background to default
    switchTicketBackgroundTab('color');
    document.getElementById('ticketBackgroundColor').value = '#4ECDC4';
    
    // Update preview
    updateTicketPreview();
}

         
// Generate unique ticket ID
function generateTicketId() {
    return 'ticket_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
}

// Replace your existing updatePhysicalTicketsList function with this
function updatePhysicalTicketsList() {
    const ticketsList = document.getElementById('physicalTicketTypesList');
    const noTicketsMessage = document.getElementById('physicalNoTicketsMessage');
    
    if (!ticketsList) {
        console.error('Tickets list element not found');
        return;
    }

    // Clear existing ticket items (but keep the no-tickets message)
    const existingTickets = ticketsList.querySelectorAll('.ticket-item');
    existingTickets.forEach(ticket => ticket.remove());

    // Show/hide no tickets message based on array length
    if (physicalTicketTypes.length === 0) {
        if (noTicketsMessage) {
            noTicketsMessage.style.display = 'block';
        }
        console.log('No tickets to display');
        return;
    }

    // Hide no tickets message
    if (noTicketsMessage) {
        noTicketsMessage.style.display = 'none';
    }

    // Add each ticket to the list
    physicalTicketTypes.forEach((ticket, index) => {
        const ticketElement = createTicketListItem(ticket, index);
        ticketsList.appendChild(ticketElement);
    });
    
    console.log(`Updated tickets list with ${physicalTicketTypes.length} tickets`);
}



// Replace your existing createTicketListItem function with this
function createTicketListItem(ticket, index) {
    const ticketDiv = document.createElement('div');
    ticketDiv.className = 'ticket-item';
    
    // Generate background style based on ticket background
    let backgroundStyle = '';
    if (ticket.background) {
        if (ticket.background.type === 'media') {
            backgroundStyle = `background-image: url('${ticket.background.data}'); background-size: cover; background-position: center;`;
        } else if (ticket.background.type === 'color') {
            backgroundStyle = `background-color: ${ticket.background.color};`;
        } else if (ticket.background.type === 'gradient') {
            backgroundStyle = `background: ${ticket.background.gradient};`;
        }
    } else {
        // Default background
        backgroundStyle = 'background-color: #4ECDC4;';
    }
    
    ticketDiv.innerHTML = `
        <div class="ticket-preview" style="${backgroundStyle}">
            <div class="ticket-preview-overlay">
                <span class="ticket-preview-text">${ticket.name}</span>
            </div>
        </div>
        <div class="ticket-info">
            <div class="ticket-header">
                <h4 class="ticket-name">${ticket.name}</h4>
                <span class="ticket-status">${ticket.status}</span>
            </div>
            <div class="ticket-details">
                <span class="ticket-quantity">Quantity: ${ticket.quantity}</span>
                <span class="ticket-type">${ticket.type.charAt(0).toUpperCase() + ticket.type.slice(1)} Ticket</span>
                ${ticket.price ? `<span class="ticket-price">${ticket.price.toLocaleString()}</span>` : ''}
                ${ticket.suggestedAmount ? `<span class="ticket-suggested">Suggested: ${ticket.suggestedAmount.toLocaleString()}</span>` : ''}
            </div>
        </div>
        <div class="ticket-actions">
           
        </div>
    `;
    
    return ticketDiv;
}
    
// Replace your existing deletePhysicalTicket function with this
function deletePhysicalTicket(index) {
    console.log('=== DELETE TICKET DEBUG ===');
    console.log('Deleting ticket at index:', index);
    console.log('Current tickets before delete:', physicalTicketTypes);
    console.log('Tickets count before delete:', physicalTicketTypes.length);
    
    if (confirm('Are you sure you want to delete this ticket?')) {
        // Validate index
        if (index < 0 || index >= physicalTicketTypes.length) {
            console.error('Invalid ticket index:', index);
            alert('Error: Invalid ticket index');
            return;
        }
        
        // Remove from the array
        const deletedTicket = physicalTicketTypes.splice(index, 1);
        console.log('Deleted ticket:', deletedTicket[0]);
        console.log('Remaining tickets after delete:', physicalTicketTypes);
        console.log('Tickets count after delete:', physicalTicketTypes.length);
        
        // Update the UI
        updatePhysicalTicketsList();
        
        // Check if physicalTicketConfigGroup is still visible
        const configGroup = document.getElementById('physicalTicketConfigGroup');
        console.log('Config group display:', configGroup ? configGroup.style.display : 'not found');
        console.log('Config group visible:', configGroup ? configGroup.offsetParent !== null : 'not found');
        
        console.log('=== DELETE COMPLETED ===');
    }
}

// Add this function to ensure the config group stays visible
function ensureTicketConfigGroupVisible() {
    const configGroup = document.getElementById('physicalTicketConfigGroup');
    if (configGroup) {
        configGroup.style.display = 'block';
        configGroup.style.visibility = 'visible';
    }
}

// Update your deletePhysicalTicket function to call this
function deletePhysicalTicket(index) {
    console.log('Deleting ticket at index:', index);
    console.log('Current tickets:', physicalTicketTypes);
    
    if (confirm('Are you sure you want to delete this ticket?')) {
        // Remove from the array
        physicalTicketTypes.splice(index, 1);
        
        // Update the UI
        updatePhysicalTicketsList();
        
        // Ensure config group stays visible
        ensureTicketConfigGroupVisible();
        
        console.log('Ticket deleted. Remaining tickets:', physicalTicketTypes);
    }
}

function editPhysicalTicket(index) {
    console.log('=== EDIT TICKET DEBUG ===');
    console.log('Editing ticket at index:', index);
    console.log('All tickets:', physicalTicketTypes);
    
    // Validate index
    if (index < 0 || index >= physicalTicketTypes.length) {
        console.error('Invalid ticket index:', index);
        alert('Error: Invalid ticket index');
        return;
    }
    
    const ticket = physicalTicketTypes[index];
    console.log('Ticket to edit:', ticket);
    
    if (!ticket) {
        console.error('Ticket not found at index:', index);
        alert('Error: Ticket not found');
        return;
    }

    // Store the index for updating later
    window.editingTicketIndex = index;
    console.log('Set editing index to:', window.editingTicketIndex);

    // Open modal first
    openPhysicalTicketConfigModal();
    
    // Small delay to ensure modal is fully rendered
    setTimeout(() => {
        try {
            // Pre-populate the modal with existing ticket data
            const nameField = document.getElementById('physicalTicketName');
            if (nameField) {
                nameField.value = ticket.name;
                console.log('Set ticket name:', ticket.name);
            } else {
                console.error('Ticket name field not found');
            }

            // Set ticket type radio button
            const typeRadio = document.querySelector(`input[name="physicalTicketType"][value="${ticket.type}"]`);
            if (typeRadio) {
                typeRadio.checked = true;
                console.log('Set ticket type:', ticket.type);
                
                // Show appropriate fields for this type
                showPhysicalTicketTypeFields(ticket.type);
            } else {
                console.error('Type radio button not found for:', ticket.type);
            }

            // Set type-specific fields
            switch(ticket.type) {
                case 'free':
                    const freeQtyField = document.getElementById('physicalFreeTicketQuantity');
                    if (freeQtyField) {
                        freeQtyField.value = ticket.quantity;
                        console.log('Set free quantity:', ticket.quantity);
                    }
                    break;
                    
                case 'paid':
                    const priceField = document.getElementById('physicalTicketPrice');
                    const paidQtyField = document.getElementById('physicalPaidTicketQuantity');
                    
                    if (priceField) {
                        priceField.value = ticket.price;
                        console.log('Set price:', ticket.price);
                    }
                    if (paidQtyField) {
                        paidQtyField.value = ticket.quantity;
                        console.log('Set paid quantity:', ticket.quantity);
                    }
                    break;
                    
                case 'donation':
                    const suggestedField = document.getElementById('physicalSuggestedDonation');
                    const donationQtyField = document.getElementById('physicalDonationTicketQuantity');
                    
                    if (suggestedField) {
                        suggestedField.value = ticket.suggestedAmount || '';
                        console.log('Set suggested amount:', ticket.suggestedAmount);
                    }
                    if (donationQtyField) {
                        donationQtyField.value = ticket.quantity;
                        console.log('Set donation quantity:', ticket.quantity);
                    }
                    break;
            }

            // Set background if exists
            if (ticket.background) {
                console.log('Setting ticket background:', ticket.background);
                
                if (ticket.background.type === 'color') {
                    // Switch to color tab
                    switchTicketBackgroundTab('color');
                    const colorField = document.getElementById('ticketBackgroundColor');
                    if (colorField) {
                        colorField.value = ticket.background.color;
                        updateTicketColorPreview();
                    }
                } else if (ticket.background.type === 'media') {
                    // Switch to media tab
                    switchTicketBackgroundTab('media');
                    // Note: Can't pre-populate file input, but show preview if possible
                    console.log('Media background detected - file input cannot be pre-populated');
                }
            } else {
                // Default to color tab
                switchTicketBackgroundTab('color');
            }

            // Update modal title and button text
            const modalTitle = document.querySelector('#physicalTicketConfigModal .modal-title');
            if (modalTitle) {
                modalTitle.textContent = 'Edit Ticket Configuration';
            }

            const saveBtn = document.getElementById('savePhysicalTicketBtn');
            if (saveBtn) {
                saveBtn.textContent = 'Update Ticket';
            }

            // Update preview
            updateTicketPreview();
            
            console.log('=== EDIT SETUP COMPLETED ===');
            
        } catch (error) {
            console.error('Error setting up edit modal:', error);
            alert('Error setting up edit form: ' + error.message);
        }
    }, 100);
}

   
// Replace your existing switchTicketBackgroundTab function with this
function switchTicketBackgroundTab(tabType) {
    // Update tab buttons
    document.querySelectorAll('.bg-tab[data-tab]').forEach(tab => tab.classList.remove('active'));
    document.querySelector(`[data-tab="${tabType}"]`).classList.add('active');
        
    // Update content sections
    document.querySelectorAll('.bg-content').forEach(content => content.classList.remove('active'));
    document.getElementById(`ticket${tabType.charAt(0).toUpperCase() + tabType.slice(1)}Content`).classList.add('active');
        
    updateTicketPreview();
}


// Update ticket color preview
function updateTicketColorPreview() {
    const color = document.getElementById('ticketBackgroundColor').value;
    const preview = document.getElementById('ticketColorPreview');
    const ticketBackground = document.getElementById('ticketPreviewBackground');
    
    preview.style.backgroundColor = color;
    ticketBackground.style.background = color;
}

// Handle ticket media upload
function handleTicketMediaUpload(input) {
    const file = input.files[0];
    if (!file) return;
    
    // Validate file size (5MB for tickets)
    const maxSize = 5 * 1024 * 1024;
    if (file.size > maxSize) {
        alert('File size must be less than 5MB for ticket backgrounds');
        input.value = '';
        return;
    }
    
    const reader = new FileReader();
    reader.onload = function(e) {
        const previewContainer = document.getElementById('ticketMediaPreviewContainer');
        const preview = document.getElementById('ticketMediaPreview');
        const ticketBackground = document.getElementById('ticketPreviewBackground');
        
        if (file.type.startsWith('image/')) {
            preview.innerHTML = `<img src="${e.target.result}" alt="Ticket background" style="width: 100%; height: 100px; object-fit: cover; border-radius: 8px;">`;
            ticketBackground.style.backgroundImage = `url(${e.target.result})`;
            ticketBackground.style.backgroundSize = 'cover';
            ticketBackground.style.backgroundPosition = 'center';
        } else if (file.type.startsWith('video/')) {
            preview.innerHTML = `<video src="${e.target.result}" style="width: 100%; height: 100px; object-fit: cover; border-radius: 8px;" controls></video>`;
            ticketBackground.style.backgroundImage = `url(${e.target.result})`;
        }
        
        previewContainer.style.display = 'block';
    };
    
    reader.readAsDataURL(file);
}

// Remove ticket media
function removeTicketMedia() {
    document.getElementById('ticketBackgroundMedia').value = '';
    document.getElementById('ticketMediaPreviewContainer').style.display = 'none';
    
    // Reset to color background
    const colorTab = document.querySelector('[data-tab="color"]');
    colorTab.click();
    updateTicketColorPreview();
}

// Update ticket preview
function updateTicketPreview() {
    const ticketName = document.getElementById('physicalTicketName').value || 'Ticket Name';
    const ticketType = document.querySelector('input[name="physicalTicketType"]:checked').value;
    
    document.getElementById('ticketPreviewName').textContent = ticketName;
    
    // Update type and price display
    const typeElement = document.getElementById('ticketPreviewType');
    const priceElement = document.getElementById('ticketPreviewPrice');
    
    switch(ticketType) {
        case 'free':
            typeElement.textContent = 'Free Ticket';
            priceElement.style.display = 'none';
            break;
        case 'paid':
            const price = document.getElementById('physicalTicketPrice').value;
            typeElement.textContent = 'Paid Ticket';
            priceElement.textContent = price ? `${parseFloat(price).toLocaleString()}` : '0';
            priceElement.style.display = 'block';
            break;
        case 'donation':
            const suggested = document.getElementById('physicalSuggestedDonation').value;
            typeElement.textContent = 'Donation Ticket';
            priceElement.textContent = suggested ? `Suggested: ${parseFloat(suggested).toLocaleString()}` : 'Pay What You Want';
            priceElement.style.display = 'block';
            break;
    }
}

   




    
  

// Helper function to get current user ID
function getCurrentUserId() {
    // Implement based on your authentication system
    // For example, if using Firebase Auth:
    // return firebase.auth().currentUser?.uid || null;
    return 'user_123'; // Placeholder
}

// Replace your existing resetPhysicalEventForm function with this
function resetPhysicalEventForm() {
    console.log('Resetting physical event form...');
    
    // Reset basic form fields
    document.getElementById('physicalEventCategory').value = '';
    document.getElementById('physicalEventName').value = '';
    document.getElementById('physicalEventDescription').value = '';
    document.getElementById('physicalEventLocation').value = '';
    document.getElementById('physicalEventLink').value = '';
    document.getElementById('physicalStartDate').value = '';
    document.getElementById('physicalStartTime').value = '';
    document.getElementById('physicalEndDate').value = '';
    document.getElementById('physicalEndTime').value = '';
    // Reset TBA option
    document.getElementById('physicalTBASchedule').checked = false;
    document.getElementById('physicalDateTimeFields').style.display = 'block';
    document.getElementById('physicalTBADisplay').style.display = 'none';
    
    // Remove TBA ticket note if exists
    const existingNote = document.getElementById('tbaTicketNote');
    if (existingNote) {
        existingNote.remove();
    }
    // Reset word count
    document.getElementById('physicalWordCount').textContent = '0';
    
    // Reset duration display
    document.getElementById('physicalDurationDisplay').style.display = 'none';
    
    // Reset link availability message
    document.getElementById('physicalLinkAvailabilityMessage').innerHTML = '';
    
    // Reset background to default gradient tab
    document.querySelectorAll('.bg-tab').forEach(tab => tab.classList.remove('active'));
    const gradientTab = document.querySelector('.bg-tab[onclick*="gradient"], .bg-tab[data-tab="gradient"]');
    if (gradientTab) {
        gradientTab.classList.add('active');
    }
    
    // Reset background content sections
    document.querySelectorAll('.bg-content').forEach(content => content.classList.remove('active'));
    const gradientContent = document.getElementById('physicalGradientContent');
    if (gradientContent) {
        gradientContent.classList.add('active');
    }
    
    // Reset gradient colors to default
    document.getElementById('physicalGradientColor1').value = '#FF6B6B';
    document.getElementById('physicalGradientColor2').value = '#4ECDC4';
    
    // Reset media upload
    const mediaInput = document.getElementById('physicalBackgroundMedia');
    if (mediaInput) {
        mediaInput.value = '';
    }
    
    // Hide media preview
    const mediaPreviewContainer = document.getElementById('physicalMediaPreviewContainer');
    if (mediaPreviewContainer) {
        mediaPreviewContainer.style.display = 'none';
    }
    
    // Reset tickets - IMPORTANT
    physicalTicketTypes = [];
    physicalEventData.tickets = [];
    physicalEventData.ticketsId = [];
    

    // Reset sponsors - IMPORTANT
    physicalEventSponsors = [];
    physicalEventData.sponsors = [];
    
    // Update tickets list UI
    updatePhysicalTicketsList();
    
    // Reset preview
    updatePhysicalPreview();
    updatePhysicalGradientPreview();
    
    console.log('Form reset completed');
}
// Add this missing function
function showPhysicalTicketTypeFields(type) {
    // Hide all config sections first
    document.getElementById('physicalFreeTicketConfig').style.display = 'none';
    document.getElementById('physicalPaidTicketConfig').style.display = 'none';
    document.getElementById('physicalDonationTicketConfig').style.display = 'none';
    
    // Show the selected type's config section
    switch(type) {
        case 'free':
            document.getElementById('physicalFreeTicketConfig').style.display = 'block';
            break;
        case 'paid':
            document.getElementById('physicalPaidTicketConfig').style.display = 'block';
            break;
        case 'donation':
            document.getElementById('physicalDonationTicketConfig').style.display = 'block';
            break;
    }
}




// Fix the loadUserPhysicalEvents function to not interfere with event creation
async function loadUserPhysicalEvents() {
    const liveEventsContainer = document.getElementById('liveEventsContainer');
    
    if (!liveEventsContainer) {
        console.log('liveEventsContainer not found - skipping load');
        return;
    }

    try {
        // Show loading state
        liveEventsContainer.innerHTML = `
            <div class="loading-events">
                <i class="fas fa-spinner fa-spin"></i>
                <p>Loading your events...</p>
            </div>
        `;

        // Check if Firebase is initialized
        if (typeof firebase === 'undefined') {
            throw new Error('Firebase is not initialized');
        }

        // Get current user ID with fallback
        let currentUserId;
        try {
            currentUserId = await getCurrentUserId();
        } catch (error) {
            console.error('Error getting user ID for loading events:', error);
            currentUserId = 'anonymous_user';
        }

        console.log('Loading events for user:', currentUserId);

        const db = firebase.firestore();
        
        // Try the query with better error handling
        let querySnapshot;
        try {
            querySnapshot = await db.collection('physicalEvents')
                .where('creatorId', '==', currentUserId)
                .orderBy('createdAt', 'desc')
                .get();
        } catch (indexError) {
            console.log('Composite index not ready, trying simple query:', indexError);
            
            try {
                querySnapshot = await db.collection('physicalEvents')
                    .where('creatorId', '==', currentUserId)
                    .get();
            } catch (simpleQueryError) {
                console.log('Simple query also failed, loading all events:', simpleQueryError);
                querySnapshot = await db.collection('physicalEvents').get();
            }
        }

        // Clear loading state
        liveEventsContainer.innerHTML = '';

        if (querySnapshot.empty) {
            liveEventsContainer.innerHTML = `
                <div class="no-events-message">
                    <i class="fas fa-calendar-plus"></i>
                    <h3>No Events Created Yet</h3>
                    <p>Create your first physical event to see it here!</p>
                </div>
            `;
            return;
        }

        // Convert to array and sort manually if needed
        let events = [];
        querySnapshot.forEach((doc) => {
            const eventData = { ...doc.data(), id: doc.id };
            events.push(eventData);
        });

        // Sort by createdAt
        events.sort((a, b) => {
            const dateA = a.createdAt ? new Date(a.createdAt) : new Date(0);
            const dateB = b.createdAt ? new Date(b.createdAt) : new Date(0);
            return dateB - dateA;
        });

        // Create cards for each event
        events.forEach((eventData) => {
            try {
                const eventCard = createPhysicalEventCard(eventData);
                liveEventsContainer.appendChild(eventCard);
            } catch (cardError) {
                console.error('Error creating event card:', cardError);
            }
        });

        console.log(`Loaded ${events.length} physical events`);

    } catch (error) {
        console.error('Error loading physical events:', error);
        
        liveEventsContainer.innerHTML = `
            <div class="error-loading-events">
                <i class="fas fa-exclamation-triangle"></i>
                <h3>Error Loading Events</h3>
                <p>There was an error loading your events. Please try again.</p>
                <button onclick="loadUserPhysicalEvents()" class="retry-btn">
                    <i class="fas fa-redo"></i> Retry
                </button>
            </div>
        `;
    }
}

// Add this function to safely load events only when needed
function safeLoadUserPhysicalEvents() {
    // Only load if we're on a page that has the events container
    const liveEventsContainer = document.getElementById('liveEventsContainer');
    if (liveEventsContainer) {
        loadUserPhysicalEvents();
    }
}

// Update the DOMContentLoaded event listener
document.addEventListener('DOMContentLoaded', function() {
    // Set minimum date to today
    const today = new Date().toISOString().split('T')[0];
    const startDateInput = document.getElementById('physicalStartDate');
    const endDateInput = document.getElementById('physicalEndDate');
    
    if (startDateInput) startDateInput.min = today;
    if (endDateInput) endDateInput.min = today;

    // Initialize gradient preview
    updatePhysicalGradientPreview();

    // Add event listeners for real-time updates
    const eventNameInput = document.getElementById('physicalEventName');
    const categorySelect = document.getElementById('physicalEventCategory');
    
    if (eventNameInput) {
        eventNameInput.addEventListener('input', updatePhysicalPreview);
    }
    if (categorySelect) {
        categorySelect.addEventListener('change', updatePhysicalPreview);
    }

    // Load events only if the container exists (i.e., we're on the dashboard page)
    setTimeout(() => {
        safeLoadUserPhysicalEvents();
    }, 1000); // Small delay to ensure everything is loaded
});
       

function getCurrentUserId() {
    return new Promise((resolve, reject) => {
        if (typeof firebase === 'undefined' || !firebase.auth) {
            // Fallback for when Firebase Auth is not available
            console.warn('Firebase Auth not available, using fallback user ID');
            resolve('anonymous_user_' + Date.now());
            return;
        }

        const currentUser = firebase.auth().currentUser;
        if (currentUser) {
            // User is already authenticated
            resolve(currentUser.uid);
            return;
        }

        // Wait for auth state change
        const unsubscribe = firebase.auth().onAuthStateChanged((user) => {
            unsubscribe();
            
            if (user) {
                console.log('User authenticated:', user.uid);
                resolve(user.uid);
            } else {
                console.log('User not authenticated, using anonymous ID');
                // Instead of rejecting, provide a fallback
                resolve('anonymous_user_' + Date.now());
            }
        }, (error) => {
            unsubscribe();
            console.error('Auth state change error:', error);
            // Provide fallback instead of rejecting
            resolve('anonymous_user_' + Date.now());
        });
    });
}


// Security state management for event IDs
const eventIdSecurity = {
    lockedEvents: new Set(),
    sessionUnlocked: new Set(),
    defaultPassword: null,
    
    // Initialize security settings
    init() {
        // Load locked events from localStorage
        const saved = localStorage.getItem('lockedEventIds');
        if (saved) {
            try {
                const parsed = JSON.parse(saved);
                this.lockedEvents = new Set(parsed);
            } catch (e) {
                console.warn('Failed to load locked events:', e);
            }
        }
        
        // Load default password if set
        const savedPassword = localStorage.getItem('eventIdDefaultPassword');
        if (savedPassword) {
            this.defaultPassword = savedPassword;
        }
    },
    
    // Save locked events to localStorage
    saveLocked() {
        localStorage.setItem('lockedEventIds', JSON.stringify([...this.lockedEvents]));
    },
    
    // Lock an event ID
    lockEvent(eventId) {
        this.lockedEvents.add(eventId);
        this.sessionUnlocked.delete(eventId);
        this.saveLocked();
    },
    
    // Unlock an event ID
    unlockEvent(eventId) {
        this.lockedEvents.delete(eventId);
        this.sessionUnlocked.delete(eventId);
        this.saveLocked();
    },
    
    // Check if event is locked
    isLocked(eventId) {
        return this.lockedEvents.has(eventId);
    },
    
    // Check if event is unlocked in current session
    isSessionUnlocked(eventId) {
        return this.sessionUnlocked.has(eventId);
    },
    
    // Unlock for current session
    unlockForSession(eventId) {
        this.sessionUnlocked.add(eventId);
    }
};

// Initialize security on page load
document.addEventListener('DOMContentLoaded', () => {
    eventIdSecurity.init();
});

                        
// Enhanced function to create individual physical event card with TBA support
function createPhysicalEventCard(eventData) {
    const cardDiv = document.createElement('div');
    cardDiv.className = 'physical-event-card';
    cardDiv.setAttribute('data-event-id', eventData.physicalEventId);
    
    // Check if event is TBA
    const isTBA = eventData.isTBA || 
                  eventData.schedulingStatus === 'TBA' || 
                  eventData.startDateTime === 'TBA' || 
                  eventData.endDateTime === 'TBA';
    
    // Generate background style
    const backgroundStyle = generateBackgroundStyle(eventData.background);
    
    if (isTBA) {
        // Create simplified TBA event card
        return createTBAEventCard(cardDiv, eventData, backgroundStyle);
    } else {
        // Create full event card with all features
        return createFullEventCard(cardDiv, eventData, backgroundStyle);
    }
}

// Create simplified TBA event card

           function createTBAEventCard(cardDiv, eventData, backgroundStyle) {
    cardDiv.classList.add('tba-event-card');
    
    cardDiv.innerHTML = `
        <div class="event-card-header tba-header" style="${backgroundStyle}">
            <div class="event-card-overlay">
                <h3 class="event-title">${eventData.eventName}</h3>
                <div class="tba-badge">
                    <i class="fas fa-calendar-times"></i>
                    <span>To Be Announced</span>
                </div>
                <div class="expand-indicator">
                    <i class="fas fa-chevron-down"></i>
                </div>
            </div>
        </div>
                
        <div class="event-card-content tba-content">
            <!-- Event Description -->
            <div class="tba-description-section">
                <h4 style="margin: 0 0 10px 0; color: #495057; display: flex; align-items: center; gap: 8px;">
                    <i class="fas fa-info-circle" style="color: #17a2b8;"></i>
                    Event Details
                </h4>
                <div class="event-description" style="
                    background: #f8f9fa;
                    border: 1px solid #e9ecef;
                    border-radius: 8px;
                    padding: 16px;
                    line-height: 1.6;
                    color: #495057;
                    font-size: 14px;
                    margin-bottom: 16px;
                ">
                    ${eventData.description || 'No description available.'}
                </div>
            </div>

            <!-- Basic Event Info -->
            <div class="tba-basic-info">
                <div class="tba-info-grid" style="
                    display: grid;
                    grid-template-columns: 1fr 1fr;
                    gap: 12px;
                    margin-bottom: 16px;
                ">
                    <div class="info-item">
                        <strong style="color: #6c757d; font-size: 12px; display: block; margin-bottom: 4px;">
                            <i class="fas fa-map-marker-alt" style="margin-right: 4px;"></i>
                            LOCATION
                        </strong>
                        <span style="color: #495057; font-size: 14px;">${eventData.location || 'TBA'}</span>
                    </div>
                    <div class="info-item">
                        <strong style="color: #6c757d; font-size: 12px; display: block; margin-bottom: 4px;">
                            <i class="fas fa-tag" style="margin-right: 4px;"></i>
                            CATEGORY
                        </strong>
                        <span style="color: #495057; font-size: 14px;">${eventData.category || 'General'}</span>
                    </div>
                </div>
            </div>

            <!-- Contact Information Section for TBA Events -->
            ${eventData.phyeveContactInfo ? `
                <div class="tba-contact-section" style="margin-bottom: 16px;">
                    <div class="contact-header" style="
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        margin-bottom: 12px;
                        padding-bottom: 8px;
                        border-bottom: 2px solid #e9ecef;
                    ">
                        <h4 style="margin: 0; color: #495057; display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-address-book" style="color: #007bff;"></i>
                            Contact Information
                        </h4>
                        <span style="font-size: 12px; color: #6c757d;">
                            Total Clicks: ${getTotalContactClicks(eventData)}
                        </span>
                    </div>
                    <div class="contact-items-grid" style="
                        display: grid;
                        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                        gap: 8px;
                    ">
                        ${generateContactItemsWithClicks(eventData)}
                    </div>
                </div>
            ` : ''}

            <!-- TBA Status Banner -->
            <div class="tba-status-banner" style="
                background: linear-gradient(135deg, #ffc107, #e0a800);
                color: #212529;
                padding: 12px 16px;
                border-radius: 8px;
                text-align: center;
                font-weight: 600;
                margin-bottom: 16px;
                border: 2px solid rgba(255, 193, 7, 0.3);
            ">
                <i class="fas fa-clock" style="margin-right: 8px;"></i>
                Date & Time: To Be Announced
            </div>

            <!-- Sponsors Section -->
            <div class="sponsors-section tba-sponsors" style="margin-bottom: 16px;">
                <div class="sponsors-header" style="
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    margin-bottom: 12px;
                    padding-bottom: 8px;
                    border-bottom: 2px solid #e9ecef;
                ">
                    <h4 style="margin: 0; color: #495057; display: flex; align-items: center; gap: 8px;">
                        <i class="fas fa-handshake" style="color: #28a745;"></i>
                        Event Sponsors
                    </h4>
                    <button class="add-sponsors-btn tba-add-sponsors" onclick="openSponsorsModal('${eventData.physicalEventId}')" style="
                        background: linear-gradient(135deg, #28a745, #20c997);
                        color: white;
                        border: none;
                        padding: 6px 12px;
                        border-radius: 6px;
                        cursor: pointer;
                        font-size: 12px;
                        font-weight: 600;
                        display: flex;
                        align-items: center;
                        gap: 6px;
                        transition: all 0.3s ease;
                    " onmouseover="this.style.transform='translateY(-1px)'" onmouseout="this.style.transform='translateY(0)'">
                        <i class="fas fa-plus"></i>
                        Add Sponsors
                    </button>
                </div>
                <div class="sponsors-display tba-sponsors-display" style="
                    background: #f8f9fa;
                    border: 1px solid #e9ecef;
                    border-radius: 8px;
                    padding: 12px;
                    min-height: 60px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                ">
                    ${generateSponsorsDisplay(eventData.sponsors)}
                </div>
            </div>

            <!-- Tickets Status for TBA -->
            <div class="tba-tickets-status" style="
                background: #e3f2fd;
                border: 1px solid #bbdefb;
                border-radius: 8px;
                padding: 12px 16px;
                text-align: center;
                margin-bottom: 16px;
            ">
                <div style="display: flex; align-items: center; justify-content: center; gap: 8px; margin-bottom: 8px;">
                    <i class="fas fa-ticket-alt" style="color: #1976d2; font-size: 18px;"></i>
                    <strong style="color: #1976d2;">Tickets Coming Soon</strong>
                </div>
                <p style="margin: 0; color: #0d47a1; font-size: 14px;">
                    Tickets will be available once the event date is confirmed
                </p>
            </div>

            <!-- Event Management -->
            <div class="tba-management-section" style="
                border-top: 1px solid #e9ecef;
                padding-top: 16px;
            ">
               
               <button class="change-event-btn" onclick="openPhyEventChange('${eventData.physicalEventId}')" title="Change Event Details" style="
    background: linear-gradient(135deg, #f39c12, #e67e22);
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 6px;
    cursor: pointer;
    font-weight: 600;
    font-size: 13px;
    display: flex;
    align-items: center;
    gap: 6px;
    transition: all 0.3s ease;
    flex: 1;
">
    <i class="fas fa-exchange-alt"></i>
    Change Event
</button>
                    <button class="close-event-btn" onclick="openPhyEventClose('${eventData.physicalEventId}')" title="Close Event" style="
                        background: linear-gradient(135deg, #dc3545, #c82333);
                        color: white;
                        border: none;
                        padding: 8px 16px;
                        border-radius: 6px;
                        cursor: pointer;
                        font-weight: 600;
                        font-size: 13px;
                        display: flex;
                        align-items: center;
                        gap: 6px;
                        transition: all 0.3s ease;
                        flex: 1;
                    ">
                        <i class="fas fa-times-circle"></i>
                        Close Event
                    </button>
                </div>

                <!-- Event Link for Sharing -->
                <div class="tba-sharing" style="
                    text-align: center;
                    padding-top: 12px;
                    border-top: 1px solid #e9ecef;
                ">
                    <small style="color: #6c757d; display: block; margin-bottom: 6px;">Event Link:</small>
                    <div style="
                        background: #f8f9fa;
                        border: 1px solid #dee2e6;
                        border-radius: 4px;
                        padding: 6px 10px;
                        font-family: monospace;
                        font-size: 12px;
                        color: #495057;
                        display: inline-block;
                        cursor: pointer;
                        transition: all 0.2s ease;
                    " onclick="copyEventLink('${eventData.eventLink}')" title="Click to copy link"
                       onmouseover="this.style.background='#e9ecef'; this.style.borderColor='#ced4da'"
                       onmouseout="this.style.background='#f8f9fa'; this.style.borderColor='#dee2e6'">
                        reward-hub.vercel.app/event/${eventData.eventLink}
                        <i class="fas fa-copy" style="margin-left: 6px; opacity: 0.7;"></i>
                    </div>
                </div>
            </div>
        </div>
    `;

    // Add click event for expand/collapse
    addExpandCollapseForTBA(cardDiv);
    
    return cardDiv;
}

              
         
// Contact Click Tracking System
async function trackContactClick(eventId, contactType, contactUrl) {
    try {
        console.log('Tracking contact click:', contactType, 'for event:', eventId);
        
        // Get current user
        const currentUser = firebase.auth().currentUser;
        if (!currentUser) {
            console.log('User not authenticated, opening contact anyway');
        }
        
        // Update click count in Firebase
        const db = firebase.firestore();
        const eventRef = db.collection('physicalEvents').doc(eventId);
        
        // Get current event data
        const eventDoc = await eventRef.get();
        if (eventDoc.exists) {
            const eventData = eventDoc.data();
            const currentClicks = eventData.contactClicks || {};
            
            // Initialize contact clicks if not exists
            if (!currentClicks[contactType]) {
                currentClicks[contactType] = 0;
            }
            
            // Increment click count
            currentClicks[contactType]++;
            
            // Update in Firebase
            await eventRef.update({
                contactClicks: currentClicks,
                updatedAt: new Date().toISOString()
            });
            
            console.log(`Click tracked for ${contactType}: ${currentClicks[contactType]} total clicks`);
            
            // Update UI immediately
            updateContactClicksUI(eventId, contactType, currentClicks[contactType]);
        }
        
        // Open the contact based on type
        openContact(contactType, contactUrl);
        
    } catch (error) {
        console.error('Error tracking contact click:', error);
        // Still open the contact even if tracking fails
        openContact(contactType, contactUrl);
    }
}

// Open contact based on type
function openContact(contactType, contactUrl) {
    switch (contactType) {
        case 'phone':
            window.open(`tel:${contactUrl}`, '_self');
            break;
        case 'website':
        case 'instagram':
        case 'tiktok':
        case 'facebook':
        case 'twitter':
        case 'youtube':
        case 'linkedin':
        case 'whatsapp':
        case 'custom1':
        case 'custom2':
        case 'custom3':
            window.open(contactUrl, '_blank');
            break;
        default:
            console.log('Unknown contact type:', contactType);
    }
}

// Update contact clicks in UI immediately
function updateContactClicksUI(eventId, contactType, newClickCount) {
    const eventCard = document.querySelector(`[data-event-id="${eventId}"]`);
    if (!eventCard) return;
    
    // Find the specific contact item and update its click count
    const contactItems = eventCard.querySelectorAll('.contact-clickable-item');
    contactItems.forEach(item => {
        const onclick = item.getAttribute('onclick');
        if (onclick && onclick.includes(`'${contactType}'`)) {
            const clickCountSpan = item.querySelector('small');
            if (clickCountSpan) {
                clickCountSpan.textContent = `${newClickCount} clicks`;
            }
        }
    });
    
    // Update total clicks
    const totalClicksSpan = eventCard.querySelector('.contact-header span');
    if (totalClicksSpan) {
        // Recalculate total from all contact types
        let totalClicks = 0;
        contactItems.forEach(item => {
            const clickText = item.querySelector('small')?.textContent || '0 clicks';
            const clickCount = parseInt(clickText.match(/\d+/)?.[0] || '0');
            totalClicks += clickCount;
        });
        totalClicksSpan.textContent = `Total Clicks: ${totalClicks}`;
    }
}

// Helper function to get contact clicks count
function getContactClicks(contactInfo, contactType) {
    return contactInfo.contactClicks?.[contactType] || 0;
}

// Helper function to get total contact clicks
function getTotalContactClicks(contactInfo) {
    if (!contactInfo.contactClicks) return 0;
    
    return Object.values(contactInfo.contactClicks).reduce((total, clicks) => total + clicks, 0);
}
     
// Function to open close event confirmation
async function openPhyEventClose(eventId) {
    try {
        console.log('Opening close confirmation for event:', eventId);
        
        // Get event data to show in confirmation
        const db = firebase.firestore();
        const eventDoc = await db.collection('physicalEvents').doc(eventId).get();
        
        if (!eventDoc.exists) {
            showNotification('Event not found', 'error');
            return;
        }
        
        const eventData = eventDoc.data();
        
        // Create close confirmation modal
        const modal = document.createElement('div');
        modal.className = 'phyeventclose-modal-overlay';
        modal.id = 'phyeventclose-modal';
        
        modal.innerHTML = `
            <div class="phyeventclose-modal">
                <div class="modal-header">
                    <h3><i class="fas fa-exclamation-triangle" style="color: #dc3545;"></i> Close Physical Event</h3>
                    <button class="close-modal-btn" onclick="closePhyEventClose()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div class="modal-body">
                    <div class="warning-section">
                        <div class="warning-icon">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <div class="warning-content">
                            <h4>Are you sure you want to close this event?</h4>
                            <p><strong>Event:</strong> ${eventData.eventName}</p>
                            <p><strong>Warning:</strong> Closing this event will:</p>
                            <ul>
                                <li>Stop ticket sales immediately</li>
                                <li>Mark the event as permanently closed</li>
                                <li>This action cannot be undone</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="confirmation-actions">
                        <button type="button" onclick="closePhyEventClose()" class="cancel-btn">
                            <i class="fas fa-times"></i> Cancel
                        </button>
                        <button type="button" onclick="confirmCloseEvent('${eventId}')" class="confirm-close-btn">
                            <i class="fas fa-times-circle"></i> Yes, Close Event
                        </button>
                    </div>
                </div>
            </div>
        `;
        
        document.body.appendChild(modal);
        
    } catch (error) {
        console.error('Error opening close confirmation:', error);
        showNotification('Error opening close confirmation: ' + error.message, 'error');
    }
}


function createFullEventCard(cardDiv, eventData, backgroundStyle) {
    // Calculate stats only if tickets exist
    const hasNoTickets = eventData.noTicketsRequired || (eventData.tickets && eventData.tickets.length === 0);
    
    let totalRevenue = 0;
    let totalBuyers = 0;
    let ticketStats = { vipSold: 0, regularSold: 0 };
    
    if (!hasNoTickets) {
        totalRevenue = calculateTotalRevenue(eventData.tickets);
        totalBuyers = calculateTotalBuyers(eventData.tickets);
        ticketStats = calculateTicketStats(eventData.tickets);
    }
    
    const totalWithdrawn = eventData.totalWithdrawn || 0;
    const likesCount = eventData.likesCount || 0;
    const currentUser = firebase.auth().currentUser;
    const userLiked = eventData.likedBy && currentUser ? eventData.likedBy.includes(currentUser.uid) : false;
    
    // Determine event status
    const eventStatus = determineEventStatus(eventData);
    
    // Check if event ID is locked
    const isLocked = eventIdSecurity.isLocked(eventData.physicalEventId);
    const isSessionUnlocked = eventIdSecurity.isSessionUnlocked(eventData.physicalEventId);
    
    // Check if bank details exist
    const hasBankDetails = eventData.bankDetails && eventData.bankDetails.bank;
    const bankStatusIcon = hasBankDetails ? 
        '<i class="fas fa-check-circle" style="color: #28a745;"></i>' : 
        '<i class="fas fa-exclamation-circle" style="color: #ffc107;"></i>';
    
    const bankStatusText = hasBankDetails ? 
        `Bank: ${eventData.bankDetails.bank}` : 
        'Bank details not set';

    cardDiv.innerHTML = `
        <div class="event-card-header" style="${backgroundStyle}">
            <div class="event-card-overlay">
                <h3 class="event-title">${eventData.eventName}</h3>
               <div class="expand-indicator">
                    <i class="fas fa-chevron-down"></i>
                </div>
            </div>
        </div>
                
        <div class="event-card-content">
            <!-- Secure Event ID Container -->
            <div class="event-id-section">
                <div class="event-id-header" onclick="handleEventIdHeaderClick('${eventData.physicalEventId}')">
                    <span class="event-id-label">
                        Event ID 
                        ${isLocked ? '<i class="fas fa-lock security-icon" title="Protected"></i>' : ''}
                    </span>
                    <div class="event-id-controls">
                        <!-- Security Toggle Button -->
                        <button class="security-toggle-btn" onclick="event.stopPropagation(); toggleEventSecurity('${eventData.physicalEventId}')" 
                                title="${isLocked ? 'Remove Protection' : 'Add Protection'}" type="button">
                            <i class="fas ${isLocked ? 'fa-lock' : 'fa-lock-open'}"></i>
                        </button>
                        
                        <!-- Eye Toggle Button -->
                        <button class="eye-toggle-btn ${isLocked && !isSessionUnlocked ? 'disabled' : ''}" 
                                onclick="event.stopPropagation(); toggleEventIdVisibility('${eventData.physicalEventId}')" 
                                type="button" ${isLocked && !isSessionUnlocked ? 'disabled' : ''}>
                            <i class="fas fa-eye" id="eye-icon-${eventData.physicalEventId}"></i>
                        </button>
                    </div>
                </div>
                
                <div class="event-id-container" id="event-id-container-${eventData.physicalEventId}" style="display: none;">
                    <div class="event-id-content">
                        <code class="event-id-code" id="event-id-code-${eventData.physicalEventId}">
                            ${(isLocked && !isSessionUnlocked) ? '' : (eventData.physicalEventId || 'N/A')}
                        </code>
                        <button class="copy-id-btn ${(isLocked && !isSessionUnlocked) ? 'disabled' : ''}" 
                                onclick="copyEventId('${eventData.physicalEventId}')" 
                                title="Copy Event ID"
                                ${(isLocked && !isSessionUnlocked) ? 'disabled' : ''}>
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                    <small class="event-id-note">
                        ${isLocked ? 
                            (isSessionUnlocked ? 'Protected ID - Unlocked for this session' : 'Protected ID - Enter password to view') : 
                            'Use this ID for API integration or support'
                        }
                    </small>
                </div>
            </div>

            <div class="event-action-tools">
                
            </div>
            
            ${!hasNoTickets ? `
                <div class="ticket-stats-grid">
                    <div class="stat-card">
                        <div class="stat-value">${totalRevenue.toLocaleString()}</div>
                        <div class="stat-label">Total Revenue</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${totalBuyers}</div>
                        <div class="stat-label">Total Buyers</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">
                            <span class="withdraw-amount" id="withdraw-${eventData.physicalEventId}">${totalWithdrawn.toLocaleString()}</span>
                            <button class="eye-toggle-btn" onclick="toggleWithdrawVisibility('${eventData.physicalEventId}')" style="margin-left: 8px;">
                                <i class="fas fa-eye" id="eye-icon-${eventData.physicalEventId}"></i>
                            </button>
                        </div>
                        <div class="stat-label">Total Withdrawn</div>
                    </div>
                     
                    <div class="individual-ticket-sales">
                        <h4>Tickets Sold by Type</h4>
                        <div class="ticket-breakdown-grid">
                            ${generateTicketBreakdown(eventData.tickets || [])}
                        </div>
                    </div>
                </div>
            ` : `
                <div class="no-tickets-stats" style="
                    background: #e3f2fd;
                    border: 1px solid #bbdefb;
                    border-radius: 8px;
                    padding: 20px;
                    text-align: center;
                    margin: 15px 0;
                ">
                    <div style="display: flex; align-items: center; justify-content: center; gap: 8px; margin-bottom: 8px;">
                        <i class="fas fa-info-circle" style="color: #1976d2; font-size: 18px;"></i>
                        <strong style="color: #1976d2;">No Tickets Required</strong>
                    </div>
                    <p style="margin: 0; color: #0d47a1; font-size: 14px;">
                        This event doesn't require tickets. Contact the organizer directly for attendance.
                    </p>
                </div>
            `}
            
${eventData.phyeveContactInfo ? `
    <div class="contact-section" style="margin-bottom: 16px;">
        <div class="contact-header" style="
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 2px solid #e9ecef;
        ">
            <h4 style="margin: 0; color: #495057; display: flex; align-items: center; gap: 8px;">
                <i class="fas fa-address-book" style="color: #007bff;"></i>
                Contact Information
            </h4>
            <span style="font-size: 12px; color: #6c757d;">
                Total Clicks: ${getTotalContactClicks(eventData)}
            </span>
        </div>
        <div class="contact-items-grid" style="
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 8px;
        ">
            ${generateContactItemsWithClicks(eventData)}
        </div>
    </div>
` : ''}
<button class="change-event-btn" onclick="openPhyEventChange('${eventData.physicalEventId}')" title="Change Event Details" style="
    background: linear-gradient(135deg, #f39c12, #e67e22);
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 6px;
    cursor: pointer;
    font-weight: 600;
    font-size: 13px;
    display: flex;
    align-items: center;
    gap: 6px;
    transition: all 0.3s ease;
    flex: 1;
">
    <i class="fas fa-exchange-alt"></i>
    Change Event
</button>
            <div class="sponsors-section">
                <div class="sponsors-header">
                    <h4>Event Sponsors</h4>
                  
                </div>
                <div class="sponsors-display">
                    ${generateSponsorsDisplay(eventData.sponsors)}
                </div>
            </div>
           
            <div class="event-action-buttons" style="display: flex; gap: 8px; margin-top: 12px;">
                
                  <h4>We are updating the withdrawal feature to better suit u 
                    sunday 24th we will get back 
                  </h4>
                  
                
            </div>
        </div>
    `;

    // Add click event for expand/collapse
    addExpandCollapseForFull(cardDiv);

    return cardDiv;
}

// Only show stats if user has tickets
if (!hasNoTickets) {
    cardDiv.innerHTML += `
        <div class="ticket-stats-grid">
            <div class="stat-card">
                <div class="stat-value">${totalRevenue.toLocaleString()}</div>
                <div class="stat-label">Total Revenue</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">${totalBuyers}</div>
                <div class="stat-label">Total Buyers</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">
                    <span class="withdraw-amount" id="withdraw-${eventData.physicalEventId}">${totalWithdrawn.toLocaleString()}</span>
                    <button class="eye-toggle-btn" onclick="toggleWithdrawVisibility('${eventData.physicalEventId}')" style="margin-left: 8px;">
                        <i class="fas fa-eye" id="eye-icon-${eventData.physicalEventId}"></i>
                    </button>
                </div>
                <div class="stat-label">Total Withdrawn</div>
            </div>
             
            <div class="individual-ticket-sales">
                <h4>Tickets Sold by Type</h4>
                <div class="ticket-breakdown-grid">
                    ${generateTicketBreakdown(eventData.tickets || [])}
                </div>
            </div>
        </div>
    `;
} else {
    // Show no tickets message instead of stats
    cardDiv.innerHTML += `
        <div class="no-tickets-stats" style="
            background: #e3f2fd;
            border: 1px solid #bbdefb;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            margin: 15px 0;
        ">
            <div style="display: flex; align-items: center; justify-content: center; gap: 8px; margin-bottom: 8px;">
                <i class="fas fa-info-circle" style="color: #1976d2; font-size: 18px;"></i>
                <strong style="color: #1976d2;">No Tickets Required</strong>
            </div>
            <p style="margin: 0; color: #0d47a1; font-size: 14px;">
                This event doesn't require tickets. Contact the organizer directly for attendance.
            </p>
        </div>
    `;
}
// Generate contact items with click tracking
function generateContactItemsWithClicks(eventData) {
    const contactInfo = eventData.phyeveContactInfo;
    if (!contactInfo) return '';
    
    let contactItems = '';
    
    // Host Name (not clickable)
    if (contactInfo.hostName) {
        contactItems += `
            <div class="contact-item" style="
                background: #f8f9fa;
                border: 1px solid #e9ecef;
                border-radius: 6px;
                padding: 8px 12px;
                display: flex;
                align-items: center;
                gap: 8px;
                font-size: 13px;
            ">
                <i class="fas fa-user" style="color: #6c757d; width: 16px;"></i>
                <span style="color: #495057; font-weight: 500;">${contactInfo.hostName}</span>
            </div>
        `;
    }
    
    // Phone Number
    if (contactInfo.phoneNumber) {
        const clicks = getContactClicks(eventData, 'phone');
        contactItems += `
            <div class="contact-clickable-item" onclick="trackContactClick('${eventData.physicalEventId}', 'phone', '${contactInfo.phoneNumber}')" style="
                background: #f8f9fa;
                border: 1px solid #e9ecef;
                border-radius: 6px;
                padding: 8px 12px;
                display: flex;
                align-items: center;
                justify-content: space-between;
                cursor: pointer;
                transition: all 0.2s ease;
                font-size: 13px;
            " onmouseover="this.style.background='#e9ecef'" onmouseout="this.style.background='#f8f9fa'">
                <div style="display: flex; align-items: center; gap: 8px;">
                    <i class="fas fa-phone" style="color: #28a745; width: 16px;"></i>
                    <span style="color: #495057; font-weight: 500;">Phone</span>
                </div>
                <small style="color: #6c757d;">${clicks} clicks</small>
            </div>
        `;
    }
    
    // Website
    if (contactInfo.websiteUrl) {
        const clicks = getContactClicks(eventData, 'website');
        contactItems += `
            <div class="contact-clickable-item" onclick="trackContactClick('${eventData.physicalEventId}', 'website', '${contactInfo.websiteUrl}')" style="
                background: #f8f9fa;
                border: 1px solid #e9ecef;
                border-radius: 6px;
                padding: 8px 12px;
                display: flex;
                align-items: center;
                justify-content: space-between;
                cursor: pointer;
                transition: all 0.2s ease;
                font-size: 13px;
            " onmouseover="this.style.background='#e9ecef'" onmouseout="this.style.background='#f8f9fa'">
                <div style="display: flex; align-items: center; gap: 8px;">
                    <i class="fas fa-globe" style="color: #007bff; width: 16px;"></i>
                    <span style="color: #495057; font-weight: 500;">Website</span>
                </div>
                <small style="color: #6c757d;">${clicks} clicks</small>
            </div>
        `;
    }
    
    // Instagram
    if (contactInfo.instagramUrl) {
        const clicks = getContactClicks(eventData, 'instagram');
        contactItems += `
            <div class="contact-clickable-item" onclick="trackContactClick('${eventData.physicalEventId}', 'instagram', '${contactInfo.instagramUrl}')" style="
                background: #f8f9fa;
                border: 1px solid #e9ecef;
                border-radius: 6px;
                padding: 8px 12px;
                display: flex;
                align-items: center;
                justify-content: space-between;
                cursor: pointer;
                transition: all 0.2s ease;
                font-size: 13px;
            " onmouseover="this.style.background='#e9ecef'" onmouseout="this.style.background='#f8f9fa'">
                <div style="display: flex; align-items: center; gap: 8px;">
                    <i class="fab fa-instagram" style="color: #E4405F; width: 16px;"></i>
                    <span style="color: #495057; font-weight: 500;">Instagram</span>
                </div>
                <small style="color: #6c757d;">${clicks} clicks</small>
            </div>
        `;
    }
    
    // TikTok
    if (contactInfo.tiktokUrl) {
        const clicks = getContactClicks(eventData, 'tiktok');
        contactItems += `
            <div class="contact-clickable-item" onclick="trackContactClick('${eventData.physicalEventId}', 'tiktok', '${contactInfo.tiktokUrl}')" style="
                background: #f8f9fa;
                border: 1px solid #e9ecef;
                border-radius: 6px;
                padding: 8px 12px;
                display: flex;
                align-items: center;
                justify-content: space-between;
                cursor: pointer;
                transition: all 0.2s ease;
                font-size: 13px;
            " onmouseover="this.style.background='#e9ecef'" onmouseout="this.style.background='#f8f9fa'">
                <div style="display: flex; align-items: center; gap: 8px;">
                    <i class="fab fa-tiktok" style="color: #000; width: 16px;"></i>
                    <span style="color: #495057; font-weight: 500;">TikTok</span>
                </div>
                <small style="color: #6c757d;">${clicks} clicks</small>
            </div>
        `;
    }
    
    // Facebook
    if (contactInfo.facebookUrl) {
        const clicks = getContactClicks(eventData, 'facebook');
        contactItems += `
            <div class="contact-clickable-item" onclick="trackContactClick('${eventData.physicalEventId}', 'facebook', '${contactInfo.facebookUrl}')" style="
                background: #f8f9fa;
                border: 1px solid #e9ecef;
                border-radius: 6px;
                padding: 8px 12px;
                display: flex;
                align-items: center;
                justify-content: space-between;
                cursor: pointer;
                transition: all 0.2s ease;
                font-size: 13px;
            " onmouseover="this.style.background='#e9ecef'" onmouseout="this.style.background='#f8f9fa'">
                <div style="display: flex; align-items: center; gap: 8px;">
                    <i class="fab fa-facebook" style="color: #4267B2; width: 16px;"></i>
                    <span style="color: #495057; font-weight: 500;">Facebook</span>
                </div>
                <small style="color: #6c757d;">${clicks} clicks</small>
            </div>
        `;
    }
    
    // Twitter
    if (contactInfo.twitterUrl) {
        const clicks = getContactClicks(eventData, 'twitter');
        contactItems += `
            <div class="contact-clickable-item" onclick="trackContactClick('${eventData.physicalEventId}', 'twitter', '${contactInfo.twitterUrl}')" style="
                background: #f8f9fa;
                border: 1px solid #e9ecef;
                border-radius: 6px;
                padding: 8px 12px;
                display: flex;
                align-items: center;
                justify-content: space-between;
                cursor: pointer;
                transition: all 0.2s ease;
                font-size: 13px;
            " onmouseover="this.style.background='#e9ecef'" onmouseout="this.style.background='#f8f9fa'">
                <div style="display: flex; align-items: center; gap: 8px;">
                    <i class="fab fa-twitter" style="color: #1DA1F2; width: 16px;"></i>
                    <span style="color: #495057; font-weight: 500;">Twitter</span>
                </div>
                <small style="color: #6c757d;">${clicks} clicks</small>
            </div>
        `;
    }
    
    // YouTube
    if (contactInfo.youtubeUrl) {
        const clicks = getContactClicks(eventData, 'youtube');
        contactItems += `
            <div class="contact-clickable-item" onclick="trackContactClick('${eventData.physicalEventId}', 'youtube', '${contactInfo.youtubeUrl}')" style="
                background: #f8f9fa;
                border: 1px solid #e9ecef;
                border-radius: 6px;
                padding: 8px 12px;
                display: flex;
                align-items: center;
                justify-content: space-between;
                cursor: pointer;
                transition: all 0.2s ease;
                font-size: 13px;
            " onmouseover="this.style.background='#e9ecef'" onmouseout="this.style.background='#f8f9fa'">
                <div style="display: flex; align-items: center; gap: 8px;">
                    <i class="fab fa-youtube" style="color: #FF0000; width: 16px;"></i>
                    <span style="color: #495057; font-weight: 500;">YouTube</span>
                </div>
                <small style="color: #6c757d;">${clicks} clicks</small>
            </div>
        `;
    }
    
    // LinkedIn
    if (contactInfo.linkedinUrl) {
        const clicks = getContactClicks(eventData, 'linkedin');
        contactItems += `
            <div class="contact-clickable-item" onclick="trackContactClick('${eventData.physicalEventId}', 'linkedin', '${contactInfo.linkedinUrl}')" style="
                background: #f8f9fa;
                border: 1px solid #e9ecef;
                border-radius: 6px;
                padding: 8px 12px;
                display: flex;
                align-items: center;
                justify-content: space-between;
                cursor: pointer;
                transition: all 0.2s ease;
                font-size: 13px;
            " onmouseover="this.style.background='#e9ecef'" onmouseout="this.style.background='#f8f9fa'">
                <div style="display: flex; align-items: center; gap: 8px;">
                    <i class="fab fa-linkedin" style="color: #0077B5; width: 16px;"></i>
                    <span style="color: #495057; font-weight: 500;">LinkedIn</span>
                </div>
                <small style="color: #6c757d;">${clicks} clicks</small>
            </div>
        `;
    }
    
    // WhatsApp
    if (contactInfo.whatsappUrl) {
        const clicks = getContactClicks(eventData, 'whatsapp');
        contactItems += `
            <div class="contact-clickable-item" onclick="trackContactClick('${eventData.physicalEventId}', 'whatsapp', '${contactInfo.whatsappUrl}')" style="
                background: #f8f9fa;
                border: 1px solid #e9ecef;
                border-radius: 6px;
                padding: 8px 12px;
                display: flex;
                align-items: center;
                justify-content: space-between;
                cursor: pointer;
                transition: all 0.2s ease;
                font-size: 13px;
            " onmouseover="this.style.background='#e9ecef'" onmouseout="this.style.background='#f8f9fa'">
                <div style="display: flex; align-items: center; gap: 8px;">
                    <i class="fab fa-whatsapp" style="color: #25D366; width: 16px;"></i>
                    <span style="color: #495057; font-weight: 500;">WhatsApp</span>
                </div>
                <small style="color: #6c757d;">${clicks} clicks</small>
            </div>
        `;
    }
    
    // Custom Links
    if (contactInfo.customLink1Url && contactInfo.customLink1Name) {
        const clicks = getContactClicks(eventData, 'custom1');
        contactItems += `
            <div class="contact-clickable-item" onclick="trackContactClick('${eventData.physicalEventId}', 'custom1', '${contactInfo.customLink1Url}')" style="
                background: #f8f9fa;
                border: 1px solid #e9ecef;
                border-radius: 6px;
                padding: 8px 12px;
                display: flex;
                align-items: center;
                justify-content: space-between;
                cursor: pointer;
                transition: all 0.2s ease;
                font-size: 13px;
            " onmouseover="this.style.background='#e9ecef'" onmouseout="this.style.background='#f8f9fa'">
                <div style="display: flex; align-items: center; gap: 8px;">
                    <i class="fas fa-external-link-alt" style="color: #6c5ce7; width: 16px;"></i>
                    <span style="color: #495057; font-weight: 500;">${contactInfo.customLink1Name}</span>
                </div>
                <small style="color: #6c757d;">${clicks} clicks</small>
            </div>
        `;
    }
    
    if (contactInfo.customLink2Url && contactInfo.customLink2Name) {
        const clicks = getContactClicks(eventData, 'custom2');
        contactItems += `
            <div class="contact-clickable-item" onclick="trackContactClick('${eventData.physicalEventId}', 'custom2', '${contactInfo.customLink2Url}')" style="
                background: #f8f9fa;
                border: 1px solid #e9ecef;
                border-radius: 6px;
                padding: 8px 12px;
                display: flex;
                align-items: center;
                justify-content: space-between;
                cursor: pointer;
                transition: all 0.2s ease;
                font-size: 13px;
            " onmouseover="this.style.background='#e9ecef'" onmouseout="this.style.background='#f8f9fa'">
                <div style="display: flex; align-items: center; gap: 8px;">
                    <i class="fas fa-link" style="color: #17a2b8; width: 16px;"></i>
                    <span style="color: #495057; font-weight: 500;">${contactInfo.customLink2Name}</span>
                </div>
                <small style="color: #6c757d;">${clicks} clicks</small>
            </div>
        `;
    }
    
    if (contactInfo.customLink3Url && contactInfo.customLink3Name) {
        const clicks = getContactClicks(eventData, 'custom3');
        contactItems += `
            <div class="contact-clickable-item" onclick="trackContactClick('${eventData.physicalEventId}', 'custom3', '${contactInfo.customLink3Url}')" style="
                background: #f8f9fa;
                border: 1px solid #e9ecef;
                border-radius: 6px;
                padding: 8px 12px;
                display: flex;
                align-items: center;
                justify-content: space-between;
                cursor: pointer;
                transition: all 0.2s ease;
                font-size: 13px;
            " onmouseover="this.style.background='#e9ecef'" onmouseout="this.style.background='#f8f9fa'">
                <div style="display: flex; align-items: center; gap: 8px;">
                    <i class="fas fa-share-alt" style="color: #fd7e14; width: 16px;"></i>
                    <span style="color: #495057; font-weight: 500;">${contactInfo.customLink3Name}</span>
                </div>
                <small style="color: #6c757d;">${clicks} clicks</small>
            </div>
        `;
    }
    
    return contactItems;
}

// Helper function to get contact clicks count (already exists but ensure it's there)
function getContactClicks(eventData, contactType) {
    return eventData.contactClicks?.[contactType] || 0;
}

// Helper function to get total contact clicks (already exists but ensure it's there)  
function getTotalContactClicks(eventData) {
    if (!eventData.contactClicks) return 0;
    
    return Object.values(eventData.contactClicks).reduce((total, clicks) => total + clicks, 0);
}
// Add expand/collapse functionality for TBA cards
function addExpandCollapseForTBA(cardDiv) {
    const cardHeader = cardDiv.querySelector('.event-card-header');
    const cardContent = cardDiv.querySelector('.event-card-content');
    const expandIndicator = cardDiv.querySelector('.expand-indicator i');
    
    cardHeader.addEventListener('click', (e) => {
        const isExpanded = cardDiv.classList.contains('expanded');
                
        if (isExpanded) {
            cardDiv.classList.remove('expanded');
            cardContent.style.maxHeight = '0';
            expandIndicator.style.transform = 'rotate(0deg)';
        } else {
            cardDiv.classList.add('expanded');
            cardContent.style.maxHeight = cardContent.scrollHeight + 'px';
            expandIndicator.style.transform = 'rotate(180deg)';
        }
    });
}

// Add expand/collapse functionality for full cards
function addExpandCollapseForFull(cardDiv) {
    const cardHeader = cardDiv.querySelector('.event-card-header');
    const cardContent = cardDiv.querySelector('.event-card-content');
    const expandIndicator = cardDiv.querySelector('.expand-indicator i');
    
    cardHeader.addEventListener('click', (e) => {
        if (e.target.closest('.event-id-section')) {
            return;
        }
        
        const isExpanded = cardDiv.classList.contains('expanded');
                
        if (isExpanded) {
            cardDiv.classList.remove('expanded');
            cardContent.style.maxHeight = '0';
            expandIndicator.style.transform = 'rotate(0deg)';
        } else {
            cardDiv.classList.add('expanded');
            cardContent.style.maxHeight = cardContent.scrollHeight + 'px';
            expandIndicator.style.transform = 'rotate(180deg)';
        }
    });
}

// Helper function to copy event link
function copyEventLink(eventLink) {
    const fullLink = `reward-hub.vercel.app/${eventLink}`;
    
    if (navigator.clipboard && window.isSecureContext) {
        navigator.clipboard.writeText(fullLink).then(function() {
            showCopySuccess(`Event Link: ${fullLink}`);
        }).catch(function(err) {
            console.error('Could not copy link: ', err);
            fallbackCopyTextToClipboard(fullLink);
        });
    } else {
        fallbackCopyTextToClipboard(fullLink);
    }
}
// Handle event ID header click with security check
function handleEventIdHeaderClick(eventId) {
    const isLocked = eventIdSecurity.isLocked(eventId);
    const isSessionUnlocked = eventIdSecurity.isSessionUnlocked(eventId);
    
    if (isLocked && !isSessionUnlocked) {
        // Show password prompt instead of toggling visibility
        showPasswordPrompt(eventId);
    } else {
        // Normal toggle behavior
        toggleEventIdVisibility(eventId);
    }
}

// Toggle event security (lock/unlock)
function toggleEventSecurity(eventId) {
    const isLocked = eventIdSecurity.isLocked(eventId);
    
    if (isLocked) {
        // Unlock the event
        showConfirmDialog(
            'Remove Protection',
            'Are you sure you want to remove password protection from this Event ID?',
            () => {
                eventIdSecurity.unlockEvent(eventId);
                updateEventCardSecurity(eventId);
                showNotification('Event ID protection removed', 'success');
            }
        );
    } else {
        // Lock the event
        showPasswordSetupDialog(eventId);
    }
}

// Show password setup dialog
function showPasswordSetupDialog(eventId) {
    const modal = createSecurityModal('setup', eventId);
    document.body.appendChild(modal);
}

// Show password prompt dialog
function showPasswordPrompt(eventId) {
    const modal = createSecurityModal('prompt', eventId);
    document.body.appendChild(modal);
}

// Create security modal
function createSecurityModal(type, eventId) {
    const modal = document.createElement('div');
    modal.className = 'security-modal-overlay';
    
    const isSetup = type === 'setup';
    const title = isSetup ? 'Set Password Protection' : 'Enter Password';
    const description = isSetup ? 
        'Set a password to protect this Event ID from unauthorized viewing.' : 
        'Enter the password to view this protected Event ID.';
    
    modal.innerHTML = `
        <div class="security-modal">
            <div class="security-modal-header">
                <h3><i class="fas fa-shield-alt"></i> ${title}</h3>
                <button class="close-modal-btn" onclick="closeSecurityModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="security-modal-body">
                <p>${description}</p>
                
                <form class="security-form" onsubmit="handleSecurityForm(event, '${type}', '${eventId}')">
                    <div class="form-group">
                        <label for="security-password">Password:</label>
                        <div class="password-input-container">
                            <input type="password" 
                                   id="security-password" 
                                   class="security-password-input" 
                                   placeholder="Enter password"
                                   required
                                   minlength="4">
                            <button type="button" class="toggle-password-btn" onclick="togglePasswordVisibility('security-password')">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>
                    
                    ${isSetup ? `
                        <div class="form-group">
                            <label for="confirm-password">Confirm Password:</label>
                            <div class="password-input-container">
                                <input type="password" 
                                       id="confirm-password" 
                                       class="security-password-input" 
                                       placeholder="Confirm password"
                                       required
                                       minlength="4">
                                <button type="button" class="toggle-password-btn" onclick="togglePasswordVisibility('confirm-password')">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="use-default-password">
                                <span class="checkmark"></span>
                                Use as default password for all events
                            </label>
                        </div>
                    ` : ''}
                    
                    <div class="security-modal-actions">
                        <button type="button" class="cancel-btn" onclick="closeSecurityModal()">
                            Cancel
                        </button>
                        <button type="submit" class="confirm-btn">
                            <i class="fas ${isSetup ? 'fa-lock' : 'fa-unlock'}"></i>
                            ${isSetup ? 'Set Protection' : 'Unlock'}
                        </button>
                    </div>
                </form>
            </div>
        </div>
    `;
    
    // Focus on password input after modal is added
    setTimeout(() => {
        const passwordInput = modal.querySelector('#security-password');
        if (passwordInput) {
            passwordInput.focus();
        }
    }, 100);
    
    return modal;
}

// Handle security form submission
function handleSecurityForm(event, type, eventId) {
    event.preventDefault();
    
    const password = document.getElementById('security-password').value;
    
    if (type === 'setup') {
        const confirmPassword = document.getElementById('confirm-password').value;
        const useDefault = document.getElementById('use-default-password').checked;
        
        if (password !== confirmPassword) {
            showNotification('Passwords do not match', 'error');
            return;
        }
        
        if (password.length < 4) {
            showNotification('Password must be at least 4 characters', 'error');
            return;
        }
        
        // Store password hash for this event
        const passwordHash = btoa(password); // Simple encoding (use proper hashing in production)
        localStorage.setItem(`eventPassword_${eventId}`, passwordHash);
        
        if (useDefault) {
            eventIdSecurity.defaultPassword = passwordHash;
            localStorage.setItem('eventIdDefaultPassword', passwordHash);
        }
        
        // Lock the event
        eventIdSecurity.lockEvent(eventId);
        updateEventCardSecurity(eventId);
        
        closeSecurityModal();
        showNotification('Event ID is now protected', 'success');
        
    } else {
               // Verify password
        const storedHash = localStorage.getItem(`eventPassword_${eventId}`) || eventIdSecurity.defaultPassword;
        const inputHash = btoa(password);
        
        if (storedHash && storedHash === inputHash) {
            // Correct password
            eventIdSecurity.unlockForSession(eventId);
            updateEventCardSecurity(eventId);
            closeSecurityModal();
            
            // Auto-show the event ID
            toggleEventIdVisibility(eventId);
            
            showNotification('Event ID unlocked for this session', 'success');
        } else {
            showNotification('Incorrect password', 'error');
            
            // Clear the input and refocus
            const passwordInput = document.getElementById('security-password');
            passwordInput.value = '';
            passwordInput.focus();
        }
    }
}

// Toggle password visibility in modal
function togglePasswordVisibility(inputId) {
    const input = document.getElementById(inputId);
    const button = input.nextElementSibling;
    const icon = button.querySelector('i');
    
    if (input.type === 'password') {
        input.type = 'text';
        icon.className = 'fas fa-eye-slash';
    } else {
        input.type = 'password';
        icon.className = 'fas fa-eye';
    }
}

// Close security modal
function closeSecurityModal() {
    const modal = document.querySelector('.security-modal-overlay');
    if (modal) {
        modal.style.animation = 'fadeOut 0.3s ease';
        setTimeout(() => {
            if (modal.parentElement) {
                modal.remove();
            }
        }, 300);
    }
}

// Update event card security UI
function updateEventCardSecurity(eventId) {
    const isLocked = eventIdSecurity.isLocked(eventId);
    const isSessionUnlocked = eventIdSecurity.isSessionUnlocked(eventId);
    
    // Update security icon in label
    const label = document.querySelector(`[data-event-id="${eventId}"] .event-id-label`);
    if (label) {
        const existingIcon = label.querySelector('.security-icon');
        if (existingIcon) {
            existingIcon.remove();
        }
        
        if (isLocked) {
            label.innerHTML += ' <i class="fas fa-lock security-icon" title="Protected"></i>';
        }
    }
    
    // Update security toggle button
    const securityBtn = document.querySelector(`[data-event-id="${eventId}"] .security-toggle-btn`);
    if (securityBtn) {
        const icon = securityBtn.querySelector('i');
        icon.className = `fas ${isLocked ? 'fa-lock' : 'fa-lock-open'}`;
        securityBtn.title = isLocked ? 'Remove Protection' : 'Add Protection';
    }
    
    // Update eye toggle button
    const eyeBtn = document.querySelector(`[data-event-id="${eventId}"] .eye-toggle-btn`);
    if (eyeBtn) {
        const shouldDisable = isLocked && !isSessionUnlocked;
        eyeBtn.disabled = shouldDisable;
        eyeBtn.classList.toggle('disabled', shouldDisable);
    }
    
    // Update event ID display
    const codeElement = document.getElementById(`event-id-code-${eventId}`);
    if (codeElement) {
        const actualId = codeElement.getAttribute('data-actual-id') || eventId;
        codeElement.setAttribute('data-actual-id', actualId);
        
        if (isLocked && !isSessionUnlocked) {
            codeElement.textContent = '';
        } else {
            codeElement.textContent = actualId;
        }
    }
    
    // Update copy button
    const copyBtn = document.querySelector(`[data-event-id="${eventId}"] .copy-id-btn`);
    if (copyBtn) {
        const shouldDisable = isLocked && !isSessionUnlocked;
        copyBtn.disabled = shouldDisable;
        copyBtn.classList.toggle('disabled', shouldDisable);
    }
    
    // Update note text
    const note = document.querySelector(`[data-event-id="${eventId}"] .event-id-note`);
    if (note) {
        if (isLocked) {
            note.textContent = isSessionUnlocked ? 
                'Protected ID - Unlocked for this session' : 
                'Protected ID - Enter password to view';
        } else {
            note.textContent = 'Use this ID for API integration or support';
        }
    }
}

// Enhanced toggle event ID visibility with security check
function toggleEventIdVisibility(eventId) {
    const isLocked = eventIdSecurity.isLocked(eventId);
    const isSessionUnlocked = eventIdSecurity.isSessionUnlocked(eventId);
    
    if (isLocked && !isSessionUnlocked) {
        showPasswordPrompt(eventId);
        return;
    }
    
    const container = document.getElementById(`event-id-container-${eventId}`);
    const eyeIcon = document.getElementById(`eye-icon-${eventId}`);
    
    if (!container || !eyeIcon) {
        console.error('Event ID container or eye icon not found');
        return;
    }
    
    const isVisible = container.style.display !== 'none';
    
    if (isVisible) {
        container.style.display = 'none';
        eyeIcon.className = 'fas fa-eye';
        eyeIcon.title = 'Show Event ID';
    } else {
        container.style.display = 'block';
        eyeIcon.className = 'fas fa-eye-slash';
        eyeIcon.title = 'Hide Event ID';
    }
}

// Enhanced copy event ID with security check
function copyEventId(eventId) {
    const isLocked = eventIdSecurity.isLocked(eventId);
    const isSessionUnlocked = eventIdSecurity.isSessionUnlocked(eventId);
    
    if (isLocked && !isSessionUnlocked) {
        showNotification('Event ID is protected. Please unlock first.', 'warning');
        return;
    }
    
    if (!eventId || eventId === 'N/A') {
        showNotification('No event ID available to copy', 'error');
        return;
    }
    
    // Get the actual ID (not the masked version)
    const codeElement = document.getElementById(`event-id-code-${eventId}`);
    const actualId = codeElement ? (codeElement.getAttribute('data-actual-id') || eventId) : eventId;
    
    if (navigator.clipboard && window.isSecureContext) {
        navigator.clipboard.writeText(actualId).then(function() {
            showCopySuccess(`Event ID: ${actualId}`);
        }).catch(function(err) {
            console.error('Could not copy event ID: ', err);
            fallbackCopyTextToClipboard(actualId);
        });
    } else {
        fallbackCopyTextToClipboard(actualId);
    }
}

// Show confirmation dialog
function showConfirmDialog(title, message, onConfirm) {
    const modal = document.createElement('div');
    modal.className = 'security-modal-overlay';
    
    modal.innerHTML = `
        <div class="security-modal confirm-dialog">
            <div class="security-modal-header">
                <h3><i class="fas fa-question-circle"></i> ${title}</h3>
            </div>
            
            <div class="security-modal-body">
                <p>${message}</p>
                
                <div class="security-modal-actions">
                    <button type="button" class="cancel-btn" onclick="closeSecurityModal()">
                        Cancel
                    </button>
                    <button type="button" class="confirm-btn" onclick="confirmAction()">
                        <i class="fas fa-check"></i>
                        Confirm
                    </button>
                </div>
            </div>
        </div>
    `;
    
    // Add confirm action
    window.confirmAction = () => {
        onConfirm();
        closeSecurityModal();
        delete window.confirmAction;
    };
    
    document.body.appendChild(modal);
}

// Security management panel (optional - for advanced users)
function openSecurityManagementPanel() {
    const modal = document.createElement('div');
    modal.className = 'security-modal-overlay';
    
    const lockedEvents = [...eventIdSecurity.lockedEvents];
    
    modal.innerHTML = `
        <div class="security-modal large">
            <div class="security-modal-header">
                <h3><i class="fas fa-shield-alt"></i> Security Management</h3>
                <button class="close-modal-btn" onclick="closeSecurityModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="security-modal-body">
                <div class="security-section">
                    <h4>Default Password</h4>
                    <p>Set a default password for protecting new event IDs.</p>
                    <div class="form-group">
                        <div class="password-input-container">
                            <input type="password" 
                                   id="default-password" 
                                   placeholder="Enter default password"
                                   value="${eventIdSecurity.defaultPassword ? '' : ''}">
                            <button type="button" class="toggle-password-btn" onclick="togglePasswordVisibility('default-password')">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                        <button class="update-btn" onclick="updateDefaultPassword()">
                            <i class="fas fa-save"></i> Update
                        </button>
                    </div>
                </div>
                
                <div class="security-section">
                    <h4>Protected Events (${lockedEvents.length})</h4>
                    <div class="protected-events-list">
                        ${lockedEvents.length === 0 ? 
                            '<p class="no-protected-events">No events are currently protected.</p>' :
                            lockedEvents.map(eventId => `
                                <div class="protected-event-item">
                                    <span class="event-id-short">${eventId.substring(0, 8)}...</span>
                                    <button class="remove-protection-btn" onclick="removeEventProtection('${eventId}')">
                                        <i class="fas fa-unlock"></i> Remove Protection
                                    </button>
                                </div>
                            `).join('')
                        }
                    </div>
                </div>
                
                <div class="security-section">
                    <h4>Session Management</h4>
                    <button class="clear-session-btn" onclick="clearAllSessions()">
                        <i class="fas fa-sign-out-alt"></i> Clear All Sessions
                    </button>
                    <small>This will require password re-entry for all protected events.</small>
                </div>
            </div>
        </div>
    `;
    
    document.body.appendChild(modal);
}

// Update default password
function updateDefaultPassword() {
    const input = document.getElementById('default-password');
    const password = input.value;
    
    if (password && password !== '') {
        eventIdSecurity.defaultPassword = btoa(password);
        localStorage.setItem('eventIdDefaultPassword', eventIdSecurity.defaultPassword);
        showNotification('Default password updated', 'success');
    } else if (!password) {
        eventIdSecurity.defaultPassword = null;
        localStorage.removeItem('eventIdDefaultPassword');
        showNotification('Default password removed', 'success');
    }
}

// Remove event protection from management panel
function removeEventProtection(eventId) {
    eventIdSecurity.unlockEvent(eventId);
    updateEventCardSecurity(eventId);
    closeSecurityModal();
    showNotification('Event protection removed', 'success');
}

// Clear all sessions
function clearAllSessions() {
    eventIdSecurity.sessionUnlocked.clear();
    
    // Update all event cards
    eventIdSecurity.lockedEvents.forEach(eventId => {
        updateEventCardSecurity(eventId);
    });
    
    closeSecurityModal();
    showNotification('All sessions cleared', 'success');
}

// Auto-lock sessions after inactivity (optional)
let inactivityTimer;
const INACTIVITY_TIMEOUT = 30 * 60 * 1000; // 30 minutes

function resetInactivityTimer() {
    clearTimeout(inactivityTimer);
    inactivityTimer = setTimeout(() => {
        clearAllSessions();
        showNotification('Sessions cleared due to inactivity', 'info');
    }, INACTIVITY_TIMEOUT);
}

// Track user activity
document.addEventListener('click', resetInactivityTimer);
document.addEventListener('keypress', resetInactivityTimer);
document.addEventListener('scroll', resetInactivityTimer);

// Initialize inactivity timer
resetInactivityTimer();


// Function to toggle event ID visibility
function toggleEventIdVisibility(eventId) {
    const container = document.getElementById(`event-id-container-${eventId}`);
    const eyeIcon = document.getElementById(`eye-icon-${eventId}`);
    
    if (!container || !eyeIcon) {
        console.error('Event ID container or eye icon not found');
        return;
    }
    
    const isVisible = container.style.display !== 'none';
    
    if (isVisible) {
        // Hide the container
        container.style.display = 'none';
        eyeIcon.className = 'fas fa-eye';
        eyeIcon.title = 'Show Event ID';
    } else {
        // Show the container
        container.style.display = 'block';
        eyeIcon.className = 'fas fa-eye-slash';
        eyeIcon.title = 'Hide Event ID';
    }
}

// Function to copy event ID to clipboard
function copyEventId(eventId) {
    if (!eventId || eventId === 'N/A') {
        showNotification('No event ID available to copy', 'error');
        return;
    }
    
    // Try using the modern clipboard API first
    if (navigator.clipboard && window.isSecureContext) {
        navigator.clipboard.writeText(eventId).then(function() {
            showCopySuccess(`Event ID: ${eventId}`);
        }).catch(function(err) {
            console.error('Could not copy event ID: ', err);
            fallbackCopyTextToClipboard(eventId);
        });
    } else {
        // Fallback for older browsers
        fallbackCopyTextToClipboard(eventId);
    }
}

// Enhanced fallback copy method for event ID
function fallbackCopyTextToClipboard(text) {
    const textArea = document.createElement("textarea");
    textArea.value = text;
        
    // Avoid scrolling to bottom
    textArea.style.top = "0";
    textArea.style.left = "0";
    textArea.style.position = "fixed";
    textArea.style.opacity = "0";
        
    document.body.appendChild(textArea);
    textArea.focus();
    textArea.select();
        
    try {
        const successful = document.execCommand('copy');
        if (successful) {
            showCopySuccess(`Event ID: ${text}`);
        } else {
            console.error('Fallback: Unable to copy event ID');
            showNotification('Unable to copy event ID', 'error');
        }
    } catch (err) {
        console.error('Fallback: Unable to copy event ID', err);
        showNotification('Unable to copy event ID', 'error');
    }
        
    document.body.removeChild(textArea);
}

// Enhanced copy success feedback for event ID
function showCopySuccess(message) {
    // Create a small success message
    const successMsg = document.createElement('div');
    successMsg.className = 'copy-success-notification';
    successMsg.style.cssText = `
        position: fixed;
        top: 50px;
        right: 20px;
        background: #10b981;
        color: white;
        padding: 12px 20px;
        border-radius: 8px;
        z-index: 10001;
        font-size: 14px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        animation: slideInRight 0.3s ease;
        max-width: 300px;
        word-break: break-all;
    `;
        
    successMsg.innerHTML = `
        <div style="display: flex; align-items: center; gap: 8px;">
            <i class="fas fa-check-circle"></i>
            <span>Copied: ${message}</span>
        </div>
    `;
        
    document.body.appendChild(successMsg);
        
    // Remove after 3 seconds
    setTimeout(() => {
        if (successMsg.parentElement) {
            successMsg.style.animation = 'slideOutRight 0.3s ease';
            setTimeout(() => {
                if (successMsg.parentElement) {
                    successMsg.remove();
                }
            }, 300);
        }
    }, 3000);
}

// Enhanced loadUserPhysicalEvents to ensure physicalEventId is included
async function loadUserPhysicalEvents() {
    const liveEventsContainer = document.getElementById('liveEventsContainer');
        
    if (!liveEventsContainer) {
        console.log('liveEventsContainer not found - skipping load');
        return;
    }
    
    try {
        // Show loading state
        liveEventsContainer.innerHTML = `
            <div class="loading-events">
                <i class="fas fa-spinner fa-spin"></i>
                <p>Loading your events...</p>
            </div>
        `;
        
        // Check if Firebase is initialized
        if (typeof firebase === 'undefined') {
            throw new Error('Firebase is not initialized');
        }
        
        // Get current user ID with fallback
        let currentUserId;
        try {
            currentUserId = await getCurrentUserId();
        } catch (error) {
            console.error('Error getting user ID for loading events:', error);
            currentUserId = 'anonymous_user';
        }
        
        console.log('Loading events for user:', currentUserId);
        const db = firebase.firestore();
                
        // Try the query with better error handling
        let querySnapshot;
        try {
            querySnapshot = await db.collection('physicalEvents')
                .where('creatorId', '==', currentUserId)
                .orderBy('createdAt', 'desc')
                .get();
        } catch (indexError) {
            console.log('Composite index not ready, trying simple query:', indexError);
                        
            try {
                querySnapshot = await db.collection('physicalEvents')
                    .where('creatorId', '==', currentUserId)
                    .get();
            } catch (simpleQueryError) {
                console.log('Simple query also failed, loading all events:', simpleQueryError);
                querySnapshot = await db.collection('physicalEvents').get();
            }
        }
        
        // Clear loading state
        liveEventsContainer.innerHTML = '';
        
        if (querySnapshot.empty) {
            liveEventsContainer.innerHTML = `
                <div class="no-events-message">
                    <i class="fas fa-calendar-plus"></i>
                    <h3>No Events Created Yet</h3>
                    <p>Create your first physical event to see it here!</p>
                </div>
            `;
            return;
        }
        
        // Convert to array and sort manually if needed
        let events = [];
        querySnapshot.forEach((doc) => {
            const eventData = { ...doc.data(), id: doc.id };
            
            // Ensure physicalEventId is present (fallback to document ID if missing)
            if (!eventData.physicalEventId) {
                eventData.physicalEventId = doc.id;
                console.warn('physicalEventId missing, using document ID:', doc.id);
            }
            
            events.push(eventData);
        });
        
        // Sort by createdAt
        events.sort((a, b) => {
            const dateA = a.createdAt ? new Date(a.createdAt) : new Date(0);
            const dateB = b.createdAt ? new Date(b.createdAt) : new Date(0);
            return dateB - dateA;
        });
        
        // Create cards for each event
        events.forEach((eventData) => {
            try {
                const eventCard = createPhysicalEventCard(eventData);
                liveEventsContainer.appendChild(eventCard);
            } catch (cardError) {
                console.error('Error creating event card:', cardError);
            }
        });
        
        console.log(`Loaded ${events.length} physical events`);
        
    } catch (error) {
        console.error('Error loading physical events:', error);
                
        liveEventsContainer.innerHTML = `
            <div class="error-loading-events">
                <i class="fas fa-exclamation-triangle"></i>
                <h3>Error Loading Events</h3>
                <p>There was an error loading your events. Please try again.</p>
                <button onclick="loadUserPhysicalEvents()" class="retry-btn">
                    <i class="fas fa-redo"></i> Retry
                </button>
            </div>
        `;
    }
}


// Helper function to generate background style
function generateBackgroundStyle(background) {
    if (!background) {
        return 'background: linear-gradient(135deg, #FF6B6B, #4ECDC4);';
    }

    switch (background.type) {
        case 'media':
            return `
                background-image: url('${background.data}');
                background-size: cover;
                background-position: center;
                background-repeat: no-repeat;
            `;
        case 'gradient':
            return `background: ${background.gradient};`;
        case 'color':
            return `background-color: ${background.color};`;
        default:
            return 'background: linear-gradient(135deg, #FF6B6B, #4ECDC4);';
    }
}

// Helper function to calculate total revenue
function calculateTotalRevenue(tickets) {
    if (!tickets || !Array.isArray(tickets)) return 0;
    
    return tickets.reduce((total, ticket) => {
        const sold = ticket.sold || 0;
        const price = ticket.price || 0;
        return total + (sold * price);
    }, 0);
}

// Helper function to calculate total buyers
function calculateTotalBuyers(tickets) {
    if (!tickets || !Array.isArray(tickets)) return 0;
    
    return tickets.reduce((total, ticket) => {
        return total + (ticket.sold || 0);
    }, 0);
}

// Helper function to calculate ticket stats
function calculateTicketStats(tickets) {
    if (!tickets || !Array.isArray(tickets)) {
        return { vipSold: 0, regularSold: 0 };
    }

    let vipSold = 0;
    let regularSold = 0;

    tickets.forEach(ticket => {
        const sold = ticket.sold || 0;
        // Determine if VIP based on name or price
        if (ticket.name.toLowerCase().includes('vip') || 
            ticket.name.toLowerCase().includes('premium') ||
            (ticket.price && ticket.price > 5000)) {
            vipSold += sold;
        } else {
            regularSold += sold;
        }
    });

    return { vipSold, regularSold };
}

// Helper function to generate individual ticket breakdown
function generateTicketBreakdown(tickets) {
    if (!tickets || !Array.isArray(tickets) || tickets.length === 0) {
        return '<p class="no-tickets">No tickets available</p>';
    }

    return tickets.map(ticket => {
        const soldCount = ticket.sold || 0;
        const ticketName = ticket.name || 'Unknown Ticket';
        const price = ticket.price || 0;
        
        return `
            <div class="ticket-breakdown-card">
                <div class="ticket-name">${ticketName}</div>
                <div class="ticket-details">
                    <span class="tickets-sold">${soldCount} Sold</span>
                    <span class="ticket-price">${price.toLocaleString()}</span>
                </div>
            </div>
        `;
    }).join('');
}


// Helper function to determine event status
function determineEventStatus(eventData) {
    const now = new Date();
    const startDate = new Date(eventData.startDateTime);
    const endDate = new Date(eventData.endDateTime);
    const status = eventData.status || 'draft';

    if (status === 'draft' || status === 'inactive') {
        return {
            class: 'draft',
            text: 'Not Launched',
            icon: 'fa-pause-circle',
            buttonClass: 'launch-active',
            buttonText: 'Launch Now',
            buttonIcon: 'fa-rocket',
            nextAction: 'launch'
        };
    } else if (now < startDate) {
        return {
            class: 'upcoming',
            text: 'Live (Upcoming)',
            icon: 'fa-clock',
            buttonClass: 'launch-pause',
            buttonText: 'Pause Event',
            buttonIcon: 'fa-pause',
            nextAction: 'pause'
        };
    } else if (now >= startDate && now <= endDate) {
        return {
            class: 'live',
            text: 'Live (Active)',
            icon: 'fa-play-circle',
            buttonClass: 'launch-pause',
            buttonText: 'Pause Event',
            buttonIcon: 'fa-pause',
            nextAction: 'pause'
        };
    } else {
        return {
            class: 'ended',
            text: 'Event Ended',
            icon: 'fa-stop-circle',
            buttonClass: 'launch-disabled',
            buttonText: 'Event Ended',
            buttonIcon: 'fa-check',
            nextAction: 'none'
        };
    }
}

// Helper function to truncate text
function truncateText(text, maxLength) {
    if (!text) return '';
    if (text.length <= maxLength) return text;
    return text.substring(0, maxLength) + '...';
}

// Function to toggle event status
async function toggleEventStatus(eventId, action) {
    if (action === 'none') return;

    try {
        const db = firebase.firestore();
        let newStatus;

        switch (action) {
            case 'launch':
                newStatus = 'active';
                break;
            case 'pause':
                newStatus = 'inactive';
                break;
            default:
                return;
        }

        await db.collection('physicalEvents').doc(eventId).update({
            status: newStatus,
            updatedAt: new Date().toISOString()
        });

        // Reload events to reflect changes
        loadUserPhysicalEvents();

        // Show success message
        showNotification(`Event ${action === 'launch' ? 'launched' : 'paused'} successfully!`, 'success');

    } catch (error) {
        console.error('Error updating event status:', error);
        showNotification('Error updating event status', 'error');
    }
}

// Function to edit event settings
function editPhysicalEventSettings(eventId) {
    // You can implement this to open the edit modal with pre-filled data
    console.log('Edit event:', eventId);
    // For now, just show a message
    showNotification('Edit functionality coming soon!', 'info');
}

// Function to view event page
function viewEventPage(eventLink) {
    // Open event page in new tab
    window.open(`/event/${eventLink}`, '_blank');
}

// Function to show notifications
function showNotification(message, type = 'info') {
    // Create notification element
    const notification = document.createElement('div');
    notification.className = `notification notification-${type}`;
    notification.innerHTML = `
        <i class="fas ${type === 'success' ? 'fa-check-circle' : type === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle'}"></i>
        <span>${message}</span>
    `;

    // Add to page
    document.body.appendChild(notification);

    // Auto remove after 3 seconds
    setTimeout(() => {
        notification.remove();
    }, 3000);
}

// Call this function when the page loads or when you want to refresh the events
document.addEventListener('DOMContentLoaded', function() {
    // Load events when page loads
    loadUserPhysicalEvents();

});

      
        
// ========================================
// SPONSORS MANAGEMENT FUNCTIONS
// ========================================

// Global variable for editing sponsor
let editingSponsorIndex = -1;

// Global variable for current event ID being edited
let currentEditingEventId = null;
// Open sponsors management modal
function openSponsorsModal(eventId = null) {
    const modal = document.getElementById('sponsorsModal');
    if (modal) {
        modal.style.display = 'flex';
           currentEditingEventId = eventId; // Store the event ID
      
        if (eventId) {
            // Load existing sponsors for this event
            loadEventSponsors(eventId);
        }
        resetSponsorForm();
    } else {
        console.error('Sponsors modal not found');
    }
}

// Close sponsors management modal
function closeSponsorsModal() {
    const modal = document.getElementById('sponsorsModal');
    if (modal) {
        modal.style.display = 'none';
    }
    resetSponsorForm();
    editingSponsorIndex = -1;
        currentEditingEventId = null; // Clear the editing event ID

}

// Reset sponsor form
function resetSponsorForm() {
    const form = document.getElementById('sponsorForm');
    if (form) {
        form.reset();
    }
    
    // Clear logo preview
    const logoPreview = document.getElementById('sponsorLogoPreview');
    if (logoPreview) {
        logoPreview.style.display = 'none';
        logoPreview.innerHTML = '';
    }
    
    // Reset form title and button
    const modalTitle = document.querySelector('#sponsorsModal .modal-title');
    const saveBtn = document.getElementById('saveSponsorBtn');
    
    if (modalTitle) modalTitle.textContent = 'Add Sponsor';
    if (saveBtn) saveBtn.textContent = 'Add Sponsor';
    
    editingSponsorIndex = -1;
}

// Handle logo upload
function handleSponsorLogoUpload(input) {
    const file = input.files[0];
    if (!file) return;
    
    // Validate file
    const maxSize = 5 * 1024 * 1024; // 5MB
    const allowedTypes = ['image/jpeg', 'image/png', 'image/gif', 'image/webp'];
    
    if (file.size > maxSize) {
        alert('Logo file size must be less than 5MB');
        input.value = '';
        return;
    }
    
    if (!allowedTypes.includes(file.type)) {
        alert('Please upload a valid image file (JPEG, PNG, GIF, WebP)');
        input.value = '';
        return;
    }
    
    const reader = new FileReader();
    reader.onload = function(e) {
        const logoPreview = document.getElementById('sponsorLogoPreview');
        logoPreview.innerHTML = `
            <img src="${e.target.result}" alt="Sponsor logo preview" 
                 style="max-width: 200px; max-height: 100px; object-fit: contain; border-radius: 8px;">
        `;
        logoPreview.style.display = 'block';
    };
    
    reader.readAsDataURL(file);
}

// Remove sponsor logo
function removeSponsorLogo() {
    const logoInput = document.getElementById('sponsorLogo');
    const logoPreview = document.getElementById('sponsorLogoPreview');
    
    if (logoInput) logoInput.value = '';
    if (logoPreview) {
        logoPreview.style.display = 'none';
        logoPreview.innerHTML = '';
    }
}

// Save sponsor (add or edit)
async function saveSponsor() {
    const sponsorName = document.getElementById('sponsorName').value.trim();
    const sponsorWebsite = document.getElementById('sponsorWebsite').value.trim();
    const logoInput = document.getElementById('sponsorLogo');
    
    // Validate required fields
    if (!sponsorName) {
        alert('Sponsor name is required');
        return;
    }
    
    // Validate website URL if provided
    if (sponsorWebsite) {
        try {
            new URL(sponsorWebsite);
        } catch (error) {
            alert('Please enter a valid website URL (e.g., https://example.com)');
            return;
        }
    }
    
    try {
        // Process logo if uploaded, otherwise preserve existing logo when editing
    let logoData = null;
    if (logoInput.files && logoInput.files[0]) {
    logoData = await processLogoFile(logoInput.files[0]);
    } else if (editingSponsorIndex >= 0 && physicalEventSponsors[editingSponsorIndex].logo) {
        // Preserve existing logo when editing and no new logo uploaded
        logoData = physicalEventSponsors[editingSponsorIndex].logo;
    }
    
    // Create sponsor object
    const sponsorData = {
    id: editingSponsorIndex >= 0 ? physicalEventSponsors[editingSponsorIndex].id : generateSponsorId(),
    name: sponsorName,
    website: sponsorWebsite || null,
        logo: logoData,
            createdAt: editingSponsorIndex >= 0 ? physicalEventSponsors[editingSponsorIndex].createdAt : new Date().toISOString(),
            updatedAt: new Date().toISOString()
        };
        
        // Add or update sponsor
        if (editingSponsorIndex >= 0) {
            physicalEventSponsors[editingSponsorIndex] = sponsorData;
            console.log('Sponsor updated:', sponsorData);
        } else {
            physicalEventSponsors.push(sponsorData);
            console.log('Sponsor added:', sponsorData);
        }
        
        // Update sponsors list display
        updateSponsorsList();
        
        // Save to Firebase if editing an existing event
        if (currentEditingEventId) {
            await saveSponsorsToFirebase(currentEditingEventId, physicalEventSponsors);
        }

        // Close modal and reset form
        closeSponsorForm();
        
        console.log('All sponsors:', physicalEventSponsors);
        
    } catch (error) {
        console.error('Error saving sponsor:', error);
        alert('Error saving sponsor: ' + error.message);
    }
}

// Process logo file to base64
function processLogoFile(file) {
    return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = function(e) {
            resolve({
                data: e.target.result,
                fileName: file.name,
                fileType: file.type,
                fileSize: file.size
            });
        };
        reader.onerror = function(error) {
            reject(error);
        };
        reader.readAsDataURL(file);
    });
}

// Close sponsor form
function closeSponsorForm() {
    const sponsorFormSection = document.getElementById('sponsorFormSection');
    if (sponsorFormSection) {
        sponsorFormSection.style.display = 'none';
    }
    resetSponsorForm();
}

// Show sponsor form
function showSponsorForm() {
    const sponsorFormSection = document.getElementById('sponsorFormSection');
    if (sponsorFormSection) {
        sponsorFormSection.style.display = 'block';
    }
     // Only reset form if we're not editing (i.e., adding new sponsor)
    if (editingSponsorIndex === -1) {
        resetSponsorForm();
    }
}

// Generate unique sponsor ID
function generateSponsorId() {
    return 'sponsor_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
}

// Update sponsors list display
function updateSponsorsList() {
    const sponsorsList = document.getElementById('sponsorsList');
    const noSponsorsMessage = document.getElementById('noSponsorsMessage');
    
    if (!sponsorsList) return;
    
    // Clear existing sponsors
    const existingSponsors = sponsorsList.querySelectorAll('.sponsor-item');
    existingSponsors.forEach(sponsor => sponsor.remove());
    
    // Show/hide no sponsors message
    if (physicalEventSponsors.length === 0) {
        if (noSponsorsMessage) {
            noSponsorsMessage.style.display = 'block';
        }
        return;
    }
    
    // Hide no sponsors message
    if (noSponsorsMessage) {
        noSponsorsMessage.style.display = 'none';
    }
    
    // Add each sponsor to the list
    physicalEventSponsors.forEach((sponsor, index) => {
        const sponsorElement = createSponsorListItem(sponsor, index);
        sponsorsList.appendChild(sponsorElement);
    });
    
    console.log(`Updated sponsors list with ${physicalEventSponsors.length} sponsors`);
}

// Create sponsor list item
function createSponsorListItem(sponsor, index) {
    const sponsorDiv = document.createElement('div');
    sponsorDiv.className = 'sponsor-item';
    
    // Generate logo display
    let logoHtml = '';
    if (sponsor.logo && sponsor.logo.data) {
        logoHtml = `
            <div class="sponsor-logo">
                <img src="${sponsor.logo.data}" alt="${sponsor.name} logo" 
                     style="max-width: 60px; max-height: 40px; object-fit: contain;">
            </div>
        `;
    } else {
        logoHtml = `
            <div class="sponsor-logo sponsor-logo-placeholder">
                <i class="fas fa-building"></i>
            </div>
        `;
    }
    
    // Generate website link
    let websiteHtml = '';
    if (sponsor.website) {
        websiteHtml = `
            <a href="${sponsor.website}" target="_blank" class="sponsor-website">
                <i class="fas fa-external-link-alt"></i>
                Visit Website
            </a>
        `;
    }
    
    sponsorDiv.innerHTML = `
        ${logoHtml}
        <div class="sponsor-info">
            <div class="sponsor-name">${sponsor.name}</div>
            ${websiteHtml}
        </div>
        <div class="sponsor-actions">
            <button type="button" class="edit-sponsor-btn" onclick="editSponsor(${index})">
                <i class="fas fa-edit"></i>
            </button>
            <button type="button" class="delete-sponsor-btn" onclick="deleteSponsor(${index})">
                <i class="fas fa-trash"></i>
            </button>
        </div>
    `;
    
    return sponsorDiv;
}

// Edit sponsor
function editSponsor(index) {
    if (index < 0 || index >= physicalEventSponsors.length) {
        console.error('Invalid sponsor index:', index);
        return;
    }
    
    const sponsor = physicalEventSponsors[index];
   // Set editing index FIRST, before showing form
    
    editingSponsorIndex = index;
    
     // Show sponsor form (this won't reset since editingSponsorIndex is not -1)
   
    showSponsorForm();
    
    // Populate form with sponsor data
    document.getElementById('sponsorName').value = sponsor.name;
    document.getElementById('sponsorWebsite').value = sponsor.website || '';
    
    // Show logo if exists
    if (sponsor.logo && sponsor.logo.data) {
        const logoPreview = document.getElementById('sponsorLogoPreview');
        logoPreview.innerHTML = `
            <img src="${sponsor.logo.data}" alt="Sponsor logo preview" 
                 style="max-width: 200px; max-height: 100px; object-fit: contain; border-radius: 8px;">
        `;
        logoPreview.style.display = 'block';
    }
    
    // Update form title and button
    const modalTitle = document.querySelector('#sponsorsModal .modal-title');
    const saveBtn = document.getElementById('saveSponsorBtn');
    
    if (modalTitle) modalTitle.textContent = 'Edit Sponsor';
    if (saveBtn) saveBtn.textContent = 'Update Sponsor';
     console.log('Editing sponsor at index:', editingSponsorIndex, sponsor);

}

// Delete sponsor
async function deleteSponsor(index) {
 
    if (index < 0 || index >= physicalEventSponsors.length) {
        console.error('Invalid sponsor index:', index);
        return;
    }
    
    const sponsor = physicalEventSponsors[index];
    
    if (confirm(`Are you sure you want to delete sponsor "${sponsor.name}"?`)) {
        physicalEventSponsors.splice(index, 1);
        updateSponsorsList();
         
        // Save to Firebase if editing an existing event
        if (currentEditingEventId) {
            try {
                await saveSponsorsToFirebase(currentEditingEventId, physicalEventSponsors);
                console.log('Sponsor deleted and saved to Firebase:', sponsor.name);
            } catch (error) {
                console.error('Error saving after deletion:', error);
                // Revert the deletion if Firebase save fails
                physicalEventSponsors.splice(index, 0, sponsor);
                updateSponsorsList();
            }
        } else {
            console.log('Sponsor deleted locally:', sponsor.name);
        }
    }
}

// Load sponsors for existing event
async function loadEventSponsors(eventId) {
    try {
        if (typeof firebase === 'undefined') {
            console.log('Firebase not available');
            return;
        }
        
        const db = firebase.firestore();
        const eventDoc = await db.collection('physicalEvents').doc(eventId).get();
        
        if (eventDoc.exists) {
            const eventData = eventDoc.data();
            if (eventData.sponsors && Array.isArray(eventData.sponsors)) {
                physicalEventSponsors = [...eventData.sponsors];
                updateSponsorsList();
                console.log('Loaded sponsors for event:', eventId);
                } else {
                // No sponsors yet, initialize empty array
                physicalEventSponsors = [];
                updateSponsorsList();
            }
        }
    } catch (error) {
        console.error('Error loading event sponsors:', error);
    }
}
// Save sponsors to Firebase for existing event
async function saveSponsorsToFirebase(eventId, sponsors) {
    try {
        if (typeof firebase === 'undefined') {
            throw new Error('Firebase not available');
        }
        
        console.log('Saving sponsors to Firebase for event:', eventId);
        console.log('Sponsors data:', sponsors);
        
        const db = firebase.firestore();
        
        // Update the event document with new sponsors array
        await db.collection('physicalEvents').doc(eventId).update({
            sponsors: sponsors,
            updatedAt: new Date().toISOString()
        });
        
        console.log('Sponsors saved successfully to Firebase');
        
        // Show success notification
        showNotification('Sponsors updated successfully!', 'success');
        
        // Refresh the event display to show updated sponsors
        setTimeout(() => {
            loadUserPhysicalEvents();
        }, 1000);
        
    } catch (error) {
        console.error('Error saving sponsors to Firebase:', error);
        showNotification('Error saving sponsors: ' + error.message, 'error');
        throw error;
    }
}
// Generate sponsors display for event card
function generateSponsorsDisplay(sponsors) {
    if (!sponsors || !Array.isArray(sponsors) || sponsors.length === 0) {
        return `
            <div class="no-sponsors-message">
                <p>No sponsors added yet</p>
            </div>
        `;
    }
    
    let sponsorsHtml = '<div class="sponsors-grid">';
    
    sponsors.forEach(sponsor => {
        let logoHtml = '';
        if (sponsor.logo && sponsor.logo.data) {
            logoHtml = `
                <img src="${sponsor.logo.data}" alt="${sponsor.name}" 
                     class="sponsor-logo-img">
            `;
        } else {
              // Special icon for brand sponsor
            const iconClass = sponsor.isBrandSponsor ? 'fa-crown' : 'fa-building';
          
            logoHtml = `
             <div class="sponsor-logo-placeholder ${sponsor.isBrandSponsor ? 'brand-sponsor' : ''}">
                    <i class="fas ${iconClass}"></i>
                </div>  
            `;
        }
        
        let websiteHtml = '';
        if (sponsor.website) {
            websiteHtml = `
                <a href="${sponsor.website}" target="_blank" class="sponsor-link">
                    <i class="fas fa-external-link-alt"></i>
                </a>
            `;
        }
          
        // Add promo code display for brand sponsor
        let promoCodeHtml = '';
        if (sponsor.isBrandSponsor && sponsor.promoCode) {
            const remainingUses = sponsor.promoMaxUsage - sponsor.promoUsageCount;
            promoCodeHtml = `
               <div class="promo-code-badge" onclick="copyPromoCode('${sponsor.promoCode}')" title="Click to copy: ${sponsor.promoCode} (${remainingUses} uses left)">
              
            <i class="fas fa-ticket-alt"></i> ${sponsor.promoCode}
                                <i class="fas fa-copy copy-icon"></i>

                </div>
            `;
        }
        sponsorsHtml += `
              <div class="sponsor-card ${sponsor.isBrandSponsor ? 'brand-sponsor-card' : ''}">
               <div class="sponsor-logo-container">
                    ${logoHtml}
                    ${websiteHtml}
                </div>
                <div class="sponsor-name">${sponsor.name}</div>
                   ${promoCodeHtml}
            </div>
        `;
    });
    
    sponsorsHtml += '</div>';
    return sponsorsHtml;
}


// ========================================
// AUTO BRAND SPONSOR & PROMO CODE SYSTEM
// ========================================
// Add Rewarder brand sponsor with promo code (optional)
function addRewarderSponsor() {
    const rewarderSponsor = {
        id: 'rewarder_sponsor_' + Date.now(),
        name: 'Rewarder',
        website: 'https://rewarder-hub.vercel.app/',
        logo: {
            data: 'https://i.ibb.co/VpC27tbt/Rewarder-logo.png',
            fileName: 'Rewarder-logo.png',
            fileType: 'image/png',
            isUrl: true // Flag to indicate this is a URL, not base64
        },
        isBrandSponsor: true,
        promoCode: generatePromoCode(),
        promoUsageCount: 0,
        promoMaxUsage: 10,
        createdAt: new Date().toISOString(),
        updatedAt: new Date().toISOString()
    };
    
    // Check if Rewarder sponsor already exists
    const existingRewarderIndex = physicalEventSponsors.findIndex(sponsor => sponsor.isBrandSponsor);
   
     if (existingRewarderIndex === -1) {
        // Add Rewarder sponsor if it doesn't exist
        physicalEventSponsors.unshift(rewarderSponsor); // Add at the beginning
        console.log('Rewarder sponsor added with promo code:', rewarderSponsor.promoCode);
        return rewarderSponsor.promoCode;
    } else {
        // Return existing promo code
        return physicalEventSponsors[existingBrandIndex].promoCode;
        console.log('Rewarder sponsor already exists with promo code:', physicalEventSponsors[existingRewarderIndex].promoCode);
        return physicalEventSponsors[existingRewarderIndex].promoCode;
   
    }
}

// Generate promo code
function generatePromoCode() {
    const prefix = 'SPONSOR';
    const randomCode = Math.random().toString(36).substring(2, 8).toUpperCase();
    return `${prefix}${randomCode}`;
}

// Validate and use promo code
function validatePromoCode(promoCode, eventId) {
    try {
        // Find the sponsor with this promo code
        const sponsor = physicalEventSponsors.find(s => s.promoCode === promoCode && s.isBrandSponsor);
        
        if (!sponsor) {
            return { isValid: false, message: 'Invalid promo code' };
        }
        
        if (sponsor.promoUsageCount >= sponsor.promoMaxUsage) {
            return { isValid: false, message: 'Promo code usage limit exceeded' };
        }
        
        return { 
            isValid: true, 
            message: 'Promo code valid - No service fee!',
            discount: 100, // 100% discount on service fee
            promoCode: promoCode
        };
        
    } catch (error) {
        console.error('Error validating promo code:', error);
        return { isValid: false, message: 'Error validating promo code' };
    }
}

// Use promo code (call this when ticket is purchased)
async function usePromoCode(promoCode, eventId) {
    try {
        const sponsorIndex = physicalEventSponsors.findIndex(s => s.promoCode === promoCode && s.isBrandSponsor);
        
        if (sponsorIndex !== -1) {
            physicalEventSponsors[sponsorIndex].promoUsageCount++;
            physicalEventSponsors[sponsorIndex].updatedAt = new Date().toISOString();
            
            // Update in Firebase if we have an event ID
            if (eventId) {
                await saveSponsorsToFirebase(eventId, physicalEventSponsors);
            }
            
            console.log(`Promo code ${promoCode} used. Remaining uses: ${physicalEventSponsors[sponsorIndex].promoMaxUsage - physicalEventSponsors[sponsorIndex].promoUsageCount}`);
            
            return {
                success: true,
                remainingUses: physicalEventSponsors[sponsorIndex].promoMaxUsage - physicalEventSponsors[sponsorIndex].promoUsageCount
            };
        }
        
        return { success: false, message: 'Promo code not found' };
        
    } catch (error) {
        console.error('Error using promo code:', error);
        return { success: false, message: 'Error processing promo code' };
    }
}

// Get promo code info
function getPromoCodeInfo(promoCode) {
    const sponsor = physicalEventSponsors.find(s => s.promoCode === promoCode && s.isBrandSponsor);
    
    if (sponsor) {
        return {
            exists: true,
            usageCount: sponsor.promoUsageCount,
            maxUsage: sponsor.promoMaxUsage,
            remainingUses: sponsor.promoMaxUsage - sponsor.promoUsageCount,
            isExpired: sponsor.promoUsageCount >= sponsor.promoMaxUsage
        };
    }
    
    return { exists: false };
}

// Display promo code notification
function showPromoCodeNotification(promoCode) {
    const notification = document.createElement('div');
    notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        z-index: 10000;
        max-width: 300px;
        font-family: Arial, sans-serif;
    `;
    
    notification.innerHTML = `
        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px;">
            <h4 style="margin: 0; color: #fff;"> Promo Code Generated!</h4>
            <button onclick="this.parentElement.parentElement.remove()" style="background: none; border: none; color: white; font-size: 18px; cursor: pointer;">&times;</button>
        </div>
          <p style="margin: 0 0 10px 0; font-size: 14px;">Rewarder sponsor added with promo code:</p>
      
       
          <div onclick="copyPromoCode('${promoCode}')" style="background: rgba(255,255,255,0.2); padding: 10px; border-radius: 5px; text-align: center; margin: 10px 0; cursor: pointer; transition: all 0.3s ease;" onmouseover="this.style.background='rgba(255,255,255,0.3)'" onmouseout="this.style.background='rgba(255,255,255,0.2)'">
      
          <strong style="font-size: 16px; letter-spacing: 1px;">${promoCode}</strong>
             <i class="fas fa-copy" style="margin-left: 8px; opacity: 0.8;"></i>
     
          </div>
         <p style="margin: 0; font-size: 12px; opacity: 0.9;">Valid for 10 uses - No service fee on tickets! Click to copy.</p>
  
          `;
    
    document.body.appendChild(notification);
    
    // Auto remove after 10 seconds
    setTimeout(() => {
        if (notification.parentElement) {
            notification.remove();
        }
    }, 10000);
}


       
           
    
   // Open Change Event Modal - fetches data by eventId and populates form
async function openPhyEventChange(eventId) {
    try {
        console.log('Opening change modal for event:', eventId);
        
        // Show loading indicator
        showToast('Loading event data...', 'info', 1000);
        
        // Fetch event data from Firebase using eventId
        if (typeof firebase === 'undefined') {
            throw new Error('Firebase not available');
        }
        
        const db = firebase.firestore();
        const eventDoc = await db.collection('physicalEvents').doc(eventId).get();
        
        if (!eventDoc.exists) {
            showToast('Event not found', 'error');
            return;
        }
        
        const eventData = eventDoc.data();
        console.log('Event data loaded for change:', eventData);
        
        // Create change modal with pre-populated data
        createChangeEventModal(eventId, eventData);
        
    } catch (error) {
        console.error('Error opening change modal:', error);
        showToast('Error loading event data: ' + error.message, 'error');
    }
}

// Create Change Event Modal with populated data
function createChangeEventModal(eventId, eventData) {
    // Remove existing modal if any
    const existingModal = document.getElementById('phyeventchange-modal');
    if (existingModal) {
        existingModal.remove();
    }
    
    // Check if event is TBA
    const isTBA = eventData.isTBA === true || 
                  eventData.schedulingStatus === 'TBA' || 
                  eventData.startDateTime === 'TBA' ||
                  eventData.endDateTime === 'TBA';
    
    // Handle dates safely for form population
    let startDateValue = '';
    let startTimeValue = '';
    let endDateValue = '';
    let endTimeValue = '';
    
    if (!isTBA && eventData.startDateTime && eventData.startDateTime !== 'TBA') {
        try {
            const startDate = new Date(eventData.startDateTime);
            if (!isNaN(startDate.getTime())) {
                startDateValue = startDate.toISOString().split('T')[0];
                startTimeValue = startDate.toTimeString().slice(0, 5);
            }
        } catch (e) {
            console.log('Error parsing start date:', e);
        }
    }
    
    if (!isTBA && eventData.endDateTime && eventData.endDateTime !== 'TBA') {
        try {
            const endDate = new Date(eventData.endDateTime);
            if (!isNaN(endDate.getTime())) {
                endDateValue = endDate.toISOString().split('T')[0];
                endTimeValue = endDate.toTimeString().slice(0, 5);
            }
        } catch (e) {
            console.log('Error parsing end date:', e);
        }
    }
    
    const modal = document.createElement('div');
    modal.className = 'phyeventchange-modal-overlay';
    modal.id = 'phyeventchange-modal';
    modal.style.cssText = `

     position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 10000;
        backdrop-filter: blur(3px);
    `;
    
    modal.innerHTML = `
        <div class="phyeventchange-modal" style="
            background: white;
            border-radius: 15px;
            max-width: 800px;
            width: 95%;
            max-height: 95vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            color: #333;
        ">
            <div class="modal-header" style="
                padding: 20px;
                border-bottom: 2px solid #e9ecef;
                display: flex;
                justify-content: space-between;
                align-items: center;
                background: linear-gradient(135deg, #f39c12, #e67e22);
                color: white;
                border-radius: 15px 15px 0 0;
            ">
                <h3 style="margin: 0; font-size: 20px; font-weight: 700; color: white;">
                    <i class="fas fa-exchange-alt" style="margin-right: 10px;"></i>
                    Change Event Details
                </h3>
                <button class="close-modal-btn" onclick="closePhyEventChange()" type="button" style="
                    background: rgba(255,255,255,0.2);
                    border: none;
                    color: white;
                    font-size: 24px;
                    cursor: pointer;
                    padding: 5px;
                    width: 35px;
                    height: 35px;
                    border-radius: 50%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    transition: all 0.2s ease;
                " onmouseover="this.style.background='rgba(255,255,255,0.3)'" onmouseout="this.style.background='rgba(255,255,255,0.2)'">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="modal-body" style="padding: 25px; color: #333;">
                <form id="changeEventForm">
                    <!-- Basic Event Information -->
                    <div class="section-group" style="margin-bottom: 25px;">
                        <h4 style="margin: 0 0 15px 0; color: #333; font-size: 16px; font-weight: 600; display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-info-circle" style="color: #f39c12;"></i>
                            Basic Information
                        </h4>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div class="form-group">
                                <label style="font-weight: 600; color: #333; font-size: 14px; display: block; margin-bottom: 6px;">Event Name *</label>
                                <input type="text" id="changeEventName" class="form-input" value="${eventData.eventName || ''}" required style="
                                    width: 100%;
                                    padding: 10px 12px;
                                    border: 2px solid #e9ecef;
                                    border-radius: 6px;
                                    font-size: 14px;
                                    transition: border-color 0.2s ease;
                                    box-sizing: border-box;
                                    color: #333;
                                    background: white;
                                ">
                            </div>
                            
                            <div class="form-group">
                                <label style="font-weight: 600; color: #333; font-size: 14px; display: block; margin-bottom: 6px;">Event Link *</label>
                                <input type="text" id="changeEventLink" class="form-input" value="${eventData.eventLink || ''}" required style="
                                    width: 100%;
                                    padding: 10px 12px;
                                    border: 2px solid #e9ecef;
                                    border-radius: 6px;
                                    font-size: 14px;
                                    transition: border-color 0.2s ease;
                                    box-sizing: border-box;
                                    color: #333;
                                    background: white;
                                ">
                            </div>
                        </div>
                        
                        <div class="form-group" style="margin-bottom: 15px;">
                            <label style="font-weight: 600; color: #333; font-size: 14px; display: block; margin-bottom: 6px;">Event Description *</label>
                            <textarea id="changeEventDescription" rows="4" required style="
                                width: 100%;
                                padding: 10px 12px;
                                border: 2px solid #e9ecef;
                                border-radius: 6px;
                                font-size: 14px;
                                resize: vertical;
                                box-sizing: border-box;
                                color: #333;
                                background: white;
                                font-family: inherit;
                            ">${eventData.description || ''}</textarea>
                        </div>
                        
                        <div class="form-group">
                            <label style="font-weight: 600; color: #333; font-size: 14px; display: block; margin-bottom: 6px;">Location *</label>
                            <textarea id="changeEventLocation" rows="2" required style="
                                width: 100%;
                                padding: 10px 12px;
                                border: 2px solid #e9ecef;
                                border-radius: 6px;
                                font-size: 14px;
                                resize: vertical;
                                box-sizing: border-box;
                                color: #333;
                                background: white;
                                font-family: inherit;
                            ">${eventData.location || ''}</textarea>
                        </div>
                    </div>
                    
                    <!-- Schedule Section -->
                    <div class="section-group" style="margin-bottom: 25px;">
                        <h4 style="margin: 0 0 15px 0; color: #333; font-size: 16px; font-weight: 600; display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-calendar-alt" style="color: #f39c12;"></i>
                            Event Schedule
                        </h4>
                        
                        <div class="form-group" style="margin-bottom: 15px;">
                            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; font-size: 14px; color: #333;">
                                <input type="checkbox" id="changeTBASchedule" ${isTBA ? 'checked' : ''} onchange="toggleChangeTBASchedule()">
                                <span style="font-weight: 600; color: #333;">To Be Announced (TBA)</span>
                            </label>
                        </div>
                        
                        <div class="datetime-section" id="changeDateTimeSection" style="${isTBA ? 'display: none;' : ''}">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                                <div class="form-group">
                                    <label style="font-weight: 600; color: #333; font-size: 14px; display: block; margin-bottom: 6px;">Start Date</label>
                                    <input type="date" id="changeStartDate" value="${startDateValue}" style="
                                        width: 100%;
                                        padding: 10px 12px;
                                        border: 2px solid #e9ecef;
                                        border-radius: 6px;
                                        font-size: 14px;
                                        box-sizing: border-box;
                                        color: #333;
                                        background: white;
                                    ">
                                </div>
                                <div class="form-group">
                                    <label style="font-weight: 600; color: #333; font-size: 14px; display: block; margin-bottom: 6px;">Start Time</label>
                                    <input type="time" id="changeStartTime" value="${startTimeValue}" style="
                                        width: 100%;
                                        padding: 10px 12px;
                                        border: 2px solid #e9ecef;
                                        border-radius: 6px;
                                        font-size: 14px;
                                        box-sizing: border-box;
                                        color: #333;
                                        background: white;
                                    ">
                                </div>
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                                <div class="form-group">
                                    <label style="font-weight: 600; color: #333; font-size: 14px; display: block; margin-bottom: 6px;">End Date</label>
                                    <input type="date" id="changeEndDate" value="${endDateValue}" style="
                                        width: 100%;
                                        padding: 10px 12px;
                                        border: 2px solid #e9ecef;
                                        border-radius: 6px;
                                        font-size: 14px;
                                        box-sizing: border-box;
                                        color: #333;
                                        background: white;
                                    ">
                                </div>
                                <div class="form-group">
                                    <label style="font-weight: 600; color: #333; font-size: 14px; display: block; margin-bottom: 6px;">End Time</label>
                                    <input type="time" id="changeEndTime" value="${endTimeValue}" style="
                                        width: 100%;
                                        padding: 10px 12px;
                                        border: 2px solid #e9ecef;
                                        border-radius: 6px;
                                        font-size: 14px;
                                        box-sizing: border-box;
                                        color: #333;
                                        background: white;
                                    ">
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Background Section -->
                    <div class="section-group" style="margin-bottom: 25px;">
                        <h4 style="margin: 0 0 15px 0; color: #333; font-size: 16px; font-weight: 600; display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-palette" style="color: #f39c12;"></i>
                            Event Background
                        </h4>
                        
                        <div class="background-tabs" style="display: flex; gap: 8px; margin-bottom: 15px;">
                            <button type="button" class="change-bg-tab active" onclick="switchChangeBackgroundTab('gradient')" data-tab="gradient" style="
                                padding: 8px 16px;
                                background: #007bff;
                                color: white;
                                border: none;
                                border-radius: 6px;
                                cursor: pointer;
                                font-size: 13px;
                                font-weight: 600;
                                transition: all 0.2s ease;
                            ">Gradient</button>
                            <button type="button" class="change-bg-tab" onclick="switchChangeBackgroundTab('media')" data-tab="media" style="
                                padding: 8px 16px;
                                background: #6c757d;
                                color: white;
                                border: none;
                                border-radius: 6px;
                                cursor: pointer;
                                font-size: 13px;
                                font-weight: 600;
                                transition: all 0.2s ease;
                            ">Media</button>
                        </div>
                        
                        <div class="background-content">
                            <!-- Gradient Background -->
                            <div class="change-bg-content active" id="changeGradientContent">
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                                    <div class="form-group">
                                        <label style="font-weight: 600; color: #333; font-size: 14px; display: block; margin-bottom: 6px;">Color 1</label>
                                        <input type="color" id="changeGradientColor1" value="${eventData.background?.color1 || '#FF6B6B'}" onchange="updateChangeGradientPreview()" style="
                                            width: 100%;
                                            height: 40px;
                                            border: 2px solid #e9ecef;
                                            border-radius: 6px;
                                            cursor: pointer;
                                        ">
                                    </div>
                                    <div class="form-group">
                                        <label style="font-weight: 600; color: #333; font-size: 14px; display: block; margin-bottom: 6px;">Color 2</label>
                                        <input type="color" id="changeGradientColor2" value="${eventData.background?.color2 || '#4ECDC4'}" onchange="updateChangeGradientPreview()" style="
                                            width: 100%;
                                            height: 40px;
                                            border: 2px solid #e9ecef;
                                            border-radius: 6px;
                                            cursor: pointer;
                                        ">
                                    </div>
                                </div>
                                <div class="gradient-preview" id="changeGradientPreview" style="
                                    height: 80px;
                                    border-radius: 8px;
                                    border: 1px solid #e9ecef;
                                "></div>
                            </div>
                            
                            <!-- Media Background -->
                            <div class="change-bg-content" id="changeMediaContent">
                                <input type="file" id="changeBackgroundMedia" accept="image/*,video/*,.gif" onchange="handleChangeMediaUpload(this)" style="
                                    width: 100%;
                                    padding: 10px;
                                    border: 2px dashed #e9ecef;
                                    border-radius: 6px;
                                    font-size: 14px;
                                    margin-bottom: 10px;
                                    color: #333;
                                    background: white;
                                ">
                                <div id="changeMediaPreviewContainer" style="display: none;">
                                    <div id="changeMediaPreview" style="margin-bottom: 10px;"></div>
                                    <button type="button" onclick="removeChangeMedia()" style="
                                        background: #dc3545;
                                        color: white;
                                        border: none;
                                        padding: 6px 12px;
                                        border-radius: 4px;
                                        cursor: pointer;
                                        font-size: 12px;
                                    ">Remove Media</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Tickets Section -->
                    <div class="section-group" style="margin-bottom: 25px;">
                        <h4 style="margin: 0 0 15px 0; color: #333; font-size: 16px; font-weight: 600; display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-ticket-alt" style="color: #f39c12;"></i>
                            Event Tickets
                        </h4>
                        <div id="changeTicketsList">
                            ${generateChangeTicketsList(eventData.tickets || [])}
                        </div>
                    </div>
                    
                    <!-- Contact Information Section -->
                    <div class="section-group" style="margin-bottom: 25px;">
                        <h4 style="margin: 0 0 15px 0; color: #333; font-size: 16px; font-weight: 600; display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-address-book" style="color: #f39c12;"></i>
                            Contact Information
                        </h4>
                        
                        <div style="background: #f8f9fa; border: 1px solid #e9ecef; border-radius: 8px; padding: 20px;">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                                <div class="form-group">
                                    <label style="font-weight: 600; color: #333; font-size: 14px; display: block; margin-bottom: 6px;">Host Name</label>
                                    <input type="text" id="changeHostName" value="${eventData.phyeveContactInfo?.hostName || ''}" style="
                                        width: 100%;
                                        padding: 10px 12px;
                                        border: 2px solid #e9ecef;
                                        border-radius: 6px;
                                        font-size: 14px;
                                        box-sizing: border-box;
                                        color: #333;
                                        background: white;
                                    ">
                                </div>
                                <div class="form-group">
                                    <label style="font-weight: 600; color: #333; font-size: 14px; display: block; margin-bottom: 6px;">Phone Number</label>
                                    <input type="tel" id="changePhoneNumber" value="${eventData.phyeveContactInfo?.phoneNumber || ''}" placeholder="+234 xxx xxx xxxx" style="
                                        width: 100%;
                                        padding: 10px 12px;
                                        border: 2px solid #e9ecef;
                                        border-radius: 6px;
                                        font-size: 14px;
                                        box-sizing: border-box;
                                        color: #333;
                                        background: white;
                                    ">
                                </div>
                            </div>
                            
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                                <div class="form-group">
                                    <label style="font-weight: 600; color: #333; font-size: 14px; display: block; margin-bottom: 6px;">Website</label>
                                    <input type="url" id="changeWebsiteUrl" value="${eventData.phyeveContactInfo?.websiteUrl || ''}" style="
                                        width: 100%;
                                        padding: 10px 12px;
                                        border: 2px solid #e9ecef;
                                        border-radius: 6px;
                                        font-size: 14px;
                                        box-sizing: border-box;
                                        color: #333;
                                        background: white;
                                    ">
                                </div>
                                <div class="form-group">
                                    <label style="font-weight: 600; color: #333; font-size: 14px; display: block; margin-bottom: 6px;">Instagram</label>
                                    <input type="url" id="changeInstagramUrl" value="${eventData.phyeveContactInfo?.instagramUrl || ''}" style="
                                        width: 100%;
                                        padding: 10px 12px;
                                        border: 2px solid #e9ecef;
                                        border-radius: 6px;
                                        font-size: 14px;
                                  box-sizing: border-box;
                                        color: #333;
                                        background: white;
                                    ">
                                </div>
                                <div class="form-group">
                                    <label style="font-weight: 600; color: #333; font-size: 14px; display: block; margin-bottom: 6px;">WhatsApp</label>
                                    <input type="text" id="changeWhatsappUrl" value="${eventData.phyeveContactInfo?.whatsappUrl || ''}" style="
                                        width: 100%;
                                        padding: 10px 12px;
                                        border: 2px solid #e9ecef;
                                        border-radius: 6px;
                                        font-size: 14px;
                                        box-sizing: border-box;
                                        color: #333;
                                        background: white;
                                    ">
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Modal Actions -->
                    <div class="modal-actions" style="
                        display: flex;
                        gap: 12px;
                        justify-content: flex-end;
                        padding-top: 20px;
                        border-top: 2px solid #e9ecef;
                    ">
                        <button type="button" onclick="closePhyEventChange()" style="
                            background: #f8f9fa;
                            color: #6c757d;
                            border: 1px solid #e9ecef;
                            padding: 12px 24px;
                            border-radius: 6px;
                            cursor: pointer;
                            font-weight: 600;
                            transition: all 0.2s ease;
                        ">Cancel</button>
                        <button type="button" onclick="submitEventChanges('${eventId}')" style="
                            background: linear-gradient(135deg, #f39c12, #e67e22);
                            color: white;
                            border: none;
                            padding: 12px 24px;
                            border-radius: 6px;
                            cursor: pointer;
                            font-weight: 600;
                            transition: all 0.2s ease;
                            display: flex;
                            align-items: center;
                            gap: 8px;
                        ">
                            <i class="fas fa-save"></i>
                            Save Changes
                        </button>
                    </div>
                </form>
            </div>
        </div>
    `;
    
        document.body.appendChild(modal);
    
    // Initialize the modal after adding to DOM
    setTimeout(() => {
        initializeChangeModal(eventData);
    }, 100);
}

// Initialize change modal with event data
function initializeChangeModal(eventData) {
    // Initialize event listeners first
    initializeChangeEventListeners();
    
    // Set background tab based on existing background
    if (eventData.background && eventData.background.type === 'media') {
        switchChangeBackgroundTab('media');
        
        // Show existing media if available
        if (eventData.background.data) {
            const previewContainer = document.getElementById('changeMediaPreviewContainer');
            const preview = document.getElementById('changeMediaPreview');
            
            if (eventData.background.fileType && eventData.background.fileType.startsWith('image/')) {
                preview.innerHTML = `<img src="${eventData.background.data}" alt="Current background" style="width: 100%; height: 120px; object-fit: cover; border-radius: 8px;">`;
            } else if (eventData.background.fileType && eventData.background.fileType.startsWith('video/')) {
                preview.innerHTML = `<video src="${eventData.background.data}" style="width: 100%; height: 120px; object-fit: cover; border-radius: 8px;" controls muted></video>`;
            }
            
            previewContainer.style.display = 'block';
        }
    } else {
        switchChangeBackgroundTab('gradient');
    }
    
    // Initialize gradient preview
    updateChangeGradientPreview();
}

// Toggle TBA schedule in change modal
function toggleChangeTBASchedule() {
    const tbaCheckbox = document.getElementById('changeTBASchedule');
    const dateTimeSection = document.getElementById('changeDateTimeSection');
    
    if (tbaCheckbox.checked) {
        dateTimeSection.style.display = 'none';
        // Clear date/time values
        document.getElementById('changeStartDate').value = '';
        document.getElementById('changeStartTime').value = '';
        document.getElementById('changeEndDate').value = '';
        document.getElementById('changeEndTime').value = '';
    } else {
        dateTimeSection.style.display = 'block';
    }
}

// Switch background tab in change modal
function switchChangeBackgroundTab(tabType) {
    console.log('Switching change tab to:', tabType);
    
    // Store the current tab type globally
    window.currentChangeBgTab = tabType;
    
    // Update tab buttons - remove active from all first
    document.querySelectorAll('.change-bg-tab').forEach(tab => {
        tab.classList.remove('active');
    });
    
    // Add active class to the correct tab
    const targetTab = document.querySelector(`.change-bg-tab[data-tab="${tabType}"]`);
    if (targetTab) {
        targetTab.classList.add('active');
        console.log('Tab activated:', tabType);
    } else {
        console.error('Target tab not found:', tabType);
    }
    
    // Update active tab styling
    document.querySelectorAll('.change-bg-tab').forEach(tab => {
        if (tab.getAttribute('data-tab') === tabType) {
            tab.style.background = '#007bff';
        } else {
            tab.style.background = '#6c757d';
        }
    });
    
    // Update content sections
    document.querySelectorAll('.change-bg-content').forEach(content => content.classList.remove('active'));
    const contentElement = document.getElementById(`change${tabType.charAt(0).toUpperCase() + tabType.slice(1)}Content`);
    
    if (contentElement) {
        contentElement.classList.add('active');
        console.log('Content section activated:', tabType);
    } else {
        console.error('Content section not found:', tabType);
    }
    
    // Update main preview if it exists
    updateChangeEventPreview();
}

// Update gradient preview in change modal
function updateChangeGradientPreview() {
    const color1 = document.getElementById('changeGradientColor1').value;
    const color2 = document.getElementById('changeGradientColor2').value;
    const preview = document.getElementById('changeGradientPreview');
    
    if (preview) {
        preview.style.background = `linear-gradient(135deg, ${color1}, ${color2})`;
    }
}

// Handle media upload in change modal
function handleChangeMediaUpload(input) {
    const file = input.files[0];
    if (!file) {
        console.log('No file selected');
        return;
    }
    
    console.log('Media upload started for change:', file.name, file.type, file.size);
    
    // Validate file
    const maxSize = 10 * 1024 * 1024; // 10MB
    if (file.size > maxSize) {
        alert('File size must be less than 10MB');
        input.value = '';
        return;
    }
    
    // Validate file type
    const validTypes = ['image/', 'video/'];
    const isValidType = validTypes.some(type => file.type.startsWith(type));
    
    if (!isValidType) {
        alert('Please select an image or video file');
        input.value = '';
        return;
    }
    
    const reader = new FileReader();
    reader.onload = function(e) {
        console.log('File loaded successfully for change, data length:', e.target.result.length);
        
        const previewContainer = document.getElementById('changeMediaPreviewContainer');
        const preview = document.getElementById('changeMediaPreview');
        
        if (file.type.startsWith('image/')) {
            preview.innerHTML = `<img src="${e.target.result}" alt="Background preview" style="width: 100%; height: 120px; object-fit: cover; border-radius: 8px;">`;
        } else if (file.type.startsWith('video/')) {
            preview.innerHTML = `<video src="${e.target.result}" style="width: 100%; height: 120px; object-fit: cover; border-radius: 8px;" controls muted></video>`;
        }
        
        previewContainer.style.display = 'block';
        
        // Store media data globally
        window.changeEventMediaData = {
            type: 'media',
            data: e.target.result,
            fileName: file.name,
            fileType: file.type,
            fileSize: file.size
        };
        
        // Ensure we're on the media tab and mark it as active
        switchChangeBackgroundTab('media');
        
        console.log('Media stored for change:', window.changeEventMediaData.fileName);
    };
    
    reader.onerror = function(error) {
        console.error('File reading error:', error);
        alert('Error reading file. Please try again.');
        input.value = '';
    };
    
    reader.readAsDataURL(file);
}

// Remove media in change modal
function removeChangeMedia() {
    console.log('Removing change media');
    
    // Clear the file input
    const mediaInput = document.getElementById('changeBackgroundMedia');
    if (mediaInput) {
        mediaInput.value = '';
    }
    
    // Hide preview container
    const previewContainer = document.getElementById('changeMediaPreviewContainer');
    if (previewContainer) {
        previewContainer.style.display = 'none';
    }
    
    // Clear stored media data
    window.changeEventMediaData = null;
    
    // Switch to gradient tab
    switchChangeBackgroundTab('gradient');
    
    console.log('Change media removed');
}

// Generate tickets list for change modal
function generateChangeTicketsList(tickets) {
    if (!tickets || tickets.length === 0) {
        return '<p style="text-align: center; color: #6c757d; padding: 20px;">No tickets configured</p>';
    }
    
    return tickets.map((ticket, index) => `
        <div class="change-ticket-item" style="
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            background: #f8f9fa;
        ">
            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-bottom: 10px;">
                <div class="form-group">
                    <label style="font-weight: 600; color: #495057; font-size: 12px; display: block; margin-bottom: 4px;">Ticket Name</label>
                    <input type="text" class="change-ticket-name" value="${ticket.name || ''}" data-index="${index}" style="
                        width: 100%;
                        padding: 8px 10px;
                        border: 1px solid #dee2e6;
                        border-radius: 4px;
                        font-size: 13px;
                        box-sizing: border-box;
                    ">
                </div>
                <div class="form-group">
                    <label style="font-weight: 600; color: #495057; font-size: 12px; display: block; margin-bottom: 4px;">Price ()</label>
                    <input type="number" class="change-ticket-price" value="${ticket.price || 0}" min="0" data-index="${index}" style="
                        width: 100%;
                        padding: 8px 10px;
                        border: 1px solid #dee2e6;
                        border-radius: 4px;
                        font-size: 13px;
                        box-sizing: border-box;
                    ">
                </div>
                <div class="form-group">
                    <label style="font-weight: 600; color: #495057; font-size: 12px; display: block; margin-bottom: 4px;">Quantity</label>
                    <input type="number" class="change-ticket-quantity" value="${ticket.quantity || 0}" min="1" data-index="${index}" style="
                        width: 100%;
                        padding: 8px 10px;
                        border: 1px solid #dee2e6;
                        border-radius: 4px;
                        font-size: 13px;
                        box-sizing: border-box;
                    ">
                </div>
            </div>
            <small style="color: #6c757d; font-size: 11px;">Sold: ${ticket.sold || 0} tickets</small>
        </div>
    `).join('');
}

// Submit all changes to Firebase
async function submitEventChanges(eventId) {
    const submitBtn = event.target || document.querySelector('[onclick*="submitEventChanges"]');
    const originalText = submitBtn.innerHTML;
    
    try {
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving Changes...';
        
        console.log('=== SUBMITTING EVENT CHANGES ===');
        console.log('Event ID:', eventId);
        
        // Collect all form data
        const eventName = document.getElementById('changeEventName').value.trim();
        const eventDescription = document.getElementById('changeEventDescription').value.trim();
        const eventLink = document.getElementById('changeEventLink').value.trim();
        const location = document.getElementById('changeEventLocation').value.trim();
        const isTBA = document.getElementById('changeTBASchedule').checked;
        
        // Validate required fields
        if (!eventName || !eventLink || !location || !eventDescription) {
            throw new Error('Please fill in all required fields');
        }
        
        // Prepare update data
        const updateData = {
            eventName: eventName,
            description: eventDescription,
            eventLink: eventLink,
            location: location,
            updatedAt: new Date().toISOString()
        };
        
        // Handle scheduling
        if (isTBA) {
            updateData.startDateTime = 'TBA';
            updateData.endDateTime = 'TBA';
            updateData.isTBA = true;
            updateData.schedulingStatus = 'TBA';
        } else {
            const startDate = document.getElementById('changeStartDate').value;
            const startTime = document.getElementById('changeStartTime').value;
            const endDate = document.getElementById('changeEndDate').value;
            const endTime = document.getElementById('changeEndTime').value;
            
            if (startDate && startTime && endDate && endTime) {
                updateData.startDateTime = new Date(`${startDate}T${startTime}`).toISOString();
                updateData.endDateTime = new Date(`${endDate}T${endTime}`).toISOString();
                updateData.isTBA = false;
                updateData.schedulingStatus = 'scheduled';
            }
        }
        
        // Handle background - FIXED VERSION
        console.log('Checking background changes...');
        console.log('Current change tab:', window.currentChangeBgTab);
        console.log('Change media data available:', !!window.changeEventMediaData);
        
        // Check multiple ways to determine if media tab is active
        const activeTabElement = document.querySelector('.change-bg-tab.active');
        const isMediaTabActive = activeTabElement && activeTabElement.getAttribute('data-tab') === 'media';
        const isMediaTabByGlobal = window.currentChangeBgTab === 'media';
        
        console.log('Active tab element:', activeTabElement);
        console.log('Is media tab active (element):', isMediaTabActive);
        console.log('Is media tab active (global):', isMediaTabByGlobal);
        
        if ((isMediaTabActive || isMediaTabByGlobal) && window.changeEventMediaData) {
            console.log('Updating with new media:', window.changeEventMediaData.fileName);
            updateData.background = {
                type: 'media',
                data: window.changeEventMediaData.data,
                fileName: window.changeEventMediaData.fileName,
                fileType: window.changeEventMediaData.fileType,
                fileSize: window.changeEventMediaData.fileSize
            };
        } else {
            // Use gradient or keep existing
            const color1Element = document.getElementById('changeGradientColor1');
            const color2Element = document.getElementById('changeGradientColor2');
            
            if (color1Element && color2Element) {
                const color1 = color1Element.value || '#FF6B6B';
                const color2 = color2Element.value || '#4ECDC4';
                
                console.log('Updating with gradient:', color1, color2);
                updateData.background = {
                    type: 'gradient',
                    color1: color1,
                    color2: color2,
                    gradient: `linear-gradient(135deg, ${color1}, ${color2})`
                };
            } else {
                console.log('No background changes detected, keeping existing');
            }
        }
        
        // Handle contact information
        const contactInfo = collectChangeContactInfo();
        if (contactInfo && Object.keys(contactInfo).length > 0) {
            updateData.phyeveContactInfo = contactInfo;
        }
        
        // Handle tickets
        const updatedTickets = collectChangeTicketsInfo();
        if (updatedTickets.length > 0) {
            updateData.tickets = updatedTickets;
        }
        
        console.log('Final update data:', updateData);
        
        // Update in Firebase
        const db = firebase.firestore();
        await db.collection('physicalEvents').doc(eventId).update(updateData);
        
        // Clear the global media data after successful save
        window.changeEventMediaData = null;
        window.currentChangeBgTab = null;
        
        // Close modal and show success
        closePhyEventChange();
        
        setTimeout(() => {
            showToast('Event changes saved successfully!', 'success');
            loadUserPhysicalEvents(); // Refresh the display
        }, 100);
        
    } catch (error) {
        console.error('Error saving changes:', error);
        showToast('Error saving changes: ' + error.message, 'error');
    } finally {
        submitBtn.disabled = false;
        submitBtn.innerHTML = originalText;
    }
}

// Function to update change event preview (optional)
function updateChangeEventPreview() {
    const eventNameElement = document.getElementById('changeEventName');
    const previewTitle = document.getElementById('changePreviewEventTitle');
    
    if (eventNameElement && previewTitle) {
        previewTitle.textContent = eventNameElement.value || 'Event Name';
    }
    
    // Update background preview if exists
    const backgroundPreview = document.getElementById('changeEventBackgroundPreview');
    if (backgroundPreview) {
        if (window.changeEventMediaData) {
            // Show media background
            backgroundPreview.style.backgroundImage = `url(${window.changeEventMediaData.data})`;
            backgroundPreview.style.backgroundSize = 'cover';
            backgroundPreview.style.backgroundPosition = 'center';
            backgroundPreview.style.background = '';
        } else {
            // Show gradient background
            const color1Element = document.getElementById('changeGradientColor1');
            const color2Element = document.getElementById('changeGradientColor2');
            
            if (color1Element && color2Element) {
                const color1 = color1Element.value || '#FF6B6B';
                const color2 = color2Element.value || '#4ECDC4';
                backgroundPreview.style.background = `linear-gradient(135deg, ${color1}, ${color2})`;
                backgroundPreview.style.backgroundImage = '';
            }
        }
    }
}

// Initialize change event listeners (call this when opening edit modal)
function initializeChangeEventListeners() {
    console.log('Initializing change event listeners');
    
    // Clear any existing media data
    window.changeEventMediaData = null;
    window.currentChangeBgTab = 'gradient'; // Default to gradient tab
    
    // Add event listeners for real-time updates
    const eventNameInput = document.getElementById('changeEventName');
    if (eventNameInput) {
        eventNameInput.addEventListener('input', updateChangeEventPreview);
    }
    
    // Add gradient color change listeners
    const gradientColor1 = document.getElementById('changeGradientColor1');
    const gradientColor2 = document.getElementById('changeGradientColor2');
    
    if (gradientColor1) {
        gradientColor1.addEventListener('change', updateChangeEventPreview);
    }
    if (gradientColor2) {
        gradientColor2.addEventListener('change', updateChangeEventPreview);
    }
}

// Collect contact information from change form
function collectChangeContactInfo() {
    const contactFields = {
        hostName: document.getElementById('changeHostName').value.trim(),
        phoneNumber: document.getElementById('changePhoneNumber').value.trim(),
        websiteUrl: document.getElementById('changeWebsiteUrl').value.trim(),
        instagramUrl: document.getElementById('changeInstagramUrl').value.trim(),
        whatsappUrl: document.getElementById('changeWhatsappUrl').value.trim()
    };
    
    // Only include non-empty values
    const contactInfo = {};
    Object.keys(contactFields).forEach(key => {
        if (contactFields[key]) {
            contactInfo[key] = contactFields[key];
        }
    });
    
    return contactInfo;
}

// Collect tickets information from change form
function collectChangeTicketsInfo() {
    const ticketInputs = document.querySelectorAll('.change-ticket-item');
    const updatedTickets = [];
    
    ticketInputs.forEach((ticketItem, index) => {
        const nameInput = ticketItem.querySelector('.change-ticket-name');
        const priceInput = ticketItem.querySelector('.change-ticket-price');
        const quantityInput = ticketItem.querySelector('.change-ticket-quantity');
        
        if (nameInput && priceInput && quantityInput) {
            const name = nameInput.value.trim();
            const price = parseFloat(priceInput.value) || 0;
            const quantity = parseInt(quantityInput.value) || 0;
            
            if (name && quantity > 0) {
                updatedTickets.push({
                    id: `ticket_${Date.now()}_${index}`,
                    name: name,
                    price: price,
                    quantity: quantity,
                    sold: 0, // Preserve sold count from original if needed
                    type: price > 0 ? 'paid' : 'free',
                    status: price > 0 ? `Paid Ticket - ${price.toLocaleString()}` : 'Free Ticket',
                    available: true,
                    background: {
                        type: 'color',
                        color: '#4ECDC4'
                    },
                    createdAt: new Date().toISOString()
                });
            }
        }
    });
    
    return updatedTickets;
}

// Close change modal
function closePhyEventChange() {
    const modal = document.getElementById('phyeventchange-modal');
    if (modal) {
        modal.remove();
    }
    
    // Clear stored media data
    window.changeEventMediaData = null;
}

// Close modal when clicking outside
document.addEventListener('click', function(event) {
    if (event.target.classList.contains('phyeventchange-modal-overlay')) {
        closePhyEventChange();
    }
});

        
// ========================================
// SEARCH AND FILTER FUNCTIONALITY
// ========================================

// Global variables for search and filter
let allPhysicalEvents = [];
let filteredEvents = [];

// Initialize search controls
function initializePhysicalEventsUI() {
    createSearchFilterControls();
}

// Create search and filter controls
function createSearchFilterControls() {
    const controlsContainer = document.getElementById('searchFilterControls');
    if (!controlsContainer) return;
    
    controlsContainer.innerHTML = `
        <div style="
    background: #f8f9fa;
    padding: 12px;
    border-radius: 8px;
    margin-bottom: 16px;
    border: 1px solid #e9ecef;
">
    <div style="
        display: grid;
        grid-template-columns: 1fr auto auto;
        gap: 8px;
        align-items: center;
    " class="search-filter-grid">
        <!-- Search Input -->
        <div style="position: relative; grid-column: 1 / -1;" class="search-input-container">
            <input type="text" 
                   id="eventSearchInput" 
                   placeholder="Search events by name..." 
                   style="
                       width: 100%;
                       padding: 12px 16px 12px 44px;
                       border: 2px solid #dee2e6;
                       border-radius: 8px;
                       font-size: 16px;
                       transition: border-color 0.2s ease;
                       box-sizing: border-box;
                       -webkit-appearance: none;
                       appearance: none;
                   "
                   onkeyup="handleEventSearch()"
                   onfocus="this.style.borderColor='#007bff'"
                   onblur="this.style.borderColor='#dee2e6'">
            <i class="fas fa-search" style="
                position: absolute;
                left: 16px;
                top: 50%;
                transform: translateY(-50%);
                color: #6c757d;
                font-size: 16px;
            "></i>
        </div>
        
        <!-- Filter Row -->
        <div style="
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            width: 100%;
            grid-column: 1 / -1;
            margin-top: 8px;
        " class="filter-row">
            <!-- Month Filter -->
            <select id="monthFilter" 
                    onchange="handleEventFilter()"
                    style="
                        padding: 12px 16px;
                        border: 2px solid #dee2e6;
                        border-radius: 8px;
                        font-size: 16px;
                        background: white;
                        cursor: pointer;
                        width: 100%;
                        box-sizing: border-box;
                        -webkit-appearance: none;
                        appearance: none;
                        background-image: url('data:image/svg+xml;charset=US-ASCII,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 4 5\"><path fill=\"%23666\" d=\"M2 0L0 2h4zm0 5L0 3h4z\"/></svg>');
                        background-repeat: no-repeat;
                        background-position: right 12px center;
                        background-size: 12px;
                        padding-right: 32px;
                    ">
                <option value="">All Months</option>
                <option value="01">January</option>
                <option value="02">February</option>
                <option value="03">March</option>
                <option value="04">April</option>
                <option value="05">May</option>
                <option value="06">June</option>
                <option value="07">July</option>
                <option value="08">August</option>
                <option value="09">September</option>
                <option value="10">October</option>
                <option value="11">November</option>
                <option value="12">December</option>
            </select>
            
            <!-- Date Filter -->
            <input type="date" 
                   id="dateFilter" 
                   onchange="handleEventFilter()"
                   style="
                       padding: 12px 16px;
                       border: 2px solid #dee2e6;
                       border-radius: 8px;
                       font-size: 16px;
                       background: white;
                       cursor: pointer;
                       width: 100%;
                       box-sizing: border-box;
                       -webkit-appearance: none;
                       appearance: none;
                   ">
        </div>
    </div>
    
    <!-- Clear Filters Button -->
    <div style="margin-top: 12px; text-align: center;">
        <button onclick="clearAllFilters()" 
                style="
                    padding: 10px 20px;
                    background: #6c757d;
                    color: white;
                    border: none;
                    border-radius: 6px;
                    font-size: 14px;
                    cursor: pointer;
                    transition: background 0.2s ease;
                    min-height: 44px;
                    min-width: 120px;
                    touch-action: manipulation;
                "
                onmouseover="this.style.background='#5a6268'"
                onmouseout="this.style.background='#6c757d'">
            <i class="fas fa-times"></i> Clear Filters
        </button>
    </div>
</div>
 `;
}





// Filter and display events
function filterAndDisplayEvents(searchTerm = '', monthFilter = '', dateFilter = '') {
    const liveEventsContainer = document.getElementById('liveEventsContainer');
    if (!liveEventsContainer) return;
    
    let filtered = [...allPhysicalEvents];
    
    // Filter by search term (event name)
    if (searchTerm) {
        filtered = filtered.filter(event => 
            event.eventName.toLowerCase().includes(searchTerm)
        );
    }
    
    // Filter by month
    if (monthFilter) {
        filtered = filtered.filter(event => {
            if (event.startDateTime) {
                const eventMonth = new Date(event.startDateTime).getMonth() + 1;
                return eventMonth.toString().padStart(2, '0') === monthFilter;
            }
            return false;
        });
    }
    
    // Filter by specific date
    if (dateFilter) {
        filtered = filtered.filter(event => {
            if (event.startDateTime) {
                const eventDate = new Date(event.startDateTime).toISOString().split('T')[0];
                return eventDate === dateFilter;
            }
            return false;
        });
    }
    
    // Display filtered events
    displayFilteredEvents(filtered);
    
    // Update results counter
    updateResultsCounter(filtered.length, allPhysicalEvents.length);
}

// Display filtered events
function displayFilteredEvents(events) {
    const liveEventsContainer = document.getElementById('liveEventsContainer');
    liveEventsContainer.innerHTML = '';
    
    if (events.length === 0) {
        liveEventsContainer.innerHTML = `
            <div style="
                text-align: center;
                padding: 40px 20px;
                color: #6c757d;
            ">
                <i class="fas fa-search" style="font-size: 48px; margin-bottom: 16px; opacity: 0.5;"></i>
                <h3 style="margin: 0 0 8px 0; font-size: 18px;">No Events Found</h3>
                <p style="margin: 0; font-size: 14px;">Try adjusting your search or filter criteria</p>
            </div>
        `;
        return;
    }
    
    events.forEach(eventData => {
        try {
            const eventCard = createPhysicalEventCard(eventData);
            liveEventsContainer.appendChild(eventCard);
        } catch (error) {
            console.error('Error creating event card:', error);
        }
    });
}

// Update results counter
function updateResultsCounter(filtered, total) {
    const controlsContainer = document.getElementById('searchFilterControls');
    if (!controlsContainer) return;
    
    let counterElement = controlsContainer.querySelector('.results-counter');
    if (!counterElement) {
        counterElement = document.createElement('div');
        counterElement.className = 'results-counter';
        controlsContainer.appendChild(counterElement);
    }
    
    counterElement.innerHTML = `
        <div style="
            margin-top: 8px;
            font-size: 12px;
            color: #6c757d;
            text-align: right;
        ">
            Showing ${filtered} of ${total} events
        </div>
    `;
}

// Clear all filters
function clearAllFilters() {
    document.getElementById('eventSearchInput').value = '';
    document.getElementById('monthFilter').value = '';
    document.getElementById('dateFilter').value = '';
    
    filterAndDisplayEvents();
}

// Enhanced loadUserPhysicalEvents with search integration
async function loadUserPhysicalEventsWithSearch() {
    const liveEventsContainer = document.getElementById('liveEventsContainer');
    
    if (!liveEventsContainer) {
        console.log('liveEventsContainer not found - skipping load');
        return;
    }
    
    try {
        // Show loading state
        liveEventsContainer.innerHTML = `
            <div class="loading-events">
                <i class="fas fa-spinner fa-spin"></i>
                <p>Loading your events...</p>
            </div>
        `;
        
        // Get current user ID
        let currentUserId;
        try {
            currentUserId = await getCurrentUserId();
        } catch (error) {
            console.error('Error getting user ID for loading events:', error);
            currentUserId = 'anonymous_user';
        }
        
        const db = firebase.firestore();
        let querySnapshot;
        
        try {
            querySnapshot = await db.collection('physicalEvents')
                .where('creatorId', '==', currentUserId)
                .orderBy('createdAt', 'desc')
                .get();
        } catch (indexError) {
            querySnapshot = await db.collection('physicalEvents')
                .where('creatorId', '==', currentUserId)
                .get();
        }
        
        // Clear loading state
        liveEventsContainer.innerHTML = '';
        
        if (querySnapshot.empty) {
            allPhysicalEvents = [];
            liveEventsContainer.innerHTML = `
                <div class="no-events-message">
                    <i class="fas fa-calendar-plus"></i>
                    <h3>No Events Created Yet</h3>
                    <p>Create your first physical event to see it here!</p>
                </div>
            `;
            updateResultsCounter(0, 0);
            return;
        }
        
        // Store all events
        allPhysicalEvents = [];
        querySnapshot.forEach((doc) => {
            const eventData = { ...doc.data(), id: doc.id };
            if (!eventData.physicalEventId) {
                eventData.physicalEventId = doc.id;
            }
            allPhysicalEvents.push(eventData);
        });
        
        // Sort by createdAt
        allPhysicalEvents.sort((a, b) => {
            const dateA = a.createdAt ? new Date(a.createdAt) : new Date(0);
            const dateB = b.createdAt ? new Date(b.createdAt) : new Date(0);
            return dateB - dateA;
        });
        
        // Apply current filters
        const searchTerm = document.getElementById('eventSearchInput')?.value.toLowerCase().trim() || '';
        const monthFilter = document.getElementById('monthFilter')?.value || '';
        const dateFilter = document.getElementById('dateFilter')?.value || '';
        
        filterAndDisplayEvents(searchTerm, monthFilter, dateFilter);
        
        console.log(`Loaded ${allPhysicalEvents.length} physical events`);
        
    } catch (error) {
        console.error('Error loading physical events:', error);
        liveEventsContainer.innerHTML = `
            <div class="error-loading-events">
                <i class="fas fa-exclamation-triangle"></i>
                <h3>Error Loading Events</h3>
                <p>There was an error loading your events. Please try again.</p>
                <button onclick="loadUserPhysicalEventsWithSearch()" class="retry-btn">
                    <i class="fas fa-redo"></i> Retry
                </button>
            </div>
        `;
    }
}

// Initialize UI when page loads
document.addEventListener('DOMContentLoaded', function() {
    // Initialize the UI components
    setTimeout(() => {
        initializePhysicalEventsUI();
        
        // Load events with search integration
        const liveEventsContainer = document.getElementById('liveEventsContainer');
        if (liveEventsContainer) {
            loadUserPhysicalEventsWithSearch();
        }
    }, 500);
});
    







// ========================================
// AUTO BRAND SPONSOR & PROMO CODE SYSTEM
// ========================================
// Add Rewarder brand sponsor with promo code (optional)
function addRewarderSponsor() {
    const rewarderSponsor = {
        id: 'rewarder_sponsor_' + Date.now(),
        name: 'Rewarder',
        website: 'https://rewarder-hub.vercel.app/',
        logo: {
            data: 'https://i.ibb.co/VpC27tbt/Rewarder-logo.png',
            fileName: 'Rewarder-logo.png',
            fileType: 'image/png',
            isUrl: true // Flag to indicate this is a URL, not base64
        },
        isBrandSponsor: true,
        promoCode: generatePromoCode(),
        promoUsageCount: 0,
        promoMaxUsage: 10,
        createdAt: new Date().toISOString(),
        updatedAt: new Date().toISOString()
    };
    
    // Check if Rewarder sponsor already exists
    const existingRewarderIndex = physicalEventSponsors.findIndex(sponsor => sponsor.isBrandSponsor);
   
     if (existingRewarderIndex === -1) {
        // Add Rewarder sponsor if it doesn't exist
        physicalEventSponsors.unshift(rewarderSponsor); // Add at the beginning
        console.log('Rewarder sponsor added with promo code:', rewarderSponsor.promoCode);
        return rewarderSponsor.promoCode;
    } else {
        // Return existing promo code
        return physicalEventSponsors[existingBrandIndex].promoCode;
        console.log('Rewarder sponsor already exists with promo code:', physicalEventSponsors[existingRewarderIndex].promoCode);
        return physicalEventSponsors[existingRewarderIndex].promoCode;
   
    }
}

// Generate promo code
function generatePromoCode() {
    const prefix = 'SPONSOR';
    const randomCode = Math.random().toString(36).substring(2, 8).toUpperCase();
    return `${prefix}${randomCode}`;
}

// Validate and use promo code
function validatePromoCode(promoCode, eventId) {
    try {
        // Find the sponsor with this promo code
        const sponsor = physicalEventSponsors.find(s => s.promoCode === promoCode && s.isBrandSponsor);
        
        if (!sponsor) {
            return { isValid: false, message: 'Invalid promo code' };
        }
        
        if (sponsor.promoUsageCount >= sponsor.promoMaxUsage) {
            return { isValid: false, message: 'Promo code usage limit exceeded' };
        }
        
        return { 
            isValid: true, 
            message: 'Promo code valid - No service fee!',
            discount: 100, // 100% discount on service fee
            promoCode: promoCode
        };
        
    } catch (error) {
        console.error('Error validating promo code:', error);
        return { isValid: false, message: 'Error validating promo code' };
    }
}

// Use promo code (call this when ticket is purchased)
async function usePromoCode(promoCode, eventId) {
    try {
        const sponsorIndex = physicalEventSponsors.findIndex(s => s.promoCode === promoCode && s.isBrandSponsor);
        
        if (sponsorIndex !== -1) {
            physicalEventSponsors[sponsorIndex].promoUsageCount++;
            physicalEventSponsors[sponsorIndex].updatedAt = new Date().toISOString();
            
            // Update in Firebase if we have an event ID
            if (eventId) {
                await saveSponsorsToFirebase(eventId, physicalEventSponsors);
            }
            
            console.log(`Promo code ${promoCode} used. Remaining uses: ${physicalEventSponsors[sponsorIndex].promoMaxUsage - physicalEventSponsors[sponsorIndex].promoUsageCount}`);
            
            return {
                success: true,
                remainingUses: physicalEventSponsors[sponsorIndex].promoMaxUsage - physicalEventSponsors[sponsorIndex].promoUsageCount
            };
        }
        
        return { success: false, message: 'Promo code not found' };
        
    } catch (error) {
        console.error('Error using promo code:', error);
        return { success: false, message: 'Error processing promo code' };
    }
}

// Get promo code info
function getPromoCodeInfo(promoCode) {
    const sponsor = physicalEventSponsors.find(s => s.promoCode === promoCode && s.isBrandSponsor);
    
    if (sponsor) {
        return {
            exists: true,
            usageCount: sponsor.promoUsageCount,
            maxUsage: sponsor.promoMaxUsage,
            remainingUses: sponsor.promoMaxUsage - sponsor.promoUsageCount,
            isExpired: sponsor.promoUsageCount >= sponsor.promoMaxUsage
        };
    }
    
    return { exists: false };
}

// Display promo code notification
function showPromoCodeNotification(promoCode) {
    const notification = document.createElement('div');
    notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        z-index: 10000;
        max-width: 300px;
        font-family: Arial, sans-serif;
    `;
    
    notification.innerHTML = `
        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px;">
            <h4 style="margin: 0; color: #fff;"> Promo Code Generated!</h4>
            <button onclick="this.parentElement.parentElement.remove()" style="background: none; border: none; color: white; font-size: 18px; cursor: pointer;">&times;</button>
        </div>
          <p style="margin: 0 0 10px 0; font-size: 14px;">Rewarder sponsor added with promo code:</p>
      
       
          <div onclick="copyPromoCode('${promoCode}')" style="background: rgba(255,255,255,0.2); padding: 10px; border-radius: 5px; text-align: center; margin: 10px 0; cursor: pointer; transition: all 0.3s ease;" onmouseover="this.style.background='rgba(255,255,255,0.3)'" onmouseout="this.style.background='rgba(255,255,255,0.2)'">
      
          <strong style="font-size: 16px; letter-spacing: 1px;">${promoCode}</strong>
             <i class="fas fa-copy" style="margin-left: 8px; opacity: 0.8;"></i>
     
          </div>
         <p style="margin: 0; font-size: 12px; opacity: 0.9;">Valid for 10 uses - No service fee on tickets! Click to copy.</p>
  
          `;
    
    document.body.appendChild(notification);
    
    // Auto remove after 10 seconds
    setTimeout(() => {
        if (notification.parentElement) {
            notification.remove();
        }
    }, 10000);
}



// Add Rewarder sponsor to current event
async function addRewarderSponsorToEvent() {
    try {
        // Check if Rewarder sponsor already exists
        const existingRewarder = physicalEventSponsors.find(sponsor => sponsor.isBrandSponsor);
        
        if (existingRewarder) {
            alert('Rewarder sponsor is already added to this event!');
            return;
        }
        
        // Add Rewarder sponsor
        const promoCode = addRewarderSponsor();
        
        // Update sponsors list display
        updateSponsorsList();
        
        // Save to Firebase if editing an existing event
        if (currentEditingEventId) {
            await saveSponsorsToFirebase(currentEditingEventId, physicalEventSponsors);
        }
        
        // Show success notification
        showPromoCodeNotification(promoCode);
        
        console.log('Rewarder sponsor added to event with promo code:', promoCode);
        
    } catch (error) {
        console.error('Error adding Rewarder sponsor:', error);
        alert('Error adding Rewarder sponsor: ' + error.message);
    }
}

// Copy promo code to clipboard
function copyPromoCode(promoCode) {
    // Try using the modern clipboard API first
    if (navigator.clipboard && window.isSecureContext) {
        navigator.clipboard.writeText(promoCode).then(function() {
            showCopySuccess(promoCode);
        }).catch(function(err) {
            console.error('Could not copy text: ', err);
            fallbackCopyTextToClipboard(promoCode);
        });
    } else {
        // Fallback for older browsers
        fallbackCopyTextToClipboard(promoCode);
    }
}

// Fallback copy method
function fallbackCopyTextToClipboard(text) {
    const textArea = document.createElement("textarea");
    textArea.value = text;
    
    // Avoid scrolling to bottom
    textArea.style.top = "0";
    textArea.style.left = "0";
    textArea.style.position = "fixed";
    
    document.body.appendChild(textArea);
    textArea.focus();
    textArea.select();
    
    try {
        const successful = document.execCommand('copy');
        if (successful) {
            showCopySuccess(text);
        } else {
            console.error('Fallback: Unable to copy');
            alert('Unable to copy promo code: ' + text);
        }
    } catch (err) {
        console.error('Fallback: Unable to copy', err);
        alert('Unable to copy promo code: ' + text);
    }
    
    document.body.removeChild(textArea);
}

// Show copy success feedback
function showCopySuccess(promoCode) {
    // Create a small success message
    const successMsg = document.createElement('div');
    successMsg.style.cssText = `
        position: fixed;
        top: 50px;
        right: 20px;
        background: #10b981;
        color: white;
        padding: 8px 16px;
        border-radius: 6px;
        z-index: 10001;
        font-size: 14px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        animation: slideIn 0.3s ease;
    `;
    
    successMsg.innerHTML = `
        <i class="fas fa-check"></i> Copied: ${promoCode}
    `;
    
    document.body.appendChild(successMsg);
    
    // Remove after 2 seconds
    setTimeout(() => {
        if (successMsg.parentElement) {
            successMsg.remove();
        }
    }, 2000);
}

// Simple function to create sponsors modal - add this HTML to your page manually
function createSponsorsModalHTML() {
    return `
    <!-- Sponsors Management Modal -->
    <div id="sponsorsModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Manage Sponsors</h2>
                <button type="button" class="close-btn" onclick="closeSponsorsModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="modal-body">
                <!-- Add New Sponsor Button -->
                <div class="sponsors-header">
                    <button type="button" class="btn btn-primary" onclick="showSponsorForm()">
                        <i class="fas fa-plus"></i> Add New Sponsor
                    </button>
                </div>
                
                <!-- Sponsor Form Section -->
                <div id="sponsorFormSection" style="display: none;">
                    <form id="sponsorForm">
                        <div class="form-group">
                            <label for="sponsorName">Sponsor Name *</label>
                            <input type="text" id="sponsorName" name="sponsorName" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="sponsorWebsite">Website URL (optional)</label>
                            <input type="url" id="sponsorWebsite" name="sponsorWebsite" placeholder="https://example.com">
                        </div>
                        
                        <div class="form-group">
                            <label for="sponsorLogo">Logo Upload (optional)</label>
                            <input type="file" id="sponsorLogo" name="sponsorLogo" 
                                   accept="image/*" onchange="handleSponsorLogoUpload(this)">
                            <small>Max file size: 5MB. Formats: JPG, PNG, GIF, WebP</small>
                        </div>
                        
                        <div id="sponsorLogoPreview" style="display: none;"></div>
                        
                        <div class="form-actions">
                            <button type="button" class="btn btn-primary" id="saveSponsorBtn" onclick="saveSponsor()">
                                Add Sponsor
                            </button>
                            <button type="button" class="btn btn-secondary" onclick="closeSponsorForm()">
                                Cancel
                            </button>
                        </div>
                    </form>
                </div>
                
                <!-- Sponsors List -->
                <div class="sponsors-list-section">
                    <h3>Current Sponsors</h3>
                    <div id="noSponsorsMessage" style="display: block;">
                        <p>No sponsors added yet</p>
                    </div>
                    <div id="sponsorsList"></div>
                </div>
            </div>
        </div>
    </div>
    `;
}
   



       // Complete Withdraw PEE JavaScript - Add this to your existing JS file

// Withdrawal system configuration
const withdrawPEESystem = {
    dailyLimit: 3,
    extraRequestFee: 500,
    
    getFee(amount) {
        if (amount < 10000) return 100;
        if (amount >= 10000 && amount < 20000) return 300;
        return 500;
    },
    
    async getDailyWithdrawalCount(userId) {
        try {
            const today = new Date().toISOString().split('T')[0];
            const db = firebase.firestore();
            
            // Get all physical events to check withdrawal requests
            const snapshot = await db.collection('physicalEvents').get();
            let count = 0;
            
            snapshot.forEach(doc => {
                const data = doc.data();
                if (data.withdrawalRequests && Array.isArray(data.withdrawalRequests)) {
                    data.withdrawalRequests.forEach(request => {
                        if (request.userId === userId && request.createdAt.startsWith(today)) {
                            count++;
                        }
                    });
                }
            });
            
            return count;
        } catch (error) {
            console.error('Error getting daily count:', error);
            return 0;
        }
    },
    
    async canMakeRequest(userId) {
        try {
            const count = await this.getDailyWithdrawalCount(userId);
            return {
                canRequest: count < this.dailyLimit,
                count: count,
                isExtraRequest: count >= this.dailyLimit
            };
        } catch (error) {
            console.error('Error checking request status:', error);
            return { canRequest: true, count: 0, isExtraRequest: false };
        }
    }
};

// Nigerian banks list
const nigerianBanks = [
    'Access Bank', 'Citibank', 'Diamond Bank', 'Ecobank Nigeria', 'Fidelity Bank Nigeria',
    'First Bank of Nigeria', 'First City Monument Bank', 'Guaranty Trust Bank',
    'Heritage Bank', 'Keystone Bank', 'Polaris Bank', 'Providus Bank', 'Stanbic IBTC Bank',
    'Standard Chartered Bank', 'Sterling Bank', 'Union Bank of Nigeria', 'United Bank for Africa',
    'Unity Bank', 'Wema Bank', 'Zenith Bank', 'Jaiz Bank', 'SunTrust Bank', 'Titan Trust Bank',
    'Globus Bank', 'PalmPay', 'Opay', 'Kuda Bank', 'Rubies Bank', 'VFD Microfinance Bank'
];

// Main function to open withdraw form
async function openWithdrawPEEForm(physicalEventId, eventName, totalRevenue) {
    console.log('Opening withdraw form for:', physicalEventId, eventName, totalRevenue);
    
    try {
        // Check if user is authenticated
        const currentUser = auth.currentUser;
        if (!currentUser) {
            showNotification('Please sign in to make withdrawal requests', 'error');
            return;
        }

        // Get request status
        const requestStatus = await withdrawPEESystem.canMakeRequest(currentUser.uid);
        console.log('Request status:', requestStatus);
        
        // Create modal
        const modal = document.createElement('div');
        modal.className = 'modal-overlay';
        modal.id = 'withdraw-pee-modal';
        modal.style.cssText = `
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
        `;
        
        modal.innerHTML = `
            <div class="modal-content withdraw-pee-modal" style="
                background: white;
                border-radius: 12px;
                max-width: 600px;
                width: 90%;
                max-height: 90vh;
                overflow-y: auto;
                position: relative;
            ">
                <div class="modal-header" style="
                    padding: 20px;
                    border-bottom: 1px solid #e9ecef;
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                ">
                    <h3 style="margin: 0; color: #495057;">
                        <i class="fas fa-money-bill-wave" style="color: #28a745; margin-right: 8px;"></i>
                        Withdraw Physical Event Earnings (PEE)
                    </h3>
                    <button class="close-btn" onclick="closeWithdrawPEEModal()" style="
                        background: none;
                        border: none;
                        font-size: 24px;
                        cursor: pointer;
                        color: #6c757d;
                        padding: 0;
                        width: 30px;
                        height: 30px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                    ">&times;</button>
                </div>
                
                <div class="modal-body" style="padding: 20px;">
                    ${!requestStatus.canRequest ? `
                        <div class="warning-box" style="
                            background: #fff3cd;
                            border: 1px solid #ffeaa7;
                            border-radius: 8px;
                            padding: 16px;
                            margin-bottom: 20px;
                            display: flex;
                            align-items: flex-start;
                            gap: 12px;
                        ">
                            <i class="fas fa-exclamation-triangle" style="color: #856404; font-size: 20px; margin-top: 2px;"></i>
                            <div>
                                <strong style="color: #856404; display: block; margin-bottom: 4px;">Daily Limit Reached</strong>
                                <p style="color: #856404; margin: 0; font-size: 14px;">
                                    You've used ${requestStatus.count}/${withdrawPEESystem.dailyLimit} daily requests. 
                                    Extra request available with ${withdrawPEESystem.extraRequestFee} fee.
                                </p>
                            </div>
                        </div>
                    ` : `
                        <div class="info-box" style="
                            background: #d1ecf1;
                            border: 1px solid #bee5eb;
                            border-radius: 8px;
                            padding: 12px 16px;
                            margin-bottom: 20px;
                            display: flex;
                            align-items: center;
                            gap: 8px;
                            color: #0c5460;
                            font-size: 14px;
                        ">
                            <i class="fas fa-info-circle" style="color: #17a2b8;"></i>
                            <span>Daily requests: ${requestStatus.count}/${withdrawPEESystem.dailyLimit}</span>
                        </div>
                    `}
                    
                    <!-- Bank Details Setup Section -->
                    <div class="bank-details-setup" style="
                        background: #f8f9fa;
                        border: 1px solid #e9ecef;
                        border-radius: 8px;
                        padding: 16px;
                        margin-bottom: 20px;
                    ">
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px;">
                            <h4 style="margin: 0; color: #495057; font-size: 16px; font-weight: 600;">
                                <i class="fas fa-university" style="color: #007bff; margin-right: 8px;"></i>
                                Saved Bank Details
                            </h4>
                            <button type="button" onclick="openBankSetup(); window.currentEventId='${physicalEventId}'" style="
                                padding: 6px 12px;
                                background: #007bff;
                                color: white;
                                border: none;
                                border-radius: 4px;
                                cursor: pointer;
                                font-size: 12px;
                                font-weight: 500;
                                transition: all 0.2s ease;
                            " onmouseover="this.style.background='#0056b3'" onmouseout="this.style.background='#007bff'">
                                <i class="fas fa-cog" style="margin-right: 4px;"></i>Setup Bank
                            </button>
                        </div>
                        <div id="bankDetailsDisplay" style="
                            font-size: 14px;
                            color: #6c757d;
                            background: white;
                            border: 1px solid #dee2e6;
                            border-radius: 6px;
                            padding: 12px;
                        ">
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <i class="fas fa-info-circle" style="color: #17a2b8;"></i>
                                <span>No bank details saved yet. Click "Setup Bank" to add your bank information.</span>
                            </div>
                        </div>
                    </div>
                    
                    <form class="withdraw-pee-form" onsubmit="handleWithdrawPEESubmit(event, '${physicalEventId}', ${totalRevenue}); return false;" style="
                        display: flex;
                        flex-direction: column;
                        gap: 16px;
                    ">
                        <div class="form-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                            <div class="form-group" style="display: flex; flex-direction: column; gap: 6px;">
                                <label style="font-weight: 600; color: #495057; font-size: 14px;">Event Name:</label>
                                <input type="text" value="${eventName}" readonly style="
                                    padding: 10px 12px;
                                    border: 2px solid #e9ecef;
                                    border-radius: 6px;
                                    font-size: 14px;
                                    background: #f8f9fa;
                                    color: #333;
                                    cursor: not-allowed;
                                    font-weight: 500;
                                ">
                            </div>
                            
                            <div class="form-group" style="display: flex; flex-direction: column; gap: 6px;">
                                <label style="font-weight: 600; color: #495057; font-size: 14px;">Physical Event ID:</label>
                                <input type="text" value="${physicalEventId}" readonly style="
                                    padding: 10px 12px;
                                    border: 2px solid #e9ecef;
                                    border-radius: 6px;
                                    font-size: 14px;
                                    background: #f8f9fa;
                                    color: #333;
                                    cursor: not-allowed;
                                    font-weight: 500;
                                ">
                            </div>
                        </div>
                        
                        
                        
                        <div class="form-group" style="display: flex; flex-direction: column; gap: 6px;">
                            <label style="font-weight: 600; color: #495057; font-size: 14px;">
                                Account Name: <span style="color: #dc3545;">*</span>
                            </label>
                            <input type="text" id="withdraw-account-name" placeholder="Enter account holder name" required readonly style="
                                padding: 10px 12px;
                                border: 2px solid #e9ecef;
                                border-radius: 6px;
                                font-size: 14px;
                                transition: border-color 0.2s ease;
                                background: #f8f9fa;
                                color: #333;
                                cursor: not-allowed;
                                font-weight: 500;
                            ">
                        </div>
                        
                        <div class="form-group" style="display: flex; flex-direction: column; gap: 6px;">
                            <label style="font-weight: 600; color: #495057; font-size: 14px;">
                                Account Number: <span style="color: #dc3545;">*</span>
                            </label>
                            <input type="text" id="withdraw-account-number" placeholder="Enter 10-digit account number" 
                                   pattern="[0-9]{10}" maxlength="10" required readonly style="
                                padding: 10px 12px;
                                border: 2px solid #e9ecef;
                                border-radius: 6px;
                                font-size: 14px;
                                transition: border-color 0.2s ease;
                                background: #f8f9fa;
                                color: #333;
                                cursor: not-allowed;
                                font-weight: 500;
                            ">
                        </div>
                        
                        <div class="form-group" style="display: flex; flex-direction: column; gap: 6px;">
                            <label style="font-weight: 600; color: #495057; font-size: 14px;">
                                Amount to Withdraw: <span style="color: #dc3545;">*</span>
                            </label>
                            <div class="amount-input" style="position: relative; display: flex; align-items: center;">
                                <span style="position: absolute; left: 12px; color: #6c757d; font-weight: 600; z-index: 1;"></span>
                                <input type="number" id="withdraw-amount" placeholder="Enter amount"
                                       min="1" max="${totalRevenue}" step="1" required
                                       oninput="calculateWithdrawPEEFee(${!requestStatus.canRequest})" style="
                                    padding: 10px 12px 10px 32px;
                                    border: 2px solid #e9ecef;
                                    border-radius: 6px;
                                    font-size: 14px;
                                    transition: border-color 0.2s ease;
                                    width: 100%;
                                    color: #333;
                                cursor: allowed;
                                font-weight: 500;
                                ">
                            </div>
                            <small style="color: #6c757d; font-size: 12px;">
                                Available: ${totalRevenue.toLocaleString()} | Minimum: 500
                            </small>
                        </div>
                        
                        <div class="fee-breakdown" id="pee-fee-breakdown" style="
                            background: #f8f9fa;
                            border: 1px solid #e9ecef;
                            border-radius: 8px;
                            padding: 16px;
                            margin-top: 8px;
                            display: none;
                        ">
                            <div class="fee-row" style="
                                display: flex;
                                justify-content: space-between;
                                align-items: center;
                                padding: 6px 0;
                                border-bottom: 1px solid #e9ecef;
                            ">
                                <span>Withdrawal Amount:</span>
                                <span id="pee-withdrawal-amount">0</span>
                            </div>
                            <div class="fee-row" style="
                                display: flex;
                                justify-content: space-between;
                                align-items: center;
                                padding: 6px 0;
                                border-bottom: 1px solid #e9ecef;
                            ">
                                <span>Processing Fee:</span>
                                <span id="pee-processing-fee">0</span>
                            </div>
                            ${!requestStatus.canRequest ? `
                                <div class="fee-row extra-fee" style="
                                    display: flex;
                                    justify-content: space-between;
                                    align-items: center;
                                    padding: 6px 0;
                                    border-bottom: 1px solid #e9ecef;
                                    color: #dc3545;
                                    font-weight: 600;
                                ">
                                    <span>Extra Request Fee:</span>
                                    <span>${withdrawPEESystem.extraRequestFee.toLocaleString()}</span>
                                </div>
                            ` : ''}
                            <div class="fee-row total" style="
                                display: flex;
                                justify-content: space-between;
                                align-items: center;
                                border-top: 2px solid #dee2e6;
                                margin-top: 8px;
                                padding-top: 12px;
                                background: #d4edda;
                                margin: 8px -16px -16px -16px;
                                padding: 12px 16px;
                                border-radius: 0 0 8px 8px;
                                color: #155724;
                                font-size: 16px;
                            ">
                                                                <span><strong>You'll Receive:</strong></span>
                                <span id="pee-net-amount"><strong>0</strong></span>
                            </div>
                        </div>
                        
                        <div class="checkbox-group" style="margin: 16px 0;">
                            <label style="
                                display: flex;
                                align-items: flex-start;
                                gap: 8px;
                                cursor: pointer;
                                font-size: 14px;
                                line-height: 1.4;
                            ">
                                <input type="checkbox" id="pee-accept-terms" required style="margin-top: 2px;">
                                I agree to the withdrawal terms and confirm all information is correct
                            </label>
                        </div>
                        
                        <div class="form-actions" style="
                            display: flex;
                            gap: 12px;
                            justify-content: flex-end;
                            margin-top: 20px;
                            padding-top: 16px;
                            border-top: 1px solid #e9ecef;
                        ">
                            <button type="button" onclick="closeWithdrawPEEModal()" style="
                                background: #f8f9fa;
                                color: #6c757d;
                                border: 1px solid #e9ecef;
                                padding: 10px 20px;
                                border-radius: 6px;
                                cursor: pointer;
                                font-weight: 600;
                                transition: all 0.2s ease;
                            ">Cancel</button>
                            <button type="submit" style="
                                background: #28a745;
                                color: white;
                                border: none;
                                padding: 10px 20px;
                                border-radius: 6px;
                                cursor: pointer;
                                font-weight: 600;
                                transition: all 0.2s ease;
                                display: flex;
                                align-items: center;
                                gap: 8px;
                            ">
                                <i class="fas fa-paper-plane"></i>
                                Submit Withdrawal Request
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        `;
        
        document.body.appendChild(modal);
        console.log('Modal added to DOM');
        
        // Load saved bank details
        window.currentEventId = physicalEventId;
        loadUserBankDetails();
        
        // Close modal when clicking outside
        modal.addEventListener('click', function(e) {
            if (e.target === modal) {
                closeWithdrawPEEModal();
            }
        });
        
    } catch (error) {
        console.error('Error opening withdraw form:', error);
        showNotification('Failed to open withdrawal form: ' + error.message, 'error');
    }
}

// Calculate withdrawal fee
function calculateWithdrawPEEFee(isExtraRequest = false) {
    try {
        const amountInput = document.getElementById('withdraw-amount');
        const amount = parseFloat(amountInput.value) || 0;
        
        if (amount <= 0) {
            document.getElementById('pee-fee-breakdown').style.display = 'none';
            return;
        }
        
        const processingFee = withdrawPEESystem.getFee(amount);
        const extraFee = isExtraRequest ? withdrawPEESystem.extraRequestFee : 0;
        const totalFee = processingFee + extraFee;
        const netAmount = amount - totalFee;
        
        document.getElementById('pee-withdrawal-amount').textContent = `${amount.toLocaleString()}`;
        document.getElementById('pee-processing-fee').textContent = `${processingFee.toLocaleString()}`;
        document.getElementById('pee-net-amount').textContent = `${netAmount.toLocaleString()}`;
        
        document.getElementById('pee-fee-breakdown').style.display = 'block';
    } catch (error) {
        console.error('Error calculating fee:', error);
    }
}

// Handle withdrawal form submission
async function handleWithdrawPEESubmit(event, physicalEventId, totalRevenue) {
    event.preventDefault();
    
    const submitBtn = event.target.querySelector('button[type="submit"]');
    const originalText = submitBtn.innerHTML;
    
    try {
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
        
        const currentUser = firebase.auth().currentUser;
        if (!currentUser) {
            alert('User not authenticated');
            return;
        }
        
        const amount = parseFloat(document.getElementById('withdraw-amount').value);
        
        // Simple validation
        if (!amount || amount < 500) {
            alert('Minimum withdrawal amount is 500');
            return;
        }
        
        if (amount > totalRevenue) {
            alert('Withdrawal amount exceeds available revenue');
            return;
        }
        
        // Check daily request limits
        const requestStatus = await withdrawPEESystem.canMakeRequest(currentUser.uid);
        const dailyCount = requestStatus.count;
        const isExtraRequest = requestStatus.isExtraRequest;
        
        // Get saved bank details
        const db = firebase.firestore();
        const eventDoc = await db.collection('physicalEvents').doc(physicalEventId).get();
        
        if (!eventDoc.exists) {
            alert('Physical event not found');
            return;
        }
        
        const eventData = eventDoc.data();
        const userBankDetails = eventData.userBankDetails && eventData.userBankDetails[currentUser.uid];
        
        if (!userBankDetails) {
            alert('Please setup your bank details first by clicking "Setup Bank" button');
            return;
        }
        
        // Calculate fee based on daily request count
        const processingFee = calculateDailyFee(dailyCount + 1, amount);
        const extraFee = isExtraRequest ? withdrawPEESystem.extraRequestFee : 0;
        const totalFee = processingFee + extraFee;
        
        // Generate unique request ID
        const requestId = 'withdraw_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        
        // Create withdrawal request data
        const withdrawalData = {
            requestId: requestId,
            userId: currentUser.uid,
            userEmail: currentUser.email,
            eventName: eventData.eventName || 'Physical Event',
            physicalEventId: physicalEventId,
            bank: userBankDetails.bankName,
            accountName: userBankDetails.accountName,
            accountNumber: userBankDetails.accountNumber,
            requestedAmount: amount,
            totalRevenue: totalRevenue,
            processingFee: processingFee,
            extraFee: extraFee,
            totalFee: totalFee,
            netAmount: amount - totalFee,
            dailyRequestNumber: dailyCount + 1,
            isExtraRequest: isExtraRequest,
            status: 'pending',
            createdAt: new Date().toISOString()
        };
        
        // Store withdrawal request in the physical event document
        const eventRef = db.collection('physicalEvents').doc(physicalEventId);
        const currentRequests = eventData.withdrawalRequests || [];
        currentRequests.push(withdrawalData);
        
        // Update total withdrawn (assuming immediate approval for this implementation)
        const currentTotalWithdrawn = eventData.totalWithdrawn || 0;
        const newTotalWithdrawn = currentTotalWithdrawn + amount;
        
        await eventRef.update({
            withdrawalRequests: currentRequests,
            totalWithdrawn: newTotalWithdrawn,
            updatedAt: new Date().toISOString()
        });
        
        closeWithdrawPEEModal();
        
        // Use global notification system
        const netAmount = amount - totalFee;
        const details = `
            <div style="color: rgba(255, 255, 255, 0.8); font-size: 14px;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                    <span>Requested Amount:</span>
                    <span style="color: white; font-weight: 600;">${amount.toLocaleString()}</span>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                    <span>Total Fees:</span>
                    <span style="color: #ffc107; font-weight: 600;">${totalFee.toLocaleString()}</span>
                </div>
                <div style="display: flex; justify-content: space-between; padding-top: 8px; border-top: 1px solid rgba(255, 255, 255, 0.2); color: white; font-weight: 700;">
                    <span>You'll Receive:</span>
                    <span style="color: #28a745;">${netAmount.toLocaleString()}</span>
                </div>
            </div>
        `;
        
        showSuccess(
            'Withdrawal Request Submitted!',
            'Your request has been successfully submitted for processing.',
            details,
            () => loadUserPhysicalEvents() // Refresh events when closed
        );
        
    } catch (error) {
        console.error('Withdrawal submission error:', error);
        showError('Withdrawal Failed', error.message || 'An unexpected error occurred while processing your withdrawal request.');
    } finally {
        submitBtn.disabled = false;
        submitBtn.innerHTML = originalText;
    }
}

// Get daily withdrawal count for fee calculation
async function getDailyWithdrawalCount(userId) {
    try {
        const today = new Date().toISOString().split('T')[0];
        const db = firebase.firestore();
        
        // Get all physical events to check withdrawal requests
        const snapshot = await db.collection('physicalEvents').get();
        let count = 0;
        
        snapshot.forEach(doc => {
            const data = doc.data();
            if (data.withdrawalRequests && Array.isArray(data.withdrawalRequests)) {
                data.withdrawalRequests.forEach(request => {
                    if (request.userId === userId && request.createdAt.startsWith(today)) {
                        count++;
                    }
                });
            }
        });
        
        return count;
    } catch (error) {
        console.error('Error getting daily count:', error);
        return 0;
    }
}

// Calculate fee based on daily request number
function calculateDailyFee(requestNumber, amount) {
    if (requestNumber <= 3) {
        // First 3 requests: normal fee based on amount
        if (amount < 10000) return 100;
        if (amount >= 10000 && amount < 20000) return 300;
        return 500;
    } else if (requestNumber <= 8) {
        // Requests 4-8: fixed fee of 500
        return 500;
    } else if (requestNumber <= 15) {
        // Requests 9-15: fixed fee of 1000
        return 1000;
    } else {
        // Requests 16+: fixed fee of 2000
        return 2000;
    }
}



// Validate withdrawal request
async function validateWithdrawPEERequest(formData, physicalEventId, totalRevenue, userId) {
    try {
        // Check if user has saved bank details
        const db = firebase.firestore();
        const eventDoc = await db.collection('physicalEvents').doc(physicalEventId).get();
        if (!eventDoc.exists) {
            return { isValid: false, error: 'Physical event not found' };
        }
        
        const eventData = eventDoc.data();
        const userBankDetails = eventData.userBankDetails && eventData.userBankDetails[userId];
        
        if (!userBankDetails) {
            return { isValid: false, error: 'Please setup your bank details first by clicking "Setup Bank" button' };
        }
        
        // 500 minimum validation
        if (!formData.amount || formData.amount < 500) {
            return { isValid: false, error: 'Minimum withdrawal amount is 500' };
        }
        
        // Check if amount is less than or equal to available revenue
        if (formData.amount > totalRevenue) {
            return { isValid: false, error: 'Withdrawal amount exceeds available revenue' };
        }
        
        return { isValid: true };
        
    } catch (error) {
        console.error('Validation error:', error);
        return { isValid: false, error: 'Failed to validate withdrawal request' };
    }
}

// Close withdraw modal
function closeWithdrawPEEModal() {
    const modal = document.getElementById('withdraw-pee-modal');
    if (modal) {
        modal.remove();
        console.log('Modal closed');
    }
}

// Custom success message for withdrawal
function showWithdrawPEESuccess(amount, totalFee) {
    const successModal = document.createElement('div');
    successModal.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(26, 26, 46, 0.9);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 10001;
        backdrop-filter: blur(5px);
    `;
    
    const netAmount = amount - totalFee;
    
    successModal.innerHTML = `
        <div style="
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border-radius: 16px;
            padding: 40px 30px;
            max-width: 450px;
            width: 90%;
            text-align: center;
            border: 2px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        ">
            <div style="
                width: 80px;
                height: 80px;
                background: linear-gradient(135deg, #28a745, #20c997);
                border-radius: 50%;
                margin: 0 auto 20px auto;
                display: flex;
                align-items: center;
                justify-content: center;
                animation: successPulse 2s ease-in-out infinite;
            ">
                <i class="fas fa-check" style="color: white; font-size: 36px;"></i>
            </div>
            
            <h2 style="
                color: white;
                margin: 0 0 10px 0;
                font-size: 24px;
                font-weight: 700;
            ">Withdrawal Request Submitted!</h2>
            
            <p style="
                color: rgba(255, 255, 255, 0.8);
                margin: 0 0 30px 0;
                font-size: 16px;
                line-height: 1.5;
            ">Your request has been successfully submitted for processing.</p>
            
            <div style="
                background: rgba(255, 255, 255, 0.1);
                border-radius: 12px;
                padding: 20px;
                margin: 20px 0;
                border: 1px solid rgba(255, 255, 255, 0.2);
            ">
                <div style="
                    display: flex;
                    justify-content: space-between;
                    margin-bottom: 10px;
                    color: rgba(255, 255, 255, 0.8);
                    font-size: 14px;
                ">
                    <span>Requested Amount:</span>
                    <span style="color: white; font-weight: 600;">${amount.toLocaleString()}</span>
                </div>
                <div style="
                    display: flex;
                    justify-content: space-between;
                    margin-bottom: 10px;
                    color: rgba(255, 255, 255, 0.8);
                    font-size: 14px;
                ">
                    <span>Total Fees:</span>
                    <span style="color: #ffc107; font-weight: 600;">${totalFee.toLocaleString()}</span>
                </div>
                <div style="
                    display: flex;
                    justify-content: space-between;
                    padding-top: 10px;
                    border-top: 1px solid rgba(255, 255, 255, 0.2);
                    color: white;
                    font-size: 16px;
                    font-weight: 700;
                ">
                    <span>You'll Receive:</span>
                    <span style="color: #28a745;">${netAmount.toLocaleString()}</span>
                </div>
            </div>
            
            <button onclick="closeSuccessModal()" style="
                background: linear-gradient(135deg, #28a745, #20c997);
                color: white;
                border: none;
                padding: 12px 30px;
                border-radius: 8px;
                font-size: 16px;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.3s ease;
                min-width: 120px;
            " onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                <i class="fas fa-check" style="margin-right: 8px;"></i>
                Okay
            </button>
        </div>
        
        <style>
            @keyframes successPulse {
                0%, 100% { transform: scale(1); }
                50% { transform: scale(1.05); }
            }
        </style>
    `;
    
    document.body.appendChild(successModal);
    
    // Auto-close after 10 seconds
    setTimeout(() => {
        if (successModal.parentElement) {
            successModal.remove();
        }
    }, 10000);
}

// Close success modal
function closeSuccessModal() {
    const modal = document.querySelector('div[style*="position: fixed"][style*="z-index: 10001"]');
    if (modal) {
        modal.remove();
    }
}          
                         


// Global notification system for all app messages
function showGlobalNotification(options) {
    const {
        title,
        message,
        type = 'info', // success, error, warning, info
        details = null, // optional detailed breakdown
        autoClose = true,
        duration = 5000,
        onClose = null
    } = options;

    // Remove any existing notifications
    const existing = document.querySelector('.global-notification-modal');
    if (existing) existing.remove();

    const notificationModal = document.createElement('div');
    notificationModal.className = 'global-notification-modal';
    notificationModal.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(26, 26, 46, 0.9);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 10001;
        backdrop-filter: blur(5px);
        animation: fadeIn 0.3s ease-out;
    `;

    // Get type-specific styling
    const typeConfig = {
        success: {
            color: '#28a745',
            icon: 'fas fa-check-circle',
            gradient: 'linear-gradient(135deg, #28a745, #20c997)'
        },
        error: {
            color: '#dc3545',
            icon: 'fas fa-exclamation-circle',
            gradient: 'linear-gradient(135deg, #dc3545, #c82333)'
        },
        warning: {
            color: '#ffc107',
            icon: 'fas fa-exclamation-triangle',
            gradient: 'linear-gradient(135deg, #ffc107, #e0a800)'
        },
        info: {
            color: '#17a2b8',
            icon: 'fas fa-info-circle',
            gradient: 'linear-gradient(135deg, #17a2b8, #138496)'
        }
    };

    const config = typeConfig[type] || typeConfig.info;

    notificationModal.innerHTML = `
        <div style="
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border-radius: 16px;
            padding: 40px 30px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            border: 2px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            animation: slideIn 0.4s ease-out;
        ">
            <div style="
                width: 80px;
                height: 80px;
                background: ${config.gradient};
                border-radius: 50%;
                margin: 0 auto 20px auto;
                display: flex;
                align-items: center;
                justify-content: center;
                animation: iconPulse 2s ease-in-out infinite;
            ">
                <i class="${config.icon}" style="color: white; font-size: 36px;"></i>
            </div>
            
            <h2 style="
                color: white;
                margin: 0 0 10px 0;
                font-size: 24px;
                font-weight: 700;
            ">${title}</h2>
            
            <p style="
                color: rgba(255, 255, 255, 0.8);
                margin: 0 0 ${details ? '20px' : '30px'} 0;
                font-size: 16px;
                line-height: 1.5;
            ">${message}</p>
            
            ${details ? `
                <div style="
                    background: rgba(255, 255, 255, 0.1);
                    border-radius: 12px;
                    padding: 20px;
                    margin: 20px 0 30px 0;
                    border: 1px solid rgba(255, 255, 255, 0.2);
                    text-align: left;
                ">
                    ${details}
                </div>
            ` : ''}
            
            <button onclick="closeGlobalNotification(${onClose ? 'true' : 'false'})" style="
                background: ${config.gradient};
                color: white;
                border: none;
                padding: 12px 30px;
                border-radius: 8px;
                font-size: 16px;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.3s ease;
                min-width: 120px;
            " onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                <i class="fas fa-check" style="margin-right: 8px;"></i>
                Okay
            </button>
        </div>
        
        <style>
            @keyframes fadeIn {
                from { opacity: 0; }
                to { opacity: 1; }
            }
            @keyframes slideIn {
                from { transform: translateY(-30px); opacity: 0; }
                to { transform: translateY(0); opacity: 1; }
            }
            @keyframes iconPulse {
                0%, 100% { transform: scale(1); }
                50% { transform: scale(1.05); }
            }
        </style>
    `;

    document.body.appendChild(notificationModal);

    // Store callback for close function
    if (onClose) {
        window.globalNotificationCallback = onClose;
    }

    // Auto-close functionality
    if (autoClose) {
        setTimeout(() => {
            if (notificationModal.parentElement) {
                closeGlobalNotification(onClose ? true : false);
            }
        }, duration);
    }
}

// Close global notification
function closeGlobalNotification(executeCallback = false) {
    const modal = document.querySelector('.global-notification-modal');
    if (modal) {
        modal.style.animation = 'fadeOut 0.3s ease-out';
        setTimeout(() => {
            modal.remove();
            if (executeCallback && window.globalNotificationCallback) {
                window.globalNotificationCallback();
                window.globalNotificationCallback = null;
            }
        }, 300);
    }
}

// Quick helper functions for common notifications
function showSuccess(title, message, details = null, onClose = null) {
    showGlobalNotification({
        title,
        message,
        type: 'success',
        details,
        onClose
    });
}

function showError(title, message, details = null, onClose = null) {
    showGlobalNotification({
        title,
        message,
        type: 'error',
        details,
        onClose,
        autoClose: false // Errors should require manual close
    });
}

function showWarning(title, message, details = null, onClose = null) {
    showGlobalNotification({
        title,
        message,
        type: 'warning',
        details,
        onClose
    });
}

function showInfo(title, message, details = null, onClose = null) {
    showGlobalNotification({
        title,
        message,
        type: 'info',
        details,
        onClose
    });
}

// Simple Toast Notification System
function showToast(message, type = 'success', duration = 3000) {
    // Remove existing toasts
    const existingToasts = document.querySelectorAll('.app-toast');
    existingToasts.forEach(toast => toast.remove());

    const toast = document.createElement('div');
    toast.className = 'app-toast';
    
    const colors = {
        success: '#28a745',
        error: '#dc3545', 
        warning: '#ffc107',
        info: '#17a2b8'
    };
    
    const icons = {
        success: 'fas fa-check-circle',
        error: 'fas fa-exclamation-circle',
        warning: 'fas fa-exclamation-triangle', 
        info: 'fas fa-info-circle'
    };

    toast.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        color: white;
        padding: 16px 20px;
        border-radius: 8px;
        border-left: 4px solid ${colors[type] || colors.success};
        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        z-index: 10000;
        max-width: 400px;
        font-family: Arial, sans-serif;
        font-size: 14px;
        display: flex;
        align-items: center;
        gap: 10px;
        animation: slideInRight 0.3s ease-out;
    `;

    toast.innerHTML = `
        <i class="${icons[type] || icons.success}" style="color: ${colors[type] || colors.success}; font-size: 16px;"></i>
        <span style="flex: 1;">${message}</span>
        <button onclick="this.parentElement.remove()" style="
            background: none;
            border: none;
            color: rgba(255,255,255,0.7);
            cursor: pointer;
            font-size: 18px;
            padding: 0;
            margin-left: 8px;
        ">&times;</button>
        
        <style>
            @keyframes slideInRight {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOutRight {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        </style>
    `;

    document.body.appendChild(toast);

    // Auto remove after duration
    setTimeout(() => {
        if (toast.parentElement) {
            toast.style.animation = 'slideOutRight 0.3s ease-out';
            setTimeout(() => toast.remove(), 300);
        }
    }, duration);
}

// Quick toast helpers
function toastSuccess(message, duration = 3000) {
    showToast(message, 'success', duration);
}

function toastError(message, duration = 5000) {
    showToast(message, 'error', duration);
}

function toastWarning(message, duration = 4000) {
    showToast(message, 'warning', duration);
}

function toastInfo(message, duration = 3000) {
    showToast(message, 'info', duration);
}



console.log('Withdraw PEE system loaded successfully');


// Simple and reliable withdrawal history function
function openWithdrawalHistory() {
    console.log('Opening withdrawal history...');
    
    // Remove existing modal
    const existingModal = document.getElementById('withdrawalHistoryModal');
    if (existingModal) {
        existingModal.remove();
    }
    
    // Create modal HTML
    const modalHTML = `
        <div id="withdrawalHistoryModal" style="
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            backdrop-filter: blur(5px);
        ">
            <div style="
                background: #fff;
                border-radius: 15px;
                width: 90%;
                max-width: 800px;
                max-height: 90vh;
                overflow-y: auto;
                position: relative;
            ">
                <!-- Header -->
                <div style="
                    padding: 20px;
                    border-bottom: 1px solid #eee;
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    background: #f8f9fa;
                    border-radius: 15px 15px 0 0;
                    position: sticky;
                    top: 0;
                    z-index: 1;
                ">
                    <h2 style="margin: 0; color: #333; font-size: 20px;">
                        <i class="fas fa-history" style="margin-right: 10px; color: #6c5ce7;"></i>
                        Withdrawal History
                    </h2>
                    <button onclick="closeWithdrawalHistory()" style="
                        background: #ff4757;
                        color: white;
                        border: none;
                        width: 35px;
                        height: 35px;
                        border-radius: 50%;
                        cursor: pointer;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        font-size: 18px;
                    ">&times;</button>
                </div>
                
                <!-- Content -->
                <div style="padding: 20px;">
                    <div id="withdrawalHistoryContent">
                        <div style="text-align: center; padding: 40px;">
                            <i class="fas fa-spinner fa-spin" style="font-size: 32px; color: #6c5ce7; margin-bottom: 15px;"></i>
                            <p style="color: #666;">Loading withdrawal history...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    `;
    
    document.body.insertAdjacentHTML('beforeend', modalHTML);
    
    // Load data immediately with timeout
    loadWithdrawalHistoryWithTimeout();
}

// Load withdrawal history with timeout and multiple collection checks
async function loadWithdrawalHistoryWithTimeout() {
    const contentDiv = document.getElementById('withdrawalHistoryContent');
    const currentUser = firebase.auth().currentUser;
    
    if (!currentUser) {
        contentDiv.innerHTML = `
            <div style="text-align: center; padding: 40px; color: #e74c3c;">
                <i class="fas fa-user-times" style="font-size: 48px; margin-bottom: 20px;"></i>
                <h3>Authentication Required</h3>
                <p>Please sign in to view withdrawal history.</p>
            </div>
        `;
        return;
    }
    
    console.log('Loading withdrawal history for user:', currentUser.uid);
    
    try {
        const db = firebase.firestore();
        
        // Set timeout to prevent infinite loading
        const timeoutPromise = new Promise((_, reject) => 
            setTimeout(() => reject(new Error('Loading timeout')), 10000)
        );
        
        // Try multiple collections to find withdrawal data
        const queries = [
            db.collection('Phywithdrawalpee').where('userId', '==', currentUser.uid).get(),
            db.collection('withdrawalHistory').where('userId', '==', currentUser.uid).get(),
            db.collection('withdrawalRequests').where('userId', '==', currentUser.uid).get()
        ];
        
        console.log('Querying withdrawal collections...');
        
        // Race against timeout
        const results = await Promise.race([
            Promise.allSettled(queries),
            timeoutPromise
        ]);
        
        console.log('Query results:', results);
        
        let allWithdrawals = [];
        let foundData = false;
        
        // Process results from all collections
        results.forEach((result, index) => {
            if (result.status === 'fulfilled' && !result.value.empty) {
                console.log(`Found data in collection ${index}:`, result.value.size, 'documents');
                foundData = true;
                
                result.value.forEach(doc => {
                    const data = { id: doc.id, ...doc.data(), source: ['Phywithdrawalpee', 'withdrawalHistory', 'withdrawalRequests'][index] };
                    allWithdrawals.push(data);
                });
            }
        });
        
        if (!foundData) {
            console.log('No withdrawal data found in any collection');
            contentDiv.innerHTML = `
                <div style="text-align: center; padding: 60px; color: #666;">
                    <i class="fas fa-receipt" style="font-size: 64px; margin-bottom: 20px; opacity: 0.3; color: #6c5ce7;"></i>
                    <h3 style="margin-bottom: 10px; color: #333; font-size: 24px;">No Withdrawal History</h3>
                    <p style="font-size: 16px; margin-bottom: 20px;">You haven't made any withdrawal requests yet.</p>
                    <button onclick="closeWithdrawalHistory()" style="
                        background: #6c5ce7;
                        color: white;
                        border: none;
                        padding: 12px 24px;
                        border-radius: 8px;
                        cursor: pointer;
                        font-size: 14px;
                        font-weight: 600;
                    ">Make Your First Withdrawal</button>
                </div>
            `;
            return;
        }
        
        // Sort by date
        allWithdrawals.sort((a, b) => {
            const getDate = (item) => {
                if (item.createdAt) {
                    return item.createdAt.toDate ? item.createdAt.toDate() : new Date(item.createdAt);
                }
                return new Date();
            };
            return getDate(b) - getDate(a);
        });
        
        console.log('Displaying', allWithdrawals.length, 'withdrawal records');
        
        // Display the data
        displayWithdrawalHistory(allWithdrawals);
        
    } catch (error) {
        console.error('Error loading withdrawal history:', error);
        contentDiv.innerHTML = `
            <div style="text-align: center; padding: 40px; color: #e74c3c;">
                <i class="fas fa-exclamation-triangle" style="font-size: 48px; margin-bottom: 20px;"></i>
                <h3 style="margin-bottom: 10px;">Error Loading History</h3>
                <p style="margin-bottom: 20px;">${error.message}</p>
                <button onclick="loadWithdrawalHistoryWithTimeout()" style="
                    background: #6c5ce7;
                    color: white;
                    border: none;
                    padding: 10px 20px;
                    border-radius: 8px;
                    cursor: pointer;
                    margin-right: 10px;
                ">Try Again</button>
                <button onclick="createTestWithdrawal()" style="
                    background: #28a745;
                    color: white;
                    border: none;
                    padding: 10px 20px;
                    border-radius: 8px;
                    cursor: pointer;
                ">Create Test Data</button>
            </div>
        `;
    }
}

// Display withdrawal history
function displayWithdrawalHistory(withdrawals) {
    const contentDiv = document.getElementById('withdrawalHistoryContent');
    
    let historyHTML = `
        <div style="margin-bottom: 20px; text-align: center;">
            <span style="background: #6c5ce7; color: white; padding: 8px 16px; border-radius: 20px; font-size: 14px; font-weight: 600;">
                ${withdrawals.length} Withdrawal${withdrawals.length !== 1 ? 's' : ''} Found
            </span>
        </div>
    `;
    
    withdrawals.forEach(data => {
        const date = data.createdAt ? 
            (data.createdAt.toDate ? data.createdAt.toDate() : new Date(data.createdAt)) : 
            new Date();
        
        // Status styling
        let statusColor, statusIcon, statusText;
        const status = data.status || 'pending';
        switch (status.toLowerCase()) {
            case 'pending':
                statusColor = '#f39c12';
                statusIcon = 'fas fa-clock';
                statusText = 'Pending';
                break;
            case 'success':
            case 'completed':
            case 'approved':
                statusColor = '#27ae60';
                statusIcon = 'fas fa-check-circle';
                statusText = 'Success';
                   break;
            case 'failed':
            case 'rejected':
            case 'cancelled':
                statusColor = '#e74c3c';
                statusIcon = 'fas fa-times-circle';
                statusText = 'Failed';
                break;
            default:
                statusColor = '#95a5a6';
                statusIcon = 'fas fa-question-circle';
                statusText = status;
        }
        
        historyHTML += `
            <div style="
                border: 1px solid #eee;
                border-radius: 10px;
                padding: 20px;
                margin-bottom: 15px;
                background: #fafafa;
                box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            ">
                <!-- Header -->
                <div style="
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    margin-bottom: 15px;
                    padding-bottom: 10px;
                    border-bottom: 1px solid #ddd;
                ">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <i class="${statusIcon}" style="color: ${statusColor}; font-size: 20px;"></i>
                        <span style="font-weight: 600; color: ${statusColor}; font-size: 16px;">${statusText}</span>
                        <small style="background: #e9ecef; padding: 2px 6px; border-radius: 10px; font-size: 10px; color: #666;">
                            ${data.source || 'Unknown'}
                        </small>
                    </div>
                    <div style="font-size: 13px; color: #666;">
                        ${date.toLocaleDateString()} ${date.toLocaleTimeString()}
                    </div>
                </div>
                
                <!-- Details Grid -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <div>
                        <strong style="color: #333; display: block; margin-bottom: 5px;">Amount</strong>
                        <span style="color: #333; font-size: 18px; font-weight: 600;">${(data.amount || 0).toLocaleString()}</span>
                    </div>
                    
                    <div>
                        <strong style="color: #333; display: block; margin-bottom: 5px;">Bank Details</strong>
                        <div style="color: #666; line-height: 1.4; font-size: 14px;">
                            <div>${data.bankName || 'N/A'}</div>
                            <div>${data.accountNumber || 'N/A'}</div>
                            <div>${data.accountName || 'N/A'}</div>
                        </div>
                    </div>
                    
                    <div>
                        <strong style="color: #333; display: block; margin-bottom: 5px;">Fees</strong>
                        <div style="color: #666; line-height: 1.4; font-size: 14px;">
                            <div>Processing: ${(data.fee || data.processingFee || 0).toLocaleString()}</div>
                            ${(data.extraFee || 0) > 0 ? `<div>Extra: ${data.extraFee.toLocaleString()}</div>` : ''}
                        </div>
                    </div>
                </div>
                
                <!-- Transaction ID -->
                <div style="margin-top: 15px; padding-top: 10px; border-top: 1px solid #eee;">
                    <small style="color: #666;">
                        ID: ${data.transactionId || data.id}
                        ${data.eventName ? `  Event: ${data.eventName}` : ''}
                    </small>
                </div>
            </div>
        `;
    });
    
    contentDiv.innerHTML = historyHTML;
}

// Test function to create sample withdrawal data
async function createTestWithdrawal() {
    const currentUser = firebase.auth().currentUser;
    if (!currentUser) return;
    
    try {
        const db = firebase.firestore();
        
        const testData = {
            userId: currentUser.uid,
            amount: 5000,
            bankName: 'Test Bank',
            accountNumber: '1234567890',
            accountName: 'Test User',
            fee: 100,
            extraFee: 0,
            status: 'pending',
            transactionId: 'TEST' + Date.now(),
            createdAt: firebase.firestore.FieldValue.serverTimestamp(),
            eventName: 'Test Event'
        };
        
        await db.collection('Phywithdrawalpee').add(testData);
        
        console.log('Test withdrawal created');
        
        // Reload the history
        setTimeout(() => {
            loadWithdrawalHistoryWithTimeout();
        }, 1000);
        
    } catch (error) {
        console.error('Error creating test withdrawal:', error);
    }
}

// Close modal
function closeWithdrawalHistory() {
    const modal = document.getElementById('withdrawalHistoryModal');
    if (modal) {
        modal.remove();
    }
}



// Function to update total revenue after withdrawal
async function updateTotalRevenueAfterWithdrawal(physicalEventId, withdrawnAmount, userId) {
    try {
        const db = firebase.firestore();
        const eventRef = db.collection('physicalEvents').doc(physicalEventId);
        
        console.log(`Updating revenue for event ${physicalEventId}: -${withdrawnAmount.toLocaleString()}`);
        
        // Get current event data
        const eventDoc = await eventRef.get();
        if (!eventDoc.exists) {
            throw new Error('Physical event not found');
        }
        
        const eventData = eventDoc.data();
        
        // Calculate current total revenue from tickets
        const currentRevenue = calculateTotalRevenue(eventData.tickets || []);
        const previousWithdrawals = eventData.totalWithdrawn || 0;
        const newTotalWithdrawals = previousWithdrawals + withdrawnAmount;
        const newAvailableRevenue = Math.max(0, currentRevenue - newTotalWithdrawals);
        
        // Update the event document
        await eventRef.update({
            totalWithdrawn: newTotalWithdrawals,
            lastWithdrawal: {
                amount: withdrawnAmount,
                userId: userId,
                date: firebase.firestore.FieldValue.serverTimestamp(),
                previousTotal: previousWithdrawals,
                newTotal: newTotalWithdrawals
            },
            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        
        // Update the UI immediately
        updateRevenueDisplayInUI(physicalEventId, currentRevenue, newTotalWithdrawals, newAvailableRevenue);
        
        console.log(`Revenue updated successfully:
            Total Revenue: ${currentRevenue.toLocaleString()}
            Total Withdrawn: ${newTotalWithdrawals.toLocaleString()}
            Available: ${newAvailableRevenue.toLocaleString()}`);
        
        return {
            success: true,
            totalRevenue: currentRevenue,
            totalWithdrawn: newTotalWithdrawals,
            availableRevenue: newAvailableRevenue
        };
        
    } catch (error) {
        console.error('Error updating total revenue:', error);
        throw error;
    }
}

// Function to update revenue display in UI
function updateRevenueDisplayInUI(physicalEventId, totalRevenue, totalWithdrawn, availableRevenue) {
    // Find the event card in the UI
    const eventCard = document.querySelector(`[data-event-id="${physicalEventId}"]`);
    if (!eventCard) {
        console.log('Event card not found in UI');
        return;
    }
    
    // Update total revenue display
    const revenueElement = eventCard.querySelector('.stat-card .stat-value');
    if (revenueElement && revenueElement.textContent.includes('')) {
        revenueElement.textContent = `${availableRevenue.toLocaleString()}`;
        
        // Add visual feedback for the update
        revenueElement.style.background = '#e8f5e8';
        revenueElement.style.transition = 'background 0.5s ease';
        setTimeout(() => {
            revenueElement.style.background = '';
        }, 2000);
    }
   
async function updateTotalRevenueAfterWithdrawal(physicalEventId, withdrawnAmount) {
    try {
        const db = firebase.firestore();
        const eventRef = db.collection('physicalEvents').doc(physicalEventId);
        
        // Get current event data
        const eventDoc = await eventRef.get();
        if (!eventDoc.exists) {
            throw new Error('Event not found');
        }
        
        const eventData = eventDoc.data();
        const currentRevenue = eventData.totalRevenue || 0;
        const newRevenue = Math.max(0, currentRevenue - withdrawnAmount);
        
        // Update the revenue
        await eventRef.update({
            totalRevenue: newRevenue,
            lastWithdrawal: {
                amount: withdrawnAmount,
                date: firebase.firestore.FieldValue.serverTimestamp(),
                newBalance: newRevenue
            }
        });
        
        // Update the UI
        const revenueElement = document.querySelector(`[data-event-id="${physicalEventId}"] .revenue-amount`);
        if (revenueElement) {
            revenueElement.textContent = `${newRevenue.toLocaleString()}`;
        }
        
        console.log(`Revenue updated: ${currentRevenue.toLocaleString()}  ${newRevenue.toLocaleString()}`);
        
    } catch (error) {
        console.error('Error updating revenue:', error);
    }
}
    // Update withdrawn amount display
    const withdrawnElement = eventCard.querySelector(`#withdraw-${physicalEventId}`);
    if (withdrawnElement) {
        withdrawnElement.textContent = `${totalWithdrawn.toLocaleString()}`;
        
        // Add visual feedback
        withdrawnElement.style.color = '#e74c3c';
        withdrawnElement.style.fontWeight = 'bold';
        setTimeout(() => {
            withdrawnElement.style.color = '';
            withdrawnElement.style.fontWeight = '';
        }, 3000);
    }
    
    // Update any withdrawal buttons with new available amount
    const withdrawButtons = eventCard.querySelectorAll('[onclick*="openWithdrawPEEForm"]');
    withdrawButtons.forEach(button => {
        // Update button onclick with new available revenue
        const onclickAttr = button.getAttribute('onclick');
        if (onclickAttr) {
            const updatedOnclick = onclickAttr.replace(/,\s*\d+(\.\d+)?\)$/, `, ${availableRevenue})`);
            button.setAttribute('onclick', updatedOnclick);
        }
    });
    
    console.log(`UI updated for event ${physicalEventId}`);
}
// ========================================
// BANK DETAILS SETUP SYSTEM FOR PHYSICAL EVENTS
// ========================================

// Global variable for current event being processed
let currentBankSetupEventId = null;

// Check if current time is within support hours (12pm to 6pm)
function isSupportHours() {
    const now = new Date();
    const currentHour = now.getHours();
    return currentHour >= 12 && currentHour < 18;
}

// Main function to open bank setup form (called from event card button)
async function openBankSetupForm(eventId) {
    currentBankSetupEventId = eventId;
    
    try {
        // Check if user is authenticated
        const currentUser = firebase.auth().currentUser;
        if (!currentUser) {
            showBankNotification('Please sign in to setup bank details', 'error');
            return;
        }

        // Check if bank details already exist
        const existingBankDetails = await checkExistingBankDetails(eventId, currentUser.uid);
        
        if (existingBankDetails && !isSupportHours()) {
            // Bank details exist and it's not support hours
            showBankDetailsAlreadySetModal(existingBankDetails);
            return;
        }

   
    
   
   
      
      

        // Create and show bank setup modal
        createBankSetupModal(existingBankDetails);
        
    } catch (error) {
        console.error('Error opening bank setup form:', error);
        showBankNotification('Error opening bank setup form: ' + error.message, 'error');
    }
}

// Check if bank details already exist for this event and user
async function checkExistingBankDetails(eventId, userId) {
    try {
        const db = firebase.firestore();
        const eventDoc = await db.collection('physicalEvents').doc(eventId).get();
        
        if (eventDoc.exists) {
            const eventData = eventDoc.data();
            return eventData.userBankDetails && eventData.userBankDetails[userId];
        }
        
        return null;
    } catch (error) {
        console.error('Error checking existing bank details:', error);
        return null;
    }
}

// Create bank setup modal with inline CSS (matching your code style)
function createBankSetupModal(existingDetails = null) {
    // Remove any existing modals
    const existingModal = document.getElementById('bank-setup-modal');
    if (existingModal) {
        existingModal.remove();
    }

    const isEditing = existingDetails !== null;
    const canEdit = !existingDetails || isSupportHours();

    const modal = document.createElement('div');
    modal.id = 'bank-setup-modal';
    modal.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 10000;
    `;

    modal.innerHTML = `
        <div class="modal-content" style="
            background: white;
            border-radius: 12px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        ">
            <div class="modal-header" style="
                padding: 20px;
                border-bottom: 1px solid #e9ecef;
                display: flex;
                justify-content: space-between;
                align-items: center;
            ">
                <h3 style="margin: 0; color: #495057;">
                    <i class="fas fa-university" style="color: #007bff; margin-right: 8px;"></i>
                    ${isEditing ? 'Update Bank Details' : 'Setup Bank Details'}
                </h3>
                <button onclick="closeBankSetupModal()" style="
                    background: none;
                    border: none;
                    font-size: 24px;
                    cursor: pointer;
                    color: #6c757d;
                    padding: 0;
                    width: 30px;
                    height: 30px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                ">&times;</button>
            </div>
            
            <div class="modal-body" style="padding: 20px;">
                ${!canEdit ? `
                    <div class="warning-box" style="
                        background: #fff3cd;
                        border: 1px solid #ffeaa7;
                        border-radius: 8px;
                        padding: 16px;
                        margin-bottom: 20px;
                        display: flex;
                        align-items: flex-start;
                        gap: 12px;
                    ">
                        <i class="fas fa-clock" style="color: #856404; font-size: 20px; margin-top: 2px;"></i>
                        <div>
                            <strong style="color: #856404; display: block; margin-bottom: 4px;">Bank Details Already Set</strong>
                            <p style="color: #856404; margin: 0; font-size: 14px;">
                                Bank details can only be modified during support hours (12pm - 6pm). 
                                Contact us during these hours for changes.
                            </p>
                        </div>
                    </div>
                ` : ''}
                
                ${isEditing && canEdit ? `
                    <div class="info-box" style="
                        background: #d1ecf1;
                        border: 1px solid #bee5eb;
                        border-radius: 8px;
                        padding: 12px 16px;
                        margin-bottom: 20px;
                        display: flex;
                        align-items: center;
                        gap: 8px;
                        color: #0c5460;
                        font-size: 14px;
                    ">
                        <i class="fas fa-info-circle" style="color: #17a2b8;"></i>
                        <span>Support hours (12pm - 6pm): You can update your bank details.</span>
                    </div>
                ` : ''}

                <form onsubmit="submitBankDetails(event)" style="
                    display: flex;
                    flex-direction: column;
                    gap: 16px;
                ">
                    <div class="form-group" style="display: flex; flex-direction: column; gap: 6px;">
                        <label style="font-weight: 600; color: #495057; font-size: 14px;">
                            Bank Name: <span style="color: #dc3545;">*</span>
                        </label>
                        <select id="bank-setup-bank" required ${!canEdit ? 'disabled' : ''} style="
                            padding: 10px 12px;
                            border: 2px solid #e9ecef;
                            border-radius: 6px;
                            font-size: 14px;
                            transition: border-color 0.2s ease;
                            ${!canEdit ? 'background: #f8f9fa; cursor: not-allowed;' : ''}
                        ">
                            <option value="">Select your bank</option>
                            ${nigerianBanks.map(bank => `<option value="${bank}">${bank}</option>`).join('')}
                        </select>
                    </div>

                    <div class="form-group" style="display: flex; flex-direction: column; gap: 6px;">
                        <label style="font-weight: 600; color: #495057; font-size: 14px;">
                            Account Number: <span style="color: #dc3545;">*</span>
                        </label>
                        <input type="text" 
                               id="bank-setup-account" 
                               placeholder="Enter 10-digit account number" 
                               pattern="[0-9]{10}" 
                               maxlength="10" 
                               required 
                               ${!canEdit ? 'disabled' : ''}
                               style="
                                   padding: 10px 12px;
                                   border: 2px solid #e9ecef;
                                   border-radius: 6px;
                                   font-size: 14px;
                                   transition: border-color 0.2s ease;
                                   ${!canEdit ? 'background: #f8f9fa; cursor: not-allowed;' : ''}
                               ">
                        <small style="color: #6c757d; font-size: 12px;">Must be exactly 10 digits</small>
                    </div>

                    <div class="form-group" style="display: flex; flex-direction: column; gap: 6px;">
                        <label style="font-weight: 600; color: #495057; font-size: 14px;">
                            Account Name: <span style="color: #dc3545;">*</span>
                        </label>
                        <input type="text" 
                               id="bank-setup-name" 
                               placeholder="Enter account holder name" 
                               required 
                               ${!canEdit ? 'disabled' : ''}
                               style="
                                   padding: 10px 12px;
                                   border: 2px solid #e9ecef;
                                   border-radius: 6px;
                                   font-size: 14px;
                                   transition: border-color 0.2s ease;
                                   ${!canEdit ? 'background: #f8f9fa; cursor: not-allowed;' : ''}
                               ">
                    </div>

                    <div id="bank-setup-error" style="
                        display: none;
                        color: #dc3545;
                        background: #f8d7da;
                        border: 1px solid #f5c6cb;
                        padding: 10px;
                        border-radius: 6px;
                        font-size: 14px;
                    "></div>

                    ${!isEditing ? `
                        <div class="warning-note" style="
                            background: #f8f9fa;
                            border-left: 4px solid #ffc107;
                            padding: 12px;
                            margin: 16px 0;
                            font-size: 13px;
                            color: #495057;
                        ">
                            <strong>Important:</strong> Bank details can only be set once and cannot be changed except during support hours (12pm - 6pm). Please ensure all information is correct.
                        </div>
                    ` : ''}

                    <div class="form-actions" style="
                        display: flex;
                        gap: 12px;
                        justify-content: flex-end;
                        margin-top: 20px;
                        padding-top: 16px;
                        border-top: 1px solid #e9ecef;
                    ">
                        <button type="button" onclick="closeBankSetupModal()" style="
                            background: #f8f9fa;
                            color: #6c757d;
                            border: 1px solid #e9ecef;
                            padding: 10px 20px;
                            border-radius: 6px;
                            cursor: pointer;
                            font-weight: 600;
                            transition: all 0.2s ease;
                        ">Cancel</button>
                        
                        ${canEdit ? `
                            <button type="submit" style="
                                background: #007bff;
                                color: white;
                                border: none;
                                padding: 10px 20px;
                                border-radius: 6px;
                                cursor: pointer;
                                font-weight: 600;
                                transition: all 0.2s ease;
                                display: flex;
                                align-items: center;
                                gap: 8px;
                            ">
                                <i class="fas fa-save"></i>
                                ${isEditing ? 'Update Details' : 'Save Details'}
                            </button>
                        ` : ''}
                    </div>
                </form>
            </div>
        </div>
    `;

    document.body.appendChild(modal);

    // Pre-populate form if editing
    if (existingDetails) {
        setTimeout(() => {
            document.getElementById('bank-setup-bank').value = existingDetails.bankName || '';
            document.getElementById('bank-setup-account').value = existingDetails.accountNumber || '';
            document.getElementById('bank-setup-name').value = existingDetails.accountName || '';
        }, 100);
    }

    // Close modal when clicking outside
    modal.addEventListener('click', function(e) {
        if (e.target === modal) {
            closeBankSetupModal();
        }
    });
}

// Show modal when bank details are already set and it's not support hours
function showBankDetailsAlreadySetModal(bankDetails) {
    const modal = document.createElement('div');
    modal.id = 'bank-details-view-modal';
    modal.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 10000;
    `;

    modal.innerHTML = `
        <div class="modal-content" style="
            background: white;
            border-radius: 12px;
            max-width: 400px;
            width: 90%;
            position: relative;
        ">
            <div class="modal-header" style="
                padding: 20px;
                border-bottom: 1px solid #e9ecef;
                display: flex;
                justify-content: space-between;
                align-items: center;
            ">
                <h3 style="margin: 0; color: #495057;">
                    <i class="fas fa-check-circle" style="color: #28a745; margin-right: 8px;"></i>
                    Bank Details Set
                </h3>
                <button onclick="document.getElementById('bank-details-view-modal').remove()" style="
                    background: none;
                    border: none;
                    font-size: 24px;
                    cursor: pointer;
                    color: #6c757d;
                    padding: 0;
                    width: 30px;
                    height: 30px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                ">&times;</button>
            </div>
            
            <div class="modal-body" style="padding: 20px;">
                <div class="bank-details-display" style="
                    background: #f8f9fa;
                    border: 1px solid #e9ecef;
                    border-radius: 8px;
                    padding: 16px;
                    margin-bottom: 16px;
                ">
                    <div style="display: grid; grid-template-columns: auto 1fr; gap: 8px; align-items: center;">
                        <strong>Bank:</strong>
                        <span>${bankDetails.bankName}</span>
                        <strong>Account:</strong>
                        <span>${bankDetails.accountNumber}</span>
                        <strong>Name:</strong>
                        <span>${bankDetails.accountName}</span>
                    </div>
                </div>
                
                <div class="info-note" style="
                    background: #d1ecf1;
                    border: 1px solid #bee5eb;
                    border-radius: 6px;
                    padding: 12px;
                    font-size: 14px;
                    color: #0c5460;
                    text-align: center;
                ">
                    <i class="fas fa-info-circle" style="margin-right: 6px;"></i>
                    Changes can only be made during support hours (12pm - 6pm)
                </div>
                
                <div style="text-align: center; margin-top: 20px;">
                    <button onclick="document.getElementById('bank-details-view-modal').remove()" style="
                        background: #007bff;
                        color: white;
                        border: none;
                        padding: 10px 20px;
                        border-radius: 6px;
                        cursor: pointer;
                        font-weight: 600;
                        transition: all 0.2s ease;
                    ">OK</button>
                </div>
            </div>
        </div>
    `;

    document.body.appendChild(modal);
}

// Close bank setup modal
function closeBankSetupModal() {
    const modal = document.getElementById('bank-setup-modal');
    if (modal) {
        modal.remove();
    }
    currentBankSetupEventId = null;
}

// Submit bank details form
async function submitBankDetails(event) {
    event.preventDefault();
    
    const submitBtn = event.target.querySelector('button[type="submit"]');
    const originalText = submitBtn.innerHTML;
    
    try {
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
        
        const bank = document.getElementById('bank-setup-bank').value.trim();
        const account = document.getElementById('bank-setup-account').value.trim();
        const name = document.getElementById('bank-setup-name').value.trim();
        const errorDiv = document.getElementById('bank-setup-error');
        
        // Hide previous errors
        errorDiv.style.display = 'none';
        
        // Validation
        if (!bank) {
            throw new Error('Please select a bank');
        }
        
        if (!account || !/^\d{10}$/.test(account)) {
            throw new Error('Account number must be exactly 10 digits');
        }
        
        if (!name || name.length < 2) {
            throw new Error('Please enter a valid account name (minimum 2 characters)');
        }
        
        const currentUser = firebase.auth().currentUser;
        if (!currentUser) {
            throw new Error('Please log in first');
        }
        
        if (!currentBankSetupEventId) {
            throw new Error('No event selected');
        }
        
        // Save to Firebase
        const db = firebase.firestore();
        await db.collection('physicalEvents').doc(currentBankSetupEventId).update({
            [`userBankDetails.${currentUser.uid}`]: {
                bankName: bank,
                accountNumber: account,
                accountName: name,
                savedAt: firebase.firestore.FieldValue.serverTimestamp(),
                eventId: currentBankSetupEventId,
                canEdit: false // Lock the details after first save
            },
            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        
        closeBankSetupModal();
        showBankNotification('Bank details saved successfully!', 'success');
        
        // Refresh events list to show updated status
        setTimeout(() => {
            loadUserPhysicalEvents();
        }, 1000);
        
    } catch (error) {
        console.error('Error saving bank details:', error);
        
        const errorDiv = document.getElementById('bank-setup-error');
        errorDiv.textContent = error.message;
        errorDiv.style.display = 'block';
        
    } finally {
        submitBtn.disabled = false;
        submitBtn.innerHTML = originalText;
    }
}

// Load bank details for withdrawal form auto-population
async function loadUserBankDetails() {
    try {
        const currentUser = firebase.auth().currentUser;
        const eventId = window.currentEventId;
        
        if (!currentUser || !eventId) {
            return;
        }
        
        const db = firebase.firestore();
        const eventDoc = await db.collection('physicalEvents').doc(eventId).get();
        
        if (eventDoc.exists) {
            const eventData = eventDoc.data();
            const userBankDetails = eventData.userBankDetails && eventData.userBankDetails[currentUser.uid];
            
            const bankDetailsDisplay = document.getElementById('bankDetailsDisplay');
            
            if (userBankDetails && bankDetailsDisplay) {
                // Update display with saved bank details
                bankDetailsDisplay.innerHTML = `
                    <div style="display: grid; grid-template-columns: auto 1fr; gap: 8px; align-items: center;">
                        <div style="display: flex; align-items: center; gap: 6px; color: #28a745;">
                            <i class="fas fa-check-circle"></i>
                            <strong>Bank:</strong>
                        </div>
                        <div style="color: #333; font-weight: 500;">${userBankDetails.bankName}</div>
                        <div style="display: flex; align-items: center; gap: 6px; color: #28a745;">
                            <i class="fas fa-check-circle"></i>
                            <strong>Account:</strong>
                        </div>
                        <div style="color: #333; font-weight: 500;">${userBankDetails.accountNumber}</div>
                        <div style="display: flex; align-items: center; gap: 6px; color: #28a745;">
                            <i class="fas fa-check-circle"></i>
                            <strong>Name:</strong>
                        </div>
                        <div style="color: #333; font-weight: 500;">${userBankDetails.accountName}</div>
                    </div>
                `;
                
                // Auto-populate withdrawal form fields
                const bankSelect = document.getElementById('withdraw-bank');
                const accountName = document.getElementById('withdraw-account-name');
                const accountNumber = document.getElementById('withdraw-account-number');
                
                if (bankSelect) {
                    for (let i = 0; i < bankSelect.options.length; i++) {
                        if (bankSelect.options[i].value === userBankDetails.bankName) {
                            bankSelect.selectedIndex = i;
                            break;
                        }
                    }
                }
                if (accountName) accountName.value = userBankDetails.accountName;
                if (accountNumber) accountNumber.value = userBankDetails.accountNumber;
            }
        }
        
    } catch (error) {
        console.error('Error loading bank details:', error);
    }
}

// Show notification for bank setup
function showBankNotification(message, type = 'info') {
    // Remove any existing notifications
    const existingNotifications = document.querySelectorAll('.bank-notification');
    existingNotifications.forEach(notif => notif.remove());
    
    const notification = document.createElement('div');
    notification.className = 'bank-notification';
    notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: ${type === 'success' ? '#d4edda' : type === 'error' ? '#f8d7da' : '#d1ecf1'};
        color: ${type === 'success' ? '#155724' : type === 'error' ? '#721c24' : '#0c5460'};
        border: 1px solid ${type === 'success' ? '#c3e6cb' : type === 'error' ? '#f5c6cb' : '#bee5eb'};
        padding: 12px 20px;
        border-radius: 8px;
        z-index: 10001;
        font-size: 14px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        max-width: 300px;
        display: flex;
        align-items: center;
        gap: 8px;
    `;
    
    const icon = type === 'success' ? 'fa-check-circle' : type === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle';
    notification.innerHTML = `
        <i class="fas ${icon}"></i>
        <span>${message}</span>
        <button onclick="this.parentElement.remove()" style="
            background: none; 
            border: none; 
            color: currentColor; 
            font-size: 16px; 
            cursor: pointer; 
            margin-left: auto;
            opacity: 0.7;
        ">&times;</button>
    `;
    
    document.body.appendChild(notification);
    
    // Auto remove after 5 seconds
    setTimeout(() => {
        if (notification.parentElement) {
            notification.remove();
        }
    }, 5000);
}

console.log('Bank Details Setup System loaded successfully');


// Function to open close event confirmation modal
async function openPhyEventClose(eventId) {
    try {
        console.log('Opening close confirmation for event:', eventId);
        
        // Get event data from Firebase
        if (typeof firebase === 'undefined') {
            throw new Error('Firebase not available');
        }
        
        const db = firebase.firestore();
        const eventDoc = await db.collection('physicalEvents').doc(eventId).get();
        
        if (!eventDoc.exists) {
            showNotification('Event not found', 'error');
            return;
        }
        
        const eventData = eventDoc.data();
        console.log('Event data loaded for closing:', eventData);
        
        // Create close confirmation modal
        const modal = document.createElement('div');
        modal.className = 'phyeventclose-modal-overlay';
        modal.id = 'phyeventclose-modal';
        
        modal.innerHTML = `
            <div class="phyeventclose-modal">
                <div class="modal-header">
                    <h3><i class="fas fa-times-circle"></i> Close Physical Event</h3>
                    <button class="close-modal-btn" onclick="closePhyEventClose()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div class="modal-body">
                    <div class="warning-section" style="
                        background: #fff3cd;
                        border: 1px solid #ffeaa7;
                        border-radius: 8px;
                        padding: 20px;
                        margin-bottom: 20px;
                        text-align: center;
                    ">
                        <i class="fas fa-exclamation-triangle" style="font-size: 48px; color: #856404; margin-bottom: 15px;"></i>
                        <h4 style="margin: 0 0 10px 0; color: #856404;">Are you sure you want to close this event?</h4>
                        <p style="margin: 0; color: #856404; font-size: 14px;">This action cannot be undone. The event will be permanently closed.</p>
                    </div>
                    
                    <div class="event-details" style="
                        background: #f8f9fa;
                        border: 1px solid #e9ecef;
                        border-radius: 8px;
                        padding: 16px;
                        margin-bottom: 20px;
                    ">
                        <h5 style="margin: 0 0 10px 0; color: #495057;">Event Details:</h5>
                        <div style="display: grid; grid-template-columns: auto 1fr; gap: 8px; align-items: center;">
                            <strong>Name:</strong>
                            <span>${eventData.eventName || 'Unknown Event'}</span>
                            <strong>ID:</strong>
                            <span>${eventId}</span>
                            <strong>Status:</strong>
                            <span>${eventData.status || 'Active'}</span>
                        </div>
                    </div>
                    
                    <div class="modal-actions" style="
                        display: flex;
                        gap: 12px;
                        justify-content: flex-end;
                        padding-top: 16px;
                        border-top: 1px solid #e9ecef;
                    ">
                        <button type="button" onclick="closePhyEventClose()" class="cancel-btn" style="
                            background: #f8f9fa;
                            color: #6c757d;
                            border: 1px solid #e9ecef;
                            padding: 10px 20px;
                            border-radius: 6px;
                            cursor: pointer;
                            font-weight: 600;
                            transition: all 0.2s ease;
                        ">Cancel</button>
                        <button type="button" onclick="confirmCloseEvent('${eventId}')" class="close-btn" style="
                            background: #dc3545;
                            color: white;
                            border: none;
                            padding: 10px 20px;
                            border-radius: 6px;
                            cursor: pointer;
                            font-weight: 600;
                            transition: all 0.2s ease;
                            display: flex;
                            align-items: center;
                            gap: 8px;
                        ">
                            <i class="fas fa-times-circle"></i>
                            Close Event Permanently
                        </button>
                    </div>
                </div>
            </div>
        `;
        
        document.body.appendChild(modal);
        
    } catch (error) {
        console.error('Error opening close modal:', error);
        showNotification('Error loading event data: ' + error.message, 'error');
    }
}


   

                       
        
// Generate new physical event ticket card (your requested format)
function generateNewPhyEventTicketCard(ticket) {
    const eventData = ticket.eventData;
    const isMobile = window.innerWidth <= 768;
    const isSmallMobile = window.innerWidth <= 480;
    
    // Generate unique ID for this card
    const cardId = 'new-ticket-card-' + ticket.id.replace(/[^a-zA-Z0-9]/g, '');
    
    // Format date and time
    const startDate = new Date(eventData.startDateTime);
    const endDate = new Date(eventData.endDateTime);
    const formattedDate = startDate.toLocaleDateString('en-US', { 
        weekday: 'short', 
        year: 'numeric', 
        month: 'short', 
        day: 'numeric' 
    });
    const formattedTime = `${startDate.toLocaleTimeString('en-US', { 
        hour: '2-digit', 
        minute: '2-digit' 
    })} - ${endDate.toLocaleTimeString('en-US', { 
        hour: '2-digit', 
        minute: '2-digit' 
    })}`;

    // Generate background style
    let backgroundStyle = 'background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);';
    if (ticket.eventbackground) {
        if (ticket.eventbackground.type === 'media') {
            backgroundStyle = `background-image: linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.3)), url('${ticket.eventbackground.data}'); background-size: cover; background-position: center;`;
        } else if (ticket.eventbackground.type === 'gradient') {
            backgroundStyle = `background: ${ticket.eventbackground.gradient};`;
        } else if (ticket.eventbackground.type === 'color') {
            backgroundStyle = `background-color: ${ticket.eventbackground.color};`;
        }
    } else if (ticket.boughtticketbackground) {
        backgroundStyle = `background: ${ticket.boughtticketbackground};`;
    }

    // Generate sponsors HTML or fallback
    let sponsorsHTML = '';
    if (eventData.sponsors && eventData.sponsors.length > 0) {
        const displaySponsors = eventData.sponsors.slice(0, 5);
        sponsorsHTML = `
            <div style="
                background: rgba(255, 255, 255, 0.1);
                border-radius: 10px;
                padding: 10px;
                display: flex;
                gap: 10px;
                align-items: center;
                flex-wrap: wrap;
                justify-content: center;
            ">
                <span style="color: white; font-size: 12px; font-weight: 600; margin-right: 5px;">Sponsors:</span>
                ${displaySponsors.map(sponsor => {
                    if (sponsor.logo && sponsor.logo.data) {
                        return `<img src="${sponsor.logo.data}" alt="${sponsor.name}" style="height: 30px; width: auto; border-radius: 5px; background: white; padding: 2px;">`;
                    } else {
                        return `<div style="background: rgba(255,255,255,0.2); padding: 5px 10px; border-radius: 5px; font-size: 10px; color: white;">${sponsor.name}</div>`;
                    }
                }).join('')}
            </div>
        `;
    } else {
        sponsorsHTML = `
            <div style="
                background: rgba(255, 255, 255, 0.1);
                border-radius: 10px;
                padding: 15px;
                text-align: center;
            ">
                <a href="https://rewarder-hub.vercel.app" style="
                    color: #4ECDC4;
                    text-decoration: none;
                    font-size: 14px;
                    font-weight: 600;
                " target="_blank">
                     Get more tickets at rewarder-hub.vercel.app
                </a>
            </div>
        `;
    }

    // Get stored user name or placeholder
    const savedBuyerName = ticket.ticketbuyername || '';

    return `
        <div style="
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: ${isMobile ? '15px' : '20px'};
            margin-bottom: ${isMobile ? '15px' : '20px'};
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
            box-sizing: border-box;
        " onmouseover="${!isMobile ? `this.style.transform='translateY(-5px)'; this.style.boxShadow='0 20px 40px rgba(0,0,0,0.2)'` : ''}" 
           onmouseout="${!isMobile ? `this.style.transform='translateY(0)'; this.style.boxShadow='none'` : ''}">
            
            <!-- Main Card Content -->
            <div style="
                display: ${isMobile ? 'block' : 'flex'}; 
                gap: ${isMobile ? '0' : '20px'}; 
                margin-bottom: ${isMobile ? '15px' : '20px'};
            ">
                
                <!-- Event Background Container -->
                <div style="
                    ${isMobile ? 'width: 100%; margin-bottom: 15px;' : 'flex: 0 0 200px;'}
                    height: ${isSmallMobile ? '120px' : isMobile ? '140px' : '150px'};
                    border-radius: 15px;
                    ${backgroundStyle}
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    color: white;
                    font-weight: 600;
                    text-shadow: 0 2px 4px rgba(0,0,0,0.5);
                    position: relative;
                    overflow: hidden;
                ">
                    <div style="
                        position: absolute;
                        top: 0;
                        left: 0;
                        right: 0;
                        bottom: 0;
                        background: rgba(0,0,0,0.2);
                        display: flex;
                        align-items: center;
                        justify-content: center;
                    ">
                        <i class="fas fa-ticket-alt" style="font-size: ${isSmallMobile ? '20px' : isMobile ? '24px' : '32px'}; opacity: 0.8;"></i>
                    </div>
                </div>
                
                <!-- Ticket Details -->
                <div style="${isMobile ? 'width: 100%;' : 'flex: 1;'} color: white;">
                    <!-- User Name Input (Always Visible) -->
                    <div style="margin-bottom: ${isMobile ? '12px' : '15px'};">
                        <input 
                            type="text" 
                            id="ticketName_${ticket.id}"
                            placeholder="Enter your name for this ticket" 
                            value="${savedBuyerName}"
                            ${ticket.boughtticketstatus !== 'unused' ? 'readonly' : ''}
                            style="
                                width: 100%;
                                padding: ${isMobile ? '12px' : '10px'};
                                border: 2px solid rgba(255, 255, 255, 0.3);
                                border-radius: 8px;
                                background: rgba(255, 255, 255, 0.1);
                                color: white;
                                font-size: ${isSmallMobile ? '14px' : isMobile ? '15px' : '16px'};
                                font-weight: 600;
                                box-sizing: border-box;
                                ${ticket.boughtticketstatus !== 'unused' ? 'opacity: 0.6; cursor: not-allowed;' : ''}
                                -webkit-appearance: none;
                            "
                        />
                    </div>
                    
                    ${ticket.boughtticketstatus === 'unused' ? `
                    <!-- Save Button (Always Visible) -->
                    <button onclick="saveTicketBuyerName('${ticket.id}')" style="
                        background: #4ECDC4;
                        color: white;
                        border: none;
                        padding: ${isMobile ? '10px 16px' : '8px 15px'};
                        border-radius: 6px;
                        font-size: ${isMobile ? '13px' : '12px'};
                        font-weight: 600;
                        cursor: pointer;
                        margin-bottom: ${isMobile ? '12px' : '0'};
                        ${isMobile ? 'width: 100%; min-height: 44px;' : 'margin-left: 10px;'}
                        transition: all 0.3s ease;
                        box-sizing: border-box;
                        -webkit-appearance: none;
                    " onmouseover="this.style.background='#45a9a9'" onmouseout="this.style.background='#4ECDC4'">
                        Save Name
                    </button>
                    ` : ''}

                    ${isMobile ? `
                    <!-- Mobile Toggle Button -->
                    <button onclick="toggleNewTicketDetails('${cardId}')" style="
                        background: rgba(76, 217, 196, 0.2);
                        border: 2px solid #4CD9C4;
                        color: #4CD9C4;
                        padding: 10px 16px;
                        border-radius: 8px;
                        font-size: 14px;
                        font-weight: 600;
                        cursor: pointer;
                        width: 100%;
                        margin-bottom: 12px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        gap: 8px;
                        transition: all 0.3s ease;
                        min-height: 44px;
                        box-sizing: border-box;
                        -webkit-user-select: none;
                        user-select: none;
                        -webkit-appearance: none;
                    " onmouseover="this.style.background='rgba(76, 217, 196, 0.3)'" onmouseout="this.style.background='rgba(76, 217, 196, 0.2)'">
                        <i class="fas fa-chevron-down" id="${cardId}-icon" style="transition: transform 0.3s ease;"></i>
                        <span id="${cardId}-text">Show Ticket Details</span>
                    </button>
                    ` : ''}

                    <!-- Ticket Info (Collapsible on Mobile) -->
                    <div id="${cardId}-details" style="
                        display: ${isMobile ? 'none' : 'flex'}; 
                        flex-direction: column; 
                        gap: ${isMobile ? '6px' : '8px'};
                        ${isMobile ? 'overflow: hidden; transition: all 0.3s ease;' : ''}
                    ">
                        <div style="font-size: ${isSmallMobile ? '11px' : isMobile ? '12px' : '14px'}; opacity: 0.8; word-break: break-all;">
                            <strong>Ticket ID:</strong> ${ticket.ticketid}
                        </div>
                        <div style="font-size: ${isSmallMobile ? '13px' : isMobile ? '14px' : '16px'}; font-weight: 600;">
                            <strong>Type:</strong> ${ticket.boughtticketname}
                        </div>
                        <div style="font-size: ${isSmallMobile ? '11px' : isMobile ? '12px' : '14px'};">
                            <strong>Date:</strong> ${formattedDate}
                        </div>
                        <div style="font-size: ${isSmallMobile ? '11px' : isMobile ? '12px' : '14px'};">
                            <strong>Time:</strong> ${formattedTime}
                        </div>
                        <div style="font-size: ${isSmallMobile ? '11px' : isMobile ? '12px' : '14px'}; word-break: break-word;">
                            <strong>Location:</strong> ${eventData.location}
                        </div>
                        
                        <!-- QR Code Button -->
                        <button onclick="showTicketQRCode('${ticket.id}', '${ticket.boughtticketqrcode}')" style="
                            background: #4ECDC4;
                            color: white;
                            border: none;
                            padding: ${isMobile ? '12px 16px' : '10px 20px'};
                            border-radius: 8px;
                            font-size: ${isSmallMobile ? '12px' : isMobile ? '13px' : '14px'};
                            font-weight: 600;
                            cursor: pointer;
                            margin-top: ${isMobile ? '12px' : '10px'};
                            width: ${isMobile ? '100%' : 'auto'};
                            min-height: ${isMobile ? '44px' : 'auto'};
                            transition: all 0.3s ease;
                            box-sizing: border-box;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            gap: 8px;
                            -webkit-appearance: none;
                        " onmouseover="this.style.background='#45a9a9'" onmouseout="this.style.background='#4ECDC4'">
                            <i class="fas fa-qrcode" style="font-size: ${isSmallMobile ? '12px' : '14px'};"></i>
                            <span>View QR Code</span>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Sponsors Section (Hidden on Mobile when details are collapsed) -->
            <div id="${cardId}-sponsors" style="display: ${isMobile ? 'none' : 'block'};">
                ${sponsorsHTML}
            </div>
        </div>
    `;
}

// Add this toggle function for new ticket cards
function toggleNewTicketDetails(cardId) {
    const detailsDiv = document.getElementById(cardId + '-details');
    const sponsorsDiv = document.getElementById(cardId + '-sponsors');
    const icon = document.getElementById(cardId + '-icon');
    const text = document.getElementById(cardId + '-text');
    
    if (detailsDiv && sponsorsDiv && icon && text) {
        if (detailsDiv.style.display === 'none') {
            // Show details
            detailsDiv.style.display = 'flex';
            sponsorsDiv.style.display = 'block';
            icon.style.transform = 'rotate(180deg)';
            text.textContent = 'Hide Ticket Details';
        } else {
            // Hide details
            detailsDiv.style.display = 'none';
            sponsorsDiv.style.display = 'none';
            icon.style.transform = 'rotate(0deg)';
            text.textContent = 'Show Ticket Details';
        }
    }
}
         
     // Save ticket buyer name with debugging
async function saveTicketBuyerName(ticketId) {
    try {
        const nameInput = document.getElementById(`ticketName_${ticketId}`);
        const buyerName = nameInput.value.trim();
        
        if (!buyerName) {
            alert('Please enter a name first');
            return;
        }
        
        const currentUser = firebase.auth().currentUser;
        if (!currentUser) {
            alert('Please sign in to save changes');
            return;
        }

        // Update in Firebase BoughtTicket collection
        await db.collection('BoughtTicket').doc(ticketId).update({
            ticketbuyername: buyerName
        });

        console.log(' Name saved to Firebase:', buyerName);
        console.log(' Ticket ID:', ticketId);
        
        // Verify it was saved by reading it back
        const ticketDoc = await db.collection('BoughtTicket').doc(ticketId).get();
        console.log(' Saved ticket data:', ticketDoc.data());

        alert('Name saved successfully!');
        
        // Reload the tickets to show updated data
        loadNewEventTickets();
    } catch (error) {
        console.error(' Error saving ticket buyer name:', error);
        alert('Error: ' + error.message);
    }
}

// Update ticket user name
async function updateTicketUserName(ticketId, userName) {
    try {
        const currentUser = firebase.auth().currentUser;
        if (!currentUser) return;

        // Update in Firebase
        await db.collection('BoughtTicket').doc(ticketId).update({
            userName: userName
        });

        console.log('Ticket name updated successfully');
    } catch (error) {
        console.error('Error updating ticket name:', error);
        alert('Error updating name. Please try again.');
    }
}

// Show ticket QR code
function showTicketQRCode(ticketId, qrCodeData) {
    // Remove any existing QR modal
    const existingModal = document.getElementById('qrCodeModal');
    if (existingModal) {
        existingModal.remove();
    }

    const qrModalHTML = `
        <div id="qrCodeModal" style="
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 20000;
            backdrop-filter: blur(10px);
        ">
            <div style="
                background: white;
                border-radius: 20px;
                padding: 30px;
                text-align: center;
                max-width: 400px;
                width: 90%;
                position: relative;
            ">
                <button onclick="closeQRCodeModal()" style="
                    position: absolute;
                    top: 15px;
                    right: 20px;
                    background: none;
                    border: none;
                    color: #333;
                    font-size: 24px;
                    cursor: pointer;
                    opacity: 0.7;
                " onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.7'">
                    <i class="fas fa-times"></i>
                </button>
                
                <h3 style="color: #333; margin-bottom: 20px; font-size: 24px;">Your Ticket QR Code</h3>
                
                <div style="
                    background: #f8f9fa;
                    border-radius: 15px;
                    padding: 20px;
                    margin-bottom: 20px;
                ">
                    <div id="qr-code-display" style="
                        background: white;
                        padding: 20px;
                        border-radius: 10px;
                        display: inline-block;
                    ">
                        <!-- QR Code will be generated here -->
                        <div style="
                            width: 200px;
                            height: 200px;
                            background: #333;
                            color: white;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            font-size: 48px;
                            border-radius: 10px;
                        ">
                            <i class="fas fa-qrcode"></i>
                        </div>
                    </div>
                </div>
                
                <p style="color: #666; font-size: 14px; margin-bottom: 20px;">
                    Show this QR code at the event entrance
                </p>
                
                <div style="display: flex; gap: 10px; justify-content: center;">
                    <button onclick="downloadTicketQR('${ticketId}')" style="
                        background: #4ECDC4;
                        color: white;
                        border: none;
                        padding: 12px 20px;
                        border-radius: 8px;
                        font-size: 14px;
                        font-weight: 600;
                        cursor: pointer;
                    ">
                        <i class="fas fa-download"></i> Download
                    </button>
                    <button onclick="shareTicketQR('${ticketId}')" style="
                        background: #6c5ce7;
                        color: white;
                        border: none;
                        padding: 12px 20px;
                        border-radius: 8px;
                        font-size: 14px;
                        font-weight: 600;
                        cursor: pointer;
                    ">
                        <i class="fas fa-share"></i> Share
                    </button>
                </div>
            </div>
        </div>
    `;
    
    document.body.insertAdjacentHTML('beforeend', qrModalHTML);
    
    // Generate QR code (placeholder - you'll need a QR code library)
    generateQRCodeDisplay(qrCodeData);
}

        // Generate proper scannable QR code with ticket information
function generateQRCodeDisplay(qrCodeData) {
    const qrContainer = document.getElementById('qr-code-display');
    if (qrContainer) {
        // Decode the base64 QR data to get the actual ticket info
        let ticketInfo;
        try {
            ticketInfo = JSON.parse(atob(qrCodeData));
        } catch (error) {
            // If decoding fails, use the raw data
            ticketInfo = qrCodeData;
        }
        
        // Create scannable ticket verification string
        const ticketVerificationData = JSON.stringify({
            ticketId: ticketInfo.ticketId,
           ticketBuyerName: ticketInfo.ticketBuyerName || 'Not provided',
        
            eventName: ticketInfo.eventName,
            ticketName: ticketInfo.ticketName,
            status: ticketInfo.status,
            eventDate: ticketInfo.eventStartDate,
            location: ticketInfo.eventLocation
        });
        
        // Generate QR code with the verification data
        const qrCodeURL = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(ticketVerificationData)}`;
        
        qrContainer.innerHTML = `
            <img src="${qrCodeURL}" alt="Scannable Ticket QR Code" style="
                width: 200px;
                height: 200px;
                border: 2px solid #ddd;
                border-radius: 10px;
            " />
        `;
    }
}          
// Close QR code modal
function closeQRCodeModal() {
    const modal = document.getElementById('qrCodeModal');
    if (modal) {
        modal.remove();
    }
}

// Download ticket QR code
function downloadTicketQR(ticketId) {
    // Placeholder function - implement QR code download
    console.log('Download QR code for ticket:', ticketId);
    alert('QR code download feature will be implemented');
}

// Share ticket QR code
function shareTicketQR(ticketId) {
    // Placeholder function - implement QR code sharing
    console.log('Share QR code for ticket:', ticketId);
    alert('QR code sharing feature will be implemented');
}

// Load old event tickets (used and expired)
async function loadOldEventTickets() {
    const container = document.getElementById('old-tickets-container');
    if (!container) return;
    
    try {
        const currentUser = firebase.auth().currentUser;
        if (!currentUser) {
            container.innerHTML = `
                <div style="text-align: center; color: white; padding: 40px;">
                    <i class="fas fa-user-times" style="font-size: 48px; margin-bottom: 20px; opacity: 0.5;"></i>
                    <h3 style="margin-bottom: 10px;">Please Sign In</h3>
                    <p>Sign in to view your old tickets</p>
                </div>
            `;
            return;
        }

        // Query BoughtTicket collection for current user (all tickets)
        const ticketsSnapshot = await db.collection('BoughtTicket')
            .where('userId', '==', currentUser.uid)
            .get();

        if (ticketsSnapshot.empty) {
            container.innerHTML = `
                <div style="text-align: center; color: white; padding: 40px;">
                    <i class="fas fa-ticket-alt" style="font-size: 48px; margin-bottom: 20px; opacity: 0.5;"></i>
                    <h3 style="margin-bottom: 10px;">No Old Tickets</h3>
                    <p style="margin-bottom: 20px;">You don't have any old tickets yet</p>
                    <a href="https://rewarder-hub.vercel.app" style="
                        color: #4ECDC4;
                        text-decoration: none;
                        font-weight: 600;
                    ">Get tickets at Rewarder Hub</a>
                </div>
            `;
            return;
        }

        const tickets = [];
        const eventPromises = [];

        // Collect tickets and prepare event queries
        ticketsSnapshot.forEach(doc => {
            const ticketData = { id: doc.id, ...doc.data() };
            tickets.push(ticketData);
            
            // Get event data for each ticket
            eventPromises.push(
                db.collection('physicalEvents').doc(ticketData.physicaleventid).get()
            );
        });

        // Fetch all event data
        const eventSnapshots = await Promise.all(eventPromises);
        
        // Filter for old tickets (used or expired) and combine with event data
        const oldTickets = [];
        tickets.forEach((ticket, index) => {
            const eventSnapshot = eventSnapshots[index];
            if (eventSnapshot.exists) {
                const eventData = eventSnapshot.data();
                const eventEndDate = new Date(eventData.endDateTime);
                const now = new Date();
                
                // Include tickets that are used OR expired
                if (ticket.boughtticketstatus === 'used' || eventEndDate <= now) {
                    oldTickets.push({
                        ...ticket,
                        eventData: eventData,
                        isExpired: eventEndDate <= now
                    });
                }
            }
        });

        if (oldTickets.length === 0) {
            container.innerHTML = `
                <div style="text-align: center; color: white; padding: 40px;">
                    <i class="fas fa-calendar-check" style="font-size: 48px; margin-bottom: 20px; opacity: 0.5;"></i>
                    <h3 style="margin-bottom: 10px;">No Old Tickets</h3>
                    <p style="margin-bottom: 20px;">All your tickets are still active</p>
                    <a href="https://rewarder-hub.vercel.app" style="
                        color: #4ECDC4;
                        text-decoration: none;
                        font-weight: 600;
                    ">Get more tickets at Rewarder Hub</a>
                </div>
            `;
            return;
        }

        // Generate old ticket cards (same format but with different styling)
        const ticketCardsHTML = oldTickets.map(ticket => generateOldPhyEventTicketCard(ticket)).join('');
        container.innerHTML = `
            <div style="display: flex; flex-direction: column; gap: 20px;">
                ${ticketCardsHTML}
            </div>
        `;

    } catch (error) {
        console.error('Error loading old tickets:', error);
        container.innerHTML = `
            <div style="text-align: center; color: white; padding: 40px;">
                <i class="fas fa-exclamation-triangle" style="font-size: 48px; margin-bottom: 20px; color: #ff4757;"></i>
                <h3 style="margin-bottom: 10px; color: #ff4757;">Error Loading Old Tickets</h3>
                <p>Please try again later</p>
            </div>
        `;
    }
}

// Generate old physical event ticket card (same layout but grayed out)
function generateOldPhyEventTicketCard(ticket) {
    const eventData = ticket.eventData;
    const isMobile = window.innerWidth <= 768;
    const isSmallMobile = window.innerWidth <= 480;
    
    // Format date and time
    const startDate = new Date(eventData.startDateTime);
    const endDate = new Date(eventData.endDateTime);
    const formattedDate = startDate.toLocaleDateString('en-US', { 
        weekday: 'short', 
        year: 'numeric', 
        month: 'short', 
        day: 'numeric' 
    });
    const formattedTime = `${startDate.toLocaleTimeString('en-US', { 
        hour: '2-digit', 
        minute: '2-digit' 
    })} - ${endDate.toLocaleTimeString('en-US', { 
        hour: '2-digit', 
        minute: '2-digit' 
    })}`;

    // Generate background style (same as new event but grayed out)
let backgroundStyle = 'background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); filter: grayscale(100%);';
if (ticket.eventbackground) {
    if (ticket.eventbackground.type === 'media') {
        backgroundStyle = `background-image: linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.3)), url('${ticket.eventbackground.data}'); background-size: cover; background-position: center; filter: grayscale(100%);`;
    } else if (ticket.eventbackground.type === 'gradient') {
        backgroundStyle = `background: ${ticket.eventbackground.gradient}; filter: grayscale(100%);`;
    } else if (ticket.eventbackground.type === 'color') {
        backgroundStyle = `background-color: ${ticket.eventbackground.color}; filter: grayscale(100%);`;
    }
} else if (ticket.boughtticketbackground) {
    backgroundStyle = `background: ${ticket.boughtticketbackground}; filter: grayscale(100%);`;
}

    // Status badge
    const statusBadge = ticket.boughtticketstatus === 'used' ? 
        '<span style="background: #27ae60; color: white; padding: 4px 8px; border-radius: 12px; font-size: 12px; font-weight: 600;">USED</span>' :
        '<span style="background: #e74c3c; color: white; padding: 4px 8px; border-radius: 12px; font-size: 12px; font-weight: 600;">EXPIRED</span>';

    // Generate sponsors HTML or fallback
    let sponsorsHTML = '';
    if (eventData.sponsors && eventData.sponsors.length > 0) {
        const displaySponsors = eventData.sponsors.slice(0, 5);
        sponsorsHTML = `
            <div style="
                background: rgba(255, 255, 255, 0.05);
                border-radius: 10px;
                padding: 10px;
                display: flex;
                gap: 10px;
                align-items: center;
                flex-wrap: wrap;
                justify-content: center;
                opacity: 0.6;
            ">
                <span style="color: rgba(255,255,255,0.6); font-size: 12px; font-weight: 600; margin-right: 5px;">Sponsors:</span>
                ${displaySponsors.map(sponsor => {
                    if (sponsor.logo && sponsor.logo.data) {
                        return `<img src="${sponsor.logo.data}" alt="${sponsor.name}" style="height: 30px; width: auto; border-radius: 5px; background: white; padding: 2px; opacity: 0.6;">`;
                    } else {
                        return `<div style="background: rgba(255,255,255,0.1); padding: 5px 10px; border-radius: 5px; font-size: 10px; color: rgba(255,255,255,0.6);">${sponsor.name}</div>`;
                    }
                }).join('')}
            </div>
        `;
    } else {
        sponsorsHTML = `
            <div style="
                background: rgba(255, 255, 255, 0.05);
                border-radius: 10px;
                padding: 15px;
                text-align: center;
                opacity: 0.6;
            ">
                <a href="https://rewarder-hub.vercel.app" style="
                    color: #4ECDC4;
                    text-decoration: none;
                    font-size: 14px;
                    font-weight: 600;
                    opacity: 0.8;
                " target="_blank">
                     Get more tickets at rewarder-hub.vercel.app
                </a>
            </div>
        `;
    }

    return `
        <div style="
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: ${isMobile ? '15px' : '20px'};
            margin-bottom: ${isMobile ? '15px' : '20px'};
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            opacity: 0.8;
            box-sizing: border-box;
        ">
            <!-- Status Badge -->
            <div style="display: flex; justify-content: flex-end; margin-bottom: ${isMobile ? '12px' : '15px'};">
                ${statusBadge}
            </div>
            
            <!-- Main Card Content -->
            <div style="display: ${isMobile ? 'block' : 'flex'}; gap: ${isMobile ? '0' : '20px'}; margin-bottom: ${isMobile ? '15px' : '20px'};">
                
                <!-- Event Background Container -->
                <div style="
                    ${isMobile ? 'width: 100%; margin-bottom: 15px;' : 'flex: 0 0 200px;'}
                    height: ${isSmallMobile ? '120px' : isMobile ? '140px' : '150px'};
                    border-radius: 15px;
                    ${backgroundStyle}
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    color: white;
                    font-weight: 600;
                    text-shadow: 0 2px 4px rgba(0,0,0,0.5);
                    position: relative;
                    overflow: hidden;
                ">
                    <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.4); display: flex; align-items: center; justify-content: center;">
                        <i class="fas fa-ticket-alt" style="font-size: ${isSmallMobile ? '20px' : isMobile ? '24px' : '32px'}; opacity: 0.6;"></i>
                    </div>
                </div>
                
                <!-- Ticket Details -->
                <div style="${isMobile ? 'width: 100%;' : 'flex: 1;'} color: rgba(255,255,255,0.8);">
                    <!-- User Name -->
                    <div style="margin-bottom: ${isMobile ? '12px' : '15px'};">
                        <div style="width: 100%; padding: ${isMobile ? '12px' : '10px'}; border: 2px solid rgba(255, 255, 255, 0.1); border-radius: 8px; background: rgba(255, 255, 255, 0.05); color: rgba(255,255,255,0.7); font-size: ${isSmallMobile ? '14px' : isMobile ? '15px' : '16px'}; font-weight: 600; box-sizing: border-box;">
                            ${ticket.ticketbuyername|| 'No name provided'}
                        </div>
                    </div>
                    
                    <!-- Ticket Info -->
                    <div style="display: flex; flex-direction: column; gap: ${isMobile ? '6px' : '8px'};">
                        <div style="font-size: ${isSmallMobile ? '11px' : isMobile ? '12px' : '14px'}; opacity: 0.6; word-break: break-all;">
                            <strong>Ticket ID:</strong> ${ticket.ticketid}
                        </div>
                        <div style="font-size: ${isSmallMobile ? '13px' : isMobile ? '14px' : '16px'}; font-weight: 600; opacity: 0.8;">
                            <strong>Type:</strong> ${ticket.boughtticketname}
                        </div>
                        <div style="font-size: ${isSmallMobile ? '11px' : isMobile ? '12px' : '14px'}; opacity: 0.7;">
                            <strong>Date:</strong> ${formattedDate}
                        </div>
                        <div style="font-size: ${isSmallMobile ? '11px' : isMobile ? '12px' : '14px'}; opacity: 0.7;">
                            <strong>Time:</strong> ${formattedTime}
                        </div>
                        <div style="font-size: ${isSmallMobile ? '11px' : isMobile ? '12px' : '14px'}; opacity: 0.7; word-break: break-word;">
                            <strong>Location:</strong> ${eventData.location}
                        </div>
                        
                        <!-- QR Code Button -->
                        <button disabled style="background: #666; color: rgba(255,255,255,0.5); border: none; padding: ${isMobile ? '12px 16px' : '10px 20px'}; border-radius: 8px; font-size: ${isSmallMobile ? '12px' : isMobile ? '13px' : '14px'}; font-weight: 600; cursor: not-allowed; margin-top: ${isMobile ? '12px' : '10px'}; width: ${isMobile ? '100%' : 'auto'}; min-height: ${isMobile ? '44px' : 'auto'}; box-sizing: border-box; display: flex; align-items: center; justify-content: center; gap: 8px;">
                            <i class="fas fa-qrcode" style="font-size: ${isSmallMobile ? '12px' : '14px'};"></i>
                            <span>QR Code (${ticket.boughtticketstatus === 'used' ? 'Used' : 'Expired'})</span>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Sponsors Section -->
            ${sponsorsHTML}
        </div>
    `;
}

// Update the other close functions to include function definitions that might be missing
function closePhysicalEventTicketPage() {
    const page = document.getElementById('physical-event-ticket-page');
    if (page) {
        page.remove();
        document.body.style.overflow = 'auto';
    }
}

// Placeholder for online event ticket page
function openOnlineEventTicketPage() {
    closeTicketsSelectionModal();
    alert('Online Event Tickets feature will be implemented soon!');
}



// ================================
// TICKETS SYSTEM - COMPLETE IMPLEMENTATION
// ================================

// Initialize tickets button event listener
document.addEventListener('DOMContentLoaded', function() {
    const ticketsBtn = document.querySelector('.tickets-btn');
    if (ticketsBtn) {
        ticketsBtn.addEventListener('click', function() {
            openTicketsModal();
        });
    }
});

// Open tickets selection modal
function openTicketsModal() {
    // Remove any existing tickets modal
    const existingModal = document.getElementById('ticketsSelectionModal');
    if (existingModal) {
        existingModal.remove();
    }

    const modalHTML = `
        <div id="ticketsSelectionModal" style="
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            backdrop-filter: blur(5px);
        ">
            <div style="
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                border-radius: 20px;
                padding: 40px;
                width: 90%;
                max-width: 500px;
                text-align: center;
                position: relative;
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            ">
                <button onclick="closeTicketsSelectionModal()" style="
                    position: absolute;
                    top: 15px;
                    right: 20px;
                    background: none;
                    border: none;
                    color: white;
                    font-size: 24px;
                    cursor: pointer;
                    opacity: 0.7;
                    transition: opacity 0.3s ease;
                " onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.7'">
                    <i class="fas fa-times"></i>
                </button>
                
                <h2 style="color: white; font-size: 28px; margin-bottom: 30px; font-weight: 600;">
                    Select Ticket Type
                </h2>
                
                <div style="display: flex; flex-direction: column; gap: 20px;">
                    <button id="physical-event-ticket-btn" onclick="openPhysicalEventTicketPage()" style="
                        background: rgba(255, 255, 255, 0.1);
                        border: 2px solid rgba(255, 255, 255, 0.3);
                        color: white;
                        padding: 20px 30px;
                        border-radius: 15px;
                        font-size: 18px;
                        font-weight: 600;
                        cursor: pointer;
                        transition: all 0.3s ease;
                        backdrop-filter: blur(10px);
                    " onmouseover="this.style.background='rgba(255, 255, 255, 0.2)'; this.style.transform='translateY(-3px)'" 
                       onmouseout="this.style.background='rgba(255, 255, 255, 0.1)'; this.style.transform='translateY(0)'">
                        <i class="fas fa-map-marker-alt" style="margin-right: 10px;"></i>
                        Physical Event Tickets
                    </button>
                    
                    <button id="online-event-ticket-btn" onclick="openOnlineEventTicketPage()" style="
                        background: rgba(255, 255, 255, 0.1);
                        border: 2px solid rgba(255, 255, 255, 0.3);
                        color: white;
                        padding: 20px 30px;
                        border-radius: 15px;
                        font-size: 18px;
                        font-weight: 600;
                        cursor: pointer;
                        transition: all 0.3s ease;
                        backdrop-filter: blur(10px);
                    " onmouseover="this.style.background='rgba(255, 255, 255, 0.2)'; this.style.transform='translateY(-3px)'" 
                       onmouseout="this.style.background='rgba(255, 255, 255, 0.1)'; this.style.transform='translateY(0)'">
                        <i class="fas fa-video" style="margin-right: 10px;"></i>
                        Online Event Tickets
                    </button>
                </div>
            </div>
        </div>
    `;
    
    document.body.insertAdjacentHTML('beforeend', modalHTML);
    document.body.style.overflow = 'hidden';
}

// Close tickets selection modal
function closeTicketsSelectionModal() {
    const modal = document.getElementById('ticketsSelectionModal');
    if (modal) {
        modal.remove();
        document.body.style.overflow = 'auto';
    }
}

// Open physical event ticket page
function openPhysicalEventTicketPage() {
    closeTicketsSelectionModal();
    
    // Remove any existing page
    const existingPage = document.getElementById('physical-event-ticket-page');
    if (existingPage) {
        existingPage.remove();
    }

    
    // Check if mobile device
    const isMobile = window.innerWidth <= 768;
    const isUltraMobile = window.innerWidth <= 480;
    
    const pageHTML = `
        <div id="physical-event-ticket-page" style="
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: #1a1a2e;
            z-index: 10000;
            overflow-y: auto;
     -webkit-overflow-scrolling: touch;
        ">

 <!-- Header -->
            <div class="${isMobile ? 'mobile-header' : ''} ${isUltraMobile ? 'ultra-mobile-header' : ''}" style="
                background: rgba(255, 255, 255, 0.95);
                backdrop-filter: blur(10px);
                padding: ${isMobile ? '10px 15px' : '15px 20px'};
                display: flex;
                justify-content: space-between;
                align-items: center;
                position: sticky;
                top: 0;
                z-index: 100;
                border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            ">
                <h1 style="color: #333; font-size: ${isUltraMobile ? '16px' : isMobile ? '18px' : '24px'}; font-weight: 600; margin: 0;">My Tickets</h1>
                <button onclick="closePhysicalEventTicketPage()" class="touch-button no-select" style="
                    background: #ff4757;
                    color: white;
                    border: none;
                    padding: ${isMobile ? '8px 12px' : '10px 15px'};
                    border-radius: 8px;
                    cursor: pointer;
                    font-size: ${isMobile ? '14px' : '16px'};
                    transition: all 0.3s ease;
                    min-width: 44px;
                    min-height: 44px;
                ">
                    <i class="fas fa-times"></i> ${isMobile ? '' : 'Close'}
                </button>
            </div>

            <!-- Auto-scrolling Banners -->
            <div style="
                background: rgba(255, 255, 255, 0.1);
                padding: ${isMobile ? '15px 0' : '20px 0'};
                overflow: hidden;
                margin-bottom: ${isMobile ? '20px' : '30px'};
            ">
                <div id="ticket-banners-container" style="
                    display: flex;
                    gap: ${isMobile ? '15px' : '20px'};
                    animation: scrollBanners 30s linear infinite;
                    padding: 0 ${isMobile ? '10px' : '0'};
                ">
                    ${generateResponsiveTicketBannersHTML(isMobile, isUltraMobile)}
                </div>
                <div style="padding: 0 ${isMobile ? '15px' : '20px'}; margin-top: 20px;">
                    <button id="ticket-validator-scanner-btn" onclick="openTicketValidatorOptions()" class="touch-button no-select" style="
                        width: 100%;
                        background: rgba(255, 255, 255, 0.9);
                        color: #333;
                        border: none;
                        padding: ${isMobile ? '12px 16px' : '15px 20px'};
                        border-radius: 10px;
                        font-size: ${isMobile ? '14px' : '16px'};
                        font-weight: 600;
                        cursor: pointer;
                        transition: all 0.3s ease;
                        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
                        min-height: 44px;
                    ">
                        <i class="fas fa-qrcode" style="margin-right: 8px;"></i>
                        Ticket Validator Scanner
                    </button>
                </div>
            </div>


            <!-- Tabs -->
            <div style="padding: 0 ${isMobile ? '15px' : '20px'}; margin-bottom: ${isMobile ? '20px' : '30px'};">
                <div style="
                    display: flex;
                    background: rgba(255, 255, 255, 0.1);
                    border-radius: 15px;
                    padding: 5px;
                    gap: 5px;
                ">
                    <button id="new-event-ticket-tab" onclick="switchPhysicalTicketTab('new')" class="touch-button no-select mobile-tab" style="
                        flex: 1;
                        background: rgba(255, 255, 255, 0.9);
                        color: #333;
                        border: none;
                        padding: ${isMobile ? '12px 10px' : '15px 20px'};
                        border-radius: 10px;
                        font-size: ${isMobile ? '14px' : '16px'};
                        font-weight: 600;
                        cursor: pointer;
                        transition: all 0.3s ease;
                        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
                        min-height: 44px;
                        text-align: center;
                    ">
                        ${isMobile ? 'New Tickets' : 'New Event Tickets'}
                    </button>
                    <button id="old-event-ticket-tab" onclick="switchPhysicalTicketTab('old')" class="touch-button no-select mobile-tab" style="
                        flex: 1;
                        background: transparent;
                        color: white;
                        border: none;
                        padding: ${isMobile ? '12px 10px' : '15px 20px'};
                        border-radius: 10px;
                        font-size: ${isMobile ? '14px' : '16px'};
                        font-weight: 600;
                        cursor: pointer;
                        transition: all 0.3s ease;
                        min-height: 44px;
                        text-align: center;
                    ">
                        ${isMobile ? 'Old Tickets' : 'Old Event Tickets'}
                    </button>
                </div>
            </div>

            <!-- Tab Content -->
            <div id="new-event-content" style="display: block; padding: 0 ${isMobile ? '15px' : '20px'};">
                <div id="new-tickets-container">
                    <div style="text-align: center; color: white; padding: ${isMobile ? '30px' : '40px'};">
                        <i class="fas fa-spinner fa-spin" style="font-size: ${isMobile ? '24px' : '32px'}; margin-bottom: 15px;"></i>
                        <p style="font-size: ${isMobile ? '16px' : '18px'};">Loading your tickets...</p>
                    </div>
                </div>
            </div>

            <div id="old-event-content" style="display: none; padding: 0 ${isMobile ? '15px' : '20px'};">
                <div id="old-tickets-container">
                    <div style="text-align: center; color: white; padding: ${isMobile ? '30px' : '40px'};">
                        <i class="fas fa-spinner fa-spin" style="font-size: ${isMobile ? '24px' : '32px'}; margin-bottom: 15px;"></i>
                        <p style="font-size: ${isMobile ? '16px' : '18px'};">Loading your old tickets...</p>
                    </div>
                </div>
            </div>
        </div>

        <style>
            @keyframes scrollBanners {
                0% { transform: translateX(0); }
                100% { transform: translateX(-50%); }
            }
            
            /* Mobile scroll optimization */
            @media (max-width: 768px) {
                #physical-event-ticket-page {
                    -webkit-overflow-scrolling: touch;
                }
            }
            /* Base responsive styles */
        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        /* Mobile-first responsive design */
        @media (max-width: 768px) {
            .mobile-optimized {
                font-size: 14px !important;
                padding: 12px 16px !important;
            }
            
            .mobile-header {
                padding: 10px 15px !important;
                flex-direction: row !important;
                gap: 10px !important;
            }
            
            .mobile-header h1 {
                font-size: 18px !important;
                margin: 0 !important;
            }
            
            .mobile-header button {
                padding: 8px 12px !important;
                font-size: 14px !important;
                min-width: 44px !important;
                min-height: 44px !important;
            }
            
            .mobile-tab {
                padding: 12px 10px !important;
                font-size: 14px !important;
                min-height: 44px !important;
            }
            
            .mobile-banner {
                min-width: 220px !important;
                padding: 20px !important;
            }
            
            .mobile-banner h4 {
                font-size: 16px !important;
            }
            
            .mobile-banner p {
                font-size: 12px !important;
            }
            
            .mobile-banner i {
                font-size: 28px !important;
            }
            
            .mobile-modal {
                margin: 10px !important;
                padding: 25px !important;
                max-height: 90vh !important;
                overflow-y: auto !important;
            }
            
            .mobile-modal h2 {
                font-size: 22px !important;
            }
            
            .mobile-modal h3 {
                font-size: 20px !important;
            }
            
            .mobile-input {
                padding: 12px !important;
                font-size: 16px !important;
                border-radius: 8px !important;
            }
            
            .mobile-button {
                padding: 12px 20px !important;
                font-size: 16px !important;
                min-height: 44px !important;
                border-radius: 8px !important;
            }
            
            .mobile-qr-controls {
                flex-direction: column !important;
                gap: 10px !important;
            }
            
            .mobile-qr-controls button {
                width: 100% !important;
                min-height: 44px !important;
            }
            
            .mobile-validation-row {
                flex-direction: column !important;
                gap: 10px !important;
            }
            
            .mobile-validation-row input {
                width: 100% !important;
            }
            
            .mobile-validation-row button {
                width: 100% !important;
                min-height: 44px !important;
            }
        }
        
        @media (max-width: 480px) {
            .ultra-mobile {
                padding: 8px 12px !important;
                font-size: 12px !important;
            }
            
            .ultra-mobile-header h1 {
                font-size: 16px !important;
            }
            
            .ultra-mobile-modal {
                margin: 5px !important;
                padding: 20px !important;
            }
            
            .ultra-mobile-banner {
                min-width: 180px !important;
                padding: 15px !important;
            }
        }
        
        /* Touch-friendly styles */
        .touch-button {
            min-width: 44px;
            min-height: 44px;
            cursor: pointer;
            user-select: none;
            -webkit-user-select: none;
            -webkit-touch-callout: none;
        }
        
        /* iOS specific styles */
        @supports (-webkit-appearance: none) {
            .ios-input {
                -webkit-appearance: none;
                border-radius: 8px;
            }
            
            .ios-button {
                -webkit-appearance: none;
                border-radius: 8px;
            }
        }
        
        /* Prevent text selection on interactive elements */
        .no-select {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
    
        </style>
    `;
    document.body.insertAdjacentHTML('beforeend', pageHTML);
    document.body.style.overflow = 'hidden';
    
    // Load tickets immediately
    loadNewEventTickets();
     // Add touch event listeners for mobile
    if (isMobile) {
        addMobileTouchHandlers();
    }
}

// Responsive ticket banners
function generateResponsiveTicketBannersHTML(isMobile, isUltraMobile) {
    const banners = [
        { title: 'Premium Sound', desc: 'Crystal clear audio', color: '#FF6B6B', icon: 'fas fa-volume-up' },
        { title: 'Event Photos', desc: 'Professional photography', color: '#4ECDC4', icon: 'fas fa-camera' },
        { title: 'VIP Access', desc: 'Exclusive backstage access', color: '#45B7D1', icon: 'fas fa-crown' },
        { title: 'Food & Drinks', desc: 'Premium catering service', color: '#96CEB4', icon: 'fas fa-utensils' },
        { title: 'Transportation', desc: 'Shuttle service available', color: '#FFEAA7', icon: 'fas fa-bus' },
        { title: 'Merchandise', desc: 'Official event merchandise', color: '#DDA0DD', icon: 'fas fa-tshirt' }
    ];
    
    const duplicatedBanners = [...banners, ...banners];
    
    return duplicatedBanners.map(banner => `
        <div class="touch-button no-select" style="
            min-width: ${isUltraMobile ? '180px' : isMobile ? '220px' : '280px'};
            background: ${banner.color};
            border-radius: 15px;
            padding: ${isUltraMobile ? '15px' : isMobile ? '20px' : '25px'};
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        ">
            <div style="
                position: absolute;
                top: -20px;
                right: -20px;
                width: 60px;
                height: 60px;
                background: rgba(255,255,255,0.1);
                border-radius: 50%;
            "></div>
            <i class="${banner.icon}" style="font-size: ${isUltraMobile ? '24px' : isMobile ? '28px' : '36px'}; margin-bottom: 15px; display: block;"></i>
            <h4 style="font-size: ${isUltraMobile ? '14px' : isMobile ? '16px' : '18px'}; font-weight: 600; margin-bottom: 8px;">${banner.title}</h4>
            <p style="font-size: ${isUltraMobile ? '11px' : isMobile ? '12px' : '14px'}; opacity: 0.9; margin: 0;">${banner.desc}</p>
        </div>
    `).join('');
}


// Switch physical ticket tabs with responsive handling
function switchPhysicalTicketTab(tabType) {
    const newTab = document.getElementById('new-event-ticket-tab');
    const oldTab = document.getElementById('old-event-ticket-tab');
    const newContent = document.getElementById('new-event-content');
    const oldContent = document.getElementById('old-event-content');
    
    const isMobile = window.innerWidth <= 768;
    
    if (tabType === 'new') {
        newTab.style.background = 'rgba(255, 255, 255, 0.9)';
        newTab.style.color = '#333';
        newTab.style.boxShadow = '0 4px 15px rgba(0, 0, 0, 0.1)';
        
        oldTab.style.background = 'transparent';
        oldTab.style.color = 'white';
        oldTab.style.boxShadow = 'none';
        
        newContent.style.display = 'block';
        oldContent.style.display = 'none';
        
        if (typeof loadNewEventTickets === 'function') {
            loadNewEventTickets();
        }
    } else {
        oldTab.style.background = 'rgba(255, 255, 255, 0.9)';
        oldTab.style.color = '#333';
        oldTab.style.boxShadow = '0 4px 15px rgba(0, 0, 0, 0.1)';
        
        newTab.style.background = 'transparent';
        newTab.style.color = 'white';
        newTab.style.boxShadow = 'none';
        
        oldContent.style.display = 'block';
        newContent.style.display = 'none';
        
        if (typeof loadOldEventTickets === 'function') {
            loadOldEventTickets();
        }
    }
}
       
// Add window resize handler to update mobile state
window.addEventListener('resize', function() {
    // Debounce resize events
    clearTimeout(window.resizeTimeout);
    window.resizeTimeout = setTimeout(function() {
        // You could add logic here to update mobile styles if needed
        console.log('Window resized, new width:', window.innerWidth);
    }, 250);
});

                 function openTicketValidatorOptions() {
    console.log('Opening ticket validator options...'); // Debug log
    
    const existingModal = document.getElementById('validatorOptionsModal');
    if (existingModal) {
        existingModal.remove();
    }

    const isMobile = window.innerWidth <= 768;
    const isUltraMobile = window.innerWidth <= 480;

    const modalHTML = `
         <div id="validatorOptionsModal" style="
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            backdrop-filter: blur(5px);
            padding: ${isMobile ? '10px' : '0'};
        ">
            <div class="${isMobile ? 'mobile-modal' : ''} ${isUltraMobile ? 'ultra-mobile-modal' : ''}" style="
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                border-radius: 20px;
                padding: ${isUltraMobile ? '20px' : isMobile ? '25px' : '40px'};
                width: 100%;
                max-width: ${isMobile ? '400px' : '500px'};
                text-align: center;
                position: relative;
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
                max-height: ${isMobile ? '90vh' : 'auto'};
                overflow-y: auto;
            ">
                <button class="close-validator-modal-btn touch-button" style="
                    position: absolute;
                    top: 15px;
                    right: 20px;
                    background: none;
                    border: none;
                    color: white;
                    font-size: 24px;
                    cursor: pointer;
                    opacity: 0.7;
                    transition: opacity 0.3s ease;
                    min-width: 44px;
                    min-height: 44px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    z-index: 10001;
                ">
                    <i class="fas fa-times"></i>
                </button>
                
                <h2 style="color: white; font-size: ${isUltraMobile ? '20px' : isMobile ? '22px' : '28px'}; margin-bottom: 30px; font-weight: 600; margin-top: ${isMobile ? '20px' : '0'};">
                    Ticket Validator
                </h2>
                
                <div style="display: flex; flex-direction: column; gap: ${isMobile ? '15px' : '20px'};">
                    <button class="ticket-input-scanner-btn touch-button mobile-button no-select" style="
                        background: rgba(255, 255, 255, 0.1);
                        border: 2px solid rgba(255, 255, 255, 0.3);
                        color: white;
                        padding: ${isMobile ? '16px 24px' : '20px 30px'};
                        border-radius: 15px;
                        font-size: ${isMobile ? '16px' : '18px'};
                        font-weight: 600;
                        cursor: pointer;
                        transition: all 0.3s ease;
                        backdrop-filter: blur(10px);
                        min-height: 44px;
                        width: 100%;
                    ">
                        <i class="fas fa-keyboard" style="margin-right: 10px;"></i>
                        Ticket Input Scanner
                    </button>
                    
                    <button class="ticket-qr-scanner-btn touch-button mobile-button no-select" style="
                        background: rgba(255, 255, 255, 0.1);
                        border: 2px solid rgba(255, 255, 255, 0.3);
                        color: white;
                        padding: ${isMobile ? '16px 24px' : '20px 30px'};
                        border-radius: 15px;
                        font-size: ${isMobile ? '16px' : '18px'};
                        font-weight: 600;
                        cursor: pointer;
                        transition: all 0.3s ease;
                        backdrop-filter: blur(10px);
                        min-height: 44px;
                        width: 100%;
                    ">
                        <i class="fas fa-camera" style="margin-right: 10px;"></i>
                        Ticket QR Scanner
                    </button>
                </div>
                
                <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.2);">
                    <p style="color: rgba(255,255,255,0.8); font-size: ${isMobile ? '12px' : '14px'}; margin: 0;">
                        Powered by <strong style="color: white;">Rewarder</strong>
                    </p>
                </div>
            </div>
        </div>
    `;
    
    document.body.insertAdjacentHTML('beforeend', modalHTML);
    document.body.style.overflow = 'hidden';
    
    // Add event listeners instead of onclick attributes
    setTimeout(() => {
        const inputScannerBtn = document.querySelector('.ticket-input-scanner-btn');
        const qrScannerBtn = document.querySelector('.ticket-qr-scanner-btn');
        const closeBtn = document.querySelector('.close-validator-modal-btn');
        
        if (inputScannerBtn) {
            inputScannerBtn.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                console.log('Input scanner button clicked'); // Debug log
                openTicketInputScanner();
            });
        }
        
        if (qrScannerBtn) {
            qrScannerBtn.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                console.log('QR scanner button clicked'); // Debug log
                openTicketQRScanner();
            });
        }
        
        if (closeBtn) {
            closeBtn.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                closeValidatorOptionsModal();
            });
        }
        
        // Add mobile touch handlers
        if (isMobile) {
            addMobileTouchHandlers();
        }
    }, 100);
}



function addMobileTouchHandlers() {
    const buttons = document.querySelectorAll('.touch-button');
    buttons.forEach(button => {
        // Remove hover effects on mobile and add touch feedback
        button.addEventListener('touchstart', function() {
            this.style.opacity = '0.8';
        });
        
        button.addEventListener('touchend', function() {
            this.style.opacity = '1';
        });
        
        button.addEventListener('touchcancel', function() {
            this.style.opacity = '1';
        });
    });
}

function closeValidatorOptionsModal() {
    const modal = document.getElementById('validatorOptionsModal');
    if (modal) {
        modal.remove();
        document.body.style.overflow = 'auto';
    }
}


// Web Audio API for validation sounds
class ValidationAudio {
    constructor() {
        this.audioContext = null;
        this.initAudio();
    }
    
    initAudio() {
        try {
            this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
        } catch (error) {
            console.log('Web Audio API not supported');
        }
    }
    
    playSuccessSound() {
        if (!this.audioContext) return;
        
        const oscillator = this.audioContext.createOscillator();
        const gainNode = this.audioContext.createGain();
        
        oscillator.connect(gainNode);
        gainNode.connect(this.audioContext.destination);
        
        oscillator.frequency.setValueAtTime(800, this.audioContext.currentTime);
        oscillator.frequency.setValueAtTime(1000, this.audioContext.currentTime + 0.1);
        
        gainNode.gain.setValueAtTime(0.3, this.audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + 0.3);
        
        oscillator.start(this.audioContext.currentTime);
        oscillator.stop(this.audioContext.currentTime + 0.3);
    }
    
    playFailureSound() {
        if (!this.audioContext) return;
        
        const oscillator = this.audioContext.createOscillator();
        const gainNode = this.audioContext.createGain();
        
        oscillator.connect(gainNode);
        gainNode.connect(this.audioContext.destination);
        
        oscillator.frequency.setValueAtTime(400, this.audioContext.currentTime);
        oscillator.frequency.setValueAtTime(200, this.audioContext.currentTime + 0.2);
        
        gainNode.gain.setValueAtTime(0.3, this.audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + 0.4);
        
        oscillator.start(this.audioContext.currentTime);
        oscillator.stop(this.audioContext.currentTime + 0.4);
    }
}

const validationAudio = new ValidationAudio();

// Global variables for session management
let currentValidationEventId = null;
let validationSessionStart = null;
let validationSessionDuration = 30 * 60 * 1000; // 30 minutes

function openTicketInputScanner() {
    closeValidatorOptionsModal();
    
    // Check if session is still valid
    if (currentValidationEventId && validationSessionStart && 
        (Date.now() - validationSessionStart < validationSessionDuration)) {
        showTicketQuantitySelector();
        return;
    }
    
    showEventIdInput('input');
}

function showEventIdInput(scannerType) {
    const existingModal = document.getElementById('eventIdInputModal');
    if (existingModal) {
        existingModal.remove();
    }

    const isMobile = window.innerWidth <= 768;
    const isUltraMobile = window.innerWidth <= 480;

    const modalHTML = `
         <div id="eventIdInputModal" style="
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            backdrop-filter: blur(10px);
            padding: ${isMobile ? '10px' : '0'};
        ">
            <div class="${isMobile ? 'mobile-modal' : ''} ${isUltraMobile ? 'ultra-mobile-modal' : ''}" style="
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                border-radius: 20px;
                padding: ${isUltraMobile ? '20px' : isMobile ? '25px' : '40px'};
                width: 100%;
                max-width: ${isMobile ? '380px' : '450px'};
                text-align: center;
                position: relative;
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
                max-height: ${isMobile ? '90vh' : 'auto'};
                overflow-y: auto;
            ">
                <button onclick="closeEventIdInputModal()" class="touch-button" style="
                    position: absolute;
                    top: 15px;
                    right: 20px;
                    background: none;
                    border: none;
                    color: white;
                    font-size: 24px;
                    cursor: pointer;
                    opacity: 0.7;
                    min-width: 44px;
                    min-height: 44px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                ">
                    <i class="fas fa-times"></i>
                </button>
                
                <h3 style="color: white; font-size: ${isUltraMobile ? '18px' : isMobile ? '20px' : '24px'}; margin-bottom: 30px; font-weight: 600; margin-top: ${isMobile ? '20px' : '0'};">
                    Enter Event ID
                </h3>
                
                <input type="text" id="eventIdInput" placeholder="Enter Event ID" class="mobile-input ios-input" style="
                    width: 100%;
                    padding: ${isMobile ? '12px' : '15px'};
                    border: 2px solid rgba(255, 255, 255, 0.3);
                    border-radius: 10px;
                    background: rgba(255, 255, 255, 0.1);
                    color: white;
                    font-size: ${isMobile ? '16px' : '16px'};
                    margin-bottom: 20px;
                    text-align: center;
                    box-sizing: border-box;
                " />
                
                <button onclick="verifyEventId('${scannerType}')" class="touch-button mobile-button ios-button no-select" style="
                    background: #4ECDC4;
                    color: white;
                    border: none;
                    padding: ${isMobile ? '12px 24px' : '15px 30px'};
                    border-radius: 10px;
                    font-size: ${isMobile ? '16px' : '16px'};
                    font-weight: 600;
                    cursor: pointer;
                    transition: all 0.3s ease;
                    width: 100%;
                    min-height: 44px;
                ">
                    Verify Event ID
                </button>
                
                <div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.2);">
                    <p style="color: rgba(255,255,255,0.8); font-size: ${isMobile ? '11px' : '12px'}; margin: 0;">
                        Powered by <strong style="color: white;">Rewarder</strong>
                    </p>
                </div>
            </div>
        </div>
    `;
    
    document.body.insertAdjacentHTML('beforeend', modalHTML);
    document.body.style.overflow = 'hidden';
    
    // Focus input and show keyboard on mobile
    if (isMobile) {
        setTimeout(() => {
            const input = document.getElementById('eventIdInput');
            if (input) {
                input.focus();
            }
        }, 300);
        addMobileTouchHandlers();
    }
}

// Responsive ticket quantity selector
function showTicketQuantitySelector() {
    const existingModal = document.getElementById('quantitySelectorModal');
    if (existingModal) {
        existingModal.remove();
    }

    const isMobile = window.innerWidth <= 768;
    const isUltraMobile = window.innerWidth <= 480;

    const modalHTML = `
        <div id="quantitySelectorModal" style="
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            backdrop-filter: blur(10px);
            padding: ${isMobile ? '10px' : '0'};
        ">
            <div class="${isMobile ? 'mobile-modal' : ''} ${isUltraMobile ? 'ultra-mobile-modal' : ''}" style="
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                border-radius: 20px;
                padding: ${isUltraMobile ? '20px' : isMobile ? '25px' : '40px'};
                width: 100%;
                max-width: ${isMobile ? '380px' : '450px'};
                text-align: center;
                position: relative;
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
                max-height: ${isMobile ? '90vh' : 'auto'};
                overflow-y: auto;
            ">
                <button onclick="closeQuantitySelectorModal()" class="touch-button" style="
                    position: absolute;
                    top: 15px;
                    right: 20px;
                    background: none;
                    border: none;
                    color: white;
                    font-size: 24px;
                    cursor: pointer;
                    opacity: 0.7;
                    min-width: 44px;
                    min-height: 44px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                ">
                    <i class="fas fa-times"></i>
                </button>
                
                <h3 style="color: white; font-size: ${isUltraMobile ? '18px' : isMobile ? '20px' : '24px'}; margin-bottom: 30px; font-weight: 600; margin-top: ${isMobile ? '20px' : '0'};">
                    How many tickets to validate?
                </h3>
                
                <input type="number" id="ticketQuantityInput" min="1" max="15" value="1" class="mobile-input ios-input" style="
                    width: 100%;
                    padding: ${isMobile ? '12px' : '15px'};
                    border: 2px solid rgba(255, 255, 255, 0.3);
                    border-radius: 10px;
                    background: rgba(255, 255, 255, 0.1);
                    color: white;
                    font-size: ${isMobile ? '18px' : '18px'};
                    margin-bottom: 20px;
                    text-align: center;
                    box-sizing: border-box;
                " />
                
                <button onclick="openInputValidationPage()" class="touch-button mobile-button ios-button no-select" style="
                    background: #4ECDC4;
                    color: white;
                    border: none;
                    padding: ${isMobile ? '12px 24px' : '15px 30px'};
                    border-radius: 10px;
                    font-size: ${isMobile ? '16px' : '16px'};
                    font-weight: 600;
                    cursor: pointer;
                    transition: all 0.3s ease;
                    width: 100%;
                    min-height: 44px;
                ">
                    Start Validation
                </button>
                
                <div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.2);">
                    <p style="color: rgba(255,255,255,0.8); font-size: ${isMobile ? '11px' : '12px'}; margin: 0;">
                        Powered by <strong style="color: white;">Rewarder</strong>
                    </p>
                </div>
            </div>
        </div>
    `;
    
    document.body.insertAdjacentHTML('beforeend', modalHTML);
    document.body.style.overflow = 'hidden';
    
    if (isMobile) {
        addMobileTouchHandlers();
    }
}

async function verifyEventId(scannerType) {
    const eventIdInput = document.getElementById('eventIdInput');
    const eventId = eventIdInput.value.trim();
    
    if (!eventId) {
        alert('Please enter an Event ID');
        return;
    }
    
    try {
        // Check if event exists in physicalEvents
        const eventDoc = await db.collection('physicalEvents').doc(eventId).get();
        
        if (!eventDoc.exists) {
            alert('Event ID not found');
            return;
        }
        
        const eventData = eventDoc.data();
        const eventEndDate = new Date(eventData.endDateTime);
        const now = new Date();
        
        // Check if event has ended
        if (eventEndDate <= now) {
            alert('This event has already ended');
            return;
        }
        
        // Check if there are tickets for this event
        const ticketsSnapshot = await db.collection('BoughtTicket')
            .where('physicaleventid', '==', eventId)
            .limit(1)
            .get();
            
        if (ticketsSnapshot.empty) {
            alert('No tickets found for this event');
            return;
        }
        
        // Set session variables
        currentValidationEventId = eventId;
        validationSessionStart = Date.now();
        
        closeEventIdInputModal();
        
        if (scannerType === 'input') {
            showTicketQuantitySelector();
        } else {
            showQRScanner();
        }
        
    } catch (error) {
        console.error('Error verifying event ID:', error);
        alert('Error verifying event. Please try again.');
    }
}

function showTicketQuantitySelector() {
    const existingModal = document.getElementById('quantitySelectorModal');
    if (existingModal) {
        existingModal.remove();
    }

    const modalHTML = `
        <div id="quantitySelectorModal" style="
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            backdrop-filter: blur(10px);
        ">
            <div style="
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                border-radius: 20px;
                padding: 40px;
                width: 90%;
                max-width: 450px;
                text-align: center;
                position: relative;
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            ">
                <button onclick="closeQuantitySelectorModal()" style="
                    position: absolute;
                    top: 15px;
                    right: 20px;
                    background: none;
                    border: none;
                    color: white;
                    font-size: 24px;
                    cursor: pointer;
                    opacity: 0.7;
                " onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.7'">
                    <i class="fas fa-times"></i>
                </button>
                
                <h3 style="color: white; font-size: 24px; margin-bottom: 30px; font-weight: 600;">
                    How many tickets to validate?
                </h3>
                
                <input type="number" id="ticketQuantityInput" min="1" max="15" value="1" style="
                    width: 100%;
                    padding: 15px;
                    border: 2px solid rgba(255, 255, 255, 0.3);
                    border-radius: 10px;
                    background: rgba(255, 255, 255, 0.1);
                    color: white;
                    font-size: 18px;
                    margin-bottom: 20px;
                    text-align: center;
                " />
                
                <button onclick="openInputValidationPage()" style="
                    background: #4ECDC4;
                    color: white;
                    border: none;
                    padding: 15px 30px;
                    border-radius: 10px;
                    font-size: 16px;
                    font-weight: 600;
                    cursor: pointer;
                    transition: all 0.3s ease;
                    width: 100%;
                " onmouseover="this.style.background='#45a9a9'" onmouseout="this.style.background='#4ECDC4'">
                    Start Validation
                </button>
                
                <div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.2);">
                    <p style="color: rgba(255,255,255,0.8); font-size: 12px; margin: 0;">
                        Powered by <strong style="color: white;">Rewarder</strong>
                    </p>
                </div>
            </div>
        </div>
    `;
    
    document.body.insertAdjacentHTML('beforeend', modalHTML);
    document.body.style.overflow = 'hidden';
}

function openInputValidationPage() {
    const quantityInput = document.getElementById('ticketQuantityInput');
    const quantity = parseInt(quantityInput.value);
    
    if (quantity < 1 || quantity > 15) {
        alert('Please enter a number between 1 and 15');
        return;
    }
    
    closeQuantitySelectorModal();
    showInputValidationPage(quantity);
}


function closeEventIdInputModal() {
    const modal = document.getElementById('eventIdInputModal');
    if (modal) {
        modal.remove();
        document.body.style.overflow = 'auto';
    }
}

function closeQuantitySelectorModal() {
    const modal = document.getElementById('quantitySelectorModal');
    if (modal) {
        modal.remove();
        document.body.style.overflow = 'auto';
    }
}


function showInputValidationPage(quantity) {
    const existingPage = document.getElementById('inputValidationPage');
    if (existingPage) {
        existingPage.remove();
    }

    // Generate input fields
    let inputFieldsHTML = '';
    for (let i = 1; i <= quantity; i++) {
        inputFieldsHTML += `
            <div class="validation-input-row" style="
                display: flex;
                gap: 10px;
                margin-bottom: 15px;
                align-items: center;
            ">
                <span style="color: white; font-weight: 600; min-width: 30px;">${i}.</span>
                <input type="text" id="ticketInput_${i}" placeholder="Enter Ticket ID" style="
                    flex: 1;
                    padding: 12px;
                    border: 2px solid rgba(255, 255, 255, 0.3);
                    border-radius: 8px;
                    background: rgba(255, 255, 255, 0.1);
                    color: white;
                    font-size: 14px;
                " />
                <button onclick="validateSingleTicket(${i})" style="
                    background: #4ECDC4;
                    color: white;
                    border: none;
                    padding: 12px 20px;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 600;
                    cursor: pointer;
                    transition: all 0.3s ease;
                    white-space: nowrap;
                " onmouseover="this.style.background='#45a9a9'" onmouseout="this.style.background='#4ECDC4'">
                    Validate
                </button>
            </div>
            <div id="validationResult_${i}" style="margin-bottom: 20px;"></div>
        `;
    }

    const pageHTML = `
        <div id="inputValidationPage" style="
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            z-index: 10000;
            overflow-y: auto;
        ">
            <div style="
                background: rgba(255, 255, 255, 0.95);
                backdrop-filter: blur(10px);
                padding: 15px 20px;
                display: flex;
                justify-content: space-between;
                align-items: center;
                position: sticky;
                top: 0;
                z-index: 100;
                border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            ">
                <h1 style="color: #333; font-size: 24px; font-weight: 600; margin: 0;">Ticket Validation</h1>
                <button onclick="closeInputValidationPage()" style="
                    background: #ff4757;
                    color: white;
                    border: none;
                    padding: 10px 15px;
                    border-radius: 8px;
                    cursor: pointer;
                    font-size: 16px;
                    transition: all 0.3s ease;
                " onmouseover="this.style.background='#ff3742'" onmouseout="this.style.background='#ff4757'">
                    <i class="fas fa-times"></i> Close
                </button>
            </div>

            <div style="padding: 20px; max-width: 800px; margin: 0 auto;">
                <div style="
                    background: rgba(255, 255, 255, 0.1);
                    border-radius: 15px;
                    padding: 20px;
                    margin-bottom: 20px;
                    backdrop-filter: blur(10px);
                ">
                    <h3 style="color: white; margin-bottom: 20px; text-align: center;">
                        Event ID: ${currentValidationEventId}
                    </h3>
                    ${inputFieldsHTML}
                </div>
                
                <div style="text-align: center; margin-top: 20px;">
                    <p style="color: rgba(255,255,255,0.8); font-size: 12px;">
                        Powered by <strong style="color: white;">Rewarder</strong>
                    </p>
                </div>
            </div>
        </div>
    `;
    
    document.body.insertAdjacentHTML('beforeend', pageHTML);
    document.body.style.overflow = 'hidden';
}

     async function validateSingleTicket(inputNumber) {
    const ticketInput = document.getElementById(`ticketInput_${inputNumber}`);
    const resultDiv = document.getElementById(`validationResult_${inputNumber}`);
    const ticketId = ticketInput.value.trim();
    
    if (!ticketId) {
        alert('Please enter a ticket ID');
        return;
    }
    
    try {
        // Get current event data first
        const currentEventDoc = await db.collection('physicalEvents').doc(currentValidationEventId).get();
        const currentEventName = currentEventDoc.exists ? currentEventDoc.data().eventName : 'Unknown Event';
        
        // Get ticket from BoughtTicket collection
        const ticketDoc = await db.collection('BoughtTicket').doc(ticketId).get();
        
        if (!ticketDoc.exists) {
            validationAudio.playFailureSound();
            resultDiv.innerHTML = `
                <div style="
                    background: #ff4757;
                    color: white;
                    padding: 15px;
                    border-radius: 10px;
                    text-align: center;
                ">
                    <i class="fas fa-times-circle" style="font-size: 20px; margin-bottom: 10px;"></i>
                    <div>Ticket not found</div>
                    <button onclick="cancelTicketValidation(${inputNumber})" style="
                        background: #95a5a6;
                        color: white;
                        border: none;
                        padding: 8px 15px;
                        border-radius: 6px;
                        font-size: 12px;
                        cursor: pointer;
                        margin-top: 10px;
                    ">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                </div>
            `;
            return;
        }
        
        const ticketData = ticketDoc.data();
        const buyerName = ticketData.ticketbuyername || 'No name provided';
        
        // Verify ticket belongs to current event
        if (ticketData.physicaleventid !== currentValidationEventId) {
            // Get the actual event this ticket belongs to
            const actualEventDoc = await db.collection('physicalEvents').doc(ticketData.physicaleventid).get();
            const actualEventName = actualEventDoc.exists ? actualEventDoc.data().eventName : 'Unknown Event';
            
            validationAudio.playFailureSound();
            resultDiv.innerHTML = `
                <div style="
                    background: #ff4757;
                    color: white;
                    padding: 15px;
                    border-radius: 10px;
                    text-align: center;
                ">
                    <i class="fas fa-exclamation-triangle" style="font-size: 20px; margin-bottom: 10px;"></i>
                    <div style="font-weight: 600; margin-bottom: 5px;">No part of this event</div>
                    <div style="font-size: 14px; margin-bottom: 5px;">User: ${buyerName}</div>
                    <div style="font-size: 14px; margin-bottom: 15px;">This ticket is for: ${actualEventName}</div>
                    <button onclick="cancelTicketValidation(${inputNumber})" style="
                        background: #95a5a6;
                        color: white;
                        border: none;
                        padding: 8px 15px;
                        border-radius: 6px;
                        font-size: 12px;
                        cursor: pointer;
                    ">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                </div>
            `;
            return;
        }
        
        validationAudio.playSuccessSound();
        
        // Display ticket validation box based on status (rest of function remains the same)
        const status = ticketData.boughtticketstatus;
        
        let actionButtons = '';
        let statusColor = '#4ECDC4';
        let statusText = status.toUpperCase();
        
        if (status === 'unused') {
            statusColor = '#4ECDC4';
            statusText = 'VERIFIED';
            actionButtons = `
                <button onclick="stampTicket('${ticketId}', ${inputNumber})" style="
                    background: #27ae60;
                    color: white;
                    border: none;
                    padding: 8px 15px;
                    border-radius: 6px;
                    font-size: 12px;
                    cursor: pointer;
                    margin-right: 5px;
                ">
                    <i class="fas fa-stamp"></i> Stamp
                </button>
                <button onclick="deletePhyTicketValidation('${ticketId}', ${inputNumber})" style="
                    background: #e74c3c;
                    color: white;
                    border: none;
                    padding: 8px 15px;
                    border-radius: 6px;
                    font-size: 12px;
                    cursor: pointer;
                    margin-right: 5px;
                ">
                    <i class="fas fa-trash"></i> Delete
                </button>
                <button onclick="cancelTicketValidation(${inputNumber})" style="
                    background: #95a5a6;
                    color: white;
                    border: none;
                    padding: 8px 15px;
                    border-radius: 6px;
                    font-size: 12px;
                    cursor: pointer;
                ">
                    <i class="fas fa-times"></i> Cancel
                </button>
            `;
        } else if (status === 'used') {
            statusColor = '#f39c12';
            statusText = 'USED';
            actionButtons = `
                <button onclick="deletePhyTicketValidation('${ticketId}', ${inputNumber})" style="
                    background: #e74c3c;
                    color: white;
                    border: none;
                    padding: 8px 15px;
                    border-radius: 6px;
                    font-size: 12px;
                    cursor: pointer;
                    margin-right: 5px;
                ">
                    <i class="fas fa-trash"></i> Delete
                </button>
                <button onclick="cancelTicketValidation(${inputNumber})" style="
                    background: #95a5a6;
                    color: white;
                    border: none;
                    padding: 8px 15px;
                    border-radius: 6px;
                    font-size: 12px;
                    cursor: pointer;
                ">
                    <i class="fas fa-times"></i> Cancel
                </button>
            `;
        } else if (status === 'terminated') {
            statusColor = '#e74c3c';
            statusText = 'TERMINATED';
            actionButtons = `
                <button onclick="cancelTicketValidation(${inputNumber})" style="
                    background: #95a5a6;
                    color: white;
                    border: none;
                    padding: 8px 15px;
                    border-radius: 6px;
                    font-size: 12px;
                    cursor: pointer;
                ">
                    <i class="fas fa-times"></i> Cancel
                </button>
            `;
        }
        
        resultDiv.innerHTML = `
            <div class="ticketvalidationbox" style="
                background: rgba(255, 255, 255, 0.1);
                border: 2px solid ${statusColor};
                border-radius: 10px;
                padding: 15px;
                backdrop-filter: blur(10px);
            ">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                    <span style="color: white; font-weight: 600;">${buyerName}</span>
                    <span style="
                        background: ${statusColor};
                        color: white;
                        padding: 4px 8px;
                        border-radius: 12px;
                        font-size: 12px;
                        font-weight: 600;
                    ">${statusText}</span>
                </div>
                <div style="color: rgba(255,255,255,0.8); font-size: 14px; margin-bottom: 15px;">
                    Event: ${currentEventName}<br>
                    Ticket ID: ${ticketId}
                </div>
                <div class="ticketvalidation-tools" style="display: flex; gap: 5px; flex-wrap: wrap;">
                    ${actionButtons}
                </div>
            </div>
        `;
        
    } catch (error) {
        console.error('Error validating ticket:', error);
        validationAudio.playFailureSound();
        resultDiv.innerHTML = `
            <div style="
                background: #ff4757;
                color: white;
                padding: 15px;
                border-radius: 10px;
                text-align: center;
            ">
                <i class="fas fa-exclamation-triangle" style="font-size: 20px; margin-bottom: 10px;"></i>
                <div>Error validating ticket</div>
                <button onclick="cancelTicketValidation(${inputNumber})" style="
                    background: #95a5a6;
                    color: white;
                    border: none;
                    padding: 8px 15px;
                    border-radius: 6px;
                    font-size: 12px;
                    cursor: pointer;
                    margin-top: 10px;
                ">
                    <i class="fas fa-times"></i> Cancel
                </button>
            </div>
        `;
    }
}


function addEventIdResetButton() {
    return `
        <button onclick="resetEventId()" style="
            background: #f39c12;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            margin-left: 10px;
        ">
            <i class="fas fa-sync"></i> Change Event
        </button>
    `;
}

function resetEventId() {
    if (confirm('Are you sure you want to change the event ID? This will restart the validation session.')) {
        currentValidationEventId = null;
        validationSessionStart = null;
        
        // Close current page and restart
        const qrPage = document.getElementById('qrScannerPage');
        const inputPage = document.getElementById('inputValidationPage');
        
        if (qrPage) {
            closeQRScannerPage();
            openTicketQRScanner();
        } else if (inputPage) {
            closeInputValidationPage();
            openTicketInputScanner();
        }
    }
}
        
  
function closeInputValidationPage() {
    const page = document.getElementById('inputValidationPage');
    if (page) {
        page.remove();
        document.body.style.overflow = 'auto';
    }
}

// Stamp ticket - change status from unused to used
async function stampTicket(ticketId, inputNumber) {
    try {
        await db.collection('BoughtTicket').doc(ticketId).update({
            boughtticketstatus: 'used'
        });
        
        validationAudio.playSuccessSound();
        
        // Update the validation box
        const resultDiv = document.getElementById(`validationResult_${inputNumber}`);
        const currentBox = resultDiv.querySelector('.ticketvalidationbox');
        if (currentBox) {
            const statusSpan = currentBox.querySelector('span:last-child');
            statusSpan.style.background = '#f39c12';
            statusSpan.textContent = 'USED';
            
            // Update border color
            currentBox.style.borderColor = '#f39c12';
            
            // Update action buttons
            const toolsDiv = currentBox.querySelector('.ticketvalidation-tools');
            toolsDiv.innerHTML = `
                <button onclick="deletePhyTicketValidation('${ticketId}', ${inputNumber})" style="
                    background: #e74c3c;
                    color: white;
                    border: none;
                    padding: 8px 15px;
                    border-radius: 6px;
                    font-size: 12px;
                    cursor: pointer;
                    margin-right: 5px;
                ">
                    <i class="fas fa-trash"></i> Delete
                </button>
                <button onclick="cancelTicketValidation(${inputNumber})" style="
                    background: #95a5a6;
                    color: white;
                    border: none;
                    padding: 8px 15px;
                    border-radius: 6px;
                    font-size: 12px;
                    cursor: pointer;
                ">
                    <i class="fas fa-times"></i> Cancel
                </button>
            `;
        }
        
        console.log('Ticket stamped successfully:', ticketId);
        
    } catch (error) {
        console.error('Error stamping ticket:', error);
        validationAudio.playFailureSound();
        alert('Error stamping ticket. Please try again.');
    }
}

// Delete ticket - change status to terminated
async function deletePhyTicketValidation(ticketId, inputNumber) {
    if (!confirm('Are you sure you want to terminate this ticket? This action cannot be undone.')) {
        return;
    }
    
    try {
        await db.collection('BoughtTicket').doc(ticketId).update({
            boughtticketstatus: 'terminated'
        });
        
        validationAudio.playFailureSound();
        
        // Update the validation box
        const resultDiv = document.getElementById(`validationResult_${inputNumber}`);
        const currentBox = resultDiv.querySelector('.ticketvalidationbox');
        if (currentBox) {
            const statusSpan = currentBox.querySelector('span:last-child');
            statusSpan.style.background = '#e74c3c';
            statusSpan.textContent = 'TERMINATED';
            
            // Update border color
            currentBox.style.borderColor = '#e74c3c';
            
            // Update action buttons
            const toolsDiv = currentBox.querySelector('.ticketvalidation-tools');
            toolsDiv.innerHTML = `
                <button onclick="cancelTicketValidation(${inputNumber})" style="
                    background: #95a5a6;
                    color: white;
                    border: none;
                    padding: 8px 15px;
                    border-radius: 6px;
                    font-size: 12px;
                    cursor: pointer;
                ">
                    <i class="fas fa-times"></i> Cancel
                </button>
            `;
        }
        
        console.log('Ticket terminated successfully:', ticketId);
        
    } catch (error) {
        console.error('Error terminating ticket:', error);
        validationAudio.playFailureSound();
        alert('Error terminating ticket. Please try again.');
    }
}

// Cancel ticket validation - clear the input and result
function cancelTicketValidation(inputNumber) {
    const ticketInput = document.getElementById(`ticketInput_${inputNumber}`);
    const resultDiv = document.getElementById(`validationResult_${inputNumber}`);
    
    if (ticketInput) {
        ticketInput.value = '';
    }
    
    if (resultDiv) {
        resultDiv.innerHTML = '';
    }
}


function openTicketQRScanner() {
    console.log('Opening QR scanner...'); // Debug log
    
    try {
        closeValidatorOptionsModal();
        
        // Check if session is still valid
        if (currentValidationEventId && validationSessionStart && 
            (Date.now() - validationSessionStart < validationSessionDuration)) {
            console.log('Using existing session for QR'); // Debug log
            showQRScanner();
            return;
        }
        
        console.log('Starting new QR session'); // Debug log
        showEventIdInput('qr');
        
    } catch (error) {
        console.error('Error opening QR scanner:', error);
        alert('Error opening QR scanner: ' + error.message);
    }
}


function showQRScanner() {
    const existingPage = document.getElementById('qrScannerPage');
    if (existingPage) {
        existingPage.remove();
    }

    const isMobile = window.innerWidth <= 768;
    const isUltraMobile = window.innerWidth <= 480;
const pageHTML = `
        <div id="qrScannerPage" style="
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            z-index: 10000;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        ">
            <div class="${isMobile ? 'mobile-header' : ''} ${isUltraMobile ? 'ultra-mobile-header' : ''}" style="
                background: rgba(255, 255, 255, 0.95);
                backdrop-filter: blur(10px);
                padding: ${isMobile ? '10px 15px' : '15px 20px'};
                display: flex;
                justify-content: space-between;
                align-items: center;
                position: sticky;
                top: 0;
                z-index: 100;
                border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            ">
                <h1 style="color: #333; font-size: ${isUltraMobile ? '16px' : isMobile ? '18px' : '24px'}; font-weight: 600; margin: 0;">QR Scanner</h1>
                <button onclick="closeQRScannerPage()" class="touch-button no-select" style="
                    background: #ff4757;
                    color: white;
                    border: none;
                    padding: ${isMobile ? '8px 12px' : '10px 15px'};
                    border-radius: 8px;
                    cursor: pointer;
                    font-size: ${isMobile ? '14px' : '16px'};
                    transition: all 0.3s ease;
                    min-width: 44px;
                    min-height: 44px;
                ">
                    <i class="fas fa-times"></i> ${isMobile ? '' : 'Close'}
                </button>
            </div>

            <div style="padding: ${isMobile ? '15px' : '20px'}; max-width: 600px; margin: 0 auto; padding-bottom: ${isMobile ? '60px' : '20px'};">
                <div style="
                    background: rgba(255, 255, 255, 0.1);
                    border-radius: 15px;
                    padding: ${isMobile ? '15px' : '20px'};
                    margin-bottom: 20px;
                    backdrop-filter: blur(10px);
                    text-align: center;
                ">
                    <h3 style="color: white; margin-bottom: 20px; font-size: ${isMobile ? '16px' : '18px'};">
                        Event ID: ${currentValidationEventId || 'Loading...'}
                    </h3>
                    
                    <!-- Camera Preview -->
                    <div id="qr-reader" style="
                        width: 100%;
                        max-width: ${isMobile ? '300px' : '400px'};
                        margin: 0 auto 20px auto;
                        border-radius: 10px;
                        overflow: hidden;
                        background: #000;
                        min-height: ${isMobile ? '250px' : '300px'};
                        position: relative;
                    ">
                        <video id="qr-video" style="
                            width: 100%;
                            height: 100%;
                            object-fit: cover;
                        " autoplay muted playsinline></video>
                        
                        <div style="
                            position: absolute;
                            top: 50%;
                            left: 50%;
                            transform: translate(-50%, -50%);
                            border: 2px solid #4ECDC4;
                            width: ${isMobile ? '150px' : '200px'};
                            height: ${isMobile ? '150px' : '200px'};
                            border-radius: 10px;
                            pointer-events: none;
                        "></div>
                    </div>
                    
                    <div class="${isMobile ? 'mobile-qr-controls' : ''}" style="
                        display: flex;
                        gap: ${isMobile ? '8px' : '10px'};
                        justify-content: center;
                        margin-bottom: 20px;
                        flex-direction: ${isMobile ? 'column' : 'row'};
                    ">
                        <button onclick="startCamera()" class="touch-button mobile-button ios-button no-select" style="
                            background: #27ae60;
                            color: white;
                            border: none;
                            padding: ${isMobile ? '12px 20px' : '12px 20px'};
                            border-radius: 8px;
                            font-size: ${isMobile ? '16px' : '14px'};
                            font-weight: 600;
                            cursor: pointer;
                            min-height: 44px;
                            width: ${isMobile ? '100%' : 'auto'};
                        ">
                            <i class="fas fa-camera"></i> Start Camera
                        </button>
                        
                        <button onclick="stopCamera()" class="touch-button mobile-button ios-button no-select" style="
                            background: #e74c3c;
                            color: white;
                            border: none;
                            padding: ${isMobile ? '12px 20px' : '12px 20px'};
                            border-radius: 8px;
                            font-size: ${isMobile ? '16px' : '14px'};
                            font-weight: 600;
                            cursor: pointer;
                            min-height: 44px;
                            width: ${isMobile ? '100%' : 'auto'};
                        ">
                            <i class="fas fa-stop"></i> Stop Camera
                        </button>
                        
                        <input type="file" id="qr-file-input" accept="image/*" style="display: none;" onchange="handleFileUpload(event)">
                        <button onclick="document.getElementById('qr-file-input').click()" class="touch-button mobile-button ios-button no-select" style="
                            background: #f39c12;
                            color: white;
                            border: none;
                            padding: ${isMobile ? '12px 20px' : '12px 20px'};
                            border-radius: 8px;
                            font-size: ${isMobile ? '16px' : '14px'};
                            font-weight: 600;
                            cursor: pointer;
                            min-height: 44px;
                            width: ${isMobile ? '100%' : 'auto'};
                        ">
                            <i class="fas fa-upload"></i> Upload QR
                        </button>
                    </div>
                    
                    <div id="qr-scan-status" style="
                        color: white;
                        font-size: ${isMobile ? '13px' : '14px'};
                        margin-bottom: 20px;
                        min-height: 20px;
                    ">
                        Ready to scan...
                    </div>
                    
                    <!-- Validation Result -->
                    <div id="qr-validation-result" style="margin-bottom: 20px;"></div>
                </div>
                
                <div style="text-align: center;">
                    <p style="color: rgba(255,255,255,0.8); font-size: ${isMobile ? '11px' : '12px'};">
                        Powered by <strong style="color: white;">Rewarder</strong>
                    </p>
                </div>
            </div>
        </div>
    `;
    
    document.body.insertAdjacentHTML('beforeend', pageHTML);
    document.body.style.overflow = 'hidden';
    
    if (isMobile) {
        addMobileTouchHandlers();
    }
    
    // Initialize QR scanning
    initQRScanner();
}

    
let qrStream = null;
let qrScanInterval = null;

async function initQRScanner() {
    // Auto-start camera
    setTimeout(() => {
        startCamera();
    }, 500);
}

async function startCamera() {
    const video = document.getElementById('qr-video');
    const statusDiv = document.getElementById('qr-scan-status');
    
    try {
        statusDiv.textContent = 'Starting camera...';
        
        qrStream = await navigator.mediaDevices.getUserMedia({ 
            video: { 
                facingMode: 'environment',
                width: { ideal: 640 },
                height: { ideal: 480 }
            } 
        });
        
        video.srcObject = qrStream;
        statusDiv.textContent = 'Camera ready - Point at QR code';
        
        // Start scanning
        startQRScanning();
        
    } catch (error) {
        console.error('Error accessing camera:', error);
        statusDiv.textContent = 'Camera access denied. Please use file upload.';
    }
}

function stopCamera() {
    const statusDiv = document.getElementById('qr-scan-status');
    
    if (qrStream) {
        qrStream.getTracks().forEach(track => track.stop());
        qrStream = null;
    }
    
    if (qrScanInterval) {
        clearInterval(qrScanInterval);
        qrScanInterval = null;
    }
    
    statusDiv.textContent = 'Camera stopped';
}

function startQRScanning() {
    const video = document.getElementById('qr-video');
    const canvas = document.createElement('canvas');
    const context = canvas.getContext('2d');
    
    qrScanInterval = setInterval(() => {
        if (video.readyState === video.HAVE_ENOUGH_DATA) {
            canvas.height = video.videoHeight;
            canvas.width = video.videoWidth;
            context.drawImage(video, 0, 0, canvas.width, canvas.height);
            
            const imageData = context.getImageData(0, 0, canvas.width, canvas.height);
            const code = jsQR(imageData.data, imageData.width, imageData.height);
            
            if (code) {
                processQRCode(code.data);
            }
        }
    }, 300);
}

function handleFileUpload(event) {
    const file = event.target.files[0];
    if (!file) return;
    
    const reader = new FileReader();
    reader.onload = function(e) {
        const img = new Image();
        img.onload = function() {
            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d');
            canvas.width = img.width;
            canvas.height = img.height;
            context.drawImage(img, 0, 0);
            
            const imageData = context.getImageData(0, 0, canvas.width, canvas.height);
            const code = jsQR(imageData.data, imageData.width, imageData.height);
            
            if (code) {
                processQRCode(code.data);
            } else {
                document.getElementById('qr-scan-status').textContent = 'No QR code found in image';
            }
        };
        img.src = e.target.result;
    };
    reader.readAsDataURL(file);
}

        
   
    async function processQRCode(qrData) {
    const statusDiv = document.getElementById('qr-scan-status');
    const resultDiv = document.getElementById('qr-validation-result');
    
    // Start processing timer
    const processingStart = Date.now();
    
    try {
        statusDiv.innerHTML = `
            <div style="color: #f39c12;">
                <i class="fas fa-spinner fa-spin"></i> Scanned! Processing...
            </div>
        `;
        
        // Parse QR data with timeout
        let ticketInfo;
        try {
            ticketInfo = JSON.parse(qrData);
        } catch (error) {
            throw new Error('Invalid QR code format');
        }
        
        const ticketId = ticketInfo.ticketId;
        if (!ticketId) {
            throw new Error('No ticket ID found in QR code');
        }
        
        // Get ticket from Firebase with timeout
        const ticketPromise = db.collection('BoughtTicket').doc(ticketId).get();
        const eventPromise = db.collection('physicalEvents').doc(currentValidationEventId).get();
        
        const [ticketDoc, currentEventDoc] = await Promise.race([
            Promise.all([ticketPromise, eventPromise]),
            new Promise((_, reject) => setTimeout(() => reject(new Error('Processing timeout')), 8000))
        ]);
        
        if (!ticketDoc.exists) {
            throw new Error('Ticket not found');
        }
        
        const ticketData = ticketDoc.data();
        const currentEventData = currentEventDoc.data();
        const currentEventName = currentEventData ? currentEventData.eventName : 'Unknown Event';
        const buyerName = ticketData.ticketbuyername || 'No name provided';
        
        // Check if ticket belongs to current event
        if (ticketData.physicaleventid !== currentValidationEventId) {
            // Get the actual event this ticket belongs to
            const actualEventDoc = await db.collection('physicalEvents').doc(ticketData.physicaleventid).get();
            const actualEventName = actualEventDoc.exists ? actualEventDoc.data().eventName : 'Unknown Event';
            
            validationAudio.playFailureSound();
            statusDiv.textContent = 'Wrong Event';
            
            resultDiv.innerHTML = `
                <div style="
                    background: #ff4757;
                    color: white;
                    padding: 15px;
                    border-radius: 10px;
                    text-align: center;
                ">
                    <i class="fas fa-exclamation-triangle" style="font-size: 20px; margin-bottom: 10px;"></i>
                    <div style="font-weight: 600; margin-bottom: 5px;">No part of this event</div>
                    <div style="font-size: 14px; margin-bottom: 10px;">User: ${buyerName}</div>
                    <div style="font-size: 14px; margin-bottom: 15px;">This ticket is for: ${actualEventName}</div>
                    <button onclick="clearQRResult()" style="
                        background: #95a5a6;
                        color: white;
                        border: none;
                        padding: 8px 15px;
                        border-radius: 6px;
                        font-size: 12px;
                        cursor: pointer;
                    ">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                </div>
            `;
            return;
        }
        
        const status = ticketData.boughtticketstatus;
        
        if (status === 'unused') {
            // Success - show verification and change status
            validationAudio.playSuccessSound();
            statusDiv.innerHTML = `
                <div style="color: #27ae60; font-weight: 600;">
                    <i class="fas fa-check-circle"></i> Verified!
                </div>
            `;
            
            // Change status to used
            await db.collection('BoughtTicket').doc(ticketId).update({
                boughtticketstatus: 'used'
            });
            
            resultDiv.innerHTML = `
                <div style="
                    background: rgba(39, 174, 96, 0.2);
                    border: 2px solid #27ae60;
                    color: white;
                    padding: 15px;
                    border-radius: 10px;
                    text-align: center;
                ">
                    <i class="fas fa-check-circle" style="font-size: 24px; margin-bottom: 10px; color: #27ae60;"></i>
                    <div style="font-weight: 600; font-size: 18px; margin-bottom: 5px;">VERIFIED</div>
                    <div style="font-size: 16px; margin-bottom: 5px;">User: ${buyerName}</div>
                    <div style="font-size: 14px; opacity: 0.9;">Event: ${currentEventName}</div>
                </div>
            `;
            
        } else if (status === 'used') {
            // Already used
            validationAudio.playFailureSound();
            statusDiv.innerHTML = `
                <div style="color: #f39c12; font-weight: 600;">
                    <i class="fas fa-exclamation-circle"></i> Already Used!
                </div>
            `;
            
            resultDiv.innerHTML = `
                <div style="
                    background: rgba(243, 156, 18, 0.2);
                    border: 2px solid #f39c12;
                    color: white;
                    padding: 15px;
                    border-radius: 10px;
                    text-align: center;
                ">
                    <i class="fas fa-exclamation-circle" style="font-size: 24px; margin-bottom: 10px; color: #f39c12;"></i>
                    <div style="font-weight: 600; font-size: 18px; margin-bottom: 5px;">USED</div>
                    <div style="font-size: 16px; margin-bottom: 5px;">User: ${buyerName}</div>
                    <div style="font-size: 14px; opacity: 0.9;">Event: ${currentEventName}</div>
                </div>
            `;
            
        } else if (status === 'terminated') {
            // Terminated ticket
            validationAudio.playFailureSound();
            statusDiv.innerHTML = `
                <div style="color: #e74c3c; font-weight: 600;">
                    <i class="fas fa-ban"></i> Terminated!
                </div>
            `;
            
            resultDiv.innerHTML = `
                <div style="
                    background: rgba(231, 76, 60, 0.2);
                    border: 2px solid #e74c3c;
                    color: white;
                    padding: 15px;
                    border-radius: 10px;
                    text-align: center;
                ">
                    <i class="fas fa-ban" style="font-size: 24px; margin-bottom: 10px; color: #e74c3c;"></i>
                    <div style="font-weight: 600; font-size: 18px; margin-bottom: 5px;">TERMINATED</div>
                    <div style="font-size: 16px; margin-bottom: 5px;">User: ${buyerName}</div>
                    <div style="font-size: 14px; opacity: 0.9;">Event: ${currentEventName}</div>
                </div>
            `;
        }
        
        // Show processing time
        const processingTime = ((Date.now() - processingStart) / 1000).toFixed(1);
        console.log(`QR processed in ${processingTime}s`);
        
        // Auto-clear result after 3 seconds for next scan
        setTimeout(() => {
            clearQRResult();
        }, 3000);
        
    } catch (error) {
        validationAudio.playFailureSound();
        statusDiv.innerHTML = `
            <div style="color: #e74c3c; font-weight: 600;">
                <i class="fas fa-times-circle"></i> Scan Failed
            </div>
        `;
        
        resultDiv.innerHTML = `
            <div style="
                background: #ff4757;
                color: white;
                padding: 15px;
                border-radius: 10px;
                text-align: center;
            ">
                <i class="fas fa-times-circle" style="font-size: 20px; margin-bottom: 10px;"></i>
                <div style="font-weight: 600; margin-bottom: 10px;">${error.message}</div>
                <button onclick="clearQRResult()" style="
                    background: #95a5a6;
                    color: white;
                    border: none;
                    padding: 8px 15px;
                    border-radius: 6px;
                    font-size: 12px;
                    cursor: pointer;
                ">
                    <i class="fas fa-times"></i> Cancel
                </button>
            </div>
        `;
        
        // Auto-clear result after 5 seconds
        setTimeout(() => {
            clearQRResult();
        }, 5000);
    }
}

function clearQRResult() {
    const statusDiv = document.getElementById('qr-scan-status');
    const resultDiv = document.getElementById('qr-validation-result');
    
    if (statusDiv) {
        statusDiv.textContent = 'Ready for next scan...';
    }
    if (resultDiv) {
        resultDiv.innerHTML = '';
    }
}


function closeQRScannerPage() {
    // Stop camera if running
    if (typeof stopCamera === 'function') {
        stopCamera();
    }
    
    const page = document.getElementById('qrScannerPage');
    if (page) {
        page.remove();
        document.body.style.overflow = 'auto';
    }
}



// Add viewport meta tag if not present
function ensureViewportMeta() {
    if (!document.querySelector('meta[name="viewport"]')) {
        const viewport = document.createElement('meta');
        viewport.name = 'viewport';
        viewport.content = 'width=device-width, initial-scale=1.0, user-scalable=no';
        document.head.appendChild(viewport);
    }
}

// Call this when the page loads
document.addEventListener('DOMContentLoaded', function() {
    ensureViewportMeta();
});


// Load new event tickets (unused and not expired)
async function loadNewEventTickets() {
    const container = document.getElementById('new-tickets-container');
    if (!container) return;
    
    try {
        const currentUser = firebase.auth().currentUser;
        if (!currentUser) {
            container.innerHTML = `
                <div style="text-align: center; color: white; padding: 40px;">
                    <i class="fas fa-user-times" style="font-size: 48px; margin-bottom: 20px; opacity: 0.5;"></i>
                    <h3 style="margin-bottom: 10px;">Please Sign In</h3>
                    <p>Sign in to view your tickets</p>
                </div>
            `;
            return;
        }

        // Query BoughtTicket collection for current user
        const ticketsSnapshot = await db.collection('BoughtTicket')
            .where('userId', '==', currentUser.uid)
            .where('boughtticketstatus', '==', 'unused')
            .get();

        if (ticketsSnapshot.empty) {
            container.innerHTML = `
                <div style="text-align: center; color: white; padding: 40px;">
                    <i class="fas fa-ticket-alt" style="font-size: 48px; margin-bottom: 20px; opacity: 0.5;"></i>
                    <h3 style="margin-bottom: 10px;">No Active Tickets</h3>
                    <p style="margin-bottom: 20px;">You don't have any unused tickets yet</p>
                    <a href="https://rewarderhub.vercel.app" style="
                        color: #4ECDC4;
                        text-decoration: none;
                        font-weight: 600;
                    ">Get tickets at Rewarder Hub</a>
                </div>
            `;
            return;
        }

        const tickets = [];
        const eventPromises = [];

        // Collect tickets and prepare event queries
        ticketsSnapshot.forEach(doc => {
            const ticketData = { id: doc.id, ...doc.data() };
            tickets.push(ticketData);
            
            // Get event data for each ticket
            eventPromises.push(
                db.collection('physicalEvents').doc(ticketData.physicaleventid).get()
            );
        });

        // Fetch all event data
        const eventSnapshots = await Promise.all(eventPromises);
        
        // Filter out expired tickets and combine with event data
        const validTickets = [];
        tickets.forEach((ticket, index) => {
            const eventSnapshot = eventSnapshots[index];
            if (eventSnapshot.exists) {
                const eventData = eventSnapshot.data();
                const eventEndDate = new Date(eventData.endDateTime);
                const now = new Date();
                
                // Only include tickets for events that haven't ended
                if (eventEndDate > now) {
                    validTickets.push({
                        ...ticket,
                        eventData: eventData
                    });
                }
            }
        });

        if (validTickets.length === 0) {
            container.innerHTML = `
                <div style="text-align: center; color: white; padding: 40px;">
                    <i class="fas fa-calendar-times" style="font-size: 48px; margin-bottom: 20px; opacity: 0.5;"></i>
                    <h3 style="margin-bottom: 10px;">No Current Events</h3>
                    <p style="margin-bottom: 20px;">All your tickets are for past events</p>
                    <a href="https://rewarder-hub.vercel.app" style="
                        color: #4ECDC4;
                        text-decoration: none;
                        font-weight: 600;
                    ">Find new events at Rewarder Hub</a>
                </div>
            `;
            return;
        } // Generate ticket cards
        const ticketCardsHTML = validTickets.map(ticket => generateNewPhyEventTicketCard(ticket)).join('');
        container.innerHTML = `
            <div style="display: flex; flex-direction: column; gap: 20px;">
                ${ticketCardsHTML}
            </div>
        `;

    } catch (error) {
        console.error('Error loading new tickets:', error);
        container.innerHTML = `
            <div style="text-align: center; color: white; padding: 40px;">
                <i class="fas fa-exclamation-triangle" style="font-size: 48px; margin-bottom: 20px; color: #ff4757;"></i>
                <h3 style="margin-bottom: 10px; color: #ff4757;">Error Loading Tickets</h3>
                <p>Please try again later</p>
            </div>
        `;
    }
} 



// Sport Event Page JavaScript
class SportEventPage {
    constructor() {
        this.isOpen = false;
        this.init();
    }

    init() {
        this.bindEvents();
        this.setupSponsorScroll();
    }

    bindEvents() {
        // Close button event
        const closeBtn = document.querySelector('.close-sport-event-page-btn');
        if (closeBtn) {
            closeBtn.addEventListener('click', () => this.closePage());
        }

        // Action button events
        const hostBtn = document.getElementById('host-sport-event');
        const joinedBtn = document.getElementById('joined-sport-event');

        if (hostBtn) {
            hostBtn.addEventListener('click', () => this.handleHostEvent());
        }

        if (joinedBtn) {
            joinedBtn.addEventListener('click', () => this.handleJoinedEvents());
        }

        // Close on escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && this.isOpen) {
                this.closePage();
            }
        });

        // Close on outside click
        const sportPage = document.querySelector('.sport-event-page');
        if (sportPage) {
            sportPage.addEventListener('click', (e) => {
                if (e.target === sportPage) {
                    this.closePage();
                }
            });
        }
    }

    openPage() {
        const sportPage = document.querySelector('.sport-event-page');
        if (sportPage) {
            sportPage.style.display = 'block';
            document.body.style.overflow = 'hidden';
            this.isOpen = true;
            
            // Add opening animation
            setTimeout(() => {
                sportPage.style.opacity = '1';
            }, 10);

            // Track page view
            this.trackPageView();
        }
    }

    closePage() {
        const sportPage = document.querySelector('.sport-event-page');
        if (sportPage) {
            sportPage.style.display = 'none';
            document.body.style.overflow = 'auto';
            this.isOpen = false;
        }
    }

    handleHostEvent() {
        console.log('Host Sport Event clicked');
        
        // Add button click animation
        const hostBtn = document.getElementById('host-sport-event');
        this.animateButton(hostBtn);

        // TODO: Navigate to sport event creation page
        // For now, show coming soon message
        this.showComingSoon('Host Sport Event');
        
        // Track button click
        this.trackButtonClick('host_sport_event');
    }

    handleJoinedEvents() {
        console.log('Joined Sport Events clicked');
        
        // Add button click animation
        const joinedBtn = document.getElementById('joined-sport-event');
        this.animateButton(joinedBtn);

        // TODO: Show user's joined sport events
        // For now, show coming soon message
        this.showComingSoon('Joined Sport Events');
        
        // Track button click
        this.trackButtonClick('joined_sport_events');
    }

    animateButton(button) {
        if (!button) return;
        
        button.style.transform = 'scale(0.95)';
        setTimeout(() => {
            button.style.transform = 'translateY(-2px)';
        }, 150);
    }

    showComingSoon(feature) {
        // Create temporary notification
        const notification = document.createElement('div');
        notification.className = 'sport-coming-soon-notification';
        notification.innerHTML = `
            <div class="sport-notification-content">
                <i class="fas fa-rocket"></i>
                <h3>${feature}</h3>
                <p>Coming Soon! This feature is under development.</p>
            </div>
        `;
        
        // Add notification styles
        notification.style.cssText = `
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(22, 33, 62, 0.95);
            border: 2px solid #008B8B;
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            color: white;
            z-index: 1001;
            backdrop-filter: blur(10px);
            animation: fadeInScale 0.3s ease;
        `;

        document.body.appendChild(notification);

        // Auto remove after 3 seconds
        setTimeout(() => {
            notification.style.animation = 'fadeOutScale 0.3s ease';
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 300);
        }, 3000);

        // Add CSS animations if not already added
        this.addNotificationStyles();
    }

    addNotificationStyles() {
        if (document.getElementById('sport-notification-styles')) return;

        const styles = document.createElement('style');
        styles.id = 'sport-notification-styles';
        styles.textContent = `
            @keyframes fadeInScale {
                from {
                    opacity: 0;
                    transform: translate(-50%, -50%) scale(0.8);
                }
                to {
                    opacity: 1;
                    transform: translate(-50%, -50%) scale(1);
                }
            }
            
            @keyframes fadeOutScale {
                from {
                    opacity: 1;
                    transform: translate(-50%, -50%) scale(1);
                }
                to {
                    opacity: 0;
                    transform: translate(-50%, -50%) scale(0.8);
                }
            }
            
            .sport-notification-content i {
                font-size: 2rem;
                color: #008B8B;
                margin-bottom: 15px;
            }
            
            .sport-notification-content h3 {
                margin: 0 0 10px 0;
                font-size: 1.3rem;
                color: white;
            }
            
            .sport-notification-content p {
                margin: 0;
                color: rgba(255, 255, 255, 0.8);
                font-size: 0.9rem;
            }
        `;
        
        document.head.appendChild(styles);
    }

    setupSponsorScroll() {
        // Pause animation on hover
        const sponsorContainer = document.querySelector('.sport-sponsors-scroll');
        if (sponsorContainer) {
            sponsorContainer.addEventListener('mouseenter', () => {
                sponsorContainer.style.animationPlayState = 'paused';
            });

            sponsorContainer.addEventListener('mouseleave', () => {
                sponsorContainer.style.animationPlayState = 'running';
            });
        }
    }

    trackPageView() {
        // Track sport event page view
        if (typeof gtag !== 'undefined') {
            gtag('event', 'page_view', {
                page_title: 'Sport Events',
                page_location: window.location.href,
                custom_parameter: 'sport_events_page'
            });
        }
        
        console.log('Sport Event Page viewed');
    }

    trackButtonClick(buttonType) {
        // Track button clicks
        if (typeof gtag !== 'undefined') {
            gtag('event', 'click', {
                event_category: 'Sport Events',
                event_label: buttonType,
                custom_parameter: 'sport_event_action'
            });
        }
        
        console.log(`Sport Event Button clicked: ${buttonType}`);
    }

    // Method to update sponsors dynamically
    updateSponsors(sponsors) {
        const scrollContainer = document.querySelector('.sport-sponsors-scroll');
        if (!scrollContainer || !sponsors || !Array.isArray(sponsors)) return;

        // Clear existing sponsors
        scrollContainer.innerHTML = '';

        // Add new sponsors (duplicate for seamless loop)
        const sponsorItems = [...sponsors, ...sponsors];
        
        sponsorItems.forEach(sponsor => {
            const sponsorElement = document.createElement('div');
            sponsorElement.className = 'sport-sponsor-item';
            sponsorElement.innerHTML = `
                <img src="${sponsor.logo || 'https://via.placeholder.com/80x40/008B8B/white?text=' + sponsor.name}" 
                     alt="${sponsor.name}" 
                     onerror="this.src='https://via.placeholder.com/80x40/008B8B/white?text=${sponsor.name}'">
                <span>${sponsor.name}</span>
            `;
            scrollContainer.appendChild(sponsorElement);
        });
    }

    // Method to check if page is open
    isPageOpen() {
        return this.isOpen;
    }
}

// Global function to open sport event page (called from your card click)
function openSportEvent() {
    if (window.sportEventPageInstance) {
        window.sportEventPageInstance.openPage();
    } else {
        console.error('Sport Event Page not initialized');
    }
}

// Initialize Sport Event Page when DOM is loaded
document.addEventListener('DOMContentLoaded', function() {
    // Initialize the sport event page
    window.sportEventPageInstance = new SportEventPage();
    
    console.log('Sport Event Page initialized');
});

// Example sponsors data (you can replace with your actual sponsors)
const defaultSponsors = [
    { name: 'Nike', logo: 'https://via.placeholder.com/80x40/008B8B/white?text=Nike' },
    { name: 'Adidas', logo: 'https://via.placeholder.com/80x40/008B8B/white?text=Adidas' },
    { name: 'Puma', logo: 'https://via.placeholder.com/80x40/008B8B/white?text=Puma' },
    { name: 'FIFA', logo: 'https://via.placeholder.com/80x40/008B8B/white?text=FIFA' },
    { name: 'UEFA', logo: 'https://via.placeholder.com/80x40/008B8B/white?text=UEFA' },
    { name: 'ESPN', logo: 'https://via.placeholder.com/80x40/008B8B/white?text=ESPN' },
    { name: 'NBC Sports', logo: 'https://via.placeholder.com/80x40/008B8B/white?text=NBC' },
    { name: 'FOX Sports', logo: 'https://via.placeholder.com/80x40/008B8B/white?text=FOX' }
];

// Auto-update sponsors on page load
window.addEventListener('load', function() {
    if (window.sportEventPageInstance) {
        window.sportEventPageInstance.updateSponsors(defaultSponsors);
    }
});


// Modified HostSportEventPopup class - update the handleCategoryClick method
class HostSportEventPopup {
    constructor() {
        this.isOpen = false;
        this.selectedSport = null;
        this.init();
    }

    init() {
        this.bindEvents();
    }

    bindEvents() {
        // Close button event
        const closeBtn = document.querySelector('.close-host-sport-popup-btn');
        if (closeBtn) {
            closeBtn.addEventListener('click', () => this.closePopup());
        }

        // Category card events
        const categoryCards = document.querySelectorAll('.host-sport-category-card');
        categoryCards.forEach(card => {
            card.addEventListener('click', () => this.handleCategoryClick(card));
        });

        // Close on escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && this.isOpen) {
                this.closePopup();
            }
        });

        // Close on outside click
        const popupOverlay = document.getElementById('host-sport-popup');
        if (popupOverlay) {
            popupOverlay.addEventListener('click', (e) => {
                if (e.target === popupOverlay) {
                    this.closePopup();
                }
            });
        }
    }

    // MODIFIED: Handle category click with special case for football
    handleCategoryClick(card) {
        if (!card) return;

        const sportType = card.dataset.sport;
        const isAccessible = card.classList.contains('accessible');
        
        console.log(`Category clicked: ${sportType}, accessible: ${isAccessible}`);
        
        this.selectedSport = sportType;
        this.animateCard(card);
        this.trackCategoryClick(sportType, isAccessible);

        // Special handling for football - open football modal
        if (sportType === 'football' && isAccessible) {
            console.log('Opening football event modal...');
            
            // Close the sport selection popup first
            this.closePopup();
            
            // Small delay to ensure smooth transition
            setTimeout(() => {
                const footballOverlay = document.getElementById('footballEventOverlay');
                if (footballOverlay) {
                    footballOverlay.style.display = 'flex';
                    document.body.style.overflow = 'hidden';
                    console.log('Football modal opened');
                } else {
                    console.error('Football modal not found');
                }
            }, 200);
            
            return;
        }

        // Handle other sports (coming soon)
        if (isAccessible) {
            console.log(`Opening ${sportType} event creation...`);
            // Add other sport handlers here when they become available
        } else {
            this.handleComingSoonSport(sportType);
        }
    }

    openPopup() {
        const popup = document.getElementById('host-sport-popup');
        if (popup) {
            popup.style.display = 'flex';
            document.body.style.overflow = 'hidden';
            this.isOpen = true;
            this.trackPopupView();
        }
    }

    closePopup() {
        const popup = document.getElementById('host-sport-popup');
        if (popup) {
            popup.style.display = 'none';
            document.body.style.overflow = 'auto';
            this.isOpen = false;
            this.selectedSport = null;
        }
    }

    handleComingSoonSport(sportType) {
        console.log(`Coming soon sport clicked: ${sportType}`);
        this.showComingSoonNotification(sportType);
    }

    showComingSoonNotification(sportType) {
        const sportName = this.getSportDisplayName(sportType);
        
        const notification = document.createElement('div');
        notification.className = 'coming-soon-notification';
        notification.innerHTML = `
            <div class="coming-soon-notification-content">
                <i class="fas fa-clock"></i>
                <h3>${sportName}</h3>
                <p>This sport category is coming soon!</p>
                <small>We're working hard to bring you more sports options.</small>
            </div>
        `;
        
        notification.style.cssText = `
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(22, 33, 62, 0.95);
            border: 2px solid #ffc107;
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            color: white;
            z-index: 1002;
            backdrop-filter: blur(10px);
            animation: fadeInScale 0.3s ease;
            max-width: 300px;
        `;

        document.body.appendChild(notification);

        // Auto remove after 3 seconds
        setTimeout(() => {
            notification.style.animation = 'fadeOutScale 0.3s ease';
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 300);
        }, 3000);

        this.addComingSoonNotificationStyles();
    }

    animateCard(card) {
        if (!card) return;
        
        card.style.transform = 'scale(0.95)';
        setTimeout(() => {
            if (card.classList.contains('accessible')) {
                card.style.transform = 'translateY(-3px) scale(1)';
            } else {
                card.style.transform = 'scale(1)';
            }
        }, 150);
    }

    getSportDisplayName(sportType) {
        const sportNames = {
            'football': 'Football',
            'basketball': 'Basketball',
            'table-tennis': 'Table Tennis',
            'tennis': 'Tennis',
            'volleyball': 'Volleyball',
            'badminton': 'Badminton',
            'running': 'Running',
            'swimming': 'Swimming',
            'cycling': 'Cycling',
            'boxing': 'Boxing',
            'wrestling': 'Wrestling',
            'golf': 'Golf',
            'baseball': 'Baseball',
            'hockey': 'Hockey',
            'cricket': 'Cricket',
            'rugby': 'Rugby',
            'gymnastics': 'Gymnastics',
            'indoor-sports': 'Indoor Sports',
            'all-events': 'All Events'
        };
        
        return sportNames[sportType] || sportType;
    }

    trackPopupView() {
        if (typeof gtag !== 'undefined') {
            gtag('event', 'popup_view', {
                event_category: 'Sport Events',
                event_label: 'host_sport_popup',
                custom_parameter: 'sport_category_selection'
            });
        }
        
        console.log('Host Sport Event Popup viewed');
    }

    trackCategoryClick(sportType, isAccessible) {
        if (typeof gtag !== 'undefined') {
            gtag('event', 'click', {
                event_category: 'Sport Categories',
                event_label: sportType,
                custom_parameter: isAccessible ? 'accessible' : 'coming_soon'
            });
        }
        
        console.log(`Sport category clicked: ${sportType} (${isAccessible ? 'accessible' : 'coming soon'})`);
    }

    addComingSoonNotificationStyles() {
        if (document.getElementById('coming-soon-notification-styles')) return;
        
        const styles = document.createElement('style');
        styles.id = 'coming-soon-notification-styles';
        styles.textContent = `
            .coming-soon-notification-content i {
                font-size: 2rem;
                color: #ffc107;
                margin-bottom: 15px;
            }
            
            .coming-soon-notification-content h3 {
                margin: 0 0 10px 0;
                font-size: 1.2rem;
                color: white;
            }
            
            .coming-soon-notification-content p {
                margin: 0 0 10px 0;
                color: rgba(255, 255, 255, 0.9);
                font-size: 0.9rem;
            }
            
            .coming-soon-notification-content small {
                color: rgba(255, 255, 255, 0.7);
                font-size: 0.8rem;
                line-height: 1.4;
            }
            
            @keyframes fadeInScale {
                from {
                    opacity: 0;
                    transform: translate(-50%, -50%) scale(0.8);
                }
                to {
                    opacity: 1;
                    transform: translate(-50%, -50%) scale(1);
                }
            }
            
            @keyframes fadeOutScale {
                from {
                    opacity: 1;
                    transform: translate(-50%, -50%) scale(1);
                }
                to {
                    opacity: 0;
                    transform: translate(-50%, -50%) scale(0.8);
                }
            }
        `;
        
        document.head.appendChild(styles);
    }

    isPopupOpen() {
        return this.isOpen;
    }

    getSelectedSport() {
        return this.selectedSport;
    }
}




// Update the original SportEventPage class to integrate with popup
// Add this to your existing sport-event-page.js file:
// Update the handleHostEvent method in SportEventPage class:
function updateSportEventPageHandleHostEvent() {
    // Replace the existing handleHostEvent method in SportEventPage class with this:
    
    SportEventPage.prototype.handleHostEvent = function() {
        console.log('Host Sport Event clicked');
        
        // Add button click animation
        const hostBtn = document.getElementById('host-sport-event');
        this.animateButton(hostBtn);

        // Open the host sport event popup
        if (window.hostSportEventPopupInstance) {
            window.hostSportEventPopupInstance.openPopup();
        } else {
            console.error('Host Sport Event Popup not initialized');
        }
        
        // Track button click
        this.trackButtonClick('host_sport_event');
    };
}

// Initialize Host Sport Event Popup when DOM is loaded
document.addEventListener('DOMContentLoaded', function() {
    // Initialize the host sport event popup
    window.hostSportEventPopupInstance = new HostSportEventPopup();
    
    // Update the sport event page handler
    updateSportEventPageHandleHostEvent();
    
    console.log('Host Sport Event Popup initialized');
});

// Additional utility functions for the popup
class HostSportEventUtils {
    static getSportIcon(sportType) {
        const icons = {
            'football': 'fas fa-futbol',
            'basketball': 'fas fa-basketball-ball',
            'table-tennis': 'fas fa-ping-pong-paddle-ball',
            'tennis': 'fas fa-table-tennis',
            'volleyball': 'fas fa-volleyball-ball',
            'badminton': 'fas fa-shuttlecock',
            'running': 'fas fa-running',
            'swimming': 'fas fa-swimmer',
            'cycling': 'fas fa-biking',
            'boxing': 'fas fa-fist-raised',
            'wrestling': 'fas fa-hand-rock',
            'golf': 'fas fa-golf-ball',
            'baseball': 'fas fa-baseball-ball',
            'hockey': 'fas fa-hockey-puck',
            'cricket': 'fas fa-cricket',
            'rugby': 'fas fa-football-ball',
            'gymnastics': 'fas fa-child',
            'indoor-sports': 'fas fa-home',
            'all-events': 'fas fa-globe'
        };
        
        return icons[sportType] || 'fas fa-trophy';
    }

    static getSportDescription(sportType) {
        const descriptions = {
            'football': 'Create football matches, tournaments and leagues',
            'basketball': 'Organize basketball games and competitions',
            'table-tennis': 'Host table tennis tournaments and matches',
            'tennis': 'Set up tennis matches and tournaments',
            'volleyball': 'Create volleyball games and competitions',
            'badminton': 'Organize badminton matches and tournaments',
            'running': 'Host running events, marathons and races',
            'swimming': 'Create swimming competitions and events',
            'cycling': 'Organize cycling races and tours',
            'boxing': 'Set up boxing matches and tournaments',
            'wrestling': 'Host wrestling competitions and matches',
            'golf': 'Create golf tournaments and competitions',
            'baseball': 'Organize baseball games and leagues',
            'hockey': 'Set up hockey matches and tournaments',
            'cricket': 'Host cricket matches and tournaments',
            'rugby': 'Create rugby games and competitions',
            'gymnastics': 'Organize gymnastics competitions',
            'indoor-sports': 'Host various indoor sporting events',
            'all-events': 'Access all available sport categories'
        };
        
        return descriptions[sportType] || 'Create and manage sport events';
    }

    static isAccessibleSport(sportType) {
        // Only football is accessible for now
        const accessibleSports = ['football'];
        return accessibleSports.includes(sportType);
    }

    static getComingSoonMessage(sportType) {
        const messages = {
            'basketball': 'Basketball events coming in the next update!',
            'table-tennis': 'Table tennis tournaments will be available soon!',
            'tennis': 'Tennis matches coming to your area soon!',
            'volleyball': 'Volleyball competitions launching soon!',
            'badminton': 'Badminton tournaments in development!',
            'running': 'Running events and marathons coming soon!',
            'swimming': 'Swimming competitions launching next month!',
            'cycling': 'Cycling races and tours coming soon!',
            'boxing': 'Boxing matches will be available soon!',
            'wrestling': 'Wrestling competitions in development!',
            'golf': 'Golf tournaments launching soon!',
            'baseball': 'Baseball leagues coming to your area!',
            'hockey': 'Hockey matches will be available soon!',
            'cricket': 'Cricket tournaments launching soon!',
            'rugby': 'Rugby competitions in development!',
            'gymnastics': 'Gymnastics events coming soon!',
            'indoor-sports': 'Indoor sports categories launching soon!',
            'all-events': 'All events access coming in future updates!'
        };
        
        return messages[sportType] || 'This sport category will be available soon!';
    }
}

// Enhanced popup with dynamic content loading
class EnhancedHostSportEventPopup extends HostSportEventPopup {
    constructor() {
        super();
        this.loadingSports = false;
    }

    // Method to dynamically load sport categories from database
    async loadSportCategories() {
        if (this.loadingSports) return;
        
        this.loadingSports = true;
        
        try {
            // TODO: Replace with actual Firebase call
            // const sportsData = await this.fetchSportsFromFirebase();
            
            // For now, use static data
            const sportsData = this.getStaticSportsData();
            this.renderSportCategories(sportsData);
            
        } catch (error) {
            console.error('Error loading sport categories:', error);
            this.showErrorMessage('Failed to load sport categories');
        } finally {
            this.loadingSports = false;
        }
    }

    getStaticSportsData() {
        return [
            { id: 'football', name: 'Football', accessible: true, popular: true },
            { id: 'basketball', name: 'Basketball', accessible: false, popular: true },
            { id: 'table-tennis', name: 'Table Tennis', accessible: false, popular: false },
            { id: 'tennis', name: 'Tennis', accessible: false, popular: true },
            { id: 'volleyball', name: 'Volleyball', accessible: false, popular: false },
            { id: 'badminton', name: 'Badminton', accessible: false, popular: false },
            { id: 'running', name: 'Running', accessible: false, popular: true },
            { id: 'swimming', name: 'Swimming', accessible: false, popular: false },
            { id: 'cycling', name: 'Cycling', accessible: false, popular: false },
            { id: 'boxing', name: 'Boxing', accessible: false, popular: false },
            { id: 'wrestling', name: 'Wrestling', accessible: false, popular: false },
            { id: 'golf', name: 'Golf', accessible: false, popular: false },
            { id: 'baseball', name: 'Baseball', accessible: false, popular: false },
            { id: 'hockey', name: 'Hockey', accessible: false, popular: false },
            { id: 'cricket', name: 'Cricket', accessible: false, popular: true },
            { id: 'rugby', name: 'Rugby', accessible: false, popular: false },
            { id: 'gymnastics', name: 'Gymnastics', accessible: false, popular: false },
            { id: 'indoor-sports', name: 'Indoor Sports', accessible: false, popular: false },
            { id: 'all-events', name: 'All Events', accessible: false, popular: false }
        ];
    }

    renderSportCategories(sportsData) {
        const grid = document.querySelector('.host-sport-categories-grid');
        if (!grid) return;

        // Clear existing content
        grid.innerHTML = '';

        // Sort sports: accessible first, then popular, then alphabetical
        sportsData.sort((a, b) => {
            if (a.accessible !== b.accessible) return b.accessible - a.accessible;
            if (a.popular !== b.popular) return b.popular - a.popular;
            return a.name.localeCompare(b.name);
        });

        // Render each sport category
        sportsData.forEach(sport => {
            const card = this.createSportCard(sport);
            grid.appendChild(card);
        });
    }

    createSportCard(sport) {
        const card = document.createElement('div');
        card.className = `host-sport-category-card ${sport.accessible ? 'accessible' : 'coming-soon'}`;
        card.setAttribute('data-sport', sport.id);
        
        card.innerHTML = `
            <div class="host-sport-category-icon">
                <i class="${HostSportEventUtils.getSportIcon(sport.id)}"></i>
            </div>
            <div class="host-sport-category-info">
                <h5>${sport.name}</h5>
                <span class="host-sport-category-status ${sport.accessible ? 'available' : 'coming-soon'}">
                    ${sport.accessible ? 'Available' : 'Coming Soon'}
                </span>
            </div>
        `;

        // Add click event
        card.addEventListener('click', () => this.handleCategoryClick(card));

        return card;
    }

    showErrorMessage(message) {
        const grid = document.querySelector('.host-sport-categories-grid');
        if (!grid) return;

        grid.innerHTML = `
            <div class="host-sport-error-message">
                <i class="fas fa-exclamation-triangle"></i>
                <h4>Error Loading Sports</h4>
                <p>${message}</p>
                <button class="retry-load-btn" onclick="window.hostSportEventPopupInstance.loadSportCategories()">
                    <i class="fas fa-redo"></i> Retry
                </button>
            </div>
        `;
    }

    // Override openPopup to load categories when opened
    openPopup() {
        super.openPopup();
        
        // Load sport categories if not already loaded
        if (!this.categoriesLoaded) {
            this.loadSportCategories();
            this.categoriesLoaded = true;
        }
    }
}

// Replace the basic popup with enhanced version
window.addEventListener('load', function() {
    // Replace basic popup with enhanced version
    if (window.hostSportEventPopupInstance) {
        window.hostSportEventPopupInstance = new EnhancedHostSportEventPopup();
        console.log('Enhanced Host Sport Event Popup initialized');
    }
});



// Handle Football Button Click
document.addEventListener('DOMContentLoaded', function() {
    // Get the football button and modal elements
    const footballBtn = document.querySelector('button[data-sport="football"]');
    const footballOverlay = document.getElementById('footballEventOverlay');
    const closeFootballBtn = document.getElementById('closeFootballEventBtn');
    
    // Open football modal when button is clicked
    if (footballBtn) {
        footballBtn.addEventListener('click', function() {
            console.log('Football button clicked!');
            if (footballOverlay) {
                footballOverlay.style.display = 'flex';
                document.body.style.overflow = 'hidden';
                console.log('Modal opened');
            } else {
                console.log('Modal not found');
            }
        });
    } else {
        console.log('Football button not found');
    }
    
    // Close modal when close button is clicked
    if (closeFootballBtn) {
        closeFootballBtn.addEventListener('click', function() {
            footballOverlay.style.display = 'none';
            document.body.style.overflow = 'auto';
        });
    }
    
    // Close modal when clicking outside
    if (footballOverlay) {
        footballOverlay.addEventListener('click', function(e) {
            if (e.target === footballOverlay) {
                footballOverlay.style.display = 'none';
                document.body.style.overflow = 'auto';
            }
        });
    }
});


     
 // Football Event Modal JavaScript
class FootballEventModal {
    constructor() {
        this.currentStep = 1;
        this.eventData = {
            eventName: '',
            background: {
                type: 'color',
                value: '#008B8B'
            },
            description: '',
            matchType: '',
            teamCount: 0,
            teamFee: 0,
            hasTeamFee: true,
            creationFee: 0,
            paymentMethod: ''
        };
        
        // Valid promo codes (50 codes)
        this.validPromoCodes = [
            'Tuc5us31', 'Bisask19', 'Lasusu35', 'Gam3r45x', 'Spo7rt89', 'Win2ner1', 'Cha9mp67',
            'Pla8yer23', 'Tea4m567', 'Goa3l890', 'Sco2re45', 'Mat5ch78', 'Lea6gue9', 'Cup7final',
            'Tro9phy12', 'Med4al56', 'Vic8tory3', 'Def2eat78', 'Att6ack90', 'Mid5field',
            'Goa1lkeep', 'Str7iker4', 'Win8g567', 'Def9ender', 'Cap5tain2', 'Coa3ch890',
            'Ref6eree1', 'Fan4s567', 'Sta8dium9', 'Fie3ld123', 'Bal7l456', 'Boo2ts789',
            'Jer5sey12', 'Whi9stle3', 'Car7d456', 'Pen2alty8', 'Fre5ekick', 'Cor6ner90',
            'Off4side1', 'Thr5owin2', 'Sub8stitut', 'Inj3ury45', 'Ext6ra789', 'Sho2otout',
            'Cel9ebrat', 'Cha4nt567', 'Sup8port9', 'Loy3al123', 'Pas5sion7', 'Dre2am890'
        ];
        
        this.usedPromoCodes = JSON.parse(localStorage.getItem('usedPromoCodes') || '[]');
        
        this.init();
    }
    
    init() {
        this.bindEvents();
        this.setupTeamOptions();
    }
    
    bindEvents() {
        // Modal controls
        document.getElementById('closeFootballEventBtn').addEventListener('click', () => this.closeModal());
        
        // Step 1 events
        document.getElementById('footballEventName').addEventListener('input', () => this.validateStep1());
        document.getElementById('footballEventDescription').addEventListener('input', () => this.validateStep1());
        document.getElementById('footballBgColor').addEventListener('change', (e) => this.updateBackground('color', e.target.value));
        document.getElementById('footballBgImage').addEventListener('change', (e) => this.handleImageUpload(e));
        
        // Background options
        document.querySelectorAll('.football-bg-option').forEach(option => {
            option.addEventListener('click', (e) => this.selectBackgroundType(e.currentTarget.dataset.bg));
        });
        
        // Match type selection
        document.querySelectorAll('.football-match-type').forEach(type => {
            type.addEventListener('click', (e) => this.selectMatchType(e.currentTarget.dataset.type));
        });
        
        // Navigation buttons
        document.getElementById('footballNextBtn').addEventListener('click', () => this.nextStep());
        document.getElementById('footballBackBtn').addEventListener('click', () => this.prevStep());
        document.getElementById('footballSummaryBtn').addEventListener('click', () => this.showSummary());
        document.getElementById('footballBackToStep2').addEventListener('click', () => this.goToStep(2));
        
        // Step 2 events
        document.getElementById('footballTeamFee').addEventListener('input', () => this.validateStep2());
        
        // Fee options
        document.querySelectorAll('.football-fee-option').forEach(option => {
            option.addEventListener('click', (e) => this.selectFeeOption(e.currentTarget.dataset.fee));
        });
        
        // Payment options
        document.querySelectorAll('.football-payment-option').forEach(option => {
            option.addEventListener('click', (e) => this.selectPaymentMethod(e.currentTarget.dataset.payment));
        });
        
        // Promo code verification
        document.getElementById('footballVerifyBtn').addEventListener('click', () => this.verifyPromoCode());
        document.getElementById('footballPromoCode').addEventListener('input', () => this.resetPromoStatus());
        
        // Create event button
        document.getElementById('footballCreateBtn').addEventListener('click', () => this.createEvent());
        
        // Close modal when clicking outside
        document.getElementById('footballEventOverlay').addEventListener('click', (e) => {
            if (e.target.id === 'footballEventOverlay') {
                this.closeModal();
            }
        });
    }
    
    // Step 1 Methods
    validateStep1() {
        const eventName = document.getElementById('footballEventName').value.trim();
        const description = document.getElementById('footballEventDescription').value.trim();
        const matchTypeSelected = document.querySelector('.football-match-type.selected');
        
        const isValid = eventName.length >= 3 && description.length >= 10 && matchTypeSelected;
        
        document.getElementById('footballNextBtn').disabled = !isValid;
        
        if (isValid) {
            this.eventData.eventName = eventName;
            this.eventData.description = description;
        }
    }
    
    selectBackgroundType(type) {
        document.querySelectorAll('.football-bg-option').forEach(opt => opt.classList.remove('active'));
        document.querySelector(`[data-bg="${type}"]`).classList.add('active');
        
        if (type === 'color') {
            document.getElementById('footballColorPicker').style.display = 'block';
            document.getElementById('footballImageUpload').style.display = 'none';
            this.updateBackground('color', document.getElementById('footballBgColor').value);
        } else {
            document.getElementById('footballColorPicker').style.display = 'none';
            document.getElementById('footballImageUpload').style.display = 'block';
        }
    }
    
    updateBackground(type, value) {
        this.eventData.background = { type, value };
        
        // Update modal background preview
        const modal = document.querySelector('.football-event-popup');
        if (type === 'color') {
            modal.style.background = `linear-gradient(135deg, ${value}, ${this.adjustColor(value, -20)})`;
            modal.style.backgroundImage = 'none';
        } else {
            modal.style.backgroundImage = `url(${value})`;
            modal.style.backgroundSize = 'cover';
            modal.style.backgroundPosition = 'center';
        }
    }
    
    handleImageUpload(event) {
        const file = event.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                this.updateBackground('image', e.target.result);
            };
            reader.readAsDataURL(file);
        }
    }
    
    adjustColor(color, amount) {
        const usePound = color[0] === '#';
        const col = usePound ? color.slice(1) : color;
        const num = parseInt(col, 16);
        let r = (num >> 16) + amount;
        let g = (num >> 8 & 0x00FF) + amount;
        let b = (num & 0x0000FF) + amount;
        r = r > 255 ? 255 : r < 0 ? 0 : r;
        g = g > 255 ? 255 : g < 0 ? 0 : g;
        b = b > 255 ? 255 : b < 0 ? 0 : b;
        return (usePound ? '#' : '') + (r << 16 | g << 8 | b).toString(16).padStart(6, '0');
    }
    
    selectMatchType(type) {
        document.querySelectorAll('.football-match-type').forEach(t => t.classList.remove('selected'));
        document.querySelector(`[data-type="${type}"]`).classList.add('selected');
        
        this.eventData.matchType = type;
        this.setupTeamOptions();
        this.validateStep1();
    }
    
    setupTeamOptions() {
        const container = document.getElementById('footballTeamOptions');
        const matchType = this.eventData.matchType;
        
        let teamOptions = [];
        
        switch (matchType) {
            case 'single':
                teamOptions = [2, 3, 4, 5, 6];
                break;
            case 'multiple':
                teamOptions = [4, 5, 7, 8, 9, 10, 11, 12];
                break;
            case 'league':
                teamOptions = [7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18];
                break;
        }
        
        container.innerHTML = teamOptions.map(count => `
            <div class="football-team-option" data-teams="${count}">
                <i class="fas fa-users"></i>
                <span>${count} Teams</span>
            </div>
        `).join('');
        
        // Bind team selection events
        container.querySelectorAll('.football-team-option').forEach(option => {
            option.addEventListener('click', (e) => this.selectTeamCount(parseInt(e.currentTarget.dataset.teams)));
        });
    }
    
    // Step 2 Methods
    selectTeamCount(count) {
        document.querySelectorAll('.football-team-option').forEach(opt => opt.classList.remove('selected'));
        document.querySelector(`[data-teams="${count}"]`).classList.add('selected');
        
        this.eventData.teamCount = count;
        this.validateStep2();
    }
    
    selectFeeOption(feeType) {
        document.querySelectorAll('.football-fee-option').forEach(opt => opt.classList.remove('active'));
        document.querySelector(`[data-fee="${feeType}"]`).classList.add('active');
        
        this.eventData.hasTeamFee = feeType === 'paid';
        
        const feeInput = document.getElementById('footballFeeInput');
        if (feeType === 'paid') {
            feeInput.style.display = 'block';
            document.getElementById('footballTeamFee').required = true;
        } else {
            feeInput.style.display = 'none';
            document.getElementById('footballTeamFee').required = false;
            this.eventData.teamFee = 0;
        }
        
        this.calculateCreationFee();
        this.validateStep2();
    }
    
    calculateCreationFee() {
        const { matchType, hasTeamFee } = this.eventData;
        
        if (hasTeamFee) {
            switch (matchType) {
                case 'single':
                    this.eventData.creationFee = 16;
                    break;
                case 'multiple':
                    this.eventData.creationFee = 20;
                    break;
                case 'league':
                    this.eventData.creationFee = 30;
                    break;
            }
        } else {
            switch (matchType) {
                case 'single':
                    this.eventData.creationFee = 20;
                    break;
                case 'multiple':
                    this.eventData.creationFee = 50;
                    break;
                case 'league':
                    this.eventData.creationFee = 70;
                    break;
            }
        }
    }
    
    validateStep2() {
        const teamSelected = document.querySelector('.football-team-option.selected');
        const teamFee = document.getElementById('footballTeamFee').value;
        
        let isValid = teamSelected;
        
        if (this.eventData.hasTeamFee) {
            const fee = parseInt(teamFee);
            isValid = isValid && fee >= 10 && fee <= 8000;
            if (isValid) {
                this.eventData.teamFee = fee;
            }
        }
        
        document.getElementById('footballSummaryBtn').disabled = !isValid;
    }
    
    // Step 3 Methods
    showSummary() {
        this.updateSummary();
        this.goToStep(3);
    }
    
    updateSummary() {
        document.getElementById('summaryEventName').textContent = this.eventData.eventName;
        document.getElementById('summaryMatchType').textContent = this.formatMatchType(this.eventData.matchType);
        document.getElementById('summaryTeamCount').textContent = `${this.eventData.teamCount} Teams`;
        document.getElementById('summaryTeamFee').textContent = this.eventData.hasTeamFee ? 
            `${this.eventData.teamFee} TC` : 'Free';
        document.getElementById('summaryCreationFee').textContent = `${this.eventData.creationFee} TC`;
        
        // Show/hide payment section based on creation fee
        const paymentSection = document.getElementById('footballPaymentSection');
        if (this.eventData.creationFee > 0) {
            paymentSection.style.display = 'block';
        } else {
            paymentSection.style.display = 'none';
            document.getElementById('footballCreateBtn').disabled = false;
        }
    }
    
    formatMatchType(type) {
        const types = {
            'single': 'Single Match',
            'multiple': 'Multiple Match',
            'league': 'League'
        };
        return types[type] || type;
    }
    
    selectPaymentMethod(method) {
        document.querySelectorAll('.football-payment-option').forEach(opt => opt.classList.remove('selected'));
        
        if (method === 'tc') {
            // TC Balance is coming soon, don't select
            this.showToast('TC Balance payment coming soon!', 'info');
            return;
        }
        
        document.querySelector(`[data-payment="${method}"]`).classList.add('selected');
        this.eventData.paymentMethod = method;
        
        const promoInput = document.getElementById('footballPromoInput');
        if (method === 'promo') {
            promoInput.style.display = 'block';
        } else {
            promoInput.style.display = 'none';
        }
        
        this.validateStep3();
    }
    
    verifyPromoCode() {
        const promoCode = document.getElementById('footballPromoCode').value.trim();
        const statusDiv = document.getElementById('footballPromoStatus');
        
        if (!promoCode) {
            this.showPromoStatus('Please enter a promo code', 'error');
            return;
        }
        
        if (this.usedPromoCodes.includes(promoCode)) {
            this.showPromoStatus('This promo code has already been used', 'error');
            return;
          }
        
        if (this.validPromoCodes.includes(promoCode)) {
            this.showPromoStatus(' Valid promo code! Creation fee waived.', 'success');
            this.eventData.creationFee = 0;
            this.eventData.promoCode = promoCode;
            document.getElementById('summaryCreationFee').textContent = '0 TC (Promo Applied)';
            document.getElementById('footballCreateBtn').disabled = false;
        } else {
            this.showPromoStatus('Invalid promo code', 'error');
            document.getElementById('footballCreateBtn').disabled = true;
        }
    }
    
    showPromoStatus(message, type) {
        const statusDiv = document.getElementById('footballPromoStatus');
        statusDiv.textContent = message;
        statusDiv.className = `football-promo-status ${type}`;
        statusDiv.style.display = 'block';
    }
    
    resetPromoStatus() {
        const statusDiv = document.getElementById('footballPromoStatus');
        statusDiv.style.display = 'none';
        this.eventData.creationFee = this.calculateOriginalCreationFee();
        document.getElementById('summaryCreationFee').textContent = `${this.eventData.creationFee} TC`;
        this.validateStep3();
    }
    
    calculateOriginalCreationFee() {
        const { matchType, hasTeamFee } = this.eventData;
        
        if (hasTeamFee) {
            switch (matchType) {
                case 'single': return 16;
                case 'multiple': return 20;
                case 'league': return 30;
            }
        } else {
            switch (matchType) {
                case 'single': return 20;
                case 'multiple': return 50;
                case 'league': return 70;
            }
        }
        return 0;
    }
    
    validateStep3() {
        const hasPaymentMethod = this.eventData.paymentMethod;
        const isPromoValid = this.eventData.paymentMethod === 'promo' && this.eventData.creationFee === 0;
        const isFree = this.eventData.creationFee === 0;
        
        document.getElementById('footballCreateBtn').disabled = !(hasPaymentMethod && (isPromoValid || isFree));
    }
    
    // Navigation Methods
    nextStep() {
        if (this.currentStep < 3) {
            this.goToStep(this.currentStep + 1);
        }
    }
    
    prevStep() {
        if (this.currentStep > 1) {
            this.goToStep(this.currentStep - 1);
        }
    }
    
    goToStep(step) {
        // Hide current step
        document.getElementById(`footballStep${this.currentStep}`).classList.remove('active');
        
        // Show target step
        document.getElementById(`footballStep${step}`).classList.add('active');
        
        this.currentStep = step;
        
        // Update step-specific logic
        if (step === 2) {
            this.calculateCreationFee();
        } else if (step === 3) {
            this.updateSummary();
        }
    }
    
    // Event Creation
    async createEvent() {
        try {
            document.getElementById('footballCreateBtn').disabled = true;
            document.getElementById('footballCreateBtn').innerHTML = '<i class="fas fa-spinner fa-spin"></i> Creating...';
            
            // Mark promo code as used if applicable
            if (this.eventData.promoCode) {
                this.usedPromoCodes.push(this.eventData.promoCode);
                localStorage.setItem('usedPromoCodes', JSON.stringify(this.usedPromoCodes));
            }
            
            // Prepare event data for Firebase
            const eventData = {
                eventName: this.eventData.eventName,
                background: this.eventData.background,
                description: this.eventData.description,
                matchType: this.eventData.matchType,
                teamCount: this.eventData.teamCount,
                teamFee: this.eventData.teamFee,
                hasTeamFee: this.eventData.hasTeamFee,
                creationFee: this.eventData.creationFee,
                paymentMethod: this.eventData.paymentMethod,
                promoCode: this.eventData.promoCode || null,
                status: 'active',
                createdAt: new Date().toISOString(),
                createdBy: 'current_user', // Replace with actual user ID
                participants: [],
                matches: []
            };
            
            // Save to Firebase
            await this.saveToFirebase(eventData);
            
            this.showToast('Football event created successfully!', 'success');
            this.closeModal();
            this.resetForm();
            
        } catch (error) {
            console.error('Error creating event:', error);
            this.showToast('Failed to create event. Please try again.', 'error');
            document.getElementById('footballCreateBtn').disabled = false;
            document.getElementById('footballCreateBtn').innerHTML = 'Create Event';
        }
    }
    
    async saveToFirebase(eventData) {
        // Check if Firebase is available
        if (typeof db === 'undefined') {
            console.log('Firebase not available, saving to localStorage for demo');
            this.saveToLocalStorage(eventData);
            return;
        }
        
        try {
            // Save to Firebase Firestore
            const docRef = await db.collection('sport_events').add(eventData);
            console.log('Event saved with ID:', docRef.id);
            
            // Also save to localStorage as backup
            this.saveToLocalStorage({...eventData, id: docRef.id});
            
        } catch (error) {
            console.error('Firebase save error:', error);
            // Fallback to localStorage
            this.saveToLocalStorage(eventData);
        }
    }
    
    saveToLocalStorage(eventData) {
        const events = JSON.parse(localStorage.getItem('footballEvents') || '[]');
        eventData.id = eventData.id || 'event_' + Date.now();
        events.push(eventData);
        localStorage.setItem('footballEvents', JSON.stringify(events));
    }
    
    // Utility Methods
    showToast(message, type = 'info') {
        // Remove existing toast
        const existingToast = document.querySelector('.football-toast');
        if (existingToast) {
            existingToast.remove();
        }
        
        // Create new toast
        const toast = document.createElement('div');
        toast.className = `football-toast ${type}`;
        toast.innerHTML = `
            <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
            <span>${message}</span>
        `;
        
        document.body.appendChild(toast);
        
        // Show toast
        setTimeout(() => toast.classList.add('show'), 100);
        
        // Hide toast after 3 seconds
        setTimeout(() => {
            toast.classList.remove('show');
            setTimeout(() => toast.remove(), 300);
        }, 3000);
    }
    
    closeModal() {
        document.getElementById('footballEventOverlay').style.display = 'none';
        this.resetForm();
    }
    
    openModal() {
        document.getElementById('footballEventOverlay').style.display = 'flex';
        this.goToStep(1);
    }
    
    resetForm() {
        // Reset to step 1
        this.currentStep = 1;
        document.querySelectorAll('.football-step').forEach(step => step.classList.remove('active'));
        document.getElementById('footballStep1').classList.add('active');
        
        // Reset form data
        this.eventData = {
            eventName: '',
            background: {
                type: 'color',
                value: '#008B8B'
            },
            description: '',
            matchType: '',
            teamCount: 0,
            teamFee: 0,
            hasTeamFee: true,
            creationFee: 0,
            paymentMethod: ''
        };
        
        // Reset form inputs
        document.getElementById('footballEventName').value = '';
        document.getElementById('footballEventDescription').value = '';
        document.getElementById('footballBgColor').value = '#008B8B';
        document.getElementById('footballBgImage').value = '';
        document.getElementById('footballTeamFee').value = '';
        document.getElementById('footballPromoCode').value = '';
        
        // Reset selections
        document.querySelectorAll('.football-match-type').forEach(t => t.classList.remove('selected'));
        document.querySelectorAll('.football-team-option').forEach(opt => opt.classList.remove('selected'));
        document.querySelectorAll('.football-fee-option').forEach(opt => opt.classList.remove('active'));
        document.querySelectorAll('.football-payment-option').forEach(opt => opt.classList.remove('selected'));
        document.querySelectorAll('.football-bg-option').forEach(opt => opt.classList.remove('active'));
        
        // Reset to defaults
        document.querySelector('[data-bg="color"]').classList.add('active');
        document.querySelector('[data-fee="paid"]').classList.add('active');
        document.getElementById('footballColorPicker').style.display = 'block';
        document.getElementById('footballImageUpload').style.display = 'none';
        document.getElementById('footballFeeInput').style.display = 'block';
        document.getElementById('footballPromoInput').style.display = 'none';
        document.getElementById('footballPromoStatus').style.display = 'none';
        
        // Reset buttons
        document.getElementById('footballNextBtn').disabled = true;
        document.getElementById('footballSummaryBtn').disabled = true;
        document.getElementById('footballCreateBtn').disabled = true;
        document.getElementById('footballCreateBtn').innerHTML = 'Create Event';
        
        // Reset modal background
        const modal = document.querySelector('.football-event-popup');
        modal.style.background = 'linear-gradient(135deg, #008B8B, #006666)';
        modal.style.backgroundImage = 'none';
    }
}

// Initialize the football event modal
let footballEventModal;

// Wait for DOM to be ready
document.addEventListener('DOMContentLoaded', function() {
    footballEventModal = new FootballEventModal();
});

// Global function to open the modal
function openFootballEventModal() {
    if (footballEventModal) {
        footballEventModal.openModal();
    }
}

// Export for global access
window.openFootballEventModal = openFootballEventModal;
window.footballEventModal = footballEventModal;

// Additional CSS for toast notifications
const footballToastStyles = `
<style>
.football-toast {
    position: fixed;
    top: 20px;
    right: 20px;
    background: linear-gradient(45deg, #27ae60, #2ecc71);
    color: white;
    padding: 15px 25px;
    border-radius: 10px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
    z-index: 10001;
    display: flex;
    align-items: center;
    gap: 10px;
    font-weight: bold;
    transform: translateX(400px);
    transition: transform 0.3s ease;
    backdrop-filter: blur(10px);
    max-width: 350px;
}

.football-toast.show {
    transform: translateX(0);
}

.football-toast.error {
    background: linear-gradient(45deg, #e74c3c, #c0392b);
}

.football-toast.info {
    background: linear-gradient(45deg, #3498db, #2980b9);
}

.football-toast.success {
    background: linear-gradient(45deg, #27ae60, #2ecc71);
}

.football-promo-status {
    margin-top: 10px;
    padding: 10px;
    border-radius: 5px;
    font-size: 14px;
    font-weight: bold;
    display: none;
}

.football-promo-status.success {
    background: rgba(39, 174, 96, 0.2);
    color: #27ae60;
    border: 1px solid #27ae60;
}

.football-promo-status.error {
    background: rgba(231, 76, 60, 0.2);
    color: #e74c3c;
    border: 1px solid #e74c3c;
}

/* Team option styles */
.football-team-option {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
    padding: 15px;
    border: 2px solid rgba(255, 255, 255, 0.2);
    border-radius: 10px;
    cursor: pointer;
    transition: all 0.3s ease;
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(10px);
}

.football-team-option:hover {
    border-color: rgba(255, 255, 255, 0.4);
    background: rgba(255, 255, 255, 0.15);
    transform: translateY(-2px);
}

.football-team-option.selected {
    border-color: #3498db;
    background: rgba(52, 152, 219, 0.2);
    box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
}

.football-team-option i {
    font-size: 24px;
    color: #3498db;
}

.football-team-option span {
    font-weight: bold;
    color: white;
}

/* Match type selection styles */
.football-match-type.selected {
    border-color: #3498db;
    background: rgba(52, 152, 219, 0.2);
    box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
}

/* Payment option styles */
.football-payment-option.selected {
    border-color: #27ae60;
    background: rgba(39, 174, 96, 0.2);
    box-shadow: 0 0 0 3px rgba(39, 174, 96, 0.2);
}

.football-payment-option .coming-soon {
    background: rgba(255, 193, 7, 0.2);
    color: #ffc107;
    padding: 4px 8px;
    border-radius: 12px;
    font-size: 11px;
    font-weight: bold;
    margin-left: auto;
}
</style>
`;

// Inject the styles
document.head.insertAdjacentHTML('beforeend', footballToastStyles);


class SportEventsLoader {
    constructor() {
        this.container = document.getElementById('sport-events-container');
        this.emptyState = document.getElementById('sport-events-empty');
        this.events = [];
        this.currentUser = null;
        
        this.init();
    }
    
    async init() {
        try {
            // Get current user (replace with your auth system)
            this.currentUser = this.getCurrentUser();
            
            if (!this.currentUser) {
                console.log('No authenticated user found');
                return;
            }
            
            // Load events from Firebase or localStorage
            await this.loadEvents();
            
            // Render the events
            this.renderEvents();
            
            // Set up real-time listener if Firebase is available
            this.setupRealtimeListener();
            
        } catch (error) {
            console.error('Error initializing sport events loader:', error);
            this.showError('Failed to load events');
        }
    }
    
    getCurrentUser() {
        // Replace this with your actual authentication system
        if (typeof firebase !== 'undefined' && firebase.auth && firebase.auth().currentUser) {
            return firebase.auth().currentUser;
        }
        
        // Fallback for demo purposes
        return {
            uid: 'demo_user_' + Date.now(),
            email: 'demo@example.com',
            displayName: 'Demo User'
        };
    }
    
    async loadEvents() {
        try {
            if (typeof db !== 'undefined') {
                // Load from Firebase
                await this.loadFromFirebase();
            } else {
                // Load from localStorage
                this.loadFromLocalStorage();
            }
        } catch (error) {
            console.error('Error loading events:', error);
            // Fallback to localStorage
            this.loadFromLocalStorage();
        }
    }
    
    async loadFromFirebase() {
        try {
            const snapshot = await db.collection('sport_events')
                .where('createdBy', '==', this.currentUser.uid)
                .orderBy('createdAt', 'desc')
                .get();
            
            this.events = [];
            snapshot.forEach(doc => {
                this.events.push({
                    id: doc.id,
                    ...doc.data()
                });
            });
            
        } catch (error) {
            console.error('Firebase load error:', error);
            throw error;
        }
    }
    
    loadFromLocalStorage() {
        const storedEvents = localStorage.getItem('footballEvents');
        if (storedEvents) {
            this.events = JSON.parse(storedEvents);
        } else {
            this.events = [];
        }
    }
    
    setupRealtimeListener() {
        if (typeof db === 'undefined') return;
        
        try {
            db.collection('sport_events')
                .where('createdBy', '==', this.currentUser.uid)
                .orderBy('createdAt', 'desc')
                .onSnapshot((snapshot) => {
                    this.events = [];
                    snapshot.forEach(doc => {
                        this.events.push({
                            id: doc.id,
                            ...doc.data()
                        });
                    });
                    this.renderEvents();
                }, (error) => {
                    console.error('Realtime listener error:', error);
                });
        } catch (error) {
            console.error('Error setting up realtime listener:', error);
        }
    }
    
    renderEvents() {
        if (!this.events || this.events.length === 0) {
            this.showEmptyState();
            return;
        }
        
        this.hideEmptyState();
        this.renderEventCards();
    }
    
    showEmptyState() {
        this.emptyState.style.display = 'block';
        // Hide any existing event cards
        const existingCards = this.container.querySelectorAll('.sport-event-card');
        existingCards.forEach(card => card.remove());
    }
    
    hideEmptyState() {
        this.emptyState.style.display = 'none';
    }
    
    renderEventCards() {
        // Clear existing cards
        const existingCards = this.container.querySelectorAll('.sport-event-card');
        existingCards.forEach(card => card.remove());
        
        // Create cards for each event
        this.events.forEach(event => {
            const card = this.createEventCard(event);
            this.container.appendChild(card);
        });
    }
    
    createEventCard(event) {
        const card = document.createElement('div');
        card.className = 'sport-event-card';
        card.setAttribute('data-event-id', event.id);
        
        // Set background based on event background settings
        const backgroundStyle = this.getBackgroundStyle(event.background);
        
        card.innerHTML = `
            <div class="sport-card-header" style="${backgroundStyle}">
                <div class="sport-card-overlay">
                    <h3 class="sport-card-title">${this.escapeHtml(event.eventName)}</h3>
                    <span class="sport-card-status status-${event.status}">${this.formatStatus(event.status)}</span>
                </div>
            </div>
            
            <div class="sport-card-body">
                <div class="sport-card-info">
                    <div class="sport-info-item">
                        <i class="fas fa-trophy"></i>
                        <span>${this.formatMatchType(event.matchType)}</span>
                    </div>
                    
                    <div class="sport-info-item">
                        <i class="fas fa-users"></i>
                        <span>${event.teamCount} Teams</span>
                    </div>
                    
                    
                </div>
                
               
                
            </div>
            
            <div class="sport-card-actions">
             <button class="sport-card-btn setup-btn" id="sport-card-setupbtn-${event.id}"
        onclick="footballControl.setupEvent('${event.id}')"
        title="Setup Event">
    <i class="fas fa-cog"></i>
    <span>Setup</span>
</button>


                
                <button class="sport-card-btn delete-btn" id="sport-card-deletebtn-${event.id}" 
                        onclick="sportEventsLoader.deleteEvent('${event.id}')" 
                        title="Delete Event">
                    <i class="fas fa-trash"></i>
                    <span>Delete</span>
                </button>
                
                <button class="sport-card-btn open-btn" id="sport-card-openbtn-${event.id}" 
                        onclick="sportEventsLoader.openEvent('${event.id}')" 
                        title="View Event">
                    <i class="fas fa-eye"></i>
                    <span>Open</span>
                </button>
                
                <button class="sport-card-btn launch-btn ${event.status === 'active' ? '' : 'disabled'}" 
                        id="sport-card-launchbtn-${event.id}" 
                        onclick="sportEventsLoader.launchEvent('${event.id}')" 
                        title="Launch Event"
                        ${event.status !== 'active' ? 'disabled' : ''}>
                    <i class="fas fa-rocket"></i>
                    <span>Launch</span>
                </button>
            </div>
        `;
        
        return card;
    }
    
    getBackgroundStyle(background) {
        if (!background) {
            return 'background: linear-gradient(135deg, #008B8B, #006666);';
        }
        
        if (background.type === 'color') {
            const color = background.value;
            const darkerColor = this.adjustColor(color, -20);
            return `background: linear-gradient(135deg, ${color}, ${darkerColor});`;
        } else if (background.type === 'image') {
            return `background-image: url('${background.value}'); background-size: cover; background-position: center;`;
        }
        
        return 'background: linear-gradient(135deg, #008B8B, #006666);';
    }
    
    adjustColor(color, amount) {
        const usePound = color[0] === '#';
        const col = usePound ? color.slice(1) : color;
        const num = parseInt(col, 16);
        let r = (num >> 16) + amount;
        let g = (num >> 8 & 0x00FF) + amount;
        let b = (num & 0x0000FF) + amount;
        r = r > 255 ? 255 : r < 0 ? 0 : r;
        g = g > 255 ? 255 : g < 0 ? 0 : g;
        b = b > 255 ? 255 : b < 0 ? 0 : b;
        return (usePound ? '#' : '') + (r << 16 | g << 8 | b).toString(16).padStart(6, '0');
    }
    
    formatMatchType(type) {
        const types = {
            'single': 'Single Match',
            'multiple': 'Multiple Match',
            'league': 'League'
        };
        return types[type] || type;
    }
    
    formatStatus(status) {
        return status.charAt(0).toUpperCase() + status.slice(1);
    }
    
    formatDate(dateString) {
        try {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });
        } catch (error) {
            return 'Unknown';
        }
    }
    
    escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    }
    
    // Update the setupEvent method in your SportEventsLoader class
async setupEvent(eventId) {
    try {
        const event = this.events.find(e => e.id === eventId);
        if (!event) {
            this.showToast('Event not found', 'error');
            return;
        }

        // Check if this is a football event and call the football control
        if (event.sportType === 'football' || !event.sportType) { // assuming football is default
            // Call the football control setup
            if (typeof footballControl !== 'undefined') {
                footballControl.setupEvent(eventId);
            } else {
                // If footballControl is not loaded, load it first
                this.loadFootballControl(eventId);
            }
        } else {
            // Handle other sports
            this.showToast('Setup feature for this sport coming soon', 'info');
        }
            
    } catch (error) {
        console.error('Error setting up event:', error);
        this.showToast('Failed to setup event', 'error');
    }
}

// Add this method to load football control if not already loaded
loadFootballControl(eventId) {
    // Make sure footballControl is available
    if (typeof footballControl === 'undefined') {
        console.error('Football control module not loaded');
        this.showToast('Football control module not available', 'error');
        return;
    }
    
    footballControl.setupEvent(eventId);
}

    async deleteEvent(eventId) {
        try {
            const event = this.events.find(e => e.id === eventId);
            if (!event) {
                this.showToast('Event not found', 'error');
                return;
            }
            
            // Show confirmation dialog
            const confirmed = await this.showConfirmDialog(
                'Delete Event',
                `Are you sure you want to delete "${event.eventName}"? This action cannot be undone.`,
                'Delete',
                'Cancel'
            );
            
            if (!confirmed) return;
            
            // Delete from Firebase or localStorage
            await this.performDelete(eventId);
            
            this.showToast('Event deleted successfully', 'success');
            
        } catch (error) {
            console.error('Error deleting event:', error);
            this.showToast('Failed to delete event', 'error');
        }
    }
    
    async performDelete(eventId) {
        if (typeof db !== 'undefined') {
            // Delete from Firebase
            await db.collection('sport_events').doc(eventId).delete();
        } else {
            // Delete from localStorage
            const events = JSON.parse(localStorage.getItem('footballEvents') || '[]');
            const filteredEvents = events.filter(e => e.id !== eventId);
            localStorage.setItem('footballEvents', JSON.stringify(filteredEvents));
            
            // Update local events array
            this.events = this.events.filter(e => e.id !== eventId);
            this.renderEvents();
        }
    }
    
    openEvent(eventId) {
        try {
            const event = this.events.find(e => e.id === eventId);
            if (!event) {
                this.showToast('Event not found', 'error');
                return;
            }
            
            // Open event details modal or navigate to event page
            this.showEventDetails(event);
            
        } catch (error) {
            console.error('Error opening event:', error);
            this.showToast('Failed to open event', 'error');
        }
    }
    
    async launchEvent(eventId) {
        try {
            const event = this.events.find(e => e.id === eventId);
            if (!event) {
                this.showToast('Event not found', 'error');
                return;
            }
            
            if (event.status !== 'active') {
                this.showToast('Only active events can be launched', 'warning');
                return;
            }
            
            // Show confirmation dialog
            const confirmed = await this.showConfirmDialog(
                'Launch Event',
                `Are you sure you want to launch "${event.eventName}"? Once launched, the event will be live and participants can join.`,
                'Launch',
                'Cancel'
            );
            
            if (!confirmed) return;
            
            // Update event status to launched
            await this.updateEventStatus(eventId, 'launched');
            
            this.showToast('Event launched successfully!', 'success');
            
        } catch (error) {
            console.error('Error launching event:', error);
            this.showToast('Failed to launch event', 'error');
        }
    }
    
    async updateEventStatus(eventId, status) {
        if (typeof db !== 'undefined') {
            // Update in Firebase
            await db.collection('sport_events').doc(eventId).update({
                status: status,
                launchedAt: status === 'launched' ? new Date().toISOString() : null
            });
        } else {
            // Update in localStorage
            const events = JSON.parse(localStorage.getItem('footballEvents') || '[]');
            const eventIndex = events.findIndex(e => e.id === eventId);
            
            if (eventIndex !== -1) {
                events[eventIndex].status = status;
                if (status === 'launched') {
                    events[eventIndex].launchedAt = new Date().toISOString();
                }
                localStorage.setItem('footballEvents', JSON.stringify(events));
                
                // Update local events array
                this.events = events;
                this.renderEvents();
            }
        }
    }
    
    showEventDetails(event) {
        // Create and show event details modal
        const modal = this.createEventDetailsModal(event);
        document.body.appendChild(modal);
        
        // Show modal with animation
        setTimeout(() => {
            modal.classList.add('show');
        }, 10);
    }
    
    createEventDetailsModal(event) {
        const modal = document.createElement('div');
        modal.className = 'sport-event-details-modal';
        modal.innerHTML = `
            <div class="sport-event-details-overlay" onclick="this.parentElement.remove()">
                <div class="sport-event-details-content" onclick="event.stopPropagation()">
                    <div class="sport-details-header" style="${this.getBackgroundStyle(event.background)}">
                        <div class="sport-card-overlay">
                            <h2>${this.escapeHtml(event.eventName)}</h2>
                            <span class="sport-card-status status-${event.status}">${this.formatStatus(event.status)}</span>
                            <button class="close-modal-btn" onclick="this.closest('.sport-event-details-modal').remove()">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="sport-details-body">
                        <div class="sport-details-grid">
                            <div class="sport-detail-section">
                                <h4><i class="fas fa-info-circle"></i> Event Information</h4>
                                <div class="sport-detail-item">
                                    <span class="detail-label">Match Type:</span>
                                    <span class="detail-value">${this.formatMatchType(event.matchType)}</span>
                                </div>
                                <div class="sport-detail-item">
                                    <span class="detail-label">Team Count:</span>
                                    <span class="detail-value">${event.teamCount} Teams</span>
                                </div>
                                <div class="sport-detail-item">
                                    <span class="detail-label">Team Fee:</span>
                                    <span class="detail-value">${event.hasTeamFee ? event.teamFee + ' TC' : 'Free'}</span>
                                </div>
                                <div class="sport-detail-item">
                                    <span class="detail-label">Creation Fee:</span>
                                    <span class="detail-value">${event.creationFee} TC</span>
                                </div>
                                <div class="sport-detail-item">
                                    <span class="detail-label">Created:</span>
                                    <span class="detail-value">${this.formatDate(event.createdAt)}</span>
                                </div>
                            </div>
                            
                            <div class="sport-detail-section">
                                <h4><i class="fas fa-chart-bar"></i> Statistics</h4>
                                <div class="sport-stats-grid">
                                    <div class="sport-stat-card">
                                        <div class="stat-number">${event.participants ? event.participants.length : 0}</div>
                                        <div class="stat-label">Participants</div>
                                    </div>
                                    <div class="sport-stat-card">
                                        <div class="stat-number">${event.matches ? event.matches.length : 0}</div>
                                        <div class="stat-label">Matches</div>
                                    </div>
                                    <div class="sport-stat-card">
                                        <div class="stat-number">${event.teamCount}</div>
                                        <div class="stat-label">Max Teams</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="sport-detail-section full-width">
                            <h4><i class="fas fa-align-left"></i> Description</h4>
                            <p class="event-description">${this.escapeHtml(event.description)}</p>
                        </div>
                        
                        ${event.participants && event.participants.length > 0 ? `
                        <div class="sport-detail-section full-width">
                            <h4><i class="fas fa-users"></i> Participants</h4>
                            <div class="participants-list">
                                ${event.participants.map(participant => `
                                    <div class="participant-item">
                                        <i class="fas fa-user"></i>
                                        <span>${this.escapeHtml(participant.teamName || participant.name || 'Unknown Team')}</span>
                                        <span class="participant-status status-${participant.status || 'joined'}">${this.formatStatus(participant.status || 'joined')}</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        ` : ''}
                        
                        <div class="sport-details-actions">
                           
                            
                            <button class="sport-detail-btn launch-btn ${event.status === 'active' ? '' : 'disabled'}" 
                                    onclick="sportEventsLoader.launchEvent('${event.id}'); this.closest('.sport-event-details-modal').remove();"
                                    ${event.status !== 'active' ? 'disabled' : ''}>
                                <i class="fas fa-rocket"></i> Launch Event
                            </button>
                            
                            <button class="sport-detail-btn delete-btn" onclick="sportEventsLoader.deleteEvent('${event.id}'); this.closest('.sport-event-details-modal').remove();">
                                <i class="fas fa-trash"></i> Delete Event
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        `;
        
        return modal;
    }
    
    async showConfirmDialog(title, message, confirmText = 'Confirm', cancelText = 'Cancel') {
        return new Promise((resolve) => {
            const modal = document.createElement('div');
            modal.className = 'sport-confirm-modal';
            modal.innerHTML = `
                <div class="sport-confirm-overlay">
                    <div class="sport-confirm-content">
                        <div class="sport-confirm-header">
                            <h3>${title}</h3>
                        </div>
                        <div class="sport-confirm-body">
                            <p>${message}</p>
                        </div>
                        <div class="sport-confirm-actions">
                            <button class="sport-confirm-btn cancel-btn" onclick="this.closest('.sport-confirm-modal').remove(); window.sportConfirmResolve(false);">
                                ${cancelText}
                            </button>
                            <button class="sport-confirm-btn confirm-btn" onclick="this.closest('.sport-confirm-modal').remove(); window.sportConfirmResolve(true);">
                                ${confirmText}
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            // Store resolve function globally
            window.sportConfirmResolve = resolve;
            
            document.body.appendChild(modal);
            setTimeout(() => modal.classList.add('show'), 10);
        });
    }
    
    showToast(message, type = 'info') {
        // Remove existing toast
        const existingToast = document.querySelector('.sport-toast');
        if (existingToast) {
            existingToast.remove();
        }
        
        // Create new toast
        const toast = document.createElement('div');
        toast.className = `sport-toast ${type}`;
        toast.innerHTML = `
            <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : type === 'warning' ? 'exclamation-triangle' : 'info-circle'}"></i>
            <span>${message}</span>
        `;
        
        document.body.appendChild(toast);
        
        // Show toast
        setTimeout(() => toast.classList.add('show'), 100);
        
        // Hide toast after 3 seconds
        setTimeout(() => {
            toast.classList.remove('show');
            setTimeout(() => toast.remove(), 300);
        }, 3000);
    }
    
    showError(message) {
        this.hideEmptyState();
        
        const errorDiv = document.createElement('div');
        errorDiv.className = 'sport-events-error';
        errorDiv.innerHTML = `
            <div class="error-state-icon">
                <i class="fas fa-exclamation-triangle"></i>
            </div>
            <h4>Error Loading Events</h4>
            <p>${message}</p>
            <button class="error-state-btn" onclick="sportEventsLoader.init()">
                <i class="fas fa-refresh"></i> Try Again
            </button>
        `;
        
        this.container.appendChild(errorDiv);
    }
    
    // Public method to refresh events
    async refresh() {
        try {
            await this.loadEvents();
            this.renderEvents();
        } catch (error) {
            console.error('Error refreshing events:', error);
            this.showToast('Failed to refresh events', 'error');
        }
    }
}

// CSS Styles for the sport events cards and modals
const sportEventsStyles = `
<style>
/* Reset and base styles */
* {
    box-sizing: border-box;
}

/* Sport Event Card Container */
.sport-event-card {
    background: rgba(255, 255, 255, 0.1);
    border-radius: 15px;
    overflow: hidden;
    margin-bottom: 20px;
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.2);
    transition: all 0.3s ease;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    will-change: transform;
    transform: translateZ(0);
    -webkit-backface-visibility: hidden;
    backface-visibility: hidden;
    width: 80%;
    max-width: 80%;
    display: flex;
     align-items: center;
    justify-content: center;
   
    color:
}

/* Card Header */
.sport-card-header {
    height: clamp(100px, 15vw, 120px);
    position: relative;
    background: linear-gradient(135deg, #008B8B, #006666);
    display: flex;
    align-items: center;
    justify-content: center;
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
}

.sport-card-overlay {
    background: rgba(0, 0, 0, 0.4);
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    padding: clamp(15px, 4vw, 20px);
    position: relative;
}

.sport-card-title {
    color: white;
    font-size: clamp(16px, 4vw, 18px);
    font-weight: bold;
    margin: 0 0 8px 0;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
    line-height: 1.2;
    word-break: break-word;
    hyphens: auto;
    -webkit-hyphens: auto;
    -ms-hyphens: auto;
    text-align: center;
}

.sport-card-status {
    padding: 4px 12px;
    border-radius: 20px;
    font-size: clamp(10px, 2.5vw, 12px);
    font-weight: bold;
    text-transform: uppercase;
    white-space: nowrap;
    display: inline-block;
}

/* Status Colors */
.sport-card-status.status-active {
    background: rgba(39, 174, 96, 0.9);
    color: white;
}

.sport-card-status.status-draft {
    background: rgba(241, 196, 15, 0.9);
    color: white;
}

.sport-card-status.status-completed {
    background: rgba(52, 152, 219, 0.9);
    color: white;
}

.sport-card-status.status-cancelled {
    background: rgba(231, 76, 60, 0.9);
    color: white;
}

.sport-card-status.status-launched {
    background: rgba(155, 89, 182, 0.9);
    color: white;
}

/* Card Body */
.sport-card-body {
    padding: clamp(15px, 4vw, 20px);
}

/* Card Info Grid */
.sport-card-info {
    display: grid;
    grid-template-columns: 1fr;
    gap: 12px;
    margin-bottom: 15px;
}

.sport-info-item {
    display: flex;
    align-items: center;
    gap: 8px;
    color: rgba(255, 255, 255, 0.9);
    font-size: clamp(12px, 3vw, 14px);
    word-break: break-word;
    line-height: 1.4;
}

.sport-info-item i {
    color: #3498db;
    width: 16px;
    flex-shrink: 0;
    text-align: center;
}

.sport-info-item span {
    flex: 1;
    min-width: 0;
}

/* Description */
.sport-card-description {
    margin-bottom: 15px;
}

.sport-card-description p {
    color: rgba(255, 255, 255, 0.8);
    font-size: clamp(12px, 3vw, 14px);
    line-height: 1.5;
    margin: 0;
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
    word-break: break-word;
    hyphens: auto;
    -webkit-hyphens: auto;
    -ms-hyphens: auto;
}

/* Stats Section */
.sport-card-stats {
    display: flex;
    justify-content: space-around;
    margin-bottom: 20px;
    padding: clamp(10px, 3vw, 15px);
    background: rgba(255, 255, 255, 0.05);
    border-radius: 10px;
    flex-wrap: wrap;
    gap: 10px;
}

.stat-item {
    text-align: center;
    min-width: 60px;
    flex: 1;
}

.stat-number {
    display: block;
    font-size: clamp(16px, 4vw, 18px);
    font-weight: bold;
    color: #3498db;
    line-height: 1.2;
}

.stat-label {
    font-size: clamp(10px, 2.5vw, 12px);
    color: rgba(255, 255, 255, 0.7);
    text-transform: uppercase;
    margin-top: 2px;
    line-height: 1.2;
}

/* Action Buttons */
.sport-card-actions {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(70px, 1fr));
    gap: 8px;
}

.sport-card-btn {
    padding: clamp(8px, 2vw, 10px);
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-size: clamp(10px, 2.5vw, 12px);
    font-weight: bold;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 4px;
    transition: all 0.3s ease;
    text-transform: uppercase;
    left:10%;
    color: #ffffff;
    -webkit-tap-highlight-color: transparent;
    transform: translateZ(0);
    position: relative;
    overflow: hidden;
    font-family: inherit;
}

.sport-card-btn i {
    font-size: clamp(14px, 3.5vw, 16px);
    line-height: 1;
     color: #ffffff;
   
}

.sport-card-btn span {
    line-height: 1;
    font-size: inherit;
}

/* Button Colors */
.sport-card-btn.edit-btn {
    background: rgba(52, 152, 219, 0.8);
    color: white;
    height: 48px;
    width: 48px;
     align-items: center;
    justify-content: center;
   
}

.sport-card-btn.delete-btn {
    background: rgba(231, 76, 60, 0.8);
    color: white;

   
}

.sport-card-btn.open-btn {
    background: rgba(39, 174, 96, 0.8);
    color: white;
    height: 48px;
    width: 48px;
}

.sport-card-btn.launch-btn {
    background: rgba(155, 89, 182, 0.8);
    color: white;
    height: 48px;
    width: 48px;
}

.sport-card-btn.disabled {
    opacity: 0.5;
    cursor: not-allowed;
    pointer-events: none;
}

/* Hover Effects for Desktop */
@media (hover: hover) and (pointer: fine) {
    .sport-event-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2);
    }
    
    .sport-card-btn:hover:not(.disabled) {
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    }
    
    .sport-card-btn.edit-btn:hover:not(.disabled) {
        background: rgba(52, 152, 219, 1);
    }
    
    .sport-card-btn.delete-btn:hover:not(.disabled) {
        background: rgba(231, 76, 60, 1);
    }
    
    .sport-card-btn.open-btn:hover:not(.disabled) {
        background: rgba(39, 174, 96, 1);
    }
    
    .sport-card-btn.launch-btn:hover:not(.disabled) {
        background: rgba(155, 89, 182, 1);
    }
}

/* Touch Device Optimizations */
@media (hover: none) and (pointer: coarse) {
    .sport-event-card:hover {
        transform: none;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    }
    
    .sport-card-btn:active:not(.disabled) {
        transform: scale(0.95);
        transition: transform 0.1s ease;
    }
    
    .sport-card-btn {
        min-height: 48px;
        min-width: 48px;
    }
}

/* Tablet Styles */
@media (min-width: 481px) and (max-width: 768px) {
    .sport-card-info {
        grid-template-columns: 1fr 1fr;
        gap: 10px;
    }
    
    .sport-card-actions {
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
    }
    
    .sport-card-stats {
        justify-content: space-between;
    }
}

/* Desktop Styles */
@media (min-width: 769px) {
    .sport-card-info {
        grid-template-columns: 1fr 1fr;
        gap: 12px;
    }
    
    .sport-card-actions {
        grid-template-columns: repeat(4, 1fr);
        gap: 8px;
    }
}

/* Mobile Portrait */
@media (max-width: 480px) {
    .sport-card-actions {
        grid-template-columns: 1fr;
        gap: 8px;
    }
    
    .sport-card-stats {
        flex-direction: column;
        gap: 12px;
    }
    
    .stat-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 8px 12px;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 6px;
        text-align: left;
    }
    
    .stat-number {
        order: 2;
    }
    
    .stat-label {
        order: 1;
        margin-top: 0;
        text-align: left;
    }
}

/* Very Small Screens */
@media (max-width: 360px) {
    .sport-card-overlay {
        padding: 10px;
    }
    
    .sport-card-body {
        padding: 12px;
    }
    
    .sport-card-stats {
        padding: 8px;
    }
}

/* Landscape Mobile */
@media (max-height: 500px) and (orientation: landscape) {
    .sport-card-header {
        height: 80px;
    }
    
    .sport-card-body {
        padding: 12px;
    }
    
    .sport-card-stats {
        flex-direction: row;
        padding: 8px;
    }
    
    .stat-item {
        flex-direction: column;
        text-align: center;
        padding: 4px;
    }
}

/* Safe Area Support for iPhone X+ */
@supports (padding: max(0px)) {
    .sport-event-card {
        margin-left: max(0px, env(safe-area-inset-left));
        margin-right: max(0px, env(safe-area-inset-right));
    }
}

/* High DPI Displays */
@media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
    .sport-event-card {
        border-width: 0.5px;
    }
}

/* Accessibility */
.sport-card-btn:focus {
    outline: 2px solid #3498db;
    outline-offset: 2px;
}

/* Reduced Motion */
@media (prefers-reduced-motion: reduce) {
    .sport-event-card,
    .sport-card-btn {
        transition: none;
    }
    
    .sport-event-card:hover,
    .sport-card-btn:hover {
        transform: none;
    }
}

/* High Contrast Mode */
@media (prefers-contrast: high) {
    .sport-event-card {
        border: 2px solid white;
    }
    
    .sport-card-btn {
        border: 1px solid white;
    }
}

/* Container Queries for Modern Browsers */
@supports (container-type: inline-size) {
    .sport-event-card {
        container-type: inline-size;
    }
    
    @container (max-width: 300px) {
        .sport-card-actions {
            grid-template-columns: 1fr;
        }
        
        .sport-card-info {
            grid-template-columns: 1fr;
        }
    }
    
    @container (min-width: 400px) and (max-width: 600px) {
        .sport-card-actions {
            grid-template-columns: repeat(2, 1fr);
        }
        
        .sport-card-info {
            grid-template-columns: 1fr 1fr;
        }
    }
    
    @container (min-width: 600px) {
        .sport-card-actions {
            grid-template-columns: repeat(4, 1fr);
        }
    }
}

/* Loading State */
.sport-event-card.loading {
    opacity: 0.7;
    pointer-events: none;
    position: relative;
    overflow: hidden;
}

.sport-event-card.loading::after {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
    animation: shimmer 1.5s infinite;
}
@keyframes shimmer {
    0% { left: -100%; }
    100% { left: 100%; }
}

/* Error State */
.sport-event-card.error {
    border: 1px solid rgba(231, 76, 60, 0.5);
    background: rgba(231, 76, 60, 0.05);
}

.sport-event-card.error .sport-card-header {
    background: linear-gradient(135deg, #e74c3c, #c0392b);
}

/* Success State */
.sport-event-card.success {
    border: 1px solid rgba(39, 174, 96, 0.5);
    background: rgba(39, 174, 96, 0.05);
}

/* Warning State */
.sport-event-card.warning {
    border: 1px solid rgba(241, 196, 15, 0.5);
    background: rgba(241, 196, 15, 0.05);
}

/* Button Loading State */
.sport-card-btn.loading {
    position: relative;
    color: transparent;
    pointer-events: none;
}

.sport-card-btn.loading::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 16px;
    height: 16px;
    margin: -8px 0 0 -8px;
    border: 2px solid transparent;
    border-top: 2px solid currentColor;
    border-radius: 50%;
    animation: spin 1s linear infinite;
    color: white;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* Ripple Effect for Touch */
.sport-card-btn {
    position: relative;
    overflow: hidden;
}

.sport-card-btn::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.3);
    transform: translate(-50%, -50%);
    transition: width 0.3s ease, height 0.3s ease;
    pointer-events: none;
}

.sport-card-btn:active::before {
    width: 100px;
    height: 100px;
}

/* Improved Typography */
.sport-card-title {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
    letter-spacing: -0.02em;
    font-weight: 600;
}

.sport-info-item span,
.stat-label,
.sport-card-description p {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
}

/* Enhanced Focus States */
.sport-card-btn:focus-visible {
    outline: 2px solid #3498db;
    outline-offset: 2px;
    box-shadow: 0 0 0 4px rgba(52, 152, 219, 0.2);
}

/* Improved Button States */
.sport-card-btn:disabled,
.sport-card-btn[aria-disabled="true"] {
    opacity: 0.4;
    cursor: not-allowed;
    pointer-events: none;
    filter: grayscale(50%);
}

/* Enhanced Status Indicators */
.sport-card-status {
    position: relative;
    overflow: hidden;
}

.sport-card-status::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
    transition: left 0.5s ease;
}

.sport-card-status.status-active::before {
    animation: statusGlow 2s ease-in-out infinite;
}

@keyframes statusGlow {
    0%, 100% { left: -100%; }
    50% { left: 100%; }
}

/* Card Entrance Animation */
.sport-event-card {
    animation: cardEnter 0.5s ease-out;
}

@keyframes cardEnter {
    0% {
        opacity: 0;
        transform: translateY(20px) scale(0.95);
    }
    100% {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
}

/* Staggered Animation for Multiple Cards */
.sport-event-card:nth-child(1) { animation-delay: 0s; }
.sport-event-card:nth-child(2) { animation-delay: 0.1s; }
.sport-event-card:nth-child(3) { animation-delay: 0.2s; }
.sport-event-card:nth-child(4) { animation-delay: 0.3s; }
.sport-event-card:nth-child(5) { animation-delay: 0.4s; }

/* Improved Scrollbar for Webkit */
.sport-card-description::-webkit-scrollbar {
    width: 4px;
}

.sport-card-description::-webkit-scrollbar-track {
    background: rgba(255, 255, 255, 0.1);
    border-radius: 2px;
}

.sport-card-description::-webkit-scrollbar-thumb {
    background: rgba(255, 255, 255, 0.3);
    border-radius: 2px;
}

/* Dark Mode Enhancements */
@media (prefers-color-scheme: dark) {
    .sport-event-card {
        background: rgba(255, 255, 255, 0.08);
        border-color: rgba(255, 255, 255, 0.15);
    }
    
    .sport-card-stats {
        background: rgba(255, 255, 255, 0.03);
    }
    
    .stat-item {
        background: rgba(255, 255, 255, 0.05);
    }
}

/* Light Mode Support */
@media (prefers-color-scheme: light) {
    .sport-event-card {
        background: rgba(0, 0, 0, 0.05);
        border-color: rgba(0, 0, 0, 0.1);
        color: #333;
    }
    
    .sport-card-title {
        color: white;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.7);
    }
    
    .sport-info-item {
        color: rgba(0, 0, 0, 0.8);
    }
    
    .sport-card-description p {
        color: rgba(0, 0, 0, 0.7);
    }
    
    .stat-label {
        color: rgba(0, 0, 0, 0.6);
    }
}

/* Foldable Device Support */
@media (spanning: single-fold-vertical) {
    .sport-card-info {
        grid-template-columns: 1fr 1fr;
    }
    
    .sport-card-actions {
        grid-template-columns: repeat(2, 1fr);
    }
}

@media (spanning: single-fold-horizontal) {
    .sport-card-header {
        height: 80px;
    }
    
    .sport-card-body {
        padding: 12px;
    }
}

/* Ultra-wide Screen Support */
@media (min-width: 1400px) {
    .sport-event-card {
        max-width: 600px;
    }
}

/* Print Styles */
@media print {
    .sport-event-card {
        background: white !important;
        color: black !important;
        box-shadow: none !important;
        border: 1px solid #ccc !important;
        break-inside: avoid;
        margin-bottom: 20px;
    }
    
    .sport-card-header {
        background: #f5f5f5 !important;
        color: black !important;
    }
    
    .sport-card-title {
        color: black !important;
        text-shadow: none !important;
    }
    
    .sport-card-status {
        background: #ddd !important;
        color: black !important;
    }
    
    .sport-info-item,
    .sport-card-description p,
    .stat-number,
    .stat-label {
        color: black !important;
    }
    
    .sport-card-actions {
        display: none !important;
    }
    
    .sport-card-stats {
        background: #f9f9f9 !important;
    }
}

/* Performance Optimizations */
.sport-event-card * {
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
}

/* GPU Acceleration for Smooth Animations */
.sport-card-btn,
.sport-card-status,
.sport-event-card {
    transform: translateZ(0);
    -webkit-backface-visibility: hidden;
    backface-visibility: hidden;
}

/* Improved Touch Targets for Accessibility */
@media (max-width: 768px) {
    .sport-card-btn {
        min-height: 48px;
        min-width: 48px;
        padding: 12px 8px;
    }
    
    .sport-card-btn i {
        font-size: 16px;
    }
    
    .sport-card-btn span {
        font-size: 11px;
    }
}

/* Enhanced Visual Feedback */
.sport-card-btn:active {
    transform: scale(0.98);
    transition: transform 0.1s ease;
}

/* Improved Button Spacing on Small Screens */
@media (max-width: 320px) {
    .sport-card-actions {
        gap: 6px;
    }
    
    .sport-card-btn {
        padding: 8px 4px;
        min-height: 44px;
    }
    
    .sport-card-btn span {
        font-size: 10px;
    }
}

/* Enhanced Status Animation */
.sport-card-status.status-active {
    animation: pulse 2s ease-in-out infinite;
}

@keyframes pulse {
    0%, 100% {
        box-shadow: 0 0 0 0 rgba(39, 174, 96, 0.4);
    }
    50% {
        box-shadow: 0 0 0 8px rgba(39, 174, 96, 0);
    }
}

/* Improved Card Hover Effect */
@media (hover: hover) {
    .sport-event-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.05), transparent);
        opacity: 0;
        transition: opacity 0.3s ease;
        pointer-events: none;
        border-radius: 15px;
    }
    
    .sport-event-card:hover::before {
        opacity: 1;
    }
}

/* Screen Reader Support */
.sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
}

/* Enhanced Button Icons */
.sport-card-btn i {
    transition: transform 0.2s ease;
}

.sport-card-btn:hover i {
    transform: scale(1.1);
}

.sport-card-btn.launch-btn:hover i {
    transform: scale(1.1) rotate(15deg);
}

.sport-card-btn.delete-btn:hover i {
    transform: scale(1.1) rotate(10deg);
}

/* Improved Text Readability */
.sport-card-description p {
    text-align: justify;
    text-justify: inter-word;
}

/* Enhanced Mobile Landscape */
@media (max-height: 600px) and (orientation: landscape) and (max-width: 900px) {
    .sport-card-header {
        height: 60px;
    }
    
    .sport-card-body {
        padding: 10px;
    }
    
    .sport-card-stats {
        flex-direction: row;
        padding: 8px;
        margin-bottom: 10px;
    }
    
    .sport-card-actions {
        grid-template-columns: repeat(4, 1fr);
        gap: 6px;
    }
    
    .sport-card-btn {
        padding: 6px 4px;
        min-height: 40px;
    }
    
    .sport-card-btn span {
        font-size: 10px;
    }
}

/* Final Performance Optimization */
.sport-event-card {
    contain: layout style paint;
}

/* Ensure proper stacking context */
.sport-event-card {
    position: relative;
    z-index: 1;
}

.sport-card-btn:focus,
.sport-card-btn:active {
    z-index: 2;
}

/* Modal Overlay */
.sport-event-details-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    z-index: 10000;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: clamp(10px, 3vw, 20px);
    opacity: 0;
    animation: modalFadeIn 0.3s ease-out forwards;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
}

@keyframes modalFadeIn {
    0% {
        opacity: 0;
        backdrop-filter: blur(0px);
        -webkit-backdrop-filter: blur(0px);
    }
    100% {
        opacity: 1;
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
    }
}

/* Modal Content Container */
.sport-event-details-content {
    background: rgba(20, 20, 20, 0.95);
    border-radius: 15px;
    width: 100%;
    max-width: clamp(350px, 90vw, 800px);
    max-height: 90vh;
    overflow: hidden;
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.2);
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    transform: scale(0.9) translateY(20px);
    animation: modalSlideIn 0.3s ease-out 0.1s forwards;
    display: flex;
    flex-direction: column;
    position: relative;
}

@keyframes modalSlideIn {
    0% {
        transform: scale(0.9) translateY(20px);
        opacity: 0;
    }
    100% {
        transform: scale(1) translateY(0);
        opacity: 1;
    }
}

/* Modal Header */
.sport-details-header {
    height: clamp(100px, 15vw, 120px);
    position: relative;
    background: linear-gradient(135deg, #008B8B, #006666);
    display: flex;
    align-items: center;
    justify-content: center;
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    flex-shrink: 0;
}

.sport-details-header .sport-card-overlay {
    background: rgba(0, 0, 0, 0.4);
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    padding: clamp(15px, 4vw, 20px);
    position: relative;
}

.sport-details-header h2 {
    color: white;
    font-size: clamp(18px, 5vw, 24px);
    font-weight: bold;
    margin: 0 0 8px 0;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
    line-height: 1.2;
    word-break: break-word;
    hyphens: auto;
    -webkit-hyphens: auto;
    -ms-hyphens: auto;
    text-align: center;
    padding-right: 40px; /* Space for close button */
}

/* Close Button */
.close-modal-btn {
    position: absolute;
    top: clamp(10px, 3vw, 15px);
    right: clamp(10px, 3vw, 15px);
    width: clamp(32px, 8vw, 40px);
    height: clamp(32px, 8vw, 40px);
    background: rgba(255, 255, 255, 0.2);
    border: none;
    border-radius: 50%;
    color: white;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    z-index: 10001;
    -webkit-tap-highlight-color: transparent;
    font-size: clamp(14px, 4vw, 16px);
}

.close-modal-btn:hover {
    background: rgba(255, 255, 255, 0.3);
    transform: scale(1.1);
}

.close-modal-btn:active {
    transform: scale(0.95);
}

/* Modal Body */
.sport-details-body {
    padding: clamp(15px, 4vw, 20px);
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
    flex: 1;
    min-height: 0;
}

/* Details Grid */
.sport-details-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: clamp(15px, 4vw, 20px);
    margin-bottom: clamp(20px, 5vw, 25px);
}

/* Detail Sections */
.sport-detail-section {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 12px;
    padding: clamp(15px, 4vw, 20px);
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.sport-detail-section.full-width {
    grid-column: 1 / -1;
}

.sport-detail-section h4 {
    color: white;
    font-size: clamp(14px, 4vw, 16px);
    font-weight: bold;
    margin: 0 0 15px 0;
    display: flex;
    align-items: center;
    gap: 8px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.sport-detail-section h4 i {
    color: #3498db;
    font-size: clamp(16px, 4vw, 18px);
}

/* Detail Items */
.sport-detail-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: clamp(8px, 2vw, 10px) 0;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    gap: 10px;
}

.sport-detail-item:last-child {
    border-bottom: none;
}

.detail-label {
    color: rgba(255, 255, 255, 0.7);
    font-size: clamp(12px, 3vw, 14px);
    font-weight: 500;
    min-width: 100px;
    flex-shrink: 0;
}

.detail-value {
    color: white;
    font-size: clamp(12px, 3vw, 14px);
    font-weight: bold;
    text-align: right;
    word-break: break-word;
    flex: 1;
}

/* Statistics Grid */
.sport-stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
    gap: clamp(10px, 3vw, 15px);
}

.sport-stat-card {
    background: rgba(255, 255, 255, 0.08);
    border-radius: 10px;
    padding: clamp(12px, 3vw, 15px);
    text-align: center;
    border: 1px solid rgba(255, 255, 255, 0.1);
    transition: all 0.3s ease;
}

.sport-stat-card:hover {
    background: rgba(255, 255, 255, 0.12);
    transform: translateY(-2px);
}

.sport-stat-card .stat-number {
    display: block;
    font-size: clamp(18px, 5vw, 24px);
    font-weight: bold;
    color: #3498db;
    line-height: 1.2;
    margin-bottom: 4px;
}

.sport-stat-card .stat-label {
    font-size: clamp(10px, 2.5vw, 12px);
    color: rgba(255, 255, 255, 0.7);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    line-height: 1.2;
}

/* Event Description */
.event-description {
    color: rgba(255, 255, 255, 0.9);
    font-size: clamp(12px, 3vw, 14px);
    line-height: 1.6;
    margin: 0;
    word-break: break-word;
    hyphens: auto;
    -webkit-hyphens: auto;
    -ms-hyphens: auto;
    text-align: justify;
    text-justify: inter-word;
}

/* Participants List */
.participants-list {
    display: flex;
    flex-direction: column;
    gap: clamp(8px, 2vw, 10px);
}

.participant-item {
    display: flex;
    align-items: center;
    gap: clamp(8px, 2vw, 12px);
    padding: clamp(10px, 3vw, 12px);
    background: rgba(255, 255, 255, 0.05);
    border-radius: 8px;
    border: 1px solid rgba(255, 255, 255, 0.1);
    transition: all 0.3s ease;
}

.participant-item:hover {
    background: rgba(255, 255, 255, 0.08);
}

.participant-item i {
    color: #3498db;
    font-size: clamp(14px, 3.5vw, 16px);
    flex-shrink: 0;
}

.participant-item span:first-of-type {
    color: white;
    font-size: clamp(12px, 3vw, 14px);
    font-weight: 500;
    flex: 1;
    word-break: break-word;
}

.participant-status {
    padding: 4px 8px;
    border-radius: 12px;
    font-size: clamp(10px, 2.5vw, 11px);
    font-weight: bold;
    text-transform: uppercase;
    white-space: nowrap;
    flex-shrink: 0;
}

/* Action Buttons */
.sport-details-actions {
    display: flex;
    gap: clamp(10px, 3vw, 15px);
    justify-content: center;
    margin-top: clamp(20px, 5vw, 30px);
    padding-top: clamp(15px, 4vw, 20px);
    border-top: 1px solid rgba(255, 255, 255, 0.1);
    flex-wrap: wrap;
}

.sport-detail-btn {
    padding: clamp(10px, 3vw, 12px) clamp(16px, 4vw, 20px);
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-weight: bold;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: all 0.3s ease;
    text-transform: uppercase;
    font-size: clamp(11px, 3vw, 13px);
    min-height: 48px;
    justify-content: center;
    -webkit-tap-highlight-color: transparent;
    flex: 1;
    min-width: 120px;
    font-family: inherit;
    letter-spacing: 0.5px;
}

.sport-detail-btn i {
    font-size: clamp(14px, 3.5vw, 16px);
}

/* Button Colors */
.sport-detail-btn.edit-btn {
    background: rgba(52, 152, 219, 0.8);
    color: white;
}

.sport-detail-btn.edit-btn:hover:not(.disabled) {
    background: rgba(52, 152, 219, 1);
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
}

.sport-detail-btn.launch-btn {
    background: rgba(155, 89, 182, 0.8);
    color: white;
}

.sport-detail-btn.launch-btn:hover:not(.disabled) {
    background: rgba(155, 89, 182, 1);
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(155, 89, 182, 0.3);
}

.sport-detail-btn.delete-btn {
    background: rgba(231, 76, 60, 0.8);
    color: white;
}

.sport-detail-btn.delete-btn:hover:not(.disabled) {
    background: rgba(231, 76, 60, 1);
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3);
}

.sport-detail-btn.disabled {
    opacity: 0.5;
    cursor: not-allowed;
    pointer-events: none;
    filter: grayscale(50%);
}

/* Tablet Styles */
@media (min-width: 481px) and (max-width: 768px) {
    .sport-details-grid {
        grid-template-columns: 1fr 1fr;
        gap: 15px;
    }
    
    .sport-stats-grid {
        grid-template-columns: repeat(3, 1fr);
    }
    
    .sport-details-actions {
        flex-direction: row;
        gap: 12px;
    }
    
    .sport-detail-btn {
        flex: 1;
        min-width: 100px;
    }
}

/* Desktop Styles */
@media (min-width: 769px) {
    .sport-details-grid {
        grid-template-columns: 1fr 1fr;
        gap: 20px;
    }
    
    .sport-stats-grid {
        grid-template-columns: repeat(3, 1fr);
    }
    
    .sport-details-actions {
        flex-direction: row;
        justify-content: center;
        gap: 15px;
    }
    
    .sport-detail-btn {
        flex: none;
        min-width: 140px;
    }
}
/* Mobile Portrait */
@media (max-width: 480px) {
    .sport-event-details-overlay {
        padding: 5px;
        align-items: flex-start;
        padding-top: 20px;
    }
    
    .sport-event-details-content {
        max-height: 95vh;
        border-radius: 12px;
    }
    
    .sport-details-header h2 {
        padding-right: 50px;
        font-size: 16px;
    }
    
    .close-modal-btn {
        width: 36px;
        height: 36px;
        top: 8px;
        right: 8px;
    }
    
    .sport-details-grid {
        grid-template-columns: 1fr;
        gap: 12px;
    }
    
    .sport-stats-grid {
        grid-template-columns: repeat(3, 1fr);
        gap: 8px;
    }
    
    .sport-details-actions {
        flex-direction: column;
        gap: 8px;
    }
    
    .sport-detail-btn {
        width: 100%;
        min-width: auto;
        flex: none;
    }
    
    .participant-item {
        flex-wrap: wrap;
        gap: 8px;
    }
    
    .participant-status {
        margin-left: auto;
    }
}

/* Very Small Screens */
@media (max-width: 360px) {
    .sport-event-details-overlay {
        padding: 2px;
        padding-top: 10px;
    }
    
    .sport-event-details-content {
        border-radius: 8px;
        max-height: 98vh;
    }
    
    .sport-details-header {
        height: 80px;
    }
    
    .sport-details-body {
        padding: 12px;
    }
    
    .sport-detail-section {
        padding: 12px;
    }
    
    .sport-stats-grid {
        grid-template-columns: 1fr 1fr;
        gap: 6px;
    }
    
    .sport-stat-card {
        padding: 8px;
    }
    
    .detail-label {
        min-width: 80px;
        font-size: 11px;
    }
    
    .detail-value {
        font-size: 11px;
    }
}

/* Landscape Mobile */
@media (max-height: 500px) and (orientation: landscape) {
    .sport-event-details-overlay {
        padding: 5px;
        align-items: flex-start;
    }
    
    .sport-event-details-content {
        max-height: 95vh;
        width: 95vw;
    }
    
    .sport-details-header {
        height: 60px;
    }
    
    .sport-details-header h2 {
        font-size: 14px;
        padding-right: 40px;
    }
    
    .close-modal-btn {
        width: 30px;
        height: 30px;
        top: 5px;
        right: 5px;
    }
    
    .sport-details-body {
        padding: 10px;
    }
    
    .sport-details-grid {
        grid-template-columns: 1fr 1fr;
        gap: 10px;
    }
    
    .sport-detail-section {
        padding: 10px;
    }
    
    .sport-details-actions {
        flex-direction: row;
        gap: 8px;
        margin-top: 10px;
        padding-top: 10px;
    }
    
    .sport-detail-btn {
        padding: 8px 12px;
        min-height: 36px;
        font-size: 10px;
    }
}

/* Touch Device Optimizations */
@media (hover: none) and (pointer: coarse) {
    .sport-detail-btn:active:not(.disabled) {
        transform: scale(0.95);
        transition: transform 0.1s ease;
    }
    
    .close-modal-btn:active {
        transform: scale(0.9);
        transition: transform 0.1s ease;
    }
    
    .sport-stat-card:hover {
        transform: none;
        background: rgba(255, 255, 255, 0.08);
    }
    
    .sport-stat-card:active {
        transform: scale(0.98);
        transition: transform 0.1s ease;
    }
    
    /* Increase touch targets */
    .sport-detail-btn {
        min-height: 48px;
        min-width: 48px;
    }
    
    .close-modal-btn {
        min-width: 44px;
        min-height: 44px;
    }
}

/* Hover Effects for Desktop */
@media (hover: hover) and (pointer: fine) {
    .sport-event-details-overlay:hover {
        cursor: pointer;
    }
    
    .sport-event-details-content:hover {
        cursor: default;
    }
    
    .sport-detail-btn:hover:not(.disabled) {
        transform: translateY(-2px);
    }
    
    .close-modal-btn:hover {
        background: rgba(255, 255, 255, 0.3);
        transform: scale(1.1);
    }
    
    .participant-item:hover {
        background: rgba(255, 255, 255, 0.08);
        transform: translateX(5px);
    }
}

/* Safe Area Support for iPhone X+ */
@supports (padding: max(0px)) {
    .sport-event-details-overlay {
        padding-left: max(5px, env(safe-area-inset-left));
        padding-right: max(5px, env(safe-area-inset-right));
        padding-top: max(20px, env(safe-area-inset-top));
        padding-bottom: max(5px, env(safe-area-inset-bottom));
    }
    
    .close-modal-btn {
        top: max(10px, calc(env(safe-area-inset-top) + 10px));
        right: max(10px, calc(env(safe-area-inset-right) + 10px));
    }
}

/* Foldable Device Support */
@media (spanning: single-fold-vertical) {
    .sport-details-grid {
        grid-template-columns: 1fr 1fr;
        gap: 20px;
    }
    
    .sport-details-actions {
        flex-direction: row;
        justify-content: space-around;
    }
}

@media (spanning: single-fold-horizontal) {
    .sport-event-details-content {
        max-height: 45vh;
    }
    
    .sport-details-header {
        height: 60px;
    }
}

/* Ultra-wide Screens */
@media (min-width: 1200px) {
    .sport-event-details-content {
        max-width: 900px;
    }
    
    .sport-details-grid {
        grid-template-columns: 1fr 1fr 1fr;
        gap: 25px;
    }
    
    .sport-detail-section.full-width {
        grid-column: 1 / -1;
    }
}

/* High DPI Displays */
@media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
    .sport-event-details-content {
        border-width: 0.5px;
    }
    
    .sport-detail-section {
        border-width: 0.5px;
    }
}

/* Accessibility Improvements */
.sport-detail-btn:focus-visible {
    outline: 2px solid #3498db;
    outline-offset: 2px;
    box-shadow: 0 0 0 4px rgba(52, 152, 219, 0.2);
}

.close-modal-btn:focus-visible {
    outline: 2px solid white;
    outline-offset: 2px;
    box-shadow: 0 0 0 4px rgba(255, 255, 255, 0.2);
}

/* Reduced Motion Support */
@media (prefers-reduced-motion: reduce) {
    .sport-event-details-overlay,
    .sport-event-details-content,
    .sport-detail-btn,
    .close-modal-btn,
    .sport-stat-card,
    .participant-item {
        animation: none;
        transition: none;
    }
    
    .sport-detail-btn:hover,
    .close-modal-btn:hover,
    .sport-stat-card:hover,
    .participant-item:hover {
        transform: none;
    }
}

/* Dark Mode Enhancements */
@media (prefers-color-scheme: dark) {
    .sport-event-details-content {
        background: rgba(10, 10, 10, 0.98);
        border-color: rgba(255, 255, 255, 0.15);
    }
    
    .sport-detail-section {
        background: rgba(255, 255, 255, 0.03);
        border-color: rgba(255, 255, 255, 0.08);
    }
    
    .sport-stat-card {
        background: rgba(255, 255, 255, 0.05);
        border-color: rgba(255, 255, 255, 0.08);
    }
    
    .participant-item {
        background: rgba(255, 255, 255, 0.03);
        border-color: rgba(255, 255, 255, 0.08);
    }
}

/* Light Mode Support */
@media (prefers-color-scheme: light) {
    .sport-event-details-content {
        background: rgba(240, 240, 240, 0.98);
        color: #333;
    }
    
    .sport-details-header h2 {
        color: white;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.7);
    }
    
    .sport-detail-section h4 {
        color: #333;
    }
    
    .detail-label {
        color: rgba(0, 0, 0, 0.6);
    }
    
    .detail-value {
        color: #333;
    }
    
    .event-description {
        color: rgba(0, 0, 0, 0.8);
    }
    
    .participant-item span:first-of-type {
        color: #333;
    }
    
    .sport-stat-card .stat-label {
        color: rgba(0, 0, 0, 0.6);
    }
}

/* High Contrast Mode */
@media (prefers-contrast: high) {
    .sport-event-details-content {
        border: 2px solid white;
    }
    
    .sport-detail-section {
        border: 1px solid white;
    }
    
    .sport-detail-btn {
        border: 1px solid white;
    }
    
    .close-modal-btn {
        border: 1px solid white;
    }
}

/* Reduced Transparency */
@media (prefers-reduced-transparency: reduce) {
    .sport-event-details-overlay {
        background: rgba(0, 0, 0, 0.95);
        backdrop-filter: none;
        -webkit-backdrop-filter: none;
    }
    
    .sport-event-details-content {
        background: rgba(20, 20, 20, 0.98);
        backdrop-filter: none;
        -webkit-backdrop-filter: none;
    }
    
    .close-modal-btn {
        background: rgba(255, 255, 255, 0.9);
        backdrop-filter: none;
        -webkit-backdrop-filter: none;
    }
}

/* Scrollbar Styling for Webkit */
.sport-details-body::-webkit-scrollbar {
    width: 8px;
}

.sport-details-body::-webkit-scrollbar-track {
    background: rgba(255, 255, 255, 0.1);
    border-radius: 4px;
}

.sport-details-body::-webkit-scrollbar-thumb {
    background: rgba(255, 255, 255, 0.3);
    border-radius: 4px;
}

.sport-details-body::-webkit-scrollbar-thumb:hover {
    background: rgba(255, 255, 255, 0.5);
}

/* Loading States */
.sport-event-details-content.loading {
    opacity: 0.8;
    pointer-events: none;
}

.sport-detail-btn.loading {
    position: relative;
    color: transparent;
    pointer-events: none;
}

.sport-detail-btn.loading::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 16px;
    height: 16px;
    margin: -8px 0 0 -8px;
    border: 2px solid transparent;
    border-top: 2px solid currentColor;
    border-radius: 50%;
    animation: spin 1s linear infinite;
    color: white;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* Performance Optimizations */
.sport-event-details-overlay,
.sport-event-details-content,
.sport-detail-btn,
.close-modal-btn {
    will-change: transform;
    transform: translateZ(0);
    -webkit-backface-visibility: hidden;
    backface-visibility: hidden;
}

.sport-event-details-content * {
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
}

/* Container Queries for Modern Browsers */
@supports (container-type: inline-size) {
    .sport-event-details-content {
        container-type: inline-size;
    }
    
    @container (max-width: 400px) {
        .sport-details-grid {
            grid-template-columns: 1fr;
        }
        
        .sport-stats-grid {
            grid-template-columns: 1fr 1fr;
        }
        
        .sport-details-actions {
            flex-direction: column;
        }
    }
    
    @container (min-width: 600px) {
        .sport-details-grid {
            grid-template-columns: 1fr 1fr;
        }
        
        .sport-stats-grid {
            grid-template-columns: repeat(3, 1fr);
        }
        
        .sport-details-actions {
            flex-direction: row;
        }
    }
}

/* Print Styles */
@media print {
    .sport-event-details-overlay {
        position: static;
        background: white !important;
        backdrop-filter: none;
        -webkit-backdrop-filter: none;
        padding: 0;
    }
    
    .sport-event-details-content {
        background: white !important;
        color: black !important;
        box-shadow: none !important;
        border: 1px solid #ccc !important;
        max-width: none;
        max-height: none;
        border-radius: 0;
    }
    
    .sport-details-header {
        background: #f5f5f5 !important;
        color: black !important;
        height: auto;
        padding: 20px;
    }
    
    .sport-details-header h2 {
        color: black !important;
        text-shadow: none !important;
        padding-right: 0;
    }
    
    .close-modal-btn {
        display: none !important;
    }
    
    .sport-detail-section {
        background: #f9f9f9 !important;
        border: 1px solid #ddd !important;
        break-inside: avoid;
    }
    
    .sport-detail-section h4 {
        color: black !important;
    }
    
    .detail-label,
    .detail-value,
    .event-description,
    .participant-item span {
        color: black !important;
    }
    
    .sport-stat-card {
        background: white !important;
        border: 1px solid #ddd !important;
    }
    
    .sport-stat-card .stat-number {
        color: #333 !important;
    }
    
    .sport-stat-card .stat-label {
        color: #666 !important;
    }
    
    .sport-details-actions {
        display: none !important;
    }
    
    .participant-status {
        background: #eee !important;
        color: black !important;
    }
}

/* Enhanced Button Ripple Effect */
.sport-detail-btn {
    position: relative;
    overflow: hidden;
}

.sport-detail-btn::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.3);
    transform: translate(-50%, -50%);
    transition: width 0.3s ease, height 0.3s ease;
    pointer-events: none;
}

.sport-detail-btn:active::before {
    width: 120px;
    height: 120px;
}

/* Enhanced Status Colors */
.sport-card-status.status-active,
.participant-status.status-active {
    background: rgba(39, 174, 96, 0.9);
    color: white;
    box-shadow: 0 0 10px rgba(39, 174, 96, 0.3);
}

.sport-card-status.status-draft,
.participant-status.status-draft {
    background: rgba(241, 196, 15, 0.9);
    color: white;
    box-shadow: 0 0 10px rgba(241, 196, 15, 0.3);
}

.sport-card-status.status-completed,
.participant-status.status-completed {
    background: rgba(52, 152, 219, 0.9);
    color: white;
    box-shadow: 0 0 10px rgba(52, 152, 219, 0.3);
}

.sport-card-status.status-cancelled,
.participant-status.status-cancelled {
    background: rgba(231, 76, 60, 0.9);
    color: white;
    box-shadow: 0 0 10px rgba(231, 76, 60, 0.3);
}

.sport-card-status.status-launched,
.participant-status.status-launched {
    background: rgba(155, 89, 182, 0.9);
    color: white;
    box-shadow: 0 0 10px rgba(155, 89, 182, 0.3);
}

.participant-status.status-joined {
    background: rgba(46, 204, 113, 0.9);
    color: white;
    box-shadow: 0 0 10px rgba(46, 204, 113, 0.3);
}

.participant-status.status-pending {
    background: rgba(230, 126, 34, 0.9);
    color: white;
    box-shadow: 0 0 10px rgba(230, 126, 34, 0.3);
}

/* Enhanced Typography */
.sport-details-header h2,
.sport-detail-section h4,
.detail-label,
.detail-value,
.event-description,
.participant-item span,
.sport-detail-btn {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
}

/* Improved Focus Management */
.sport-event-details-overlay[tabindex="0"]:focus {
    outline: none;
}

.sport-event-details-content:focus-within {
    outline: 2px solid #3498db;
    outline-offset: 2px;
}

/* Enhanced Modal Exit Animation */
.sport-event-details-overlay.closing {
    animation: modalFadeOut 0.3s ease-in forwards;
}

.sport-event-details-overlay.closing .sport-event-details-content {
    animation: modalSlideOut 0.3s ease-in forwards;
}

@keyframes modalFadeOut {
    0% {
        opacity: 1;
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
    }
    100% {
        opacity: 0;
        backdrop-filter: blur(0px);
        -webkit-backdrop-filter: blur(0px);
    }
}

@keyframes modalSlideOut {
    0% {
        transform: scale(1) translateY(0);
        opacity: 1;
    }
    100% {
        transform: scale(0.9) translateY(20px);
        opacity: 0;
    }
}

/* Enhanced Scrolling Behavior */
.sport-details-body {
    scroll-behavior: smooth;
    overscroll-behavior: contain;
}

/* Improved Button Icons Animation */
.sport-detail-btn i {
    transition: transform 0.2s ease;
}

.sport-detail-btn:hover i {
    transform: scale(1.1);
}

.sport-detail-btn.launch-btn:hover i {
    transform: scale(1.1) rotate(15deg);
}

.sport-detail-btn.delete-btn:hover i {
    transform: scale(1.1) rotate(10deg);
}

.sport-detail-btn.edit-btn:hover i {
    transform: scale(1.1) rotate(-5deg);
}

/* Enhanced Error States */
.sport-event-details-content.error {
    border-color: rgba(231, 76, 60, 0.5);
    box-shadow: 0 0 20px rgba(231, 76, 60, 0.2);
}

.sport-event-details-content.error .sport-details-header {
    background: linear-gradient(135deg, #e74c3c, #c0392b);
}

/* Enhanced Success States */
.sport-event-details-content.success {
    border-color: rgba(39, 174, 96, 0.5);
    box-shadow: 0 0 20px rgba(39, 174, 96, 0.2);
}

/* Improved Empty States */
.participants-list:empty::after {
    content: 'No participants yet';
    display: block;
    text-align: center;
    color: rgba(255, 255, 255, 0.5);
    font-style: italic;
    padding: 20px;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 8px;
    border: 1px dashed rgba(255, 255, 255, 0.2);
}

/* Enhanced Keyboard Navigation */
.sport-detail-btn:focus,
.close-modal-btn:focus {
    z-index: 10002;
}

/* Improved Modal Backdrop Click */
.sport-event-details-overlay {
    cursor: pointer;
}

.sport-event-details-content {
    cursor: default;
}

/* Enhanced Mobile Gestures */
@media (max-width: 768px) {
    .sport-event-details-content {
        touch-action: pan-y;
    }
    
    .sport-details-body {
        -webkit-overflow-scrolling: touch;
        overscroll-behavior-y: contain;
    }
}

/* Final Performance Optimizations */
.sport-event-details-overlay {
    contain: layout style paint;
}

.sport-event-details-content {
    contain: layout style;
}

.sport-details-body {
    contain: layout;
}

/* Ensure proper stacking context */
.sport-event-details-overlay {
    isolation: isolate;
}

.close-modal-btn {
    z-index: 10001;
}

/* Enhanced Visual Hierarchy */
.sport-detail-section h4 {
    position: relative;
    padding-bottom: 8px;
}

.sport-detail-section h4::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    width: 30px;
    height: 2px;
    background: #3498db;
    border-radius: 1px;
}

/* Improved Content Spacing */
.sport-detail-item + .sport-detail-item {
    margin-top: 2px;
}

.participant-item + .participant-item {
    margin-top: 2px;
}

/* Enhanced Visual Feedback */
.sport-stat-card {
    position: relative;
    overflow: hidden;
}

.sport-stat-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
    transition: left 0.5s ease;
}

.sport-stat-card:hover::before {
    left: 100%;
}

/* Final Responsive Adjustments */
@media (max-width: 280px) {
    .sport-event-details-content {
        margin: 0;
        border-radius: 0;
        max-height: 100vh;
    }
    
    .sport-details-header {
        height: 70px;
    }
    
    .sport-details-body {
        padding: 8px;
    }
    
    .sport-detail-section {
        padding: 8px;
    }
    
    .sport-details-actions {
        gap: 4px;
    }
    
    .sport-detail-btn {
        padding: 8px 6px;
        font-size: 9px;
        min-height: 40px;
    }
}

</style>
`;

// Initialize the sport events loader when DOM is ready
document.addEventListener('DOMContentLoaded', function() {
    // Inject styles
    document.head.insertAdjacentHTML('beforeend', sportEventsStyles);
    
    // Initialize the sport events loader
    window.sportEventsLoader = new SportEventsLoader();
});

// Export for use in other modules
if (typeof
    module !== 'undefined' && module.exports) {
        module.exports = {
            SportEventsLoader
        };
    } else {
        window.SportEventsLoader = SportEventsLoader;
    }
   
// Standalone Football Control System
const footballControl = {
    currentEventId: null,
    isPageCreated: false,
    
    setupEvent(eventId) {
        console.log('Setting up football event with ID:', eventId);
        
        // Get the event data from sportEventsLoader
        let eventData = null;
        if (typeof sportEventsLoader !== 'undefined' && sportEventsLoader.events) {
            eventData = sportEventsLoader.events.find(event => event.id === eventId);
        }
        
        if (!eventData) {
            console.error('Event not found:', eventId);
            // Show error message
            if (typeof sportEventsLoader !== 'undefined' && sportEventsLoader.showToast) {
                sportEventsLoader.showToast('Event not found', 'error');
            } else {
                alert('Event not found');
            }
            return;
        }

        console.log('Found event data:', eventData);
        
        // Store current event ID
        this.currentEventId = eventId;
        
        // Create the football control page if it doesn't exist
        if (!this.isPageCreated) {
            this.createFootballControlPage();
            this.injectStyles();
            this.isPageCreated = true;
        }
        
        // Hide main content and show football control page
        const mainContent = document.getElementById('main-content');
        const footballPage = document.getElementById('football-control-page');
        
        if (mainContent) {
            mainContent.style.display = 'none';
        }
        
        if (footballPage) {
            footballPage.style.display = 'block';
            // Initialize the football control page with event data
            this.initializeFootballControlPage(eventData);
        } else {
            console.error('Football control page not found');
        }
    },

    createFootballControlPage() {
        // Check if page already exists
        if (document.getElementById('football-control-page')) {
            console.log('Football control page already exists');
            return;
        }

        const footballControlHTML = `
        <!-- Football Control Match Page Section -->
        <div id="football-control-page" class="page-section" style="display: none;">
            <!-- Header Section -->
            <header class="control-header">
                <div class="header-container">
                    <div class="header-left">
                        <button class="back-btn" onclick="closeFootballControl()">
                            <i class="fas fa-arrow-left"></i>
                        </button>
                        <div class="header-info">
                            <h1>Football Control Match</h1>
                            <p id="event-name">Football Tournament 2024</p>
                        </div>
                    </div>
                    <div class="header-right">
                        <div class="event-status" id="event-status">
                            <span class="status-indicator"></span>
                            <span class="status-text">Active</span>
                        </div>
                        <button class="settings-btn" onclick="openSettings()">
                            <i class="fas fa-cog"></i>
                        </button>
                    </div>
                </div>
            </header>

            <!-- Banner Ads Section -->
            <section class="banner-ads-section">
                <div class="banner-container">
                    <div class="banner-slider" id="bannerSlider">
                        <div class="banner-slide active">
                            <div class="banner-content">
                                <div class="banner-bg" style="background: linear-gradient(45deg, #FF6B6B, #FF8E8E);"></div>
                                <div class="banner-overlay">
                                    <h3>Football Championship 2024</h3>
                                    <p>Join the biggest football tournament of the year!</p>
                                    <button class="banner-btn">Learn More</button>
                                </div>
                            </div>
                        </div>
                        <div class="banner-slide">
                            <div class="banner-content">
                                <div class="banner-bg" style="background: linear-gradient(45deg, #4ECDC4, #44A08D);"></div>
                                <div class="banner-overlay">
                                    <h3>Premium Sports Gear</h3>
                                    <p>Get 30% off on all football equipment!</p>
                                    <button class="banner-btn">Shop Now</button>
                                </div>
                            </div>
                        </div>
                        <div class="banner-slide">
                            <div class="banner-content">
                                <div class="banner-bg" style="background: linear-gradient(45deg, #45B7D1, #96C93D);"></div>
                                <div class="banner-overlay">
                                    <h3>Live Streaming Available</h3>
                                    <p>Watch all matches live with HD quality!</p>
                                    <button class="banner-btn">Watch Now</button>
                                </div>
                            </div>
                        </div>
                        <div class="banner-slide">
                            <div class="banner-content">
                                <div class="banner-bg" style="background: linear-gradient(45deg, #96CEB4, #FFEAA7);"></div>
                                <div class="banner-overlay">
                                    <h3>Advanced Football Analytics</h3>
                                    <p>Track player performance and match statistics!</p>
                                    <button class="banner-btn">View Stats</button>
                                </div>
                            </div>
                        </div>
                        <div class="banner-slide">
                            <div class="banner-content">
                                <div class="banner-bg" style="background: linear-gradient(45deg, #FFEAA7, #FFD93D);"></div>
                                <div class="banner-overlay">
                                    <h3>Professional Training Programs</h3>
                                    <p>Improve your skills with expert coaches!</p>
                                    <button class="banner-btn">Enroll Now</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="banner-indicators" id="bannerIndicators">
                        <span class="indicator active" data-slide="0"></span>
                        <span class="indicator" data-slide="1"></span>
                        <span class="indicator" data-slide="2"></span>
                        <span class="indicator" data-slide="3"></span>
                        <span class="indicator" data-slide="4"></span>
                    </div>
                </div>
            </section>

            <!-- Main Control Panel -->
            <main class="control-main">
                <div class="control-container">
                    <!-- Quick Stats Section -->
                    <section class="quick-stats">
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-icon">
                                    <i class="fas fa-users"></i>
                                </div>
                                <div class="stat-info">
                                    <h3 id="total-teams">8</h3>
                                    <p>Total Teams</p>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon">
                                    <i class="fas fa-calendar-alt"></i>
                                </div>
                                <div class="stat-info">
                                    <h3 id="total-matches">16</h3>
                                    <p>Total Matches</p>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon">
                                    <i class="fas fa-trophy"></i>
                                </div>
                                <div class="stat-info">
                                    <h3 id="completed-matches">4</h3>
                                    <p>Completed</p>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon">
                                    <i class="fas fa-clock"></i>
                                </div>
                                <div class="stat-info">
                                    <h3 id="upcoming-matches">12</h3>
                                    <p>Upcoming</p>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- Control Buttons Section -->
                    <section class="control-buttons">
                        <div class="buttons-grid">
                            <!-- Create Match Button -->
                            <div class="control-btn-card" onclick="openCreateMatch()">
                                <div class="btn-icon">
                                    <i class="fas fa-plus-circle"></i>
                                </div>
                                <div class="btn-content">
                                    <h3>Create Match</h3>
                                    <p>Schedule new football matches</p>
                                </div>
                                <div class="btn-arrow">
                                    <i class="fas fa-chevron-right"></i>
                                </div>
                            </div>

                            <!-- Find Teams/Players Button -->
                            <div class="control-btn-card" onclick="openFindTeamsPlayers()">
                                <div class="btn-icon">
                                    <i class="fas fa-search"></i>
                                </div>
                                <div class="btn-content">
                                    <h3>Find T/P</h3>
                                    <p>Search teams and players</p>
                                </div>
                                <div class="btn-arrow">
                                    <i class="fas fa-chevron-right"></i>
                                </div>
                            </div>

                            <!-- Previous Matches Button -->
                            <div class="control-btn-card" onclick="openPreviousMatches()">
                                <div class="btn-icon">
                                    <i class="fas fa-history"></i>
                                </div>
                                <div class="btn-content">
                                    <h3>Previous Matches</h3>
                                    <p>View completed match history</p>
                                </div>
                                <div class="btn-arrow">
                                    <i class="fas fa-chevron-right"></i>
                                </div>
                            </div>

                            <!-- Live Matches Button -->
                            <div class="control-btn-card live-indicator" onclick="openLiveMatches()">
                                <div class="btn-icon">
                                    <i class="fas fa-broadcast-tower"></i>
                                </div>
                                <div class="btn-content">
                                    <h3>Live Matches</h3>
                                    <p>Watch ongoing matches</p>
                                </div>
                                <div class="btn-arrow">
                                    <i class="fas fa-chevron-right"></i>
                                </div>
                                <div class="live-dot"></div>
                            </div>

                            <!-- Set Table Button -->
                            <div class="control-btn-card" onclick="openSetTable()">
                                <div class="btn-icon">
                                    <i class="fas fa-table"></i>
                                </div>
                                <div class="btn-content">
                                    <h3>Set Table</h3>
                                    <p>Manage league standings</p>
                                </div>
                                <div class="btn-arrow">
                                    <i class="fas fa-chevron-right"></i>
                                </div>
                            </div>

                            <!-- Upcoming Matches Button -->
                            <div class="control-btn-card" onclick="openUpcomingMatches()">
                                <div class="btn-icon">
                                    <i class="fas fa-calendar-plus"></i>
                                </div>
                                <div class="btn-content">
                                    <h3>Upcoming Matches</h3>
                                    <p>View scheduled fixtures</p>
                                </div>
                                <div class="btn-arrow">
                                    <i class="fas fa-chevron-right"></i>
                                </div>
                            </div>

                            <!-- Football News Button -->
                            <div class="control-btn-card" onclick="openFootballNews()">
                                <div class="btn-icon">
                                    <i class="fas fa-newspaper"></i>
                                </div>
                                <div class="btn-content">
                                    <h3>Football News</h3>
                                    <p>Latest football updates</p>
                                </div>
                                <div class="btn-arrow">
                                    <i class="fas fa-chevron-right"></i>
                                </div>
                            </div>

                            <!-- Football Highlights Button -->
                            <div class="control-btn-card" onclick="openFootballHighlights()">
                                <div class="btn-icon">
                                    <i class="fas fa-video"></i>
                                </div>
                                <div class="btn-content">
                                    <h3>Football Highlights</h3>
                                    <p>Watch match highlights</p>
                                </div>
                                <div class="btn-arrow">
                                    <i class="fas fa-chevron-right"></i>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- Recent Activity Section -->
                    <section class="recent-activity">
                        <div class="section-header">
                            <h2>Recent Activity</h2>
                            <button class="view-all-btn" onclick="viewAllActivity()">
                                View All <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                        <div class="activity-list" id="activityList">
                            <div class="activity-item">
                                <div class="activity-icon">
                                    <i class="fas fa-plus text-success"></i>
                                </div>
                                   <div class="activity-content">
                                    <p><strong>New match created:</strong> Team A vs Team B</p>
                                    <span class="activity-time">2 minutes ago</span>
                                </div>
                            </div>
                            <div class="activity-item">
                                <div class="activity-icon">
                                    <i class="fas fa-users text-info"></i>
                                </div>
                                <div class="activity-content">
                                    <p><strong>Team registered:</strong> Lightning Bolts joined the tournament</p>
                                    <span class="activity-time">15 minutes ago</span>
                                </div>
                            </div>
                            <div class="activity-item">
                                <div class="activity-icon">
                                    <i class="fas fa-trophy text-warning"></i>
                                </div>
                                <div class="activity-content">
                                    <p><strong>Match completed:</strong> Thunder FC won 3-1 against Storm United</p>
                                    <span class="activity-time">1 hour ago</span>
                                </div>
                            </div>
                        </div>
                    </section>
                </div>
            </main>
        </div>
        `;

        // Append to body
        document.body.insertAdjacentHTML('beforeend', footballControlHTML);
        console.log('Football control page created successfully');
    },

    injectStyles() {
        // Check if styles already injected
        if (document.getElementById('football-control-styles')) {
            return;
        }

        const styles = `
        <style id="football-control-styles">
        /* Football Control Match Page Styles */
        #football-control-page {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            z-index: 1000;
            overflow-y: auto;
        }

        /* Header Styles */
        .control-header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            padding: 15px 0;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .back-btn {
            background: rgba(102, 126, 234, 0.1);
            border: none;
            color: #667eea;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .back-btn:hover {
            background: rgba(102, 126, 234, 0.2);
            transform: translateX(-2px);
        }

        .header-info h1 {
            font-size: 24px;
            color: #333;
            margin: 0;
        }

        .header-info p {
            color: #666;
            margin: 5px 0 0 0;
            font-size: 14px;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .event-status {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: rgba(39, 174, 96, 0.1);
            border-radius: 20px;
        }

        .status-indicator {
            width: 8px;
            height: 8px;
            background: #27ae60;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .status-text {
            color: #27ae60;
            font-weight: 600;
            font-size: 12px;
        }

        .settings-btn {
            background: rgba(149, 165, 166, 0.1);
            border: none;
            color: #95a5a6;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .settings-btn:hover {
            background: rgba(149, 165, 166, 0.2);
            transform: rotate(90deg);
        }

        /* Banner Ads Styles */
        .banner-ads-section {
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .banner-container {
            position: relative;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .banner-slider {
            position: relative;
            height: 200px;
            overflow: hidden;
        }

        .banner-slide {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
        }

        .banner-slide.active {
            opacity: 1;
        }

        .banner-content {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .banner-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        .banner-overlay {
            position: relative;
            z-index: 2;
            text-align: center;
            color: white;
            padding: 20px;
        }

        .banner-overlay h3 {
            font-size: 28px;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .banner-overlay p {
            font-size: 16px;
            margin-bottom: 20px;
            opacity: 0.9;
        }

        .banner-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .banner-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .banner-indicators {
            position: absolute;
            bottom: 15px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
            z-index: 3;
        }

        .indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.5);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .indicator.active {
            background: white;
            transform: scale(1.2);
        }

        /* Main Control Panel */
        .control-main {
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .control-container {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        /* Quick Stats */
        .quick-stats {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.15);
        }

        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
        }

        .stat-info h3 {
            font-size: 28px;
            color: white;
            margin: 0;
            font-weight: 700;
        }

        .stat-info p {
            color: rgba(255, 255, 255, 0.8);
            margin: 5px 0 0 0;
            font-size: 14px;
        }

        /* Control Buttons */
        .control-buttons {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .buttons-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .control-btn-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
            overflow: hidden;
        }

        .control-btn-card:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.15);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        .control-btn-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.5s ease;
        }

        .control-btn-card:hover::before {
            left: 100%;
        }

        .btn-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
            flex-shrink: 0;
        }

        .btn-content {
            flex: 1;
        }

        .btn-content h3 {
            color: white;
            margin: 0 0 5px 0;
            font-size: 18px;
            font-weight: 600;
        }

        .btn-content p {
            color: rgba(255, 255, 255, 0.8);
            margin: 0;
            font-size: 14px;
        }

        .btn-arrow {
            color: rgba(255, 255, 255, 0.6);
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .control-btn-card:hover .btn-arrow {
            transform: translateX(5px);
            color: white;
        }

        /* Live Indicator */
        .live-indicator {
            position: relative;
        }

        .live-dot {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 10px;
            height: 10px;
            background: #e74c3c;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .live-dot::before {
            content: '';
            position: absolute;
            top: -5px;
            left: -5px;
            width: 20px;
            height: 20px;
            background: rgba(231, 76, 60, 0.3);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        /* Recent Activity */
        .recent-activity {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .section-header h2 {
            color: white;
            margin: 0;
            font-size: 22px;
        }

        .view-all-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .view-all-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .activity-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .activity-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            transition: all 0.3s ease;
        }

        .activity-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .activity-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .activity-content {
            flex: 1;
        }

        .activity-content p {
            color: white;
            margin: 0 0 5px 0;
            font-size: 14px;
        }

        .activity-time {
            color: rgba(255, 255, 255, 0.6);
            font-size: 12px;
        }

        .text-success { color: #27ae60; }
        .text-info { color: #3498db; }
        .text-warning { color: #f39c12; }

        /* Animations */
        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.7; }
            100% { transform: scale(1); opacity: 1; }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .header-container {
                padding: 0 15px;
            }
            
            .header-info h1 {
                font-size: 20px;
            }
            
            .banner-ads-section {
                padding: 15px;
            }
            
            .banner-slider {
                height: 150px;
            }
            
            .banner-overlay h3 {
                font-size: 22px;
            }
            
            .banner-overlay p {
                font-size: 14px;
            }
            
            .control-main {
                padding: 15px;
            }
            
            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                gap: 15px;
            }
            
            .buttons-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .stat-card, .control-btn-card {
                padding: 15px;
            }
            
            .section-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
        }

        @media (max-width: 480px) {
            .header-left {
                gap: 10px;
            }
            
            .header-info h1 {
                font-size: 18px;
            }
            
            .banner-slider {
                height: 120px;
            }
            
            .banner-overlay h3 {
                font-size: 18px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr 1fr;
            }
            
            .stat-card {
                flex-direction: column;
                text-align: center;
                gap: 10px;
            }
            
            .control-btn-card {
                padding: 15px;
            }
            
            .btn-content h3 {
                font-size: 16px;
            }
        }
        </style>
        `;

        // Inject styles into head
        document.head.insertAdjacentHTML('beforeend', styles);
        console.log('Football control styles injected successfully');
    },

    initializeFootballControlPage(eventData) {
        console.log('Initializing football control page with event data:', eventData);
        
        // Update event name
        const eventNameElement = document.getElementById('event-name');
        if (eventNameElement) {
            eventNameElement.textContent = eventData.name || 'Football Tournament 2024';
        }
        
        // Update event status
        this.updateEventStatus(eventData);
        
        // Initialize banner slider
        this.initializeBannerSlider();
        
        // Update stats (you can customize these based on your event data)
        this.updateStats(eventData);
        
        // Update recent activity with event-specific data
        this.updateRecentActivity(eventData);
        
        // Initialize all event listeners
        this.initializeEventListeners();
        
        console.log('Football control page initialized successfully');
    },

    updateEventStatus(eventData) {
        const statusElement = document.getElementById('event-status');
        const statusText = statusElement?.querySelector('.status-text');
        const statusIndicator = statusElement?.querySelector('.status-indicator');
        
        if (statusText && statusIndicator) {
            // Determine status based on event data
            let status = 'Active';
            let statusColor = '#27ae60';
            
            if (eventData.status) {
                switch (eventData.status.toLowerCase()) {
                    case 'completed':
                        status = 'Completed';
                        statusColor = '#95a5a6';
                        break;
                    case 'upcoming':
                        status = 'Upcoming';
                        statusColor = '#3498db';
                        break;
                    case 'live':
                        status = 'Live';
                        statusColor = '#e74c3c';
                        break;
                    default:
                        status = 'Active';
                        statusColor = '#27ae60';
                }
            }
            
            statusText.textContent = status;
            statusIndicator.style.background = statusColor;
            
            // Update parent background color
            if (statusElement) {
                statusElement.style.background = `rgba(${this.hexToRgb(statusColor)}, 0.1)`;
            }
        }
    },

    hexToRgb(hex) {
        const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
        return result ? 
            `${parseInt(result[1], 16)}, ${parseInt(result[2], 16)}, ${parseInt(result[3], 16)}` : 
            '39, 174, 96';
    },

    initializeBannerSlider() {
        let currentSlide = 0;
        const slides = document.querySelectorAll('.banner-slide');
        const indicators = document.querySelectorAll('.indicator');
        
        if (slides.length === 0 || indicators.length === 0) {
            console.warn('Banner slider elements not found');
            return;
        }
        
        const showSlide = (index) => {
            slides.forEach((slide, i) => {
                slide.classList.toggle('active', i === index);
            });
            indicators.forEach((indicator, i) => {
                indicator.classList.toggle('active', i === index);
            });
        };
        
        // Auto slide
        const autoSlideInterval = setInterval(() => {
            currentSlide = (currentSlide + 1) % slides.length;
            showSlide(currentSlide);
        }, 4000);
        
        // Indicator click events
        indicators.forEach((indicator, index) => {
            indicator.addEventListener('click', () => {
                currentSlide = index;
                showSlide(currentSlide);
                // Reset auto slide timer
                clearInterval(autoSlideInterval);
                setTimeout(() => {
                    setInterval(() => {
                        currentSlide = (currentSlide + 1) % slides.length;
                        showSlide(currentSlide);
                    }, 4000);
                }, 4000);
            });
        });
        
        console.log('Banner slider initialized successfully');
    },

    updateStats(eventData) {
        // Extract stats from event data or use defaults
        const stats = {
            totalTeams: eventData.teams?.length || eventData.totalTeams || 8,
            totalMatches: eventData.matches?.length || eventData.totalMatches || 16,
            completedMatches: eventData.matches?.filter(m => m.status === 'completed').length || eventData.completedMatches || 4,
            upcomingMatches: eventData.matches?.filter(m => m.status === 'upcoming').length || eventData.upcomingMatches || 12
        };
        
        // Update DOM elements
        const elements = {
            'total-teams': stats.totalTeams,
            'total-matches': stats.totalMatches,
            'completed-matches': stats.completedMatches,
            'upcoming-matches': stats.upcomingMatches
        };
        
        Object.entries(elements).forEach(([id, value]) => {
            const element = document.getElementById(id);
            if (element) {
                element.textContent = value.toString();
            }
        });
        
        console.log('Stats updated:', stats);
    },

    updateRecentActivity(eventData) {
        const activityList = document.getElementById('activityList');
        if (!activityList) return;
        
        // Generate activity based on event data
        const activities = [];
        
        if (eventData.recentActivity && Array.isArray(eventData.recentActivity)) {
            activities.push(...eventData.recentActivity);
        } else {
            // Default activities
            activities.push(
                {
                    icon: 'fas fa-plus text-success',
                    text: `<strong>Event created:</strong> ${eventData.name}`,
                    time: '2 minutes ago'
                },
                {
                    icon: 'fas fa-users text-info',
                    text: `<strong>Teams registered:</strong> ${eventData.teams?.length || 8} teams joined`,
                    time: '15 minutes ago'
                },
                {
                    icon: 'fas fa-trophy text-warning',
                    text: '<strong>Tournament started:</strong> First matches scheduled',
                    time: '1 hour ago'
                }
            );
        }
        
        // Update activity list HTML
        activityList.innerHTML = activities.map(activity => `
            <div class="activity-item">
                <div class="activity-icon">
                    <i class="${activity.icon}"></i>
                </div>
                <div class="activity-content">
                    <p>${activity.text}</p>
                    <span class="activity-time">${activity.time}</span>
                </div>
            </div>
        `).join('');
        
        console.log('Recent activity updated');
    },

    initializeEventListeners() {
        // Add any additional event listeners here if needed
        console.log('Football Control Page event listeners initialized');
        
        // Add banner button click handlers
        const bannerBtns = document.querySelectorAll('.banner-btn');
        bannerBtns.forEach(btn => {
            btn.addEventListener('click', (e) => {
                e.preventDefault();
                const bannerText = btn.closest('.banner-overlay')?.querySelector('h3')?.textContent;
                console.log('Banner clicked:', bannerText);
                // You can add specific functionality for each banner here
            });
        });
    },

    // Method to update the football control page with new data
    updatePage(eventData) {
        if (this.currentEventId && document.getElementById('football-control-page')) {
            this.initializeFootballControlPage(eventData);
        }
    },

    // Method to refresh stats
    refreshStats() {
        if (this.currentEventId && typeof sportEventsLoader !== 'undefined') {
            const eventData = sportEventsLoader.events.find(event => event.id === this.currentEventId);
            if (eventData) {
                this.updateStats(eventData);
            }
        }
    }
};

// Global functions for button clicks
function closeFootballControl() {
    const footballPage = document.getElementById('football-control-page');
    const mainContent = document.getElementById('main-content');
    
    if (footballPage) {
        footballPage.style.display = 'none';
    }
    
    if (mainContent) {
        mainContent.style.display = 'block';
    }
    
    console.log('Football control page closed');
}

function openSettings() {
    console.log('Settings clicked');
    if (typeof sportEventsLoader !== 'undefined' && sportEventsLoader.showToast) {
        sportEventsLoader.showToast('Settings functionality coming soon!', 'info');
    } else {
        alert('Settings functionality coming soon!');
    }
}

function openCreateMatch() {
    console.log('Create Match clicked');
    if (typeof sportEventsLoader !== 'undefined' && sportEventsLoader.showToast) {
        sportEventsLoader.showToast('Create Match functionality coming soon!', 'info');
    } else {
        alert('Create Match functionality coming soon!');
    }
}

function openFindTeamsPlayers() {
    console.log('Find Teams/Players clicked');
    if (typeof sportEventsLoader !== 'undefined' && sportEventsLoader.showToast) {
        sportEventsLoader.showToast('Find Teams/Players functionality coming soon!', 'info');
    } else {
        alert('Find Teams/Players functionality coming soon!');
    }
}

function openPreviousMatches() {
    console.log('Previous Matches clicked');
    if (typeof sportEventsLoader !== 'undefined' && sportEventsLoader.showToast) {
        sportEventsLoader.showToast('Previous Matches functionality coming soon!', 'info');
    } else {
        alert('Previous Matches functionality coming soon!');
    }
}

function openLiveMatches() {
    console.log('Live Matches clicked');
    if (typeof sportEventsLoader !== 'undefined' && sportEventsLoader.showToast) {
        sportEventsLoader.showToast('Live Matches functionality coming soon!', 'info');
    } else {
        alert('Live Matches functionality coming soon!');
    }
}

function openSetTable() {
    console.log('Set Table clicked');
    if (typeof sportEventsLoader !== 'undefined' && sportEventsLoader.showToast) {
        sportEventsLoader.showToast('Set Table functionality coming soon!', 'info');
    } else {
        alert('Set Table functionality coming soon!');
    }
}

function openUpcomingMatches() {
    console.log('Upcoming Matches clicked');
    if (typeof sportEventsLoader !== 'undefined' && sportEventsLoader.showToast) {
        sportEventsLoader.showToast('Upcoming Matches functionality coming soon!', 'info');
    } else {
        alert('Upcoming Matches functionality coming soon!');
    }
}

function openFootballNews() {
    console.log('Football News clicked');
    if (typeof sportEventsLoader !== 'undefined' && sportEventsLoader.showToast) {
        sportEventsLoader.showToast('Football News functionality coming soon!', 'info');
    } else {
        alert('Football News functionality coming soon!');
    }
}

function openFootballHighlights() {
    console.log('Football Highlights clicked');
    if (typeof sportEventsLoader !== 'undefined' && sportEventsLoader.showToast) {
        sportEventsLoader.showToast('Football Highlights functionality coming soon!', 'info');
    } else {
        alert('Football Highlights functionality coming soon!');
    }
}

function viewAllActivity() {
    console.log('View All Activity clicked');
    if (typeof sportEventsLoader !== 'undefined' && sportEventsLoader.showToast) {
        sportEventsLoader.showToast('View All Activity functionality coming soon!', 'info');
    } else {
        alert('View All Activity functionality coming soon!');
    }
}

// Update your existing setup button click handler
function setupEvent(eventId) {
    footballControl.setupEvent(eventId);
}

// Make footballControl available globally for debugging
window.footballControl = footballControl;

console.log('Football Control System loaded successfully');

// Teams/Players Management System
const teamsPlayersManager = {
    currentEventId: null,
    currentTab: 'teams',

    openTeamsPlayersPage(eventId) {
        console.log('Opening Teams/Players page for event:', eventId);
        
        if (!eventId) {
            console.error('No event ID provided');
            return;
        }

        this.currentEventId = eventId;
        
        // Get event data
        let eventData = null;
        if (typeof sportEventsLoader !== 'undefined' && sportEventsLoader.events) {
            eventData = sportEventsLoader.events.find(event => event.id === eventId);
        }

        if (!eventData) {
            console.error('Event not found:', eventId);
            if (typeof sportEventsLoader !== 'undefined' && sportEventsLoader.showToast) {
                sportEventsLoader.showToast('Event not found!', 'error');
            }
            return;
        }

        // Check if page already exists
        let existingPage = document.getElementById('teams-players-page');
        if (existingPage) {
            existingPage.remove();
        }

        // Inject styles first
        this.injectStyles();

        // Create the page
        this.createTeamsPlayersPage(eventData);

        // Hide main content and show teams/players page
        const mainContent = document.getElementById('main-content');
        const footballPage = document.getElementById('football-control-page');
        
        if (mainContent) mainContent.style.display = 'none';
        if (footballPage) footballPage.style.display = 'none';

        // Initialize the page
        this.initializeTeamsPlayersPage(eventData);
    },

    createTeamsPlayersPage(eventData) {
        const pageHTML = `
        <div id="teams-players-page">
            <!-- Header -->
            <div class="tp-header">
                <div class="tp-header-container">
                    <div class="tp-header-left">
                        <button class="tp-back-btn" onclick="closeTeamsPlayersPage()">
                            <i class="fas fa-arrow-left"></i>
                        </button>
                        <div class="tp-header-info">
                            <h1 id="tp-event-name">${eventData.name || 'Event Management'}</h1>
                            <p>Teams & Players Management</p>
                        </div>
                    </div>
                    <div class="tp-header-right">
                        <div class="tp-event-status" id="tp-event-status">
                            <div class="tp-status-indicator"></div>
                            <span class="tp-status-text">Active</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Main Content -->
            <div class="tp-main">
                <div class="tp-container">
                    <!-- Action Buttons -->
                    <div class="tp-actions">
                       <!-- Update your existing Add Teams button to use the new modal -->
<button class="add-teams-btn" onclick="teamsPlayersManager.openAddTeamModal()">
    <i class="fas fa-plus"></i>
    Add Teams
</button>

                        <button class="tp-action-btn secondary" onclick="generateTeamCode()">
                            <i class="fas fa-qrcode"></i>
                            <span>Generate Code to Add Team</span>
                            <small>(Coming Soon)</small>
                        </button>
                    </div>

                    <!-- Tabs -->
                    <div class="tp-tabs-container">
                        <div class="tp-tabs">
                            <button class="tp-tab active" data-tab="teams" onclick="switchTab('teams')">
                                <i class="fas fa-users"></i>
                                <span>Teams</span>
                                <span class="tp-tab-count" id="teams-count">0</span>
                            </button>
                            <button class="tp-tab" data-tab="players" onclick="switchTab('players')">
                                <i class="fas fa-user"></i>
                                <span>Players</span>
                                <span class="tp-tab-count" id="players-count">0</span>
                            </button>
                        </div>
                    </div>

                    <!-- Search Bar -->
                    <div class="tp-search-container">
                        <div class="tp-search-box">
                            <i class="fas fa-search"></i>
                            <input type="text" id="tp-search-input" placeholder="Search teams..." />
                            <button class="tp-search-clear" onclick="clearSearch()">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="tp-search-filters">
                            <select id="tp-filter-select">
                                <option value="all">All Status</option>
                                <option value="active">Active</option>
                                <option value="inactive">Inactive</option>
                            </select>
                        </div>
                    </div>

                    <!-- Content Area -->
                    <div class="tp-content">
                        <!-- Teams Tab Content -->
                        <div id="teams-content" class="tp-tab-content active">
                            <div class="tp-content-header">
                                <h3>Teams (Event ID: ${eventData.id})</h3>
                                <div class="tp-content-actions">
                                    <button class="tp-btn-icon" onclick="refreshTeams()" title="Refresh">
                                        <i class="fas fa-sync-alt"></i>
                                    </button>
                                    <button class="tp-btn-icon" onclick="exportTeams()" title="Export">
                                        <i class="fas fa-download"></i>
                                    </button>
                                </div>
                            </div>
                            <div id="teams-list" class="tp-list">
                                <!-- Teams will be loaded here -->
                            </div>
                        </div>

                        <!-- Players Tab Content -->
                        <div id="players-content" class="tp-tab-content">
                            <div class="tp-content-header">
                                <h3>Players (Event ID: ${eventData.id})</h3>
                                <div class="tp-content-actions">
                                    <button class="tp-btn-icon" onclick="refreshPlayers()" title="Refresh">
                                        <i class="fas fa-sync-alt"></i>
                                    </button>
                                    <button class="tp-btn-icon" onclick="exportPlayers()" title="Export">
                                        <i class="fas fa-download"></i>
                                    </button>
                                </div>
                            </div>
                            <div id="players-list" class="tp-list">
                                <!-- Players will be loaded here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        `;

        document.body.insertAdjacentHTML('beforeend', pageHTML);
        console.log('Teams/Players page created successfully');
    },

    injectStyles() {
        // Check if styles already exist
        if (document.getElementById('teams-players-styles')) {
            return;
        }

        const styles = `
        <style id="teams-players-styles">
        /* Teams/Players Page Styles */
        #teams-players-page {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            z-index: 1000;
            overflow-y: auto;
        }

        /* Header Styles */
        .tp-header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            padding: 15px 0;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .tp-header-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .tp-header-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .tp-back-btn {
            background: rgba(52, 152, 219, 0.1);
            border: none;
            color: #3498db;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .tp-back-btn:hover {
            background: rgba(52, 152, 219, 0.2);
            transform: translateX(-2px);
        }

        .tp-header-info h1 {
            font-size: 24px;
            color: #333;
            margin: 0;
        }

        .tp-header-info p {
            color: #666;
            margin: 5px 0 0 0;
            font-size: 14px;
        }

        .tp-event-status {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: rgba(39, 174, 96, 0.1);
            border-radius: 20px;
        }

        .tp-status-indicator {
            width: 8px;
            height: 8px;
            background: #27ae60;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .tp-status-text {
            color: #27ae60;
            font-weight: 600;
            font-size: 12px;
        }

        /* Main Content */
        .tp-main {
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .tp-container {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        /* Action Buttons */
        .tp-actions {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .tp-action-btn {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 15px 25px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .tp-action-btn.primary {
            background: rgba(46, 204, 113, 0.9);
            color: white;
        }

        .tp-action-btn.primary:hover {
            background: rgba(46, 204, 113, 1);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(46, 204, 113, 0.3);
        }

        .tp-action-btn.secondary {
            background: rgba(155, 89, 182, 0.9);
            color: white;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }

        .tp-action-btn.secondary:hover {
            background: rgba(155, 89, 182, 1);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(155, 89, 182, 0.3);
        }

        .tp-action-btn small {
            font-size: 11px;
            opacity: 0.8;
            margin-top: 2px;
        }

        /* Tabs */
        .tp-tabs-container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 5px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .tp-tabs {
            display: flex;
            gap: 5px;
        }

        .tp-tab {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 15px 20px;
            background: transparent;
            border: none;
            border-radius: 10px;
            color: rgba(255, 255, 255, 0.7);
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .tp-tab.active {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .tp-tab:hover:not(.active) {
            background: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.9);
        }

        .tp-tab-count {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .tp-tab.active .tp-tab-count {
            background: rgba(255, 255, 255, 0.3);
        }

        /* Search Container */
        .tp-search-container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .tp-search-box {
            flex: 1;
            min-width: 300px;
            position: relative;
            display: flex;
            align-items: center;
        }

        .tp-search-box i {
            position: absolute;
            left: 15px;
            color: rgba(255, 255, 255, 0.6);
            z-index: 1;
        }

        .tp-search-box input {
            width: 100%;
            padding: 12px 45px 12px 45px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 25px;
            color: white;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .tp-search-box input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .tp-search-box input:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.4);
        }

        .tp-search-clear {
                      position: absolute;
            right: 15px;
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.6);
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .tp-search-clear:hover {
            color: white;
            background: rgba(255, 255, 255, 0.1);
        }

        .tp-search-filters {
            display: flex;
            gap: 10px;
        }

        .tp-search-filters select {
            padding: 10px 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            color: white;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .tp-search-filters select:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.4);
        }

        .tp-search-filters select option {
            background: #2c3e50;
            color: white;
        }

        /* Content Area */
        .tp-content {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            min-height: 400px;
        }

        .tp-tab-content {
            display: none;
            padding: 25px;
        }

        .tp-tab-content.active {
            display: block;
        }

        .tp-content-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .tp-content-header h3 {
            color: white;
            margin: 0;
            font-size: 20px;
        }

        .tp-content-actions {
            display: flex;
            gap: 10px;
        }

        .tp-btn-icon {
            width: 35px;
            height: 35px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: rgba(255, 255, 255, 0.7);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .tp-btn-icon:hover {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            transform: translateY(-1px);
        }

        /* List Styles */
        .tp-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .tp-list-item {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .tp-list-item:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .tp-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .tp-item-title {
            color: white;
            font-size: 18px;
            font-weight: 600;
            margin: 0;
        }

        .tp-item-status {
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 600;
        }

        .tp-item-status.active {
            background: rgba(46, 204, 113, 0.2);
            color: #2ecc71;
        }

        .tp-item-status.inactive {
            background: rgba(231, 76, 60, 0.2);
            color: #e74c3c;
        }

        .tp-item-details {
            display: flex;
            gap: 20px;
            color: rgba(255, 255, 255, 0.7);
            font-size: 14px;
        }

        .tp-item-detail {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .tp-empty-state {
            text-align: center;
            padding: 60px 20px;
            color: rgba(255, 255, 255, 0.6);
        }

        .tp-empty-state i {
            font-size: 48px;
            margin-bottom: 15px;
            opacity: 0.5;
        }

        .tp-empty-state h4 {
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 10px;
        }

        .tp-empty-state p {
            margin: 0;
        }

        /* Loading State */
        .tp-loading {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 40px;
            color: rgba(255, 255, 255, 0.6);
        }

        .tp-loading i {
            font-size: 24px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .tp-header-container {
                padding: 0 15px;
            }
            
            .tp-main {
                padding: 15px;
            }
            
            .tp-actions {
                flex-direction: column;
            }
            
            .tp-action-btn {
                justify-content: center;
            }
            
            .tp-search-container {
                flex-direction: column;
                align-items: stretch;
            }
            
            .tp-search-box {
                min-width: auto;
            }
            
            .tp-content-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .tp-item-details {
                flex-direction: column;
                gap: 10px;
            }
        }

        @media (max-width: 480px) {
            .tp-tabs {
                flex-direction: column;
            }
            
            .tp-tab {
                justify-content: flex-start;
            }
            
            .tp-list-item {
                padding: 15px;
            }
            
            .tp-item-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
        }
        </style>
        `;

        document.head.insertAdjacentHTML('beforeend', styles);
        console.log('Teams/Players styles injected successfully');
    },

    initializeTeamsPlayersPage(eventData) {
        console.log('Initializing Teams/Players page with event data:', eventData);
        
        // Update counts
        this.updateCounts(eventData);
        
        // Load initial data
        this.loadTeams(eventData);
        this.loadPlayers(eventData);
        
        // Initialize search functionality
        this.initializeSearch();
        
        console.log('Teams/Players page initialized successfully');
    },

    updateCounts(eventData) {
        const teamsCount = eventData.teams?.length || 0;
        const playersCount = eventData.players?.length || this.calculateTotalPlayers(eventData);
        
        const teamsCountElement = document.getElementById('teams-count');
        const playersCountElement = document.getElementById('players-count');
        
        if (teamsCountElement) teamsCountElement.textContent = teamsCount;
        if (playersCountElement) playersCountElement.textContent = playersCount;
    },

    calculateTotalPlayers(eventData) {
        if (!eventData.teams) return 0;
        return eventData.teams.reduce((total, team) => {
            return total + (team.players?.length || 0);
        }, 0);
    },

    loadTeams(eventData) {
        const teamsList = document.getElementById('teams-list');
        if (!teamsList) return;

        // Show loading state
        teamsList.innerHTML = '<div class="tp-loading"><i class="fas fa-spinner"></i></div>';

        // Simulate loading delay
        setTimeout(() => {
            const teams = eventData.teams || [];
            
            if (teams.length === 0) {
                teamsList.innerHTML = `
                    <div class="tp-empty-state">
                        <i class="fas fa-users"></i>
                        <h4>No Teams Found</h4>
                        <p>No teams have been added to this event yet. Click "Add Teams" to get started.</p>
                    </div>
                `;
                return;
            }

            const teamsHTML = teams.map(team => `
                <div class="tp-list-item" onclick="viewTeamDetails('${team.id}')">
                    <div class="tp-item-header">
                        <h4 class="tp-item-title">${team.name}</h4>
                        <span class="tp-item-status ${team.status || 'active'}">${(team.status || 'active').toUpperCase()}</span>
                    </div>
                    <div class="tp-item-details">
                        <div class="tp-item-detail">
                            <i class="fas fa-user"></i>
                            <span>${team.players?.length || 0} Players</span>
                        </div>
                        <div class="tp-item-detail">
                            <i class="fas fa-calendar"></i>
                            <span>Joined ${team.joinedDate || 'Recently'}</span>
                        </div>
                        <div class="tp-item-detail">
                            <i class="fas fa-trophy"></i>
                            <span>${team.wins || 0} Wins</span>
                        </div>
                    </div>
                </div>
            `).join('');

            teamsList.innerHTML = teamsHTML;
        }, 500);
    },

    loadPlayers(eventData) {
        const playersList = document.getElementById('players-list');
        if (!playersList) return;

        // Show loading state
        playersList.innerHTML = '<div class="tp-loading"><i class="fas fa-spinner"></i></div>';

        // Simulate loading delay
        setTimeout(() => {
            const players = this.getAllPlayers(eventData);
            
            if (players.length === 0) {
                playersList.innerHTML = `
                    <div class="tp-empty-state">
                        <i class="fas fa-user"></i>
                        <h4>No Players Found</h4>
                        <p>No players have been added to this event yet. Add teams first to see players.</p>
                    </div>
                `;
                return;
            }

            const playersHTML = players.map(player => `
                <div class="tp-list-item" onclick="viewPlayerDetails('${player.id}')">
                    <div class="tp-item-header">
                        <h4 class="tp-item-title">${player.name}</h4>
                        <span class="tp-item-status ${player.status || 'active'}">${(player.status || 'active').toUpperCase()}</span>
                    </div>
                    <div class="tp-item-details">
                        <div class="tp-item-detail">
                            <i class="fas fa-users"></i>
                            <span>Team: ${player.teamName}</span>
                        </div>
                        <div class="tp-item-detail">
                            <i class="fas fa-hashtag"></i>
                            <span>Jersey: ${player.jerseyNumber || 'N/A'}</span>
                        </div>
                        <div class="tp-item-detail">
                            <i class="fas fa-map-marker-alt"></i>
                            <span>Position: ${player.position || 'N/A'}</span>
                        </div>
                    </div>
                </div>
            `).join('');

            playersList.innerHTML = playersHTML;
        }, 500);
    },

    getAllPlayers(eventData) {
        if (!eventData.teams) return [];
        
        const players = [];
        eventData.teams.forEach(team => {
            if (team.players) {
                team.players.forEach(player => {
                    players.push({
                        ...player,
                        teamName: team.name,
                        teamId: team.id
                    });
                });
            }
        });
        
        return players;
    },

    initializeSearch() {
        const searchInput = document.getElementById('tp-search-input');
        const filterSelect = document.getElementById('tp-filter-select');
        
        if (searchInput) {
            searchInput.addEventListener('input', (e) => {
                this.performSearch(e.target.value);
            });
        }
        
        if (filterSelect) {
            filterSelect.addEventListener('change', (e) => {
                this.applyFilter(e.target.value);
            });
        }
    },

    performSearch(query) {
        console.log('Searching for:', query);
        const currentTab = this.currentTab;
        const items = document.querySelectorAll(`#${currentTab}-content .tp-list-item`);
        
        items.forEach(item => {
            const title = item.querySelector('.tp-item-title')?.textContent.toLowerCase() || '';
            const details = item.querySelector('.tp-item-details')?.textContent.toLowerCase() || '';
            
            if (title.includes(query.toLowerCase()) || details.includes(query.toLowerCase())) {
                item.style.display = 'block';
            } else {
                item.style.display = 'none';
            }
        });
    },

    applyFilter(filterValue) {
        console.log('Applying filter:', filterValue);
        const currentTab = this.currentTab;
        const items = document.querySelectorAll(`#${currentTab}-content .tp-list-item`);
        
        items.forEach(item => {
            const status = item.querySelector('.tp-item-status')?.textContent.toLowerCase() || '';
            
            if (filterValue === 'all' || status.includes(filterValue)) {
                item.style.display = 'block';
            } else {
                item.style.display = 'none';
            }
        });
    }
};

// Global functions for Teams/Players page
function closeTeamsPlayersPage() {
    const teamsPlayersPage = document.getElementById('teams-players-page');
    const footballPage = document.getElementById('football-control-page');
    
    if (teamsPlayersPage) {
        teamsPlayersPage.style.display = 'none';
    }
    
    if (footballPage) {
        footballPage.style.display = 'block';
    }
    
    console.log('Teams/Players page closed');
}

function switchTab(tabName) {
    console.log('Switching to tab:', tabName);
    
    // Update current tab
    teamsPlayersManager.currentTab = tabName;
    
    // Update tab buttons
    const tabs = document.querySelectorAll('.tp-tab');
    tabs.forEach(tab => {
        if (tab.dataset.tab === tabName) {
            tab.classList.add('active');
        } else {
            tab.classList.remove('active');
        }
    });
    
    // Update tab content
    const tabContents = document.querySelectorAll('.tp-tab-content');
    tabContents.forEach(content => {
        if (content.id === `${tabName}-content`) {
            content.classList.add('active');
        } else {
            content.classList.remove('active');
        }
    });
    
    // Update search placeholder
    const searchInput = document.getElementById('tp-search-input');
    if (searchInput) {
        searchInput.placeholder = `Search ${tabName}...`;
        searchInput.value = ''; // Clear search when switching tabs
    }
    
    // Clear any active filters
    const filterSelect = document.getElementById('tp-filter-select');
    if (filterSelect) {
        filterSelect.value = 'all';
    }
    
    // Show all items in the new tab
    const items = document.querySelectorAll(`#${tabName}-content .tp-list-item`);
    items.forEach(item => {
        item.style.display = 'block';
    });
}

function clearSearch() {
    const searchInput = document.getElementById('tp-search-input');
    if (searchInput) {
        searchInput.value = '';
        teamsPlayersManager.performSearch('');
    }
}

function openAddTeamsModal() {
    console.log('Opening Add Teams modal for event:', teamsPlayersManager.currentEventId);
    
    if (typeof sportEventsLoader !== 'undefined' && sportEventsLoader.showToast) {
        sportEventsLoader.showToast('Add Teams functionality will be implemented next!', 'info');
    } else {
        alert('Add Teams functionality will be implemented next!');
    }
    
    // TODO: Implement Add Teams modal
    // This will be a modal/popup where users can:
    // - Add individual teams
    // - Import teams from CSV
    // - Add team details (name, players, etc.)
}

function generateTeamCode() {
    console.log('Generating team code for event:', teamsPlayersManager.currentEventId);
    
    if (typeof sportEventsLoader !== 'undefined' && sportEventsLoader.showToast) {
        sportEventsLoader.showToast('Generate Team Code feature coming soon!', 'info');
    } else {
        alert('Generate Team Code feature coming soon!');
    }
    
    // TODO: Implement team code generation
    // This will generate a unique code that teams can use to self-register
}

function refreshTeams() {
    console.log('Refreshing teams for event:', teamsPlayersManager.currentEventId);
    
    if (teamsPlayersManager.currentEventId && typeof sportEventsLoader !== 'undefined') {
        const eventData = sportEventsLoader.events.find(event => event.id === teamsPlayersManager.currentEventId);
        if (eventData) {
            teamsPlayersManager.loadTeams(eventData);
            teamsPlayersManager.updateCounts(eventData);
        }
    }
    
    if (typeof sportEventsLoader !== 'undefined' && sportEventsLoader.showToast) {
        sportEventsLoader.showToast('Teams refreshed!', 'success');
    }
}

function refreshPlayers() {
    console.log('Refreshing players for event:', teamsPlayersManager.currentEventId);
    
    if (teamsPlayersManager.currentEventId && typeof sportEventsLoader !== 'undefined') {
        const eventData = sportEventsLoader.events.find(event => event.id === teamsPlayersManager.currentEventId);
        if (eventData) {
            teamsPlayersManager.loadPlayers(eventData);
            teamsPlayersManager.updateCounts(eventData);
        }
    }
    
    if (typeof sportEventsLoader !== 'undefined' && sportEventsLoader.showToast) {
        sportEventsLoader.showToast('Players refreshed!', 'success');
    }
}

function exportTeams() {
    console.log('Exporting teams for event:', teamsPlayersManager.currentEventId);
    
    if (typeof sportEventsLoader !== 'undefined' && sportEventsLoader.showToast) {
        sportEventsLoader.showToast('Export Teams functionality coming soon!', 'info');
    } else {
        alert('Export Teams functionality coming soon!');
    }
    
    // TODO: Implement teams export (CSV, PDF, etc.)
}

function exportPlayers() {
    console.log('Exporting players for event:', teamsPlayersManager.currentEventId);
    
    if (typeof sportEventsLoader !== 'undefined' && sportEventsLoader.showToast) {
        sportEventsLoader.showToast('Export Players functionality coming soon!', 'info');
    } else {
        alert('Export Players functionality coming soon!');
    }
    
    // TODO: Implement players export (CSV, PDF, etc.)
}

function viewTeamDetails(teamId) {
    console.log('Viewing team details for team:', teamId, 'in event:', teamsPlayersManager.currentEventId);
    
    if (typeof sportEventsLoader !== 'undefined' && sportEventsLoader.showToast) {
        sportEventsLoader.showToast('Team details view coming soon!', 'info');
    } else {
        alert('Team details view coming soon!');
    }
    
    // TODO: Implement team details view
    // This will show detailed information about the team:
    // - Team info, players list, match history, etc.
}

function viewPlayerDetails(playerId) {
    console.log('Viewing player details for player:', playerId, 'in event:', teamsPlayersManager.currentEventId);
    
    if (typeof sportEventsLoader !== 'undefined' && sportEventsLoader.showToast) {
        sportEventsLoader.showToast('Player details view coming soon!', 'info');
    } else {
        alert('Player details view coming soon!');
    }
    
    // TODO: Implement player details view
    // This will show detailed information about the player:
    // - Player stats, team info, match history, etc.
}

// Update the openFindTeamsPlayers function in the football control system
function openFindTeamsPlayers() {
    console.log('Find Teams/Players clicked');
    
    if (footballControl.currentEventId) {
        teamsPlayersManager.openTeamsPlayersPage(footballControl.currentEventId);
    } else {
        console.error('No current event ID found');
        if (typeof sportEventsLoader !== 'undefined' && sportEventsLoader.showToast) {
            sportEventsLoader.showToast('Error: No event selected!', 'error');
        } else {
            alert('Error: No event selected!');
        }
    }
}

// Make teamsPlayersManager available globally for debugging
window.teamsPlayersManager = teamsPlayersManager;

console.log('Teams/Players Management System loaded successfully');

// Additional utility functions for the Teams/Players system
const teamsPlayersUtils = {
    // Generate sample team data for testing
    generateSampleTeams(eventId, count = 4) {
        const teamNames = [
            'Thunder Bolts', 'Fire Dragons', 'Ice Wolves', 'Storm Eagles',
            'Lightning Hawks', 'Blazing Tigers', 'Frost Bears', 'Wind Runners'
        ];
        
        const positions = ['Forward', 'Midfielder', 'Defender', 'Goalkeeper'];
        
        const teams = [];
        
        for (let i = 0; i < count; i++) {
            const team = {
                id: `team_${eventId}_${i + 1}`,
                name: teamNames[i] || `Team ${i + 1}`,
                status: Math.random() > 0.1 ? 'active' : 'inactive',
                joinedDate: this.getRandomDate(),
                wins: Math.floor(Math.random() * 10),
                players: []
            };
            
            // Generate 11 players per team
            for (let j = 0; j < 11; j++) {
                team.players.push({
                    id: `player_${team.id}_${j + 1}`,
                    name: `Player ${j + 1}`,
                    jerseyNumber: j + 1,
                    position: positions[Math.floor(Math.random() * positions.length)],
                    status: Math.random() > 0.05 ? 'active' : 'inactive'
                });
            }
            
            teams.push(team);
        }
        
        return teams;
    },
    
    getRandomDate() {
        const dates = ['Today', 'Yesterday', '2 days ago', '1 week ago', '2 weeks ago'];
        return dates[Math.floor(Math.random() * dates.length)];
    },
    
    // Add sample data to an event
    addSampleDataToEvent(eventId) {
        if (typeof sportEventsLoader !== 'undefined' && sportEventsLoader.events) {
            const event = sportEventsLoader.events.find(e => e.id === eventId);
            if (event) {
                event.teams = this.generateSampleTeams(eventId);
                console.log('Sample data added to event:', eventId);
                return true;
            }
        }
        return false;
    },
    
    // Search functionality helpers
    highlightSearchTerm(text, searchTerm) {
        if (!searchTerm) return text;
        
        const regex = new RegExp(`(${searchTerm})`, 'gi');
        return text.replace(regex, '<mark>$1</mark>');
    },
    
    // Filter helpers
    filterByStatus(items, status) {
        if (status === 'all') return items;
        return items.filter(item => item.status === status);
    },
    
    // Sort helpers
    sortByName(items, ascending = true) {
        return items.sort((a, b) => {
            const comparison = a.name.localeCompare(b.name);
            return ascending ? comparison : -comparison;
        });
    },
    
    sortByDate(items, ascending = true) {
        return items.sort((a, b) => {
            const dateA = new Date(a.joinedDate || 0);
            const dateB = new Date(b.joinedDate || 0);
            return ascending ? dateA - dateB : dateB - dateA;
        });
    }
};

// Make utils available globally
window.teamsPlayersUtils = teamsPlayersUtils;

// Auto-add sample data for testing (remove in production)
if (typeof sportEventsLoader !== 'undefined' && sportEventsLoader.events) {
    sportEventsLoader.events.forEach(event => {
        if (!event.teams || event.teams.length === 0) {
            event.teams = teamsPlayersUtils.generateSampleTeams(event.id);
        }
    });
    console.log('Sample teams data added to all events for testing');
}

// Add Team Modal Implementation with Firebase Integration
const addTeamModal = {
    currentEventId: null,
    uploadedImages: {
        logo: null,
        coach: null,
        staff: [],
        players: []
    },

    init() {
        this.injectStyles();
        this.createModal();
        console.log('Add Team Modal initialized');
    },

    injectStyles() {
        const styles = `
        <style>
        /* Add Team Modal Styles */
        .add-team-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            z-index: 10000;
            overflow-y: auto;
            padding: 20px;
        }

        .add-team-modal.active {
            display: flex;
            align-items: flex-start;
            justify-content: center;
        }

        .add-team-modal-content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 20px;
            width: 100%;
            max-width: 800px;
            margin: 20px auto;
            position: relative;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .add-team-modal-header {
            padding: 25px 30px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .add-team-modal-header h2 {
            color: white;
            margin: 0;
            font-size: 24px;
            font-weight: 600;
        }

        .add-team-modal-close {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            transition: all 0.3s ease;
        }

        .add-team-modal-close:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: rotate(90deg);
        }

        .add-team-modal-body {
            padding: 30px;
            max-height: 70vh;
            overflow-y: auto;
        }

        .add-team-form {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .form-section {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .form-section-title {
            color: white;
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-section-title i {
            color: rgba(255, 255, 255, 0.7);
        }

        .form-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }

        .color-input-wrapper {
            position: relative;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .color-input {
            width: 50px !important;
            height: 40px !important;
            padding: 0 !important;
            border-radius: 8px !important;
            cursor: pointer;
        }

        .color-preview {
            flex: 1;
            height: 40px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
            font-weight: 500;
        }

        .image-upload-area {
            border: 2px dashed rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .image-upload-area:hover {
            border-color: rgba(255, 255, 255, 0.5);
            background: rgba(255, 255, 255, 0.05);
        }

        .image-upload-area.has-image {
            border-style: solid;
            border-color: rgba(46, 204, 113, 0.5);
            background: rgba(46, 204, 113, 0.1);
        }

        .image-upload-content {
            color: rgba(255, 255, 255, 0.7);
        }

        .image-upload-content i {
            font-size: 24px;
            margin-bottom: 10px;
            display: block;
        }

        .image-preview {
            max-width: 100px;
            max-height: 100px;
            border-radius: 8px;
            margin: 10px auto;
            display: block;
        }

        .image-remove-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(231, 76, 60, 0.8);
            color: white;
            border: none;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .dynamic-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .dynamic-item {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            position: relative;
        }

        .dynamic-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .dynamic-item-title {
            color: white;
            font-weight: 500;
            font-size: 16px;
        }

        .dynamic-item-remove {
            background: rgba(231, 76, 60, 0.2);
            color: #e74c3c;
            border: 1px solid rgba(231, 76, 60, 0.3);
            border-radius: 6px;
            padding: 5px 10px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }

        .dynamic-item-remove:hover {
            background: rgba(231, 76, 60, 0.3);
        }

        .add-item-btn {
            background: rgba(46, 204, 113, 0.2);
            color: #2ecc71;
            border: 1px solid rgba(46, 204, 113, 0.3);
            border-radius: 10px;
            padding: 12px 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-weight: 500;
            transition: all 0.3s ease;
            margin-top: 10px;
        }

        .add-item-btn:hover {
            background: rgba(46, 204, 113, 0.3);
            transform: translateY(-1px);
        }

        .captain-checkbox {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 10px;
        }

        .captain-checkbox input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: #2ecc71;
        }

        .captain-checkbox label {
            color: rgba(255, 255, 255, 0.8);
            font-size: 14px;
            margin: 0;
        }

        .generate-code-option {
            background: rgba(52, 152, 219, 0.1);
            border: 1px solid rgba(52, 152, 219, 0.3);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            margin-top: 15px;
        }

        .generate-code-btn {
            background: rgba(52, 152, 219, 0.2);
            color: #3498db;
            border: 1px solid rgba(52, 152, 219, 0.3);
            border-radius: 8px;
            padding: 10px 20px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .generate-code-btn:hover {
            background: rgba(52, 152, 219, 0.3);
        }

        .form-actions {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            margin-top: 20px;
        }

        .btn-cancel {
            background: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            padding: 12px 25px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .btn-cancel:hover {
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }

        .btn-create {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            color: white;
            border: none;
            border-radius: 10px;
            padding: 12px 30px;
            cursor: pointer;
            font-weight: 600;
            font-size: 16px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .btn-create:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(46, 204, 113, 0.3);
        }

        .btn-create:disabled {
            background: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.5);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-create.loading {
            pointer-events: none;
        }

        .btn-create.loading::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 20px;
            height: 20px;
            margin: -10px 0 0 -10px;
            border: 2px solid transparent;
            border-top: 2px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        .form-error {
            color: #ff6b6b;
            font-size: 12px;
            margin-top: 5px;
            display: none;
        }

        .form-group.error input,
        .form-group.error textarea,
        .form-group.error select {
            border-color: #ff6b6b;
            background: rgba(255, 107, 107, 0.1);
        }

        .form-group.error .form-error {
            display: block;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .add-team-modal-content {
                margin: 10px;
                max-width: none;
            }
            
            .add-team-modal-header {
                padding: 20px;
            }
            
            .add-team-modal-body {
                padding: 20px;
            }
            
            .form-row {
                flex-direction: column;
            }
            
            .form-actions {
                flex-direction: column;
            }
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        </style>
        `;

        document.head.insertAdjacentHTML('beforeend', styles);
    },

    createModal() {
        const modalHTML = `
        <div id="add-team-modal" class="add-team-modal">
            <div class="add-team-modal-content">
                <div class="add-team-modal-header">
                    <h2>Add Team Form</h2>
                                        <button class="add-team-modal-close" onclick="addTeamModal.close()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="add-team-modal-body">
                    <form id="add-team-form" class="add-team-form">
                        <!-- Basic Team Information -->
                        <div class="form-section">
                            <div class="form-section-title">
                                <i class="fas fa-users"></i>
                                Basic Team Information
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="team-name">
                                        Team Name <span class="required">*</span>
                                    </label>
                                    <input type="text" id="team-name" name="teamName" placeholder="Enter team name" required>
                                    <div class="form-error">Team name is required (2-50 characters)</div>
                                </div>
                                <div class="form-group">
                                    <label for="team-color">
                                        Team Color <span class="required">*</span>
                                    </label>
                                    <div class="color-input-wrapper">
                                        <input type="color" id="team-color" name="teamColor" class="color-input" value="#3498db" required>
                                        <div class="color-preview" id="color-preview">Primary Color</div>
                                    </div>
                                    <div class="form-error">Team color is required</div>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="team-slogan">Team Slogan (Optional)</label>
                                    <input type="text" id="team-slogan" name="slogan" placeholder="Enter team slogan">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="team-logo">Team Logo (Optional)</label>
                                    <div class="image-upload-area" onclick="addTeamModal.triggerFileInput('logo')">
                                        <input type="file" id="team-logo" accept="image/*" style="display: none;" onchange="addTeamModal.handleImageUpload(event, 'logo')">
                                        <div class="image-upload-content" id="logo-upload-content">
                                            <i class="fas fa-cloud-upload-alt"></i>
                                            <div>Click to upload team logo</div>
                                            <small>PNG, JPG up to 5MB</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Stadium & Owner Information -->
                        <div class="form-section">
                            <div class="form-section-title">
                                <i class="fas fa-building"></i>
                                Stadium & Owner Information
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="stadium-name">Stadium Name (Optional)</label>
                                    <input type="text" id="stadium-name" name="stadiumName" placeholder="Enter stadium name">
                                </div>
                                <div class="form-group">
                                    <label for="owner-name">Owner Name (Optional)</label>
                                    <input type="text" id="owner-name" name="ownerName" placeholder="Enter owner name">
                                </div>
                            </div>
                        </div>

                        <!-- Coach Information -->
                        <div class="form-section">
                            <div class="form-section-title">
                                <i class="fas fa-user-tie"></i>
                                Coach Information
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="coach-name">Coach Name (Optional)</label>
                                    <input type="text" id="coach-name" name="coachName" placeholder="Enter coach name">
                                </div>
                                <div class="form-group">
                                    <label for="coach-age">Coach Age (Optional)</label>
                                    <input type="number" id="coach-age" name="coachAge" placeholder="Enter coach age" min="18" max="80">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="coach-image">Coach Image (Optional)</label>
                                    <div class="image-upload-area" onclick="addTeamModal.triggerFileInput('coach')">
                                        <input type="file" id="coach-image" accept="image/*" style="display: none;" onchange="addTeamModal.handleImageUpload(event, 'coach')">
                                        <div class="image-upload-content" id="coach-upload-content">
                                            <i class="fas fa-camera"></i>
                                            <div>Click to upload coach image</div>
                                            <small>PNG, JPG up to 5MB</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Staff Information -->
                        <div class="form-section">
                            <div class="form-section-title">
                                <i class="fas fa-users-cog"></i>
                                Staff Information (Optional)
                            </div>
                            <div id="staff-list" class="dynamic-list">
                                <!-- Staff items will be added here dynamically -->
                            </div>
                            <button type="button" class="add-item-btn" onclick="addTeamModal.addStaffMember()">
                                <i class="fas fa-plus"></i>
                                Add Staff Member
                            </button>
                        </div>

                        <!-- Players Information -->
                        <div class="form-section">
                            <div class="form-section-title">
                                <i class="fas fa-running"></i>
                                Players Information
                            </div>
                            <div id="players-list" class="dynamic-list">
                                <!-- Player items will be added here dynamically -->
                            </div>
                            <button type="button" class="add-item-btn" onclick="addTeamModal.addPlayer()">
                                <i class="fas fa-plus"></i>
                                Add Player
                            </button>
                            
                            <div class="generate-code-option">
                                <p style="color: rgba(255, 255, 255, 0.8); margin-bottom: 15px;">
                                    Or generate a code for players to add themselves:
                                </p>
                                <button type="button" class="generate-code-btn" onclick="addTeamModal.generatePlayerCode()">
                                    <i class="fas fa-qrcode"></i>
                                    Generate Code to Add Players (Coming Soon)
                                </button>
                            </div>
                        </div>

                        <!-- Form Actions -->
                        <div class="form-actions">
                            <button type="button" class="btn-cancel" onclick="addTeamModal.close()">
                                Cancel
                            </button>
                            <button type="submit" id="creating-team-btn" class="btn-create">
                                Create Team
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        `;

        document.body.insertAdjacentHTML('beforeend', modalHTML);
        this.setupEventListeners();
    },

    setupEventListeners() {
        // Form submission
        document.getElementById('add-team-form').addEventListener('submit', (e) => {
            e.preventDefault();
            this.handleFormSubmit();
        });

        // Color picker change
        document.getElementById('team-color').addEventListener('change', (e) => {
            document.getElementById('color-preview').style.backgroundColor = e.target.value;
        });

        // Close modal on outside click
        document.getElementById('add-team-modal').addEventListener('click', (e) => {
            if (e.target.id === 'add-team-modal') {
                this.close();
            }
        });

        // Escape key to close
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && document.getElementById('add-team-modal').classList.contains('active')) {
                this.close();
            }
        });
    },

    open(eventId) {
        console.log('Opening Add Team modal for event:', eventId);
        this.currentEventId = eventId;
        this.resetForm();
        document.getElementById('add-team-modal').classList.add('active');
        document.body.style.overflow = 'hidden';
    },

    close() {
        console.log('Closing Add Team modal');
        document.getElementById('add-team-modal').classList.remove('active');
        document.body.style.overflow = '';
        this.resetForm();
    },

    resetForm() {
        // Reset form fields
        document.getElementById('add-team-form').reset();
        
        // Reset uploaded images
        this.uploadedImages = {
            logo: null,
            coach: null,
            staff: [],
            players: []
        };

        // Reset color preview
        document.getElementById('color-preview').style.backgroundColor = '#3498db';

        // Clear dynamic lists
        document.getElementById('staff-list').innerHTML = '';
        document.getElementById('players-list').innerHTML = '';

        // Reset image upload areas
        this.resetImageUploadArea('logo');
        this.resetImageUploadArea('coach');

        // Clear form errors
        this.clearFormErrors();

        // Reset counters
        this.staffCounter = 0;
        this.playerCounter = 0;
        this.captainSelected = false;
    },

    triggerFileInput(type) {
        const inputId = type === 'logo' ? 'team-logo' : 
                       type === 'coach' ? 'coach-image' : 
                       `${type}-image`;
        document.getElementById(inputId).click();
    },

    async handleImageUpload(event, type, index = null) {
        const file = event.target.files[0];
        if (!file) return;

        // Validate file size (5MB max)
        if (file.size > 5 * 1024 * 1024) {
            this.showError('File size must be less than 5MB');
            return;
        }

        // Validate file type
        if (!file.type.startsWith('image/')) {
            this.showError('Please select a valid image file');
            return;
        }

        try {
            // Show loading state
            this.showImageLoading(type, index);

            // Upload to Firebase Storage
            const imageUrl = await this.uploadImageToFirebase(file, type, index);
            
            // Store the uploaded image URL
            if (type === 'logo' || type === 'coach') {
                this.uploadedImages[type] = imageUrl;
            } else if (type === 'staff') {
                this.uploadedImages.staff[index] = imageUrl;
            } else if (type === 'player') {
                this.uploadedImages.players[index] = imageUrl;
            }

            // Update UI
            this.showImagePreview(imageUrl, type, index);

        } catch (error) {
            console.error('Error uploading image:', error);
            this.showError('Failed to upload image. Please try again.');
            this.resetImageUploadArea(type, index);
        }
    },

    async uploadImageToFirebase(file, type, index = null) {
        // This would be the actual Firebase Storage upload
        // For now, we'll simulate it with a placeholder
        return new Promise((resolve) => {
            setTimeout(() => {
                const mockUrl = URL.createObjectURL(file);
                resolve(mockUrl);
            }, 1000);
        });
    },

    showImageLoading(type, index = null) {
        const contentId = type === 'logo' ? 'logo-upload-content' :
                         type === 'coach' ? 'coach-upload-content' :
                         `${type}-${index}-upload-content`;
        
        const content = document.getElementById(contentId);
        if (content) {
            content.innerHTML = `
                <i class="fas fa-spinner fa-spin"></i>
                <div>Uploading...</div>
            `;
        }
    },

    showImagePreview(imageUrl, type, index = null) {
        const contentId = type === 'logo' ? 'logo-upload-content' :
                         type === 'coach' ? 'coach-upload-content' :
                         `${type}-${index}-upload-content`;
        
        const content = document.getElementById(contentId);
        const uploadArea = content.parentElement;
        
        if (content) {
            content.innerHTML = `
                <img src="${imageUrl}" alt="Preview" class="image-preview">
                <div>Image uploaded successfully</div>
                <button type="button" class="image-remove-btn" onclick="addTeamModal.removeImage('${type}', ${index})">
                    <i class="fas fa-times"></i>
                </button>
            `;
            uploadArea.classList.add('has-image');
        }
    },

    removeImage(type, index = null) {
        // Remove from uploaded images
        if (type === 'logo' || type === 'coach') {
            this.uploadedImages[type] = null;
        } else if (type === 'staff') {
            this.uploadedImages.staff[index] = null;
        } else if (type === 'player') {
            this.uploadedImages.players[index] = null;
        }

        // Reset upload area
        this.resetImageUploadArea(type, index);
    },

    resetImageUploadArea(type, index = null) {
        const contentId = type === 'logo' ? 'logo-upload-content' :
                         type === 'coach' ? 'coach-upload-content' :
                         `${type}-${index}-upload-content`;
        
        const content = document.getElementById(contentId);
        const uploadArea = content?.parentElement;
        
        if (content) {
            const uploadText = type === 'logo' ? 'Click to upload team logo' :
                              type === 'coach' ? 'Click to upload coach image' :
                              type === 'staff' ? 'Click to upload staff image' :
                              'Click to upload player image';
            
            content.innerHTML = `
                <i class="fas fa-cloud-upload-alt"></i>
                <div>${uploadText}</div>
                <small>PNG, JPG up to 5MB</small>
            `;
            uploadArea?.classList.remove('has-image');
        }
    },

    staffCounter: 0,
    addStaffMember() {
        const staffList = document.getElementById('staff-list');
        const staffId = this.staffCounter++;
        
        const staffHTML = `
            <div class="dynamic-item" id="staff-${staffId}">
                <div class="dynamic-item-header">
                    <div class="dynamic-item-title">Staff Member ${staffId + 1}</div>
                    <button type="button" class="dynamic-item-remove" onclick="addTeamModal.removeStaffMember(${staffId})">
                        Remove
                    </button>
                </div>
                <div class="form-row">
                    <div class="form-group">
                                                <label for="staff-${staffId}-name">Staff Name</label>
                        <input type="text" id="staff-${staffId}-name" name="staffName" placeholder="Enter staff name">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="staff-${staffId}-image">Staff Image (Optional)</label>
                        <div class="image-upload-area" onclick="addTeamModal.triggerFileInput('staff-${staffId}')">
                            <input type="file" id="staff-${staffId}-image" accept="image/*" style="display: none;" onchange="addTeamModal.handleImageUpload(event, 'staff', ${staffId})">
                            <div class="image-upload-content" id="staff-${staffId}-upload-content">
                                <i class="fas fa-camera"></i>
                                <div>Click to upload staff image</div>
                                <small>PNG, JPG up to 5MB</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        `;
        
        staffList.insertAdjacentHTML('beforeend', staffHTML);
    },

    removeStaffMember(staffId) {
        const staffElement = document.getElementById(`staff-${staffId}`);
        if (staffElement) {
            staffElement.remove();
            // Remove uploaded image if exists
            if (this.uploadedImages.staff[staffId]) {
                this.uploadedImages.staff[staffId] = null;
            }
        }
    },

    playerCounter: 0,
    captainSelected: false,
    addPlayer() {
        const playersList = document.getElementById('players-list');
        const playerId = this.playerCounter++;
        
        const playerHTML = `
            <div class="dynamic-item" id="player-${playerId}">
                <div class="dynamic-item-header">
                    <div class="dynamic-item-title">Player ${playerId + 1}</div>
                    <button type="button" class="dynamic-item-remove" onclick="addTeamModal.removePlayer(${playerId})">
                        Remove
                    </button>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="player-${playerId}-name">Player Name</label>
                        <input type="text" id="player-${playerId}-name" name="playerName" placeholder="Enter player name">
                    </div>
                    <div class="form-group">
                        <label for="player-${playerId}-age">Player Age</label>
                        <input type="number" id="player-${playerId}-age" name="playerAge" placeholder="Age" min="16" max="50">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <div class="captain-checkbox">
                            <input type="checkbox" id="player-${playerId}-captain" name="captain" onchange="addTeamModal.handleCaptainSelection(${playerId})">
                            <label for="player-${playerId}-captain">Team Captain</label>
                        </div>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="player-${playerId}-image">Player Image (Optional)</label>
                        <div class="image-upload-area" onclick="addTeamModal.triggerFileInput('player-${playerId}')">
                            <input type="file" id="player-${playerId}-image" accept="image/*" style="display: none;" onchange="addTeamModal.handleImageUpload(event, 'player', ${playerId})">
                            <div class="image-upload-content" id="player-${playerId}-upload-content">
                                <i class="fas fa-camera"></i>
                                <div>Click to upload player image</div>
                                <small>PNG, JPG up to 5MB</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        `;
        
        playersList.insertAdjacentHTML('beforeend', playerHTML);
    },

    removePlayer(playerId) {
        const playerElement = document.getElementById(`player-${playerId}`);
        if (playerElement) {
            // Check if this player was the captain
            const captainCheckbox = document.getElementById(`player-${playerId}-captain`);
            if (captainCheckbox && captainCheckbox.checked) {
                this.captainSelected = false;
            }
            
            playerElement.remove();
            
            // Remove uploaded image if exists
            if (this.uploadedImages.players[playerId]) {
                this.uploadedImages.players[playerId] = null;
            }
        }
    },

    handleCaptainSelection(playerId) {
        const currentCheckbox = document.getElementById(`player-${playerId}-captain`);
        
        if (currentCheckbox.checked) {
            // Uncheck all other captain checkboxes
            const allCaptainCheckboxes = document.querySelectorAll('input[name="captain"]');
            allCaptainCheckboxes.forEach(checkbox => {
                if (checkbox.id !== `player-${playerId}-captain`) {
                    checkbox.checked = false;
                }
            });
            this.captainSelected = true;
        } else {
            this.captainSelected = false;
        }
    },

    generatePlayerCode() {
        // Coming soon functionality
        this.showInfo('Generate Player Code feature is coming soon!');
    },

    async handleFormSubmit() {
        console.log('Handling form submission...');
        
        if (!this.validateForm()) {
            return;
        }

        const createBtn = document.getElementById('creating-team-btn');
        createBtn.classList.add('loading');
        createBtn.disabled = true;

        try {
            // Collect form data
            const teamData = await this.collectFormData();
            
            // Save to Firebase
            await this.saveTeamToFirebase(teamData);
            
            // Show success message
            this.showSuccess('Team created successfully!');
            
            // Close modal and refresh teams list
            setTimeout(() => {
                this.close();
                if (typeof teamsPlayersManager !== 'undefined' && teamsPlayersManager.loadTeams) {
                    teamsPlayersManager.loadTeams();
                }
            }, 1500);

        } catch (error) {
            console.error('Error creating team:', error);
            this.showError('Failed to create team. Please try again.');
        } finally {
            createBtn.classList.remove('loading');
            createBtn.disabled = false;
        }
    },

    validateForm() {
        let isValid = true;
        this.clearFormErrors();

        // Validate required fields
        const teamName = document.getElementById('team-name').value.trim();
        const teamColor = document.getElementById('team-color').value;

        if (!teamName || teamName.length < 2 || teamName.length > 50) {
            this.showFieldError('team-name', 'Team name is required (2-50 characters)');
            isValid = false;
        }

        if (!teamColor) {
            this.showFieldError('team-color', 'Team color is required');
            isValid = false;
        }

        // Validate players (minimum 5 required according to Firebase rules)
        const players = this.getPlayersData();
        if (players.length < 5) {
            this.showError('Minimum 5 players are required to create a team');
            isValid = false;
        }

        if (players.length > 15) {
            this.showError('Maximum 15 players are allowed per team');
            isValid = false;
        }

        return isValid;
    },

    showFieldError(fieldId, message) {
        const field = document.getElementById(fieldId);
        const formGroup = field.closest('.form-group');
        const errorElement = formGroup.querySelector('.form-error');
        
        formGroup.classList.add('error');
        if (errorElement) {
            errorElement.textContent = message;
        }
    },

    clearFormErrors() {
        const errorGroups = document.querySelectorAll('.form-group.error');
        errorGroups.forEach(group => {
            group.classList.remove('error');
        });
    },

    async collectFormData() {
        const formData = new FormData(document.getElementById('add-team-form'));
        
        // Basic team information
        const teamData = {
            eventId: this.currentEventId,
            teamName: formData.get('teamName').trim(),
            teamColor: formData.get('teamColor'),
            slogan: formData.get('slogan')?.trim() || null,
            stadiumName: formData.get('stadiumName')?.trim() || null,
            ownerName: formData.get('ownerName')?.trim() || null,
            captainId: firebase.auth().currentUser.uid,
            createdAt: firebase.firestore.FieldValue.serverTimestamp(),
            status: 'registered'
        };

        // Add optional fields if they have values
        if (this.uploadedImages.logo) {
            teamData.teamLogo = this.uploadedImages.logo;
        }

        // Coach information
        const coachName = formData.get('coachName')?.trim();
        const coachAge = formData.get('coachAge');
        if (coachName || coachAge || this.uploadedImages.coach) {
            teamData.coach = {
                name: coachName || null,
                age: coachAge ? parseInt(coachAge) : null,
                image: this.uploadedImages.coach || null
            };
        }

        // Staff information
        const staff = this.getStaffData();
        if (staff.length > 0) {
            teamData.staff = staff;
        }

        // Players information (required)
        teamData.players = this.getPlayersData();

        return teamData;
    },

    getStaffData() {
        const staff = [];
        const staffElements = document.querySelectorAll('#staff-list .dynamic-item');
        
        staffElements.forEach((element, index) => {
            const nameInput = element.querySelector('input[name="staffName"]');
            const name = nameInput?.value.trim();
            
            if (name) {
                const staffMember = {
                    name: name,
                    image: this.uploadedImages.staff[index] || null
                };
                staff.push(staffMember);
            }
        });

        return staff;
    },

    getPlayersData() {
        const players = [];
        const playerElements = document.querySelectorAll('#players-list .dynamic-item');
        
        playerElements.forEach((element, index) => {
            const nameInput = element.querySelector('input[name="playerName"]');
            const ageInput = element.querySelector('input[name="playerAge"]');
            const captainCheckbox = element.querySelector('input[name="captain"]');
            
            const name = nameInput?.value.trim();
            const age = ageInput?.value;
            const isCaptain = captainCheckbox?.checked || false;
            
            if (name) {
                const player = {
                    name: name,
                    age: age ? parseInt(age) : null,
                    isCaptain: isCaptain,
                    image: this.uploadedImages.players[index] || null,
                    userId: firebase.auth().currentUser.uid // For now, all players are added by team creator
                };
                players.push(player);
            }
        });

        return players;
    },

    async saveTeamToFirebase(teamData) {
        console.log('Saving team to Firebase:', teamData);
        
        try {
            // Add team to football_teams collection
            const teamRef = await firebase.firestore()
                .collection('football_teams')
                .add(teamData);

            console.log('Team created with ID:', teamRef.id);

            // Update event's team count or participants list if needed
            await this.updateEventTeamCount();

            return teamRef.id;
        } catch (error) {
            console.error('Error saving team to Firebase:', error);
            throw error;
        }
    },

    async updateEventTeamCount() {
        try {
            const eventRef = firebase.firestore()
                .collection('sport_events')
                .doc(this.currentEventId);

            // Get current teams count
            const teamsSnapshot = await firebase.firestore()
                .collection('football_teams')
                .where('eventId', '==', this.currentEventId)
                .get();

            const teamsCount = teamsSnapshot.size;

            // Update event document
            await eventRef.update({
                currentTeamsCount: teamsCount,
                lastActivity: firebase.firestore.FieldValue.serverTimestamp()
            });

        } catch (error) {
            console.error('Error updating event team count:', error);
            // Don't throw error here as team creation was successful
        }
    },

    showSuccess(message) {
        // You can integrate with your existing notification system
        console.log('Success:', message);
        if (typeof showNotification !== 'undefined') {
            showNotification(message, 'success');
        } else {
            alert(message);
        }
    },

    showError(message) {
        console.error('Error:', message);
        if (typeof showNotification !== 'undefined') {
            showNotification(message, 'error');
        } else {
            alert(message);
        }
    },

    showInfo(message) {
        console.log('Info:', message);
        if (typeof showNotification !== 'undefined') {
            showNotification(message, 'info');
        } else {
            alert(message);
        }
    }
};

// Initialize the modal when DOM is loaded
document.addEventListener('DOMContentLoaded', function() {
    addTeamModal.init();
});

// Make it globally accessible
window.addTeamModal = addTeamModal;
// Update the existing teamsPlayersManager to integrate with the new Add Team modal

// Add this method to your existing teamsPlayersManager object
teamsPlayersManager.openAddTeamModal = function() {
    if (typeof addTeamModal !== 'undefined' && this.currentEventId) {
        addTeamModal.open(this.currentEventId);
    } else {
        console.error('Add Team Modal not available or no event selected');
        this.showNotification('Unable to open Add Team form', 'error');
    }
};

// Update your existing "Add Teams" button click handler
// Replace the existing click handler with this:
document.addEventListener('click', function(e) {
    if (e.target.closest('.add-teams-btn')) {
        e.preventDefault();
        teamsPlayersManager.openAddTeamModal();
    }
});




// Define all functions at the top level to avoid hoisting issues

// Event Mode Selection Function
function selectEventMode(mode) {
    console.log('selectEventMode called with:', mode);
    
    // Get the radio buttons
    const onlineRadio = document.getElementById('onlineEvent');
    const physicalRadio = document.getElementById('physicalEvent');
    
    // Get the sections
    const onlineEventSections = document.getElementById('onlineEventSections');
    const physicalEventSections = document.getElementById('physicalEventSections');
    
    if (!onlineEventSections || !physicalEventSections) {
        console.error('Required sections not found');
        return;
    }
    
    if (mode === 'online') {
        // Update radio buttons
        if (onlineRadio) onlineRadio.checked = true;
        if (physicalRadio) physicalRadio.checked = false;
        
        // Show online sections, hide physical sections
        onlineEventSections.style.display = 'block';
        physicalEventSections.style.display = 'none';
        
        console.log('Switched to online mode');
        
    } else if (mode === 'physical') {
        // Update radio buttons
        if (physicalRadio) physicalRadio.checked = true;
        if (onlineRadio) onlineRadio.checked = false;
        
        // Show physical sections, hide online sections
        physicalEventSections.style.display = 'block';
        onlineEventSections.style.display = 'none';
        
        // Show the first form group for physical events
        const physicalCategoryGroup = document.getElementById('physicalCategoryGroup');
        if (physicalCategoryGroup) {
            physicalCategoryGroup.style.display = 'block';
        }
        
        console.log('Switched to physical mode');
    }
}

// Make functions globally available
window.selectEventMode = selectEventMode;

// Initialize everything when DOM is loaded
(function() {
    'use strict';
    
    function initializeEventModeSelection() {
        console.log('Initializing event mode selection...');
        
        // Set default to online mode
        selectEventMode('online');
        
        // Add event listeners to radio buttons
        const onlineRadio = document.getElementById('onlineEvent');
        const physicalRadio = document.getElementById('physicalEvent');
        
        if (onlineRadio) {
            onlineRadio.addEventListener('change', function() {
                if (this.checked) {
                    selectEventMode('online');
                }
            });
        }
        
        if (physicalRadio) {
            physicalRadio.addEventListener('change', function() {
                if (this.checked) {
                    selectEventMode('physical');
                }
            });
        }
        
        console.log('Event mode selection initialized');
    }
    
    // Wait for DOM to be ready
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initializeEventModeSelection);
    } else {
        initializeEventModeSelection();
    }
    
})();

 // Function to open the Nomination form page
function openNominationform() {
    const nominationPage = document.getElementById('NominationformPage');
    if (nominationPage) {
        nominationPage.style.display = 'block';
    }
}

// Function to close the Nomination form page
function closeNominationformPage() {
    const nominationPage = document.getElementById('NominationformPage');
    if (nominationPage) {
        nominationPage.style.display = 'none';
    }
}

// Add event listener for the close button when DOM is loaded
document.addEventListener('DOMContentLoaded', function() {
    const closeBtn = document.getElementById('closeNominationformPageBtn');
    if (closeBtn) {
        closeBtn.addEventListener('click', closeNominationformPage);
    }
});
  
// ========================================
// NOMINATIONS & AWARDS SYSTEM - COMPLETE
// ========================================

// Global variables
let nominsCategories = [];
let nominsSponsors = [];
let awardsCategories = [];
let awardsSponsors = [];

// Initialize the nomination system
function initializeNominsSystem() {
    console.log('Initializing Nominations & Awards system...');
    
    // Add event listener to host button
    const hostButton = document.getElementById('hostNominationform');
    if (hostButton) {
        hostButton.addEventListener('click', openNominsChoiceModal);
    }
    
    console.log('Nominations & Awards system initialized');
}

// Open choice modal (Nominations vs Awards)
function openNominsChoiceModal() {
    console.log('Opening nomination/awards choice modal');
    const modal = document.getElementById('nominsChoiceModal');
    if (modal) {
        modal.style.display = 'flex';
        document.body.style.overflow = 'hidden';
    }
}

// Close choice modal
function closeNominsChoiceModal() {
    const modal = document.getElementById('nominsChoiceModal');
    if (modal) {
        modal.style.display = 'none';
        document.body.style.overflow = '';
    }
}

// Open nominations modal
function openNominsModal() {
    closeNominsChoiceModal();
    const modal = document.getElementById('nominsModal');
    if (modal) {
        modal.style.display = 'flex';
        document.body.style.overflow = 'hidden';
        resetNominsForm();
    }
}

// Close nominations modal
function closeNominsModal() {
    const modal = document.getElementById('nominsModal');
    if (modal) {
        modal.style.display = 'none';
        document.body.style.overflow = '';
    }
}

// Open awards modal
function openAwardsModal() {
    closeNominsChoiceModal();
    const modal = document.getElementById('awardsModal');
    if (modal) {
        modal.style.display = 'flex';
        document.body.style.overflow = 'hidden';
        resetAwardsForm();
    }
}

// Close awards modal
function closeAwardsModal() {
    const modal = document.getElementById('awardsModal');
    if (modal) {
        modal.style.display = 'none';
        document.body.style.overflow = '';
    }
}

// Toggle background type for nominations
function toggleNominsBackgroundType() {
    const type = document.getElementById('nominsBackgroundType').value;
    const gradientSection = document.getElementById('nominsGradientSection');
    const imageSection = document.getElementById('nominsImageSection');
    
    if (type === 'gradient') {
        gradientSection.style.display = 'block';
        imageSection.style.display = 'none';
    } else {
        gradientSection.style.display = 'none';
        imageSection.style.display = 'block';
    }
}

// Toggle background type for awards
function toggleAwardsBackgroundType() {
    const type = document.getElementById('awardsBackgroundType').value;
    const gradientSection = document.getElementById('awardsGradientSection');
    const imageSection = document.getElementById('awardsImageSection');
    
    if (type === 'gradient') {
        gradientSection.style.display = 'block';
        imageSection.style.display = 'none';
    } else {
        gradientSection.style.display = 'none';
        imageSection.style.display = 'block';
    }
}

// Toggle payment section for nominations
function toggleNominsPayment() {
    const type = document.querySelector('input[name="nominsType"]:checked').value;
    const paymentSection = document.getElementById('nominsPaymentSection');
    
    if (type === 'paid') {
        paymentSection.style.display = 'block';
    } else {
        paymentSection.style.display = 'none';
    }
}

// Toggle payment section for awards
function toggleAwardsPayment() {
    const type = document.querySelector('input[name="awardsType"]:checked').value;
    const paymentSection = document.getElementById('awardsPaymentSection');
    
    if (type === 'paid') {
        paymentSection.style.display = 'block';
    } else {
        paymentSection.style.display = 'none';
    }
}

// Add nomination category
function addNominsCategory() {
    const categoryId = 'nomins_category_' + Date.now();
    const categoryDiv = document.createElement('div');
    categoryDiv.className = 'nomins-category-item';
    categoryDiv.style.cssText = `
        border: 1px solid #e9ecef;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 10px;
        background: #f8f9fa;
    `;
    
    categoryDiv.innerHTML = `
        <div style="display: grid; grid-template-columns: 1fr auto; gap: 15px; align-items: start;">
            <div>
                <input type="text" placeholder="Category Name" required style="
                    width: 100%;
                    padding: 8px;
                    border: 1px solid #dee2e6;
                    border-radius: 4px;
                    margin-bottom: 10px;
                    color: #495057;
                    background-color: #fff;
                " data-category-name>
                <input type="file" accept="image/*" style="
                    width: 100%;
                    padding: 6px;
                    border: 1px solid #dee2e6;
                    border-radius: 4px;
                    color: #495057;
                    background-color: #fff;
                " data-category-image>
                <small style="color: #6c757d;">Image is optional</small>
            </div>
            <button type="button" onclick="removeNominsCategory(this)" style="
                background: #dc3545;
                color: white;
                border: none;
                padding: 8px 12px;
                border-radius: 4px;
                cursor: pointer;
            ">
                <i class="fas fa-trash"></i>
            </button>
        </div>
    `;
    
    document.getElementById('nominsCategoriesList').appendChild(categoryDiv);
}

// Add awards category
function addAwardsCategory() {
    const categoryId = 'awards_category_' + Date.now();
    const categoryDiv = document.createElement('div');
    categoryDiv.className = 'awards-category-item';
    categoryDiv.style.cssText = `
        border: 1px solid #e9ecef;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 10px;
        background: #f8f9fa;
    `;
    
    categoryDiv.innerHTML = `
        <div style="display: grid; grid-template-columns: 1fr auto; gap: 15px; align-items: start;">
            <div>
                <input type="text" placeholder="Category Name" required style="
                    width: 100%;
                    padding: 8px;
                    border: 1px solid #dee2e6;
                    border-radius: 4px;
                    margin-bottom: 10px;
                    color: #495057;
                    background-color: #fff;
                " data-category-name>
                <input type="file" accept="image/*" style="
                    width: 100%;
                    padding: 6px;
                    border: 1px solid #dee2e6;
                    border-radius: 4px;
                    color: #495057;
                    background-color: #fff;
                " data-category-image>
                <small style="color: #6c757d;">Image is optional</small>
            </div>
            <button type="button" onclick="removeAwardsCategory(this)" style="
                background: #dc3545;
                color: white;
                border: none;
                padding: 8px 12px;
                border-radius: 4px;
                cursor: pointer;
            ">
                <i class="fas fa-trash"></i>
            </button>
        </div>
    `;
    
    document.getElementById('awardsCategoriesList').appendChild(categoryDiv);
}

// Remove nomination category
function removeNominsCategory(button) {
    button.closest('.nomins-category-item').remove();
}

// Remove awards category
function removeAwardsCategory(button) {
    button.closest('.awards-category-item').remove();
}

// Add nomination sponsor
function addNominsSponsor() {
    const sponsorDiv = document.createElement('div');
    sponsorDiv.className = 'nomins-sponsor-item';
    sponsorDiv.style.cssText = `
        border: 1px solid #e9ecef;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 10px;
        background: #f8f9fa;
    `;
    
    sponsorDiv.innerHTML = `
        <div style="display: grid; grid-template-columns: 1fr 1fr auto; gap: 15px; align-items: start;">
            <input type="text" placeholder="Sponsor Name" style="
                padding: 8px;
                border: 1px solid #dee2e6;
                border-radius: 4px;
                color: #495057;
                background-color: #fff;
            " data-sponsor-name>
            <input type="url" placeholder="Sponsor Website (Optional)" style="
                padding: 8px;
                border: 1px solid #dee2e6;
                border-radius: 4px;
                color: #495057;
                background-color: #fff;
            " data-sponsor-website>
            <button type="button" onclick="removeNominsSponsor(this)" style="
                background: #dc3545;
                color: white;
                border: none;
                padding: 8px 12px;
                border-radius: 4px;
                cursor: pointer;
            ">
                <i class="fas fa-trash"></i>
            </button>
        </div>
        <input type="file" accept="image/*" style="
            width: 100%;
            padding: 6px;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            margin-top: 10px;
            color: #495057;
            background-color: #fff;
        " data-sponsor-logo>
        <small style="color: #6c757d;">Logo is optional</small>
    `;
    
    document.getElementById('nominsSponsorsList').appendChild(sponsorDiv);
}

// Add awards sponsor
function addAwardsSponsor() {
    const sponsorDiv = document.createElement('div');
    sponsorDiv.className = 'awards-sponsor-item';
    sponsorDiv.style.cssText = `
        border: 1px solid #e9ecef;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 10px;
        background: #f8f9fa;
    `;
    
    sponsorDiv.innerHTML = `
        <div style="display: grid; grid-template-columns: 1fr 1fr auto; gap: 15px; align-items: start;">
            <input type="text" placeholder="Sponsor Name" style="
                padding: 8px;
                border: 1px solid #dee2e6;
                border-radius: 4px;
                color: #495057;
                background-color: #fff;
            " data-sponsor-name>
            <input type="url" placeholder="Sponsor Website (Optional)" style="
                padding: 8px;
                border: 1px solid #dee2e6;
                border-radius: 4px;
                color: #495057;
                background-color: #fff;
            " data-sponsor-website>
            <button type="button" onclick="removeAwardsSponsor(this)" style="
                background: #dc3545;
                color: white;
                border: none;
                padding: 8px 12px;
                border-radius: 4px;
                cursor: pointer;
            ">
                <i class="fas fa-trash"></i>
            </button>
        </div>
        <input type="file" accept="image/*" style="
            width: 100%;
            padding: 6px;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            margin-top: 10px;
            color: #495057;
            background-color: #fff;
        " data-sponsor-logo>
        <small style="color: #6c757d;">Logo is optional</small>
    `;
    
    document.getElementById('awardsSponsorsList').appendChild(sponsorDiv);
}

// Remove nomination sponsor
function removeNominsSponsor(button) {
    button.closest('.nomins-sponsor-item').remove();
}

// Remove awards sponsor
function removeAwardsSponsor(button) {
    button.closest('.awards-sponsor-item').remove();
}

// Reset nominations form
function resetNominsForm() {
    const form = document.getElementById('nominsForm');
    if (form) {
        form.reset();
    }
    document.getElementById('nominsCategoriesList').innerHTML = '';
    document.getElementById('nominsSponsorsList').innerHTML = '';
    nominsCategories = [];
    nominsSponsors = [];
    toggleNominsBackgroundType();
    toggleNominsPayment();
}

// Reset awards form
function resetAwardsForm() {
    const form = document.getElementById('awardsForm');
    if (form) {
        form.reset();
    }
    document.getElementById('awardsCategoriesList').innerHTML = '';
    document.getElementById('awardsSponsorsList').innerHTML = '';
    awardsCategories = [];
    awardsSponsors = [];
    toggleAwardsBackgroundType();
    toggleAwardsPayment();
}

// Create nominations event
async function createNominsEvent(event) {
    event.preventDefault();
    
    const submitBtn = event.target.querySelector('button[type="submit"]');
    const originalText = submitBtn.innerHTML;
    
    try {
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Creating...';
        
        console.log('Creating nomination event...');
        
        // Collect form data
        const formData = await collectNominsData();
        console.log('Collected nomination data:', formData);
        
        // Validate data
        const validation = validateNominsData(formData);
        if (!validation.isValid) {
            showNominsError(validation.message);
            return;
        }
        
        console.log('Validation passed');
        
        // Check Firebase availability
        if (typeof firebase === 'undefined') {
            throw new Error('Firebase is not available');
        }
        
        // Save to Firebase
        const eventId = await db.collection('nomination_form').doc(eventId).set(data);

        
        if (eventId) {
            console.log('Nomination event created successfully:', eventId);
            closeNominsModal();
            showNominsSuccess('Nomination form created successfully!');
            // Refresh the nominations list
            loadNominsEvents();
        }
        
    } catch (error) {
        console.error('Error creating nomination event:', error);
        showNominsError('Error creating nomination form: ' + error.message);
    } finally {
        submitBtn.disabled = false;
        submitBtn.innerHTML = originalText;
    }
}

// Create awards event
async function createAwardsEvent(event) {
    event.preventDefault();
    
    const submitBtn = event.target.querySelector('button[type="submit"]');
    const originalText = submitBtn.innerHTML;
    
    try {
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Creating...';
        
        console.log('Creating awards event...');
        
        // Collect form data
        const formData = await collectAwardsData();
        console.log('Collected awards data:', formData);
        
        // Validate data
        const validation = validateAwardsData(formData);
        if (!validation.isValid) {
            showNominsError(validation.message);
            return;
        }
        
        console.log('Validation passed');
        
        // Check Firebase availability
        if (typeof firebase === 'undefined') {
            throw new Error('Firebase is not available');
        }
        
        // Save to Firebase
        const eventId = await saveAwardsToFirebase(formData);
        
        if (eventId) {
            console.log('Awards event created successfully:', eventId);
            closeAwardsModal();
            showNominsSuccess('Awards event created successfully!');
            // Refresh the awards list
            loadAwardsEvents();
        }
        
    } catch (error) {
        console.error('Error creating awards event:', error);
        showNominsError('Error creating awards event: ' + error.message);
    } finally {
        submitBtn.disabled = false;
        submitBtn.innerHTML = originalText;
    }
}

// Collect nominations data
async function collectNominsData() {
    try {
        const eventName = document.getElementById('nominsEventName').value.trim();
        const description = document.getElementById('nominsDescription').value.trim();
        const startDateTime = document.getElementById('nominsStartDateTime').value;
        const endDateTime = document.getElementById('nominsEndDateTime').value;
        const eventLink = document.getElementById('nominsEventLink').value.trim();
        const responseType = document.querySelector('input[name="nominsResponseType"]:checked').value;
        const nominationType = document.querySelector('input[name="nominsType"]:checked').value;
        const maxPeople = parseInt(document.getElementById('nominsMaxPeople').value) || 100;
        const hostName = document.getElementById('nominsHostName').value.trim();
        const hostContact = document.getElementById('nominsHostContact').value.trim();
        const twitter = document.getElementById('nominsTwitter').value.trim();
        const instagram = document.getElementById('nominsInstagram').value.trim();
        
        // Collect background
        const backgroundType = document.getElementById('nominsBackgroundType').value;
        let background;
        
        if (backgroundType === 'gradient') {
            const color1 = document.getElementById('nominsColor1').value;
            const color2 = document.getElementById('nominsColor2').value;
            background = {
                type: 'gradient',
                color1: color1,
                color2: color2,
                gradient: `linear-gradient(135deg, ${color1}, ${color2})`
            };
        } else {
            const imageFile = document.getElementById('nominsBackgroundImage').files[0];
            if (imageFile) {
                background = await processImageFile(imageFile);
                background.type = 'image';
            } else {
                // Default gradient if no image selected
                background = {
                    type: 'gradient',
                    color1: '#667eea',
                    color2: '#764ba2',
                    gradient: 'linear-gradient(135deg, #667eea, #764ba2)'
                };
            }
        }
        
        // Collect extra media
        const extraMediaFiles = document.getElementById('nominsExtraMedia').files;
        const extraMedia = [];
        if (extraMediaFiles && extraMediaFiles.length > 0) {
            const maxMedia = Math.min(extraMediaFiles.length, 15);
            for (let i = 0; i < maxMedia; i++) {
                const mediaFile = await processImageFile(extraMediaFiles[i]);
                extraMedia.push(mediaFile);
            }
        }
        
        // Collect categories
        const categoryItems = document.querySelectorAll('.nomins-category-item');
        const categories = [];
        for (const item of categoryItems) {
            const name = item.querySelector('[data-category-name]').value.trim();
            const imageFile = item.querySelector('[data-category-image]').files[0];
            
            if (name) {
                const category = { 
                    id: 'cat_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                    name 
                };
                if (imageFile) {
                    category.image = await processImageFile(imageFile);
                }
                categories.push(category);
            }
        }
        
        // Collect sponsors
        const sponsorItems = document.querySelectorAll('.nomins-sponsor-item');
        const sponsors = [];
        for (const item of sponsorItems) {
            const name = item.querySelector('[data-sponsor-name]').value.trim();
            const website = item.querySelector('[data-sponsor-website]').value.trim();
            const logoFile = item.querySelector('[data-sponsor-logo]').files[0];
            
            if (name) {
                const sponsor = { 
                    id: 'sponsor_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                    name 
                };
                if (website) sponsor.website = website;
                if (logoFile) {
                    sponsor.logo = await processImageFile(logoFile);
                }
                sponsors.push(sponsor);
            }
        }
        
        // Handle nomination fee
        let nominationFee = 0;
        if (nominationType === 'paid') {
            nominationFee = parseFloat(document.getElementById('nominsNominationFee').value) || 0;
        }
        
        // Get current user ID
        let creatorId;
        try {
            creatorId = await getCurrentUserId();
        } catch (error) {
            console.error('Error getting user ID:', error);
            creatorId = 'anonymous_user_' + Date.now();
        }
        
        return {
            eventName,
            description,
            startDateTime,
            endDateTime,
            eventLink,
            background,
            extraMedia,
            categories,
            responseType,
            nominationType,
            nominationFee,
            maxPeople,
            sponsors,
            hostName,
            hostContact: hostContact || null,
            socialMedia: {
                twitter: twitter || null,
                instagram: instagram || null
            },
            eventType: 'nomination',
            creatorId,
            createdAt: new Date().toISOString(),
            updatedAt: new Date().toISOString(),
            status: 'active'
        };
        
    } catch (error) {
        console.error('Error collecting nomination data:', error);
        throw new Error('Failed to collect form data: ' + error.message);
    }
}

// Collect awards data
async function collectAwardsData() {
    try {
        const eventName = document.getElementById('awardsEventName').value.trim();
        const description = document.getElementById('awardsDescription').value.trim();
        const startDateTime = document.getElementById('awardsStartDateTime').value;
        const endDateTime = document.getElementById('awardsEndDateTime').value;
        const eventLink = document.getElementById('awardsEventLink').value.trim();
        const responseType = document.querySelector('input[name="awardsResponseType"]:checked').value;
        const awardsType = document.querySelector('input[name="awardsType"]:checked').value;
        const maxPeople = parseInt(document.getElementById('awardsMaxPeople').value) || 100;
        const hostName = document.getElementById('awardsHostName').value.trim();
        const hostContact = document.getElementById('awardsHostContact').value.trim();
        const twitter = document.getElementById('awardsTwitter').value.trim();
        const instagram = document.getElementById('awardsInstagram').value.trim();
        
        // Collect background
        const backgroundType = document.getElementById('awardsBackgroundType').value;
        let background;
        
        if (backgroundType === 'gradient') {
            const color1 = document.getElementById('awardsColor1').value;
            const color2 = document.getElementById('awardsColor2').value;
            background = {
                type: 'gradient',
                color1: color1,
                color2: color2,
                gradient: `linear-gradient(135deg, ${color1}, ${color2})`
            };
        } else {
            const imageFile = document.getElementById('awardsBackgroundImage').files[0];
            if (imageFile) {
                background = await processImageFile(imageFile);
                background.type = 'image';
            } else {
                // Default gradient if no image selected
                background = {
                    type: 'gradient',
                    color1: '#ffc107',
                    color2: '#e0a800',
                    gradient: 'linear-gradient(135deg, #ffc107, #e0a800)'
                };
            }
        }
        
        // Collect extra media
        const extraMediaFiles = document.getElementById('awardsExtraMedia').files;
        const extraMedia = [];
        if (extraMediaFiles && extraMediaFiles.length > 0) {
            const maxMedia = Math.min(extraMediaFiles.length, 15);
            for (let i = 0; i < maxMedia; i++) {
                const mediaFile = await processImageFile(extraMediaFiles[i]);
                extraMedia.push(mediaFile);
            }
        }
        
        // Collect categories
        const categoryItems = document.querySelectorAll('.awards-category-item');
        const categories = [];
        for (const item of categoryItems) {
            const name = item.querySelector('[data-category-name]').value.trim();
            const imageFile = item.querySelector('[data-category-image]').files[0];
            
            if (name) {
                const category = { 
                    id: 'cat_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                    name 
                };
                if (imageFile) {
                    category.image = await processImageFile(imageFile);
                }
                categories.push(category);
            }
        }
        
        // Collect sponsors
        const sponsorItems = document.querySelectorAll('.awards-sponsor-item');
        const sponsors = [];
        for (const item of sponsorItems) {
            const name = item.querySelector('[data-sponsor-name]').value.trim();
            const website = item.querySelector('[data-sponsor-website]').value.trim();
            const logoFile = item.querySelector('[data-sponsor-logo]').files[0];
            
            if (name) {
                const sponsor = { 
                    id: 'sponsor_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                    name 
                };
                if (website) sponsor.website = website;
                if (logoFile) {
                    sponsor.logo = await processImageFile(logoFile);
                }
                sponsors.push(sponsor);
            }
        }
        
        // Handle awards fee
        let awardsFee = 0;
        if (awardsType === 'paid') {
            awardsFee = parseFloat(document.getElementById('awardsNominationFee').value) || 0;
        }
        
        // Get current user ID
        let creatorId;
        try {
            creatorId = await getCurrentUserId();
        } catch (error) {
            console.error('Error getting user ID:', error);
            creatorId = 'anonymous_user_' + Date.now();
        }
        
        return {
            eventName,
            description,
            startDateTime,
            endDateTime,
            eventLink,
            background,
            extraMedia,
            categories,
            responseType,
            awardsType,
            awardsFee,
            maxPeople,
            sponsors,
            hostName,
            hostContact: hostContact || null,
            socialMedia: {
                twitter: twitter || null,
                instagram: instagram || null
            },
            eventType: 'awards',
            creatorId,
            createdAt: new Date().toISOString(),
            updatedAt: new Date().toISOString(),
            status: 'active'
        };
        
    } catch (error) {
        console.error('Error collecting awards data:', error);
        throw new Error('Failed to collect form data: ' + error.message);
    }
}

// Validate nominations data
function validateNominsData(data) {
    // Required fields validation
    if (!data.eventName) {
        return { isValid: false, message: 'Event name is required' };
    }
    
    if (data.eventName.length < 3) {
        return { isValid: false, message: 'Event name must be at least 3 characters' };
    }
    
    if (!data.description) {
        return { isValid: false, message: 'Description is required' };
    }
    
    if (data.description.length < 10) {
        return { isValid: false, message: 'Description must be at least 10 characters' };
    }
    
    if (!data.startDateTime || !data.endDateTime) {
        return { isValid: false, message: 'Start and end dates are required' };
    }
    
    if (new Date(data.startDateTime) >= new Date(data.endDateTime)) {
        return { isValid: false, message: 'End date must be after start date' };
    }
    
    if (new Date(data.startDateTime) <= new Date()) {
        return { isValid: false, message: 'Start date must be in the future' };
    }
    
    if (!data.eventLink) {
        return { isValid: false, message: 'Event link is required' };
    }
    
    if (!/^[a-z0-9-]+$/.test(data.eventLink)) {
        return { isValid: false, message: 'Event link can only contain lowercase letters, numbers, and hyphens' };
    }
    
    if (data.categories.length === 0) {
        return { isValid: false, message: 'At least one category is required' };
    }
    
    if (!data.hostName) {
        return { isValid: false, message: 'Host name is required' };
    }
    
    // Payment validation
    if (data.nominationType === 'paid') {
        if (!data.nominationFee || data.nominationFee < 100) {
            return { isValid: false, message: 'Nomination fee must be at least 100 for paid events' };
        }
    }
    
    // Optional fields validation (check if filled properly)
    if (data.hostContact && data.hostContact.length < 5) {
        return { isValid: false, message: 'Host contact must be at least 5 characters if provided' };
    }
    
    if (data.socialMedia.twitter && !isValidUrl(data.socialMedia.twitter)) {
        return { isValid: false, message: 'Twitter URL is not valid' };
    }
    
    if (data.socialMedia.instagram && !isValidUrl(data.socialMedia.instagram)) {
        return { isValid: false, message: 'Instagram URL is not valid' };
    }
    
    return { isValid: true };
}

// Validate awards data
function validateAwardsData(data) {
    // Required fields validation
    if (!data.eventName) {
        return { isValid: false, message: 'Event name is required' };
    }
    
    if (data.eventName.length < 3) {
        return { isValid: false, message: 'Event name must be at least 3 characters' };
    }
    
    if (!data.description) {
        return { isValid: false, message: 'Description is required' };
    }
    
    if (data.description.length < 10) {
        return { isValid: false, message: 'Description must be at least 10 characters' };
    }
    
    if (!data.startDateTime || !data.endDateTime) {
        return { isValid: false, message: 'Start and end dates are required' };
    }
    
    if (new Date(data.startDateTime) >= new Date(data.endDateTime)) {
        return { isValid: false, message: 'End date must be after start date' };
    }
    
    if (new Date(data.startDateTime) <= new Date()) {
        return { isValid: false, message: 'Start date must be in the future' };
    }
    
    if (!data.eventLink) {
        return { isValid: false, message: 'Event link is required' };
    }
    
    if (!/^[a-z0-9-]+$/.test(data.eventLink)) {
        return { isValid: false, message: 'Event link can only contain lowercase letters, numbers, and hyphens' };
    }
    
    if (data.categories.length === 0) {
        return { isValid: false, message: 'At least one category is required' };
    }
    
    if (!data.hostName) {
        return { isValid: false, message: 'Host name is required' };
    }
    
    // Payment validation
    if (data.awardsType === 'paid') {
        if (!data.awardsFee || data.awardsFee < 100) {
            return { isValid: false, message: 'Awards fee must be at least 100 for paid events' };
        }
    }
    
    // Optional fields validation (check if filled properly)
    if (data.hostContact && data.hostContact.length < 5) {
        return { isValid: false, message: 'Host contact must be at least 5 characters if provided' };
    }
    
    if (data.socialMedia.twitter && !isValidUrl(data.socialMedia.twitter)) {
        return { isValid: false, message: 'Twitter URL is not valid' };
    }
    
    if (data.socialMedia.instagram && !isValidUrl(data.socialMedia.instagram)) {
        return { isValid: false, message: 'Instagram URL is not valid' };
    }
    
    return { isValid: true };
}

// Save nominations to Firebase
async function saveNominsToFirebase(data) {
    try {
        console.log('Saving nomination to Firebase...');
        
        const eventId = 'nomins_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        data.nominsEventId = eventId;
        
        const db = firebase.firestore();
        await db.collection('nomination form').doc(eventId).set(data);
        
        console.log('Nomination event saved successfully:', eventId);
        return eventId;
        
    } catch (error) {
        console.error('Error saving nomination event:', error);
        throw new Error('Failed to save nomination: ' + error.message);
    }
}

// Save awards to Firebase
async function saveAwardsToFirebase(data) {
    try {
        console.log('Saving awards event to Firebase...');
        
        const eventId = 'awards_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        data.awardsEventId = eventId;
        
        const db = firebase.firestore();
        await db.collection('award choice event').doc(eventId).set(data);
        
        console.log('Awards event saved successfully:', eventId);
        return eventId;
        
    } catch (error) {
        console.error('Error saving awards event:', error);
        throw new Error('Failed to save awards event: ' + error.message);
    }
}

// Helper function to get current user ID
async function getCurrentUserId() {
    return new Promise((resolve, reject) => {
        if (typeof firebase === 'undefined' || !firebase.auth) {
            resolve('anonymous_user_' + Date.now());
            return;
        }

        const currentUser = firebase.auth().currentUser;
        if (currentUser) {
            resolve(currentUser.uid);
            return;
        }

        const unsubscribe = firebase.auth().onAuthStateChanged((user) => {
            unsubscribe();
            
            if (user) {
                resolve(user.uid);
            } else {
                resolve('anonymous_user_' + Date.now());
            }
        }, (error) => {
            unsubscribe();
            resolve('anonymous_user_' + Date.now());
        });
    });
}

// Process image file to base64
function processImageFile(file) {
    return new Promise((resolve, reject) => {
        // Validate file size (max 5MB)
        if (file.size > 5 * 1024 * 1024) {
            reject(new Error('File size must be less than 5MB'));
            return;
        }
        
        const reader = new FileReader();
        reader.onload = function(e) {
            resolve({
                data: e.target.result,
                fileName: file.name,
                fileType: file.type,
                fileSize: file.size
            });
        };
        reader.onerror = function(error) {
            reject(new Error('Failed to read file'));
        };
        reader.readAsDataURL(file);
    });
}

// Validate URL
function isValidUrl(string) {
    try {
        new URL(string);
        return true;
    } catch (_) {
        return false;
    }
}

// Show success notification
function showNominsSuccess(message) {
    const notification = document.createElement('div');
    notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: linear-gradient(135deg, #28a745, #20c997);
        color: white;
        padding: 15px 20px;
        border-radius: 10px;
        z-index: 10002;
        font-weight: 600;
        box-shadow: 0 5px 20px rgba(0,0,0,0.2);
        animation: slideInRight 0.3s ease;
    `;
    notification.innerHTML = `
        <i class="fas fa-check-circle" style="margin-right: 8px;"></i>
        ${message}
    `;
    
    document.body.appendChild(notification);
    
    setTimeout(() => {
        notification.style.animation = 'slideOutRight 0.3s ease';
        setTimeout(() => notification.remove(), 300);
    }, 4000);
}

// Show error notification
function showNominsError(message) {
    const notification = document.createElement('div');
    notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: linear-gradient(135deg, #dc3545, #c82333);
        color: white;
        padding: 15px 20px;
        border-radius: 10px;
        z-index: 10002;
        font-weight: 600;
        box-shadow: 0 5px 20px rgba(0,0,0,0.2);
        animation: slideInRight 0.3s ease;
    `;
    notification.innerHTML = `
        <i class="fas fa-exclamation-circle" style="margin-right: 8px;"></i>
        ${message}
    `;
    
    document.body.appendChild(notification);
    
    setTimeout(() => {
        notification.style.animation = 'slideOutRight 0.3s ease';
        setTimeout(() => notification.remove(), 300);
    }, 5000);
}

// Load nominations events (placeholder)
function loadNominsEvents() {
    console.log('Loading nomination events...');
    // Implementation for loading and displaying nomination events
}

// Load awards events (placeholder)
function loadAwardsEvents() {
    console.log('Loading awards events...');
    // Implementation for loading and displaying awards events
}

// Initialize on DOM load
document.addEventListener('DOMContentLoaded', function() {
    initializeNominsSystem();
});

// Close modals when clicking outside
document.addEventListener('click', function(event) {
    if (event.target.classList.contains('modal-overlay')) {
        closeNominsChoiceModal();
        closeNominsModal();
        closeAwardsModal();
    }
});

// CSS animations
const style = document.createElement('style');
style.textContent = `
    @keyframes slideInRight {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
    }
    @keyframes slideOutRight {
        from { transform: translateX(0); opacity: 1; }
        to { transform: translateX(100%); opacity: 0; }
    }
    /* Fix for text visibility in nomination/awards forms */
#nominsModal input,
#nominsModal textarea,
#nominsModal select,
#awardsModal input,
#awardsModal textarea,
#awardsModal select {
    color: #495057 !important;
    background-color: #fff !important;
}

#nominsModal input::placeholder,
#nominsModal textarea::placeholder,
#awardsModal input::placeholder,
#awardsModal textarea::placeholder {
    color: #6c757d !important;
    opacity: 0.7;
}

#nominsModal input:focus,
#nominsModal textarea:focus,
#nominsModal select:focus,
#awardsModal input:focus,
#awardsModal textarea:focus,
#awardsModal select:focus {
    border-color: #667eea !important;
    color: #495057 !important;
    background-color: #fff !important;
}

/* Fix for radio button labels */
#nominsModal label,
#awardsModal label {
    color: #495057 !important;
}

/* Fix for small text */
#nominsModal small,
#awardsModal small {
    color: #6c757d !important;
}
`;
document.head.appendChild(style);

console.log('Nominations & Awards System loaded successfully');
  
// Social media links
function openSocialLink(platform) {
    const links = {
        facebook: 'https://facebook.com/rewarder',
        twitter: 'https://twitter.com/rewarder',
        instagram: 'https://instagram.com/rewarder',
        linkedin: 'https://linkedin.com/company/rewarder'
    };
    
    if (links[platform]) {
        window.open(links[platform], '_blank');
    }
}

// Navigation functions
function navigateToPage(page) {
    console.log(`Navigating to: ${page}`);
    // Add your navigation logic here
    switch(page) {
        case 'events':
            // Navigate to events page
            break;
        case 'create-event':
            // Navigate to create event page
            break;
        case 'my-tickets':
            // Navigate to tickets page
            break;
        case 'dashboard':
            // Navigate to dashboard
            break;
        case 'help':
            // Navigate to help center
            break;
    }
}

// Filter events by category
function filterEvents(category) {
    console.log(`Filtering events by category: ${category}`);
    // Add your event filtering logic here
}

// Newsletter subscription
function subscribeNewsletter() {
    const email = document.getElementById('newsletterEmail').value;
    
    if (!email) {
        alert('Please enter your email address');
        return;
    }
    
    if (!email.includes('@')) {
        alert('Please enter a valid email address');
        return;
    }
    
    // Here you would typically send the email to your backend
    console.log(`Subscribing email: ${email}`);
    
    // Show success message
    const button = event.target;
    const originalHTML = button.innerHTML;
    button.innerHTML = '<i class="fas fa-check"></i>';
    button.style.background = '#27ae60';
    
    setTimeout(() => {
        button.innerHTML = originalHTML;
        button.style.background = 'linear-gradient(135deg, #4ECDC4, #44A08D)';
        document.getElementById('newsletterEmail').value = '';
        alert('Thank you for subscribing to our newsletter!');
    }, 2000);
}

// App download functions
function downloadApp(platform) {
    const links = {
        ios: 'https://apps.apple.com/app/rewarder',
        android: 'https://play.google.com/store/apps/details?id=com.rewarder'
    };
    
    console.log(`Downloading app for: ${platform}`);
    
    if (links[platform]) {
        window.open(links[platform], '_blank');
    } else {
        alert('App will be available soon!');
    }
}

// Legal pages
function showLegalPage(type) {
    console.log(`Showing legal page: ${type}`);
    
    switch(type) {
        case 'privacy':
            if (typeof showPrivacyPolicy === 'function') {
                showPrivacyPolicy();
            } else {
                alert('Privacy Policy page will be available soon');
            }
            break;
        case 'terms':
            if (typeof showTermsOfService === 'function') {
                showTermsOfService();
            } else {
                alert('Terms of Service page will be available soon');
            }
            break;
        case 'cookies':
            alert('Cookie Policy page will be available soon');
            break;
        case 'support':
            alert('Support page will be available soon');
            break;
    }
}

// Add responsive behavior
window.addEventListener('resize', function() {
    // Add any responsive adjustments here if needed
});

// Add scroll to top functionality
function scrollToTop() {
    window.scrollTo({
        top: 0,
        behavior: 'smooth'
    });
}

// Optional: Add scroll to top button that appears when footer is visible
const footer = document.querySelector('footer');
if (footer) {
    const scrollToTopBtn = document.createElement('button');
    scrollToTopBtn.innerHTML = '<i class="fas fa-chevron-up"></i>';
    scrollToTopBtn.style.cssText = `
        position: fixed;
        bottom: 30px;
        right: 30px;
        width: 50px;
        height: 50px;
        background: linear-gradient(135deg, #6c5ce7, #fd79a8);
        color: white;
        border: none;
        border-radius: 50%;
        cursor: pointer;
        font-size: 18px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        transition: all 0.3s ease;
        z-index: 1000;
        display: none;
    `;
    
    scrollToTopBtn.onclick = scrollToTop;
    
    scrollToTopBtn.onmouseover = function() {
        this.style.transform = 'translateY(-3px)';
        this.style.boxShadow = '0 8px 25px rgba(0,0,0,0.3)';
    };
    
    scrollToTopBtn.onmouseout = function() {
        this.style.transform = 'translateY(0)';
        this.style.boxShadow = '0 4px 15px rgba(0,0,0,0.2)';
    };
    
    document.body.appendChild(scrollToTopBtn);
    
    // Show/hide scroll to top button based on scroll position
    window.addEventListener('scroll', function() {
        if (window.scrollY > 300) {
            scrollToTopBtn.style.display = 'flex';
            scrollToTopBtn.style.alignItems = 'center';
            scrollToTopBtn.style.justifyContent = 'center';
        } else {
            scrollToTopBtn.style.display = 'none';
        }
    });
}




       document.addEventListener('DOMContentLoaded', function() {
    // Get the button and the live events page
    const liveeventBtn = document.querySelector('.Liveevents-btn');
    const liveeventPage = document.querySelector('.liveevent-page');
    
    // Hide the live events page initially
    if (liveeventPage) {
        liveeventPage.style.display = 'none';
    }
    
    // Add click event listener to the button
    if (liveeventBtn && liveeventPage) {
        liveeventBtn.addEventListener('click', function() {
            // Toggle the display of the live events page
            if (liveeventPage.style.display === 'none' || liveeventPage.style.display === '') {
                // Show the live events page
                liveeventPage.style.display = 'block';
                // Optional: Add a class for additional styling
                liveeventPage.classList.add('liveevent-page-open');
            } else {
                // Hide the live events page
                liveeventPage.style.display = 'none';
                // Optional: Remove the class
                liveeventPage.classList.remove('liveevent-page-open');
            }
        });
    }
    // Optional: Add a close button functionality (if you want to close from within the page)
    // You can add this HTML inside your liveevent-page: <button class="liveevent-close-btn"><i class="fas fa-times"></i></button>
    const liveeventCloseBtn = document.querySelector('.liveevent-close-btn');
    if (liveeventCloseBtn && liveeventPage) {
        liveeventCloseBtn.addEventListener('click', function() {
            liveeventPage.style.display = 'none';
            liveeventPage.classList.remove('liveevent-page-open');
        });
    }
    
    // Optional: Close when clicking outside the live events page
    document.addEventListener('click', function(event) {
        // Check if the click is outside the live events page and not on the trigger button
        if (liveeventPage && 
            liveeventPage.style.display === 'block' && 
            !liveeventPage.contains(event.target) && 
            !liveeventBtn.contains(event.target)) {
            
            liveeventPage.style.display = 'none';
            liveeventPage.classList.remove('liveevent-page-open');
        }
    });
});
 
    
   // Tab switching functionality
        document.addEventListener('DOMContentLoaded', function() {
            const liveeventTabBtns = document.querySelectorAll('.liveevent-tab-btn');
            const liveeventTabContents = document.querySelectorAll('.liveevent-tab-content');

            liveeventTabBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const liveeventTabId = this.getAttribute('data-tab');
                    
                    // Remove active class from all tabs and contents
                    liveeventTabBtns.forEach(b => b.classList.remove('liveevent-active'));
                    liveeventTabContents.forEach(c => c.classList.remove('liveevent-active'));
                    
                    // Add active class to clicked tab and corresponding content
                    this.classList.add('liveevent-active');
                    document.getElementById(`liveevent-${liveeventTabId}-tab`).classList.add('liveevent-active');
                });
            });

            // Sport icon selection
            const liveeventSportIcons = document.querySelectorAll('.liveevent-sport-icon');
            liveeventSportIcons.forEach(icon => {
                icon.addEventListener('click', function() {
                    liveeventSportIcons.forEach(i => i.classList.remove('liveevent-active'));
                    this.classList.add('liveevent-active');
                });
            });

            // Talent icon selection
            const liveeventTalentIcons = document.querySelectorAll('.liveevent-talent-icon');
            liveeventTalentIcons.forEach(icon => {
                icon.addEventListener('click', function() {
                    liveeventTalentIcons.forEach(i => i.classList.remove('liveevent-active'));
                    this.classList.add('liveevent-active');
                });
            });

            // Filter button selection
            const liveeventFilterBtns = document.querySelectorAll('.liveevent-filter-btn');
            liveeventFilterBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    liveeventFilterBtns.forEach(b => b.classList.remove('liveevent-active'));
                    this.classList.add('liveevent-active');
                });
            });

            // Search filter button selection
            const liveeventSearchFilterBtns = document.querySelectorAll('.liveevent-search-filter-btn');
            liveeventSearchFilterBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const liveeventParentContainer = this.closest('.liveevent-search-filters');
                    const liveeventSiblingBtns = liveeventParentContainer.querySelectorAll('.liveevent-search-filter-btn');
                    liveeventSiblingBtns.forEach(b => b.classList.remove('liveevent-active'));
                    this.classList.add('liveevent-active');
                });
            });

            // Search input functionality
            const liveeventSearchInputs = document.querySelectorAll('.liveevent-search-input');
            liveeventSearchInputs.forEach(input => {
                input.addEventListener('input', function() {
                    const liveeventSearchTerm = this.value.toLowerCase();
                    console.log('Searching for:', liveeventSearchTerm);
                    // Add your search logic here
                });
            });

            // Simulate loading content after 2 seconds
            setTimeout(() => {
                const liveeventLoadingMessages = document.querySelectorAll('.liveevent-loading-message');
                liveeventLoadingMessages.forEach(message => {
                    message.innerHTML = `
                        <div class="liveevent-no-results">
                            <i class="fas fa-calendar-times"></i>
                            <h3>No Live Events</h3>
                            <p>There are currently no live events available. Please check back later.</p>
                        </div>
                    `;
                });
            }, 2000);
        });


  


  document.addEventListener('DOMContentLoaded', function() {
    const newEventsBtn = document.querySelector('.newevents-btn');
    const newEventsPage = document.querySelector('.newevent-page');
    const closeBtn = document.querySelector('.newevent-close-btn');
    
    // Initially hide the page
    if (newEventsPage) {
        newEventsPage.style.display = 'none';
    }
    
    // Function to open the page
    function openNewEventsPage() {
        if (newEventsPage) {
            newEventsPage.style.display = 'block';
            newEventsBtn.classList.add('active');
        }
    }
    
    // Function to close the page
    function closeNewEventsPage() {
        if (newEventsPage) {
            newEventsPage.style.display = 'none';
            newEventsBtn.classList.remove('active');
        }
    }
    
    // Open button click event
    if (newEventsBtn) {
        newEventsBtn.addEventListener('click', function() {
            if (newEventsPage.style.display === 'none' || newEventsPage.style.display === '') {
                openNewEventsPage();
            } else {
                closeNewEventsPage();
            }
        });
    }
    
    // Close button click event
    if (closeBtn) {
        closeBtn.addEventListener('click', function() {
            closeNewEventsPage();
        });
    }
    
    // Close on outside click
    document.addEventListener('click', function(event) {
        if (newEventsPage && 
            newEventsPage.style.display === 'block' && 
            !newEventsPage.contains(event.target) && 
            !newEventsBtn.contains(event.target)) {
            closeNewEventsPage();
        }
    });
    
    // Close on Escape key
    document.addEventListener('keydown', function(event) {
        if (event.key === 'Escape' && newEventsPage && newEventsPage.style.display === 'block') {
            closeNewEventsPage();
        }
    });
});



   
     
     
       
   



       document.addEventListener('DOMContentLoaded', function() {
    // Get the button and the live events page
    const liveeventBtn = document.querySelector('.Liveevents-btn');
    const liveeventPage = document.querySelector('.liveevent-page');
    
    // Hide the live events page initially
    if (liveeventPage) {
        liveeventPage.style.display = 'none';
    }
    
    // Add click event listener to the button
    if (liveeventBtn && liveeventPage) {
        liveeventBtn.addEventListener('click', function() {
            // Toggle the display of the live events page
            if (liveeventPage.style.display === 'none' || liveeventPage.style.display === '') {
                // Show the live events page
                liveeventPage.style.display = 'block';
                // Optional: Add a class for additional styling
                liveeventPage.classList.add('liveevent-page-open');
            } else {
                // Hide the live events page
                liveeventPage.style.display = 'none';
                // Optional: Remove the class
                liveeventPage.classList.remove('liveevent-page-open');
            }
        });
    }
    // Optional: Add a close button functionality (if you want to close from within the page)
    // You can add this HTML inside your liveevent-page: <button class="liveevent-close-btn"><i class="fas fa-times"></i></button>
    const liveeventCloseBtn = document.querySelector('.liveevent-close-btn');
    if (liveeventCloseBtn && liveeventPage) {
        liveeventCloseBtn.addEventListener('click', function() {
            liveeventPage.style.display = 'none';
            liveeventPage.classList.remove('liveevent-page-open');
        });
    }
    
    // Optional: Close when clicking outside the live events page
    document.addEventListener('click', function(event) {
        // Check if the click is outside the live events page and not on the trigger button
        if (liveeventPage && 
            liveeventPage.style.display === 'block' && 
            !liveeventPage.contains(event.target) && 
            !liveeventBtn.contains(event.target)) {
            
            liveeventPage.style.display = 'none';
            liveeventPage.classList.remove('liveevent-page-open');
        }
    });
});
 
    

  // Improved Spin Wheel Functionality with isolated class names
document.addEventListener('DOMContentLoaded', function() {
    // Modal Elements
    const spinWheelBtn = document.querySelector('.action-btn.spin-btn'); // Your existing button
    const spinWheelModal = document.getElementById('spinWheelModal');
    const closeModalBtn = document.querySelector('.sg-spin-wheel-modal .sg-close-modal');
    const resultModal = document.getElementById('spinResultModal');
    const claimPrizeBtn = document.getElementById('claimPrizeBtn');
    const spinAgainBtn = document.getElementById('spinAgainBtn');
    const resultTitle = document.getElementById('resultTitle');
    const resultMessage = document.getElementById('resultMessage');
    
    // Tab Elements
    const tabBtns = document.querySelectorAll('.sg-spin-wheel-modal .sg-tab-btn');
    const tabContents = document.querySelectorAll('.sg-spin-wheel-modal .sg-tab-content');
    
    // Spin Buttons
    const basicSpinBtn = document.getElementById('sg-basic-spin-btn');
    const standardSpinBtn = document.getElementById('sg-standard-spin-btn');
    const premiumSpinBtn = document.getElementById('sg-premium-spin-btn');
    
    // Wheels
    const basicWheel = document.getElementById('sg-basic-wheel');
    const standardWheel = document.getElementById('sg-standard-wheel');
    const premiumWheel = document.getElementById('sg-premium-wheel');
    
    // Free Spins Display
    const basicFreeSpins = document.getElementById('sg-basic-free-spins');
    const standardFreeSpins = document.getElementById('sg-standard-free-spins');
    const premiumFreeSpins = document.getElementById('sg-premium-free-spins');
    
    // Spin History
    const basicSpinHistory = document.getElementById('sg-basic-spin-history');
    const standardSpinHistory = document.getElementById('sg-standard-spin-history');
    const premiumSpinHistory = document.getElementById('sg-premium-spin-history');
    
    // User data (would come from your backend)
    let userData = {
        talentCoins: 500,
        freeSpins: {
            basic: 1,
            standard: 0,
            premium: 0
        }
    };
    
    // Update free spins display
    function updateFreeSpinsDisplay() {
        basicFreeSpins.textContent = `Free Spins: ${userData.freeSpins.basic}`;
        standardFreeSpins.textContent = `Free Spins: ${userData.freeSpins.standard}`;
        premiumFreeSpins.textContent = `Free Spins: ${userData.freeSpins.premium}`;
    }
    
    // Open modal when clicking the existing spin button
    if (spinWheelBtn) {
        spinWheelBtn.addEventListener('click', function() {
            spinWheelModal.style.display = 'block';
            updateFreeSpinsDisplay();
            updateSpinButtonStates();
        });
    }
    
    // Close modal
    if (closeModalBtn) {
        closeModalBtn.addEventListener('click', function() {
            spinWheelModal.style.display = 'none';
        });
    }
    
    // Close modal when clicking outside
    window.addEventListener('click', function(event) {
        if (event.target === spinWheelModal) {
            spinWheelModal.style.display = 'none';
        }
        if (event.target === resultModal) {
            resultModal.style.display = 'none';
        }
    });
    
    // Tab functionality
    tabBtns.forEach(btn => {
        btn.addEventListener('click', function() {
            const tabId = this.getAttribute('data-tab');
            
            // Remove active class from all tabs
            tabBtns.forEach(btn => btn.classList.remove('active'));
            tabContents.forEach(content => content.classList.remove('active'));
            // Add active class to current tab
            this.classList.add('active');
            document.getElementById(tabId).classList.add('active');
        });
    });
    
    // Enhanced spin wheel function
    function spinWheel(wheel, button, cost, prizes, spinType) {
        // Check if user has enough coins or free spins
        if (userData.freeSpins[spinType] > 0) {
            userData.freeSpins[spinType]--;
        } else if (userData.talentCoins >= cost) {
            userData.talentCoins -= cost;
        } else {
            // Show insufficient funds message
            resultTitle.textContent = "Insufficient Talent Coins";
            resultMessage.textContent = `You need ${cost} TC to spin this wheel. Purchase more coins to continue.`;
            resultModal.style.display = 'block';
            return;
        }
        
        // Update displays
        updateFreeSpinsDisplay();
        updateSpinButtonStates();
        
        // Disable button during spin
        button.disabled = true;
        button.classList.add('spinning');
        
        // Generate random result (0-7 for 8 sections)
        const randomIndex = Math.floor(Math.random() * 8);
        const prize = prizes[randomIndex];
        
        // Calculate rotation (multiple full rotations + position to land on the prize)
        // We need to adjust the rotation to account for the wheel's starting position
        // Each section is 45 degrees, so we need to rotate to (360 - (randomIndex * 45)) + multiple full rotations
        const rotationAngle = 1440 + (360 - (randomIndex * 45));
        
        // Set the custom property for the animation
        wheel.style.setProperty('--spin-rotation', `${rotationAngle}deg`);
        
        // Add spinning class to trigger animation
        wheel.classList.add('spinning');
        
        // After animation completes, show result
        setTimeout(() => {
            // Remove spinning class
            wheel.classList.remove('spinning');
            
            // Re-enable button
            button.disabled = false;
            button.classList.remove('spinning');
            
            // Process result
            const isWin = prize > 0;
            
            // Add to user's coins if they won
            if (isWin) {
                userData.talentCoins += prize;
                updateSpinButtonStates();
                
                // Create confetti effect for wins
                createConfetti();
            }
            
            // Add to spin history
            addToSpinHistory(spinType, prize, isWin);
            
            // Show result modal
            if (isWin) {
                resultTitle.textContent = "Congratulations!";
                resultMessage.textContent = `You won ${prize} Talent Coins!`;
                
                // Change icon for win
                document.querySelector('.sg-result-icon i').className = 'fas fa-trophy';
                document.querySelector('.sg-result-icon').style.color = '#f1c40f';
            } else {
                resultTitle.textContent = "Try Again!";
                resultMessage.textContent = "Better luck next time!";
                
                // Change icon for loss
                document.querySelector('.sg-result-icon i').className = 'fas fa-sync-alt';
                document.querySelector('.sg-result-icon').style.color = '#95a5a6';
            }
            
            resultModal.style.display = 'block';
        }, 5000); // Match this to the CSS animation duration
    }
    
    // Add to spin history
    function addToSpinHistory(spinType, prize, isWin) {
        // Get the appropriate history container
        let historyContainer;
        switch(spinType) {
            case 'basic':
                historyContainer = basicSpinHistory;
                break;
            case 'standard':
                historyContainer = standardSpinHistory;
                break;
            case 'premium':
                historyContainer = premiumSpinHistory;
                break;
        }
        
        // Remove empty history message if present
        const emptyHistory = historyContainer.querySelector('.sg-empty-history');
        if (emptyHistory) {
            emptyHistory.remove();
        }
        
        // Create new history item
        const historyItem = document.createElement('div');
        historyItem.className = isWin ? 'sg-spin-result sg-win-result' : 'sg-spin-result sg-lose-result';
        
        // Create content
        if (isWin) {
            historyItem.innerHTML = `<i class="fas fa-coins"></i> ${prize} TC`;
        } else {
            historyItem.innerHTML = `<i class="fas fa-times"></i> Try Again`;
        }
        
        // Add to history container (at the beginning)
        historyContainer.insertBefore(historyItem, historyContainer.firstChild);
        
        // Limit history items to 10
        const historyItems = historyContainer.querySelectorAll('.sg-spin-result');
        if (historyItems.length > 10) {
            historyContainer.removeChild(historyItems[historyItems.length - 1]);
        }
    }
    
    // Function to check if user can afford to spin
    function canAffordSpin(cost, spinType) {
        return userData.freeSpins[spinType] > 0 || userData.talentCoins >= cost;
    }
    
    // Update spin button states
    function updateSpinButtonStates() {
        basicSpinBtn.disabled = !canAffordSpin(2, 'basic');
        standardSpinBtn.disabled = !canAffordSpin(10, 'standard');
        premiumSpinBtn.disabled = !canAffordSpin(50, 'premium');
        
        // Update button appearance based on disabled state
        [basicSpinBtn, standardSpinBtn, premiumSpinBtn].forEach(btn => {
            if (btn.disabled) {
                btn.classList.add('disabled');
            } else {
                btn.classList.remove('disabled');
            }
        });
    }
    
    // Create confetti effect
    function createConfetti() {
        const colors = ['#f39c12', '#e74c3c', '#3498db', '#2ecc71', '#9b59b6'];
        
        for (let i = 0; i < 100; i++) {
            const confetti = document.createElement('div');
            confetti.className = 'sg-confetti';
            confetti.style.left = Math.random() * 100 + 'vw';
            confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
            confetti.style.animationDelay = Math.random() * 3 + 's';
            
            document.body.appendChild(confetti);
            
            // Remove confetti after animation
            setTimeout(() => {
                confetti.remove();
            }, 3000);
        }
    }
    
    // Handle result modal buttons
    claimPrizeBtn.addEventListener('click', function() {
        resultModal.style.display = 'none';
    });
    
    spinAgainBtn.addEventListener('click', function() {
        resultModal.style.display = 'none';
        
        // Find which tab is active and click its spin button
        const activeTab = document.querySelector('.sg-tab-content.active');
        if (activeTab) {
            const tabId = activeTab.id;
            let spinBtn;
            
            switch(tabId) {
                case 'sg-basic-spin':
                    spinBtn = basicSpinBtn;
                    break;
                case 'sg-standard-spin':
                    spinBtn = standardSpinBtn;
                    break;
                case 'sg-premium-spin':
                    spinBtn = premiumSpinBtn;
                    break;
            }
            
            if (spinBtn && !spinBtn.disabled) {
                spinBtn.click();
            }
        }
    });
    
    // Spin wheel event listeners
    basicSpinBtn.addEventListener('click', function() {
        const basicPrizes = [1, 5, 0, 25, 10, 0, 100, 0];
        spinWheel(basicWheel, basicSpinBtn, 2, basicPrizes, 'basic');
    });
    
    standardSpinBtn.addEventListener('click', function() {
        const standardPrizes = [3, 30, 0, 120, 50, 0, 700, 0];
        spinWheel(standardWheel, standardSpinBtn, 10, standardPrizes, 'standard');
    });
    
    premiumSpinBtn.addEventListener('click', function() {
        const premiumPrizes = [7, 50, 0, 145, 75, 0, 1000, 0];
        spinWheel(premiumWheel, premiumSpinBtn, 50, premiumPrizes, 'premium');
    });
    
    // Initialize
    updateFreeSpinsDisplay();
    updateSpinButtonStates();
    
    // For testing - add free spins
    window.addFreeSpin = function(type) {
        userData.freeSpins[type]++;
        updateFreeSpinsDisplay();
        updateSpinButtonStates();
    };
    
    // For testing - add coins
    window.addCoins = function(amount) {
        userData.talentCoins += amount;
        updateSpinButtonStates();
    };
});





       </script>


<!-- Sponsors Management Modal -->
<div id="sponsorsModal" class="modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; justify-content: center; align-items: center;">
    <div class="modal-content" style="background: white; border-radius: 10px; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto; position: relative;">
        <div class="modal-header" style="padding: 20px; border-bottom: 1px solid #e5e7eb; display: flex; justify-content: space-between; align-items: center;">
            <h2 class="modal-title" style="margin: 0; color: #1f2937;">Manage Sponsors</h2>
            <button type="button" class="close-btn" onclick="closeSponsorsModal()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #6b7280;">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="modal-body" style="padding: 20px;">
            <!-- Add New Sponsor Button -->
                <div class="sponsors-header" style="margin-bottom: 20px;">
                <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 10px;">
                    <button type="button" class="btn btn-primary" onclick="showSponsorForm()" style="background: #3b82f6; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer;">
                        <i class="fas fa-plus"></i> Add New Sponsor
                    </button>
                   
               
                     <button type="button" class="btn btn-rewarder" onclick="addRewarderSponsorToEvent()" style="background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%); color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; display: flex; align-items: center; gap: 5px;">
                    <i class="fas fa-crown"></i>  Add Rewarder as Sponsor
                </button>
                </div>
                <small style="color: #6b7280; font-size: 18px; font-style: italic;">( Add us as sponsor and get promocode for 10 ticket off service fee )</small>
            </div>
            
            <!-- Sponsor Form Section -->
            <div id="sponsorFormSection" style="display: none; background: #f9fafb; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <form id="sponsorForm">
                    <div class="form-group" style="margin-bottom: 15px;">
                       <label for="sponsorName" style="display: block; margin-bottom: 5px; font-weight: 500; color: #1f2937;">Sponsor Name *</label>
                        <input type="text" id="sponsorName" name="sponsorName" required style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 6px; color: #1f2937; background: white;">
                   
                    </div>
                    
                    <div class="form-group" style="margin-bottom: 15px;">
                        <label for="sponsorWebsite" style="display: block; margin-bottom: 5px; font-weight: 500; color: #1f2937;">Website URL (optional)</label>
                        <input type="url" id="sponsorWebsite" name="sponsorWebsite" placeholder="https://example.com" style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 6px; color: #1f2937; background: white;">
                  
                    </div>
                    
                    <div class="form-group" style="margin-bottom: 15px;">
                        <label for="sponsorLogo" style="display: block; margin-bottom: 5px; font-weight: 500;">Logo Upload (optional)</label>
                        <input type="file" id="sponsorLogo" name="sponsorLogo" accept="image/*" onchange="handleSponsorLogoUpload(this)" style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 6px;">
                        <small style="color: #6b7280; font-size: 12px;">Max file size: 5MB. Formats: JPG, PNG, GIF, WebP</small>
                    </div>
                    
                    <div id="sponsorLogoPreview" style="display: none; margin-bottom: 15px; text-align: center;"></div>
                    
                    <div class="form-actions" style="display: flex; gap: 10px;">
                        <button type="button" class="btn btn-primary" id="saveSponsorBtn" onclick="saveSponsor()" style="background: #3b82f6; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer;">
                            Add Sponsor
                        </button>
                        <button type="button" class="btn btn-secondary" onclick="closeSponsorForm()" style="background: #6b7280; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer;">
                            Cancel
                        </button>
                    </div>
                </form>
            </div>
            
            <!-- Sponsors List -->
            <div class="sponsors-list-section">
                <h3 style="margin-bottom: 15px; color: #1f2937;">Current Sponsors</h3>
                <div id="noSponsorsMessage" style="display: block; padding: 20px; text-align: center; background: #f3f4f6; border-radius: 8px; color: #6b7280;">
                    <p style="margin: 0;">No sponsors added yet</p>
                </div>
                <div id="sponsorsList" style="display: flex; flex-direction: column; gap: 10px;"></div>
            </div>
        </div>
    </div>
</div>

<!-- Sponsor Item Styles -->
<style>
.sponsor-item {
    display: flex;
    align-items: center;
    padding: 15px;
    background: #f9fafb;
    border: 1px solid #e5e7eb;
    border-radius: 8px;
    gap: 15px;
}

.sponsor-logo {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 60px;
    height: 40px;
    background: white;
    border: 1px solid #e5e7eb;
    border-radius: 6px;
}

.sponsor-logo img {
    max-width: 60px;
    max-height: 40px;
    object-fit: contain;
}

.sponsor-logo-placeholder {
    color: #9ca3af;
    font-size: 20px;
}

.sponsor-info {
    flex: 1;
}

.sponsor-name {
    font-weight: 600;
    color: #1f2937;
    margin-bottom: 5px;
}

.sponsor-website {
    color: #3b82f6;
    text-decoration: none;
    font-size: 14px;
    display: flex;
    align-items: center;
    gap: 5px;
}

.sponsor-website:hover {
    text-decoration: underline;
}

.sponsor-actions {
    display: flex;
    gap: 5px;
}

.edit-sponsor-btn, .delete-sponsor-btn {
    padding: 8px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 14px;
}

.edit-sponsor-btn {
    background: #f3f4f6;
    color: #6b7280;
}

.edit-sponsor-btn:hover {
    background: #e5e7eb;
}

.delete-sponsor-btn {
    background: #fef2f2;
    color: #ef4444;
}

.delete-sponsor-btn:hover {
    background: #fee2e2;
}

/* Sponsors Display in Event Card */
.sponsors-section {
    margin-top: 20px;
    padding-top: 20px;
    border-top: 1px solid #e5e7eb;
}

.sponsors-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
}

.sponsors-header h4 {
    margin: 0;
    color: #1f2937;
    font-size: 16px;
}

.add-sponsors-btn {
    background: #3b82f6;
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 14px;
    display: flex;
    align-items: center;
    gap: 5px;
}

.add-sponsors-btn:hover {
    background: #2563eb;
}

.sponsors-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
    gap: 10px;
}

@media (max-width: 768px) {
    .sponsors-grid {
        grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
        gap: 8px;
    }
}

@media (max-width: 480px) {
    .sponsors-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 8px;
    }
}

.sponsor-card {
    text-align: center;
    padding: 10px;
    background: white;
    border: 1px solid #e5e7eb;
    border-radius: 8px;
}

.sponsor-logo-container {
    position: relative;
    margin-bottom: 8px;
}

.sponsor-logo-img {
    max-width: 80px;
    max-height: 50px;
    object-fit: contain;
}

.sponsor-logo-placeholder {
    width: 80px;
    height: 50px;
    background: #f3f4f6;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto;
    border-radius: 6px;
    color: #9ca3af;
    font-size: 24px;
    
}

.sponsor-link {
    position: absolute;
    top: -5px;
    right: -5px;
    background: #3b82f6;
    color: white;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 10px;
    text-decoration: none;
}

.sponsor-name {
    font-size: 12px;
    font-weight: 500;
    color: #1f2937;
    line-height: 1.2;
}

.no-sponsors-message {
    text-align: center;
    padding: 20px;
    color: #6b7280;
    background: #f9fafb;
    border-radius: 8px;
}

/* Brand Sponsor Styles */
.brand-sponsor-card {
    border: 2px solid #fbbf24;
    background: linear-gradient(135deg, #fff7ed 0%, #fef3c7 100%);
    position: relative;
}

.brand-sponsor-card::before {
    content: "";
    position: absolute;
    top: -5px;
    right: -5px;
    background: #fbbf24;
    color: white;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 10px;
}

.sponsor-logo-placeholder.brand-sponsor {
    background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
    color: white;
}

.promo-code-badge {
    background: #10b981;
    color: white;
    font-size: 10px;
    padding: 4px 6px;
    border-radius: 4px;
    margin-top: 5px;
    display: flex;
    align-items: center;
    gap: 3px;
    justify-content: center;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
}

.promo-code-badge:hover {
    background: #059669;
    transform: scale(1.05);
}

.promo-code-badge .copy-icon {
    opacity: 0.7;
    font-size: 8px;
    margin-left: 2px;
}

.promo-code-badge:hover .copy-icon {
    opacity: 1;
}


  /* Withdrawal History Modal Styles */
.withdrawal-history-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.7);
    z-index: 10000;
    display: flex;
    justify-content: center;
    align-items: center;
    backdrop-filter: blur(5px);
}

.withdrawal-history-content {
    background: white;
    border-radius: 12px;
    width: 90%;
    max-width: 800px;
    max-height: 90vh;
    overflow: hidden;
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
}

.withdrawal-history-header {
    padding: 20px;
    border-bottom: 1px solid #e9ecef;
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: #f8f9fa;
}

.withdrawal-history-header h2 {
    margin: 0;
    color: #495057;
    font-size: 1.5rem;
}

.close-withdrawal-history {
    background: none;
    border: none;
    font-size: 24px;
    cursor: pointer;
    color: #6c757d;
    padding: 0;
    width: 30px;
    height: 30px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    transition: all 0.2s ease;
}

.close-withdrawal-history:hover {
    background: #e9ecef;
    color: #495057;
}

.withdrawal-history-body {
    padding: 20px;
    max-height: 70vh;
    overflow-y: auto;
}

.withdrawal-history-filters {
    display: flex;
    gap: 12px;
    margin-bottom: 20px;
    flex-wrap: wrap;
}

.withdrawal-history-filters select {
    padding: 8px 12px;
    border: 1px solid #dee2e6;
    border-radius: 6px;
    font-size: 14px;
    background: white;
    cursor: pointer;
}

.withdrawal-item {
    background: #f8f9fa;
    border: 1px solid #e9ecef;
    border-radius: 8px;
    padding: 16px;
    margin-bottom: 12px;
    transition: all 0.2s ease;
}

.withdrawal-item:hover {
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.withdrawal-item-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
}

.withdrawal-amount {
    font-size: 1.2rem;
    font-weight: 600;
    color: #495057;
}

.withdrawal-status {
    padding: 4px 12px;
    border-radius: 12px;
    font-size: 12px;
    font-weight: 600;
    text-transform: uppercase;
}

.status-pending {
    background: #fff3cd;
    color: #856404;
    border: 1px solid #ffeaa7;
}

.status-paid {
    background: #d4edda;
    color: #155724;
    border: 1px solid #c3e6cb;
}

.status-failed {
    background: #f8d7da;
    color: #721c24;
    border: 1px solid #f5c6cb;
}

.withdrawal-details {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
    font-size: 14px;
    color: #6c757d;
}

.withdrawal-detail-item {
    display: flex;
    flex-direction: column;
    gap: 2px;
}

.withdrawal-detail-label {
    font-weight: 600;
    color: #495057;
}

.loading-state, .empty-state {
    text-align: center;
    padding: 40px 20px;
    color: #6c757d;
}

.loading-state i {
    font-size: 24px;
    margin-bottom: 12px;
    color: #007bff;
}

/* Mobile Responsive */
@media (max-width: 768px) {
    .withdrawal-history-content {
        width: 95%;
        margin: 10px;
    }
    
    .withdrawal-history-filters {
        flex-direction: column;
    }
    
    .withdrawal-history-filters select {
        width: 100%;
    }
    
    .withdrawal-details {
        grid-template-columns: 1fr;
    }
    
    .withdrawal-item-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
    }
    
@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes fadeOut {
    from { opacity: 1; }
    to { opacity: 0; }
}

@keyframes slideInUp {
    from { 
        opacity: 0; 
        transform: translateY(30px) scale(0.95); 
    }
    to { 
        opacity: 1; 
        transform: translateY(0) scale(1); 
    }
}

/* Scrollbar styling for modal content */
#phyContactModal div::-webkit-scrollbar {
    width: 6px;
}

#phyContactModal div::-webkit-scrollbar-track {
    background: rgba(255,255,255,0.1);
    border-radius: 3px;
}

#phyContactModal div::-webkit-scrollbar-thumb {
    background: #6c5ce7;
    border-radius: 3px;
}

#phyContactModal div::-webkit-scrollbar-thumb:hover {
    background: #a29bfe;
}

.contact-section {
    margin-bottom: 16px;
    padding: 12px;
    background: #f8f9fa;
    border-radius: 8px;
    border: 1px solid #e9ecef;
}

.contact-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
    gap: 6px;
}

.contact-clickable-item {
    transition: all 0.2s ease;
    position: relative;
}

.contact-clickable-item:hover {
    transform: scale(1.05);
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.contact-clickable-item:active {
    transform: scale(0.98);
}

/* Close event modal styles */
.phyeventclose-modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 10000;
}

.phyeventclose-modal {
    background: white;
    border-radius: 12px;
    max-width: 500px;
    width: 90%;
    position: relative;
}

.warning-section {
    background: #fff3cd;
    border: 1px solid #ffeaa7;
    border-radius: 8px;
    padding: 20px;
    margin-bottom: 20px;
    display: flex;
    gap: 15px;
}

.warning-icon {
    color: #856404;
    font-size: 24px;
}

.confirmation-actions {
    display: flex;
    gap: 12px;
    justify-content: flex-end;
}

.confirm-close-btn {
    background: #dc3545;
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 6px;
    cursor: pointer;
    font-weight: 600;
}

.confirm-close-btn:hover {
    background: #c82333;
}




@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes fadeOut {
    from { opacity: 1; }
    to { opacity: 0; }
}

@keyframes slideInUp {
    from { 
        opacity: 0; 
        transform: translateY(30px) scale(0.95); 
    }
    to { 
        opacity: 1; 
        transform: translateY(0) scale(1); 
    }
}

/* Scrollbar styling for modal content */
#phyContactModal div::-webkit-scrollbar {
    width: 6px;
}

#phyContactModal div::-webkit-scrollbar-track {
    background: rgba(255,255,255,0.1);
    border-radius: 3px;
}

#phyContactModal div::-webkit-scrollbar-thumb {
    background: #6c5ce7;
    border-radius: 3px;
}

#phyContactModal div::-webkit-scrollbar-thumb:hover {
    background: #a29bfe;
}

.openpage.hidden {
    display: none !important;
    opacity: 0 !important;
    visibility: hidden !important;
    pointer-events: none !important;


}


.advanced-tba-badge {
    position: absolute;
    top: 50px;
    left: 10px;
    background: rgba(255, 193, 7, 0.9);
    color: #000;
    padding: 4px 8px;
    border-radius: 15px;
    font-size: 0.75rem;
    font-weight: bold;
    backdrop-filter: blur(4px);
    z-index: 3;
    display: flex;
    align-items: center;
    gap: 4px;
}

.tba-datetime .advanced-detail-item {
    background: rgba(255, 215, 0, 0.1);
    padding: 4px 8px;
    border-radius: 8px;
    border: 1px solid rgba(255, 215, 0, 0.3);
}


/* Mobile Responsive Styles */
@media (max-width: 768px) {
    .search-filter-grid {
        grid-template-columns: 1fr !important;
        gap: 12px !important;
    }
    
    .search-input-container {
        grid-column: 1 / -1 !important;
    }
    
    .filter-row {
        grid-template-columns: 1fr !important;
        gap: 12px !important;
        margin-top: 12px !important;
    }
    
    #eventSearchInput {
        font-size: 16px !important;
        padding: 14px 18px 14px 48px !important;
    }
    
    #monthFilter, #dateFilter {
        font-size: 16px !important;
        padding: 14px 18px !important;
        min-height: 48px !important;
    }
    
    .fas.fa-search {
        left: 18px !important;
        font-size: 18px !important;
    }
}

@media (max-width: 480px) {
    .search-filter-grid {
        padding: 8px !important;
    }
    
    #eventSearchInput {
        padding: 16px 20px 16px 52px !important;
        font-size: 16px !important;
    }
    
    #monthFilter, #dateFilter {
        padding: 16px 20px !important;
        font-size: 16px !important;
        min-height: 52px !important;
    }
    
    .fas.fa-search {
        left: 20px !important;
        font-size: 20px !important;
    }
}


/* Responsive Auto-scrolling Banner Styles */
.banner-section {
    margin-bottom: clamp(20px, 5vw, 40px);
    overflow: hidden;
    border-radius: clamp(8px, 3vw, 15px);
    position: relative;
    width: 100%;
}

.banner-carousel {
    display: flex;
    gap: clamp(10px, 3vw, 20px);
    animation: autoScroll 15s linear infinite;
    width: calc(var(--banner-width) * 6);
    will-change: transform;
}

:root {
    --banner-width: clamp(250px, 60vw, 380px);
    --banner-height: clamp(140px, 35vw, 220px);
}

@keyframes autoScroll {
    0% {
        transform: translateX(0);
    }
    100% {
        transform: translateX(-50%);
    }
}

/* Pause animation on hover for desktop */
@media (hover: hover) and (pointer: fine) {
    .banner-carousel:hover {
        animation-play-state: paused;
    }
}

.banner-item {
    flex: 0 0 auto;
    width: var(--banner-width);
    position: relative;
}

.banner-item img {
    width: 100%;
    height: var(--banner-height);
    object-fit: cover;
    border-radius: clamp(8px, 2vw, 15px);
    border: clamp(1px, 0.5vw, 3px) solid rgba(0, 123, 255, 0.3);
    transition: all 0.3s ease;
    display: block;
}

/* Desktop hover effects */
@media (hover: hover) and (pointer: fine) {
    .banner-item img:hover {
        transform: scale(1.05);
        border-color: #00d4ff;
        box-shadow: 0 8px 25px rgba(0, 212, 255, 0.3);
    }
}

/* Mobile optimizations */
@media (max-width: 768px) {
    :root {
        --banner-width: clamp(200px, 70vw, 300px);
        --banner-height: clamp(120px, 30vw, 180px);
    }
    
    .banner-carousel {
        gap: clamp(8px, 2vw, 15px);
        animation-duration: 20s; /* Slower on mobile for better visibility */
    }
    
    .banner-item img {
        border-width: 2px;
    }
    
    /* Touch feedback for mobile */
    .banner-item img:active {
        transform: scale(0.98);
        transition: transform 0.1s ease;
    }
}

/* Small mobile devices */
@media (max-width: 480px) {
    :root {
        --banner-width: clamp(180px, 80vw, 250px);
        --banner-height: clamp(100px, 25vw, 150px);
    }
    
    .banner-section {
        margin-bottom: 20px;
        border-radius: 8px;
    }
    
    .banner-carousel {
        gap: 8px;
        animation-duration: 25s;
    }
    
    .banner-item img {
        border-radius: 8px;
        border-width: 1px;
    }
}

/* Large screens */
@media (min-width: 1200px) {
    :root {
        --banner-width: 400px;
        --banner-height: 250px;
    }
    
    .banner-carousel {
        gap: 25px;
        animation-duration: 12s;
    }
}

/* Ultra-wide screens */
@media (min-width: 1600px) {
    :root {
        --banner-width: 450px;
        --banner-height: 280px;
    }
    
    .banner-section {
        margin-bottom: 50px;
    }
}

/* High DPI displays */
@media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
    .banner-item img {
        image-rendering: -webkit-optimize-contrast;
        image-rendering: crisp-edges;
    }
}

/* Reduce motion for accessibility */
@media (prefers-reduced-motion: reduce) {
    .banner-carousel {
        animation: none;
    }
    
    .banner-item img {
        transition: none;
    }
    
    .banner-item img:hover {
        transform: none;
    }
}

/* Dark mode support */
@media (prefers-color-scheme: dark) {
    .banner-item img {
        border-color: rgba(0, 123, 255, 0.4);
    }
    
    .banner-item img:hover {
        border-color: #00d4ff;
        box-shadow: 0 8px 25px rgba(0, 212, 255, 0.4);
    }
}

/* Landscape mobile orientation */
@media (max-height: 500px) and (orientation: landscape) {
    :root {
        --banner-height: clamp(80px, 20vw, 120px);
    }
    
    .banner-section {
        margin-bottom: 15px;
    }
}

/* Portrait tablet */
@media (min-width: 481px) and (max-width: 768px) and (orientation: portrait) {
    :root {
        --banner-width: clamp(280px, 60vw, 350px);
        --banner-height: clamp(160px, 32vw, 200px);
    }
}

/* Landscape tablet */
@media (min-width: 769px) and (max-width: 1024px) and (orientation: landscape) {
    :root {
        --banner-width: clamp(300px, 45vw, 380px);
        --banner-height: clamp(180px, 28vw, 220px);
    }
}

/* Container queries for modern browsers */
@supports (container-type: inline-size) {
    .banner-section {
        container-type: inline-size;
    }
    
    @container (max-width: 500px) {
        :root {
            --banner-width: clamp(160px, 75vw, 220px);
            --banner-height: clamp(90px, 22vw, 130px);
        }
        
        .banner-carousel {
            gap: 6px;
        }
    }
    
    @container (min-width: 1000px) {
        :root {
            --banner-width: 400px;
            --banner-height: 250px;
        }
    }
}

/* Touch device optimizations */
@media (hover: none) and (pointer: coarse) {
    .banner-item img {
        -webkit-tap-highlight-color: transparent;
    }
    
    .banner-item img:active {
        opacity: 0.8;
        transform: scale(0.98);
    }
}

/* Safe area insets for notched devices */
@supports (padding: max(0px)) {
    .banner-section {
        margin-left: max(10px, env(safe-area-inset-left));
        margin-right: max(10px, env(safe-area-inset-right));
    }
}

/* Loading state */
.banner-item img[loading="lazy"] {
    background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
    background-size: 200% 100%;
    animation: shimmer 1.5s infinite;
}

@keyframes shimmer {
    0% { background-position: -200% 0; }
    100% { background-position: 200% 0; }
}

/* Performance optimizations */
.banner-carousel {
    transform: translateZ(0);
    -webkit-backface-visibility: hidden;
    backface-visibility: hidden;
}

.banner-item img {
    transform: translateZ(0);
    -webkit-backface-visibility: hidden;
    backface-visibility: hidden;
}

/* Print styles */
@media print {
    .banner-section {
        display: none;
    }
}

/* Focus styles for accessibility */
.banner-item img:focus {
    outline: 2px solid #00d4ff;
    outline-offset: 2px;
}

/* Error state for broken images */
.banner-item img::after {
    content: "Image failed to load";
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(0, 0, 0, 0.8);
    color: white;
    padding: 10px;
    border-radius: 5px;
    font-size: 12px;
    display: none;
}

.banner-item img:not([src]),
.banner-item img[src=""] {
    background: #f0f0f0;
}

.banner-item img:not([src])::after,
.banner-item img[src=""]::after {
    display: block;
}
}
</style>

</body>
</html>


